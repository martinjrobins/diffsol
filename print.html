<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DiffSol</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DiffSol</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="modelling-with-diffsol"><a class="header" href="#modelling-with-diffsol">Modelling with DiffSol</a></h1>
<p>Ordinary Differential Equations (ODEs) are a powerful tool for modelling a wide range of physical systems. Unlike purely data-driven models, ODEs are based on the underlying physics, biology, or chemistry of the system being modelled. This makes them particularly useful for predicting the behaviour of a system under conditions that have not been observed. In this section, we will introduce the basics of ODE modelling, and illustrate their use with a series of examples written using the DiffSol crate.</p>
<p>The topics covered in this section are:</p>
<ul>
<li>
<p><a href="primer/./primer/first_order_odes.html">First Order ODEs</a>: First order ODEs are the simplest type of ODE. Any ODE system can be written as a set of first order ODEs, so libraries like DiffSol are designed such that the user provides their equations in this form.</p>
<ul>
<li><a href="primer/./primer/population_dynamics.html">Example: Population Dynamics</a>: A simple example of a first order ODE system, modelling the interaction of predator and prey populations.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/higher_order_odes.html">Higher Order ODEs</a>: Higher order ODEs are equations that involve derivatives of order greater than one. These can be converted to a system of first order ODEs, which is the form that DiffSol expects.</p>
<ul>
<li><a href="primer/./primer/spring_mass_systems.html">Example: Spring-mass systems</a>: A simple example of a higher order ODE system, modelling the motion of a damped spring-mass system.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/discrete_events.html">Discrete Events</a>: Discrete events are events that occur at specific times or when the system is in a particular state, rather than continuously. These can be modelled by treating the events as changes in the ODE system's state. DiffSol provides an API to detect and handle these events.</p>
<ul>
<li><a href="primer/./primer/compartmental_models_of_drug_delivery.html">Example: Compartmental models of Drug Delivery</a>: Pharmacokinetic models describe how a drug is absorbed, distributed, metabolised, and excreted by the body. They are a common example of systems with discrete events, as the drug is often administered at discrete times.</li>
<li><a href="primer/./primer/bouncing_ball.html">Example: Bouncing Ball</a>: A simple example of a system where the discrete event occurs when the ball hits the ground, instead of at a specific time.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/the_mass_matrix.html">DAEs via the Mass Matrix</a>: Differential Algebraic Equations (DAEs) are a generalisation of ODEs that include algebraic equations as well as differential equations. DiffSol can solve DAEs by treating them as ODEs with a mass matrix. This section explains how to use the mass matrix to solve DAEs.</p>
<ul>
<li><a href="primer/./primer/electrical_circuits.html">Example: Electrical Circuits</a>: Electrical circuits are a common example of DAEs, here we will model a simple low-pass LRC filter circuit.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/pdes.html">PDEs</a>: Partial Differential Equations (PDEs) are a generalisation of ODEs that involve derivatives with respect to more than one variable (e.g. a spatial variable). DiffSol can be used to solver PDEs using the method of lines, where the spatial derivatives are discretised to form a system of ODEs.</p>
<ul>
<li><a href="primer/./primer/heat_equation.html">Example: Heat Equation</a>: The heat equation describes how heat diffuses in a domain over time. We will solve the heat equation in a 1D domain with Dirichlet boundary conditions.</li>
<li><a href="primer/./primer/physics_based_battery_simulation.html">Example: Physics-based Battery Simulation</a>: A more complex example of a PDE system, modelling the charge and discharge of a lithium-ion battery. For this example we will use the PyBaMM library to form the ODE system, and DiffSol to solve it.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/forward_sensitivity_analysis.html">Forward Sensitivity Analysis</a>: Sensitivity analysis is a technique used to determine how the output of a model changes with respect to changes in the model parameters. Forward sensitivity analysis calculates the sensitivity of the model output with respect to the parameters by solving the ODE system and the sensitivity equations simultaneously.</p>
<ul>
<li><a href="primer/./primer/population_dynamics_fitting.html">Example: Fitting a predator-prey model to data</a>: An example of fitting a predator-prey model to synthetic data using forward sensitivity analysis.</li>
</ul>
</li>
<li>
<p><a href="primer/./primer/backwards_sensitivity_analysis.html">Backwards Sensitivity Analysis</a>: Backwards sensitivity analysis calculates the sensitivity of a loss function with respect to the parameters by first solving the ODE system and then the adjoint equations backwards in time. This is useful if your model has a high number of parameters, as it can be more efficient than forward sensitivity analysis.</p>
<ul>
<li><a href="primer/./primer/spring_mass_fitting.html">Example: Fitting a spring-mass model to data</a>: An example of fitting a spring-mass model to synthetic data using backwards sensitivity analysis.</li>
<li><a href="primer/./primer/weather_neural_ode.html">Example: Weather prediction using neural ODEs</a>: An example of fitting a neural ODE to weather data using backwards sensitivity analysis.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="explicit-first-order-odes"><a class="header" href="#explicit-first-order-odes">Explicit First Order ODEs</a></h1>
<p>Ordinary Differential Equations (ODEs) are often called rate equations because they describe how the <em>rate of change</em> of a system depends on its current <em>state</em>. For example, lets assume we wish to model the growth of a population of cells within a petri dish. We could define the <em>state</em> of the system as the concentration of cells in the dish, and assign this state to a variable \(c\). The <em>rate of change</em> of the system would then be the rate at which the concentration of cells changes with time, which we could denote as \(\frac{dc}{dt}\). We know that our cells will grow at a rate proportional to the current concentration of cells, so this can be written as:</p>
<p>\[
\frac{dc}{dt} = k c
\]</p>
<p>where \(k\) is a constant that describes the growth rate of the cells. This is a first order ODE, because it involves only the first derivative of the state variable \(c\) with respect to time.</p>
<p>We can extend this further to solve multiple equations simultaineously, in order to model the rate of change of more than one quantity. For example, say we had <em>two</em> populations of cells in the same dish that grow with different rates. We could define the state of the system as the concentrations of the two cell populations, and assign these states to variables \(c_1\) and \(c_2\). could then write down both equations as:</p>
<p>\[
\begin{align*}
\frac{dc_1}{dt} &amp;= k_1 c_1  \\
\frac{dc_2}{dt} &amp;= k_2 c_2
\end{align*}
\]</p>
<p>and then combine them in a vector form as:</p>
<p>\[
\begin{bmatrix}
\frac{dc_1}{dt} \\
\frac{dc_2}{dt}
\end{bmatrix} = \begin{bmatrix}
k_1 c_1 \\
k_2 c_2
\end{bmatrix}
\]</p>
<p>By defining a new <em>vector</em> of state variables \(\mathbf{y} = [c_1, c_2]\) and a vector valued function \(\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} k_1 c_1 \\ k_2 c_2 \end{bmatrix}\), we are left with the standard form of a <em>explicit</em> first order ODE system:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>This is an explicit equation for the derivative of the state, \(\frac{d\mathbf{y}}{dt}\), as a function of only of the state variables \(\mathbf{y}\) and of time \(t\).</p>
<p>We need one more piece of information to solve this system of ODEs: the initial conditions for the populations at time \(t = 0\). For example, if we started with a concentration of 10 for the first population and 5 for the second population, we would write:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} 10 \\ 5 \end{bmatrix}
\]</p>
<p>Many ODE solver libraries, like DiffSol, require users to provide their ODEs in the form of a set of explicit first order ODEs. Given both the system of ODEs and the initial conditions, the solver can then integrate the equations forward in time to find the solution \(\mathbf{y}(t)\). This is the general process for solving ODEs, so it is important to know how to translate your problem into a set of first order ODEs, and thus to the general form of a explicit first order ODE system shown above. In the next two sections, we will look at an example of a first order ODE system in the area of population dynamics, and then solve it using DiffSol.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="population-dynamics---predator-prey-model"><a class="header" href="#population-dynamics---predator-prey-model">Population Dynamics - Predator-Prey Model</a></h1>
<p>In this example, we will model the population dynamics of a predator-prey system using a set of first order ODEs. The <a href="https://en.wikipedia.org/wiki/Lotka%E2%80%93Volterra_equations">Lotka-Volterra equations</a> are a classic example of a predator-prey model, and describe the interactions between two species in an ecosystem. The first species is a prey species, which we will call \(x\), and the second species is a predator species, which we will call \(y\).</p>
<p>The rate of change of the prey population is governed by two terms: growth and predation. The growth term represents the natural increase in the prey population in the absence of predators, and is proportional to the current population of prey. The predation term represents the rate at which the predators consume the prey, and is proportional to the product of the prey and predator populations. The rate of change of the prey population can be written as:</p>
<p>\[
\frac{dx}{dt} = a x - b x y
\]</p>
<p>where \(a\) is the growth rate of the prey population, and \(b\) is the predation rate.</p>
<p>The rate of change of the predator population is also governed by two terms: death and growth. The death term represents the natural decrease in the predator population in the absence of prey, and is proportional to the current population of predators. The growth term represents the rate at which the predators reproduce, and is proportional to the product of the prey and predator populations, since the predators need to consume the prey to reproduce. The rate of change of the predator population can be written as:</p>
<p>\[
\frac{dy}{dt} = c x y - d y
\]</p>
<p>where \(c\) is the reproduction rate of the predators, and \(d\) is the death rate.</p>
<p>The Lotka-Volterra equations are a simple model of predator-prey dynamics, and make several assumptions that may not hold in real ecosystems. For example, the model assumes that the prey population grows exponentially in the absence of predators, that the predator population decreases linearly in the absence of prey, and that the spatial distribution of the species has no effect. Despite these simplifications, the Lotka-Volterra equations capture some of the essential features of predator-prey interactions, such as oscillations in the populations and the dependence of each species on the other. When modelling with ODEs, it is important to consider the simplest model that captures the behaviour of interest, and to be aware of the assumptions that underlie the model.</p>
<p>Putting the two equations together, we have a system of two first order ODEs:</p>
<p>\[
\frac{x}{dt} = a x - b x y \\
\frac{y}{dt} = c x y - d y
\]</p>
<p>which can be written in vector form as:</p>
<p>\[
\begin{bmatrix}
\frac{dx}{dt} \\
\frac{dy}{dt}
\end{bmatrix} = \begin{bmatrix}
a x - b x y \\
c x y - d y
\end{bmatrix}
\]</p>
<p>or in the general form of a first order ODE system:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>where</p>
<p>\[\mathbf{y} = \begin{bmatrix} x \\ y \end{bmatrix} \]</p>
<p>and</p>
<p>\[\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} a x - b x y \\ c x y - d y \end{bmatrix}\]</p>
<p>We also have initial conditions for the populations at time \(t = 0\). We can set both populations to 1 at the start like so:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} 1 \\ 1 \end{bmatrix}
\]</p>
<p>Let's solve this system of ODEs using the DiffSol crate. We will use the <a href="https://martinjrobins.github.io/diffsl/">DiffSL</a> domain-specific language to specify the problem. We could have also used <a href="primer/specify/ode_equations.html">Rust closures</a>, but this allows us to illustrate the modelling process with a minimum of Rust syntax.</p>
<pre><code class="language-rust ignore">use diffsol::{CraneliftModule, DiffSl, OdeBuilder, OdeEquations, OdeSolverMethod};
use plotly::{common::Mode, layout::Axis, layout::Layout, Plot, Scatter};
use std::fs;
type M = nalgebra::DMatrix&lt;f64&gt;;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
type CG = CraneliftModule;

fn main() {
    solve();
    phase_plane();
}

fn solve() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
    a { 2.0/3.0 } b { 4.0/3.0 } c { 1.0 } d { 1.0 }
    u_i {
        y1 = 1,
        y2 = 1,
    }
    F_i {
        a * y1 - b * y1 * y2,
        c * y1 * y2 - d * y2,
    }
",
    )
    .unwrap();
    let problem = OdeBuilder::&lt;M&gt;::new().build_from_eqn(eqn).unwrap();
    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let (ys, ts) = solver.solve(40.0).unwrap();

    let prey: Vec&lt;_&gt; = ys.row(0).into_iter().copied().collect();
    let predator: Vec&lt;_&gt; = ys.row(1).into_iter().copied().collect();
    let time: Vec&lt;_&gt; = ts.into_iter().collect();

    let prey = Scatter::new(time.clone(), prey)
        .mode(Mode::Lines)
        .name("Prey");
    let predator = Scatter::new(time, predator)
        .mode(Mode::Lines)
        .name("Predator");

    let mut plot = Plot::new();
    plot.add_trace(prey);
    plot.add_trace(predator);

    let layout = Layout::new()
        .x_axis(Axis::new().title("t"))
        .y_axis(Axis::new().title("population"));
    plot.set_layout(layout);
    let plot_html = plot.to_inline_html(Some("prey-predator"));
    fs::write("book/src/primer/images/prey-predator.html", plot_html)
        .expect("Unable to write file");</code></pre>
<div id="prey-predator" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("prey-predator", {"data":[{"type":"scatter","name":"Prey","mode":"lines","x":[0.0,0.0001878853488829644,0.0003757706977659288,0.000770329930420154,0.0011648891630743792,0.0015594483957286046,0.0023880227843024776,0.0032165971728763507,0.004045171561450223,0.005785177777455357,0.0075251839934604905,0.009265190209465625,0.012919203263076405,0.016573216316687185,0.020227229370297965,0.023881242423908745,0.031554669836491384,0.03922809724907402,0.04690152466165666,0.0545749520742393,0.07068914964066284,0.08680334720708638,0.10291754477350992,0.11903174233993347,0.135145939906357,0.16898575479584646,0.2028255696853359,0.23666538457482536,0.2705051994643148,0.30434501435380423,0.37540862562173205,0.44647223688965987,0.5175358481575877,0.5885994594255155,0.6596630706934433,0.7307266819613711,0.801790293229299,0.8728539044972268,0.9439175157651546,1.0149811270330824,1.0860447383010103,1.1571083495689383,1.2281719608368662,1.2992355721047941,1.370299183372722,1.44136279464065,1.512426405908578,1.5834900171765058,1.6545536284444338,1.7991961753895858,1.9438387223347378,2.0884812692798898,2.2331238162250417,2.3777663631701937,2.5224089101153457,2.6670514570604977,2.8116940040056497,2.9563365509508017,3.1009790978959537,3.2456216448411057,3.3902641917862577,3.5349067387314097,3.6795492856765617,3.8241918326217137,3.9688343795668657,4.113476926512018,4.25811947345717,4.402762020402323,4.547404567347475,4.692047114292627,4.83668966123778,4.981332208182932,5.125974755128085,5.270617302073237,5.41525984901839,5.559902395963542,5.7045449429086945,5.849187489853847,5.993830036798999,6.102367349878065,6.210904662957131,6.319441976036197,6.427979289115263,6.536516602194329,6.645053915273395,6.737815460778981,6.8305770062845665,6.9233385517901525,7.016100097295738,7.108861642801324,7.20162318830691,7.277034801966158,7.352446415625406,7.427858029284653,7.503269642943901,7.578681256603149,7.654092870262397,7.7295044839216445,7.804916097580892,7.88032771124014,7.955739324899388,8.031150938558635,8.107043735763774,8.182936532968913,8.258829330174052,8.334722127379191,8.41061492458433,8.492985249278702,8.575355573973074,8.657725898667445,8.740096223361817,8.82246654805619,8.904836872750561,8.987207197444933,9.069577522139305,9.151947846833677,9.234318171528049,9.31668849622242,9.399058820916792,9.481429145611164,9.563799470305536,9.646169794999908,9.72854011969428,9.810910444388652,9.893280769083024,9.975651093777396,10.058021418471768,10.14039174316614,10.222762067860511,10.305132392554883,10.387502717249255,10.469873041943627,10.552243366637999,10.63461369133237,10.716984016026743,10.799354340721115,10.881724665415486,11.046556109528849,11.211387553642211,11.376218997755574,11.541050441868936,11.705881885982299,11.870713330095661,12.035544774209024,12.200376218322386,12.365207662435749,12.530039106549111,12.694870550662474,12.859701994775836,13.024533438889199,13.189364883002561,13.354196327115924,13.519027771229286,13.683859215342649,13.848690659456011,13.980027416450215,14.111364173444418,14.20545344695306,14.299542720461702,14.393631993970343,14.487721267478985,14.581810540987627,14.675899814496269,14.76998908800491,14.864078361513553,14.958167635022194,15.052256908530836,15.135246127846514,15.218235347162192,15.30122456647787,15.384213785793548,15.467203005109226,15.550192224424904,15.633181443740582,15.71617066305626,15.799159882371939,15.882149101687617,15.956752220895607,16.031355340103598,16.10595845931159,16.180561578519583,16.255164697727576,16.32976781693557,16.40437093614356,16.478974055351554,16.553577174559546,16.62818029376754,16.70278341297553,16.777386532183524,16.851989651391516,16.92659277059951,17.0011958898075,17.075799009015494,17.150402128223487,17.22500524743148,17.29960836663947,17.374211485847464,17.448814605055457,17.52341772426345,17.598020843471442,17.672623962679435,17.747227081887427,17.82183020109542,17.896433320303412,17.971036439511405,18.045639558719397,18.12024267792739,18.194845797135383,18.269448916343375,18.344052035551368,18.41865515475936,18.493258273967353,18.64346614122167,18.793674008475985,18.943881875730302,19.094089742984618,19.244297610238934,19.39450547749325,19.544713344747567,19.694921212001884,19.8451290792562,19.995336946510516,20.145544813764833,20.29575268101915,20.445960548273465,20.59616841552778,20.746376282782098,20.896584150036414,21.04679201729073,21.196999884545047,21.347207751799363,21.49741561905368,21.647623486307996,21.797831353562312,21.94803922081663,22.06669381746252,22.185348414108415,22.304003010754307,22.39972003377019,22.495437056786074,22.591154079801957,22.68687110281784,22.782588125833723,22.878305148849606,22.97402217186549,23.06973919488137,23.153287249280734,23.236835303680095,23.320383358079457,23.40393141247882,23.48747946687818,23.571027521277543,23.654575575676905,23.738123630076267,23.82167168447563,23.90521973887499,23.979971395780975,24.05472305268696,24.129474709592944,24.20422636649893,24.278978023404914,24.3537296803109,24.428481337216883,24.503232994122868,24.577984651028853,24.652736307934838,24.727487964840822,24.802239621746807,24.876991278652792,24.951742935558777,25.02649459246476,25.101246249370746,25.17599790627673,25.250749563182715,25.3255012200887,25.400252876994685,25.47500453390067,25.549756190806654,25.62450784771264,25.699259504618624,25.77401116152461,25.848762818430593,25.923514475336578,25.998266132242563,26.073017789148548,26.147769446054532,26.222521102960517,26.2972727598665,26.372024416772486,26.44677607367847,26.521527730584456,26.67176665820358,26.822005585822705,26.97224451344183,27.122483441060954,27.27272236868008,27.422961296299203,27.573200223918327,27.723439151537452,27.873678079156576,28.0239170067757,28.174155934394825,28.32439486201395,28.474633789633074,28.6248727172522,28.775111644871323,28.925350572490448,29.075589500109572,29.225828427728697,29.37606735534782,29.526306282966946,29.67654521058607,29.826784138205195,29.97702306582432,30.095458841459074,30.21389461709383,30.332330392728583,30.427991033104767,30.523651673480952,30.619312313857137,30.71497295423332,30.810633594609506,30.90629423498569,31.001954875361875,31.09761551573806,31.181067280121802,31.264519044505544,31.347970808889286,31.43142257327303,31.51487433765677,31.598326102040513,31.681777866424255,31.765229630807998,31.84868139519174,31.932133159575482,32.006871404826676,32.081609650077866,32.156347895329056,32.231086140580246,32.305824385831436,32.380562631082626,32.455300876333816,32.530039121585006,32.604777366836196,32.679515612087386,32.754253857338576,32.828992102589766,32.903730347840956,32.978468593092146,33.053206838343336,33.127945083594525,33.202683328845715,33.277421574096905,33.352159819348095,33.426898064599285,33.501636309850475,33.576374555101665,33.651112800352855,33.725851045604045,33.800589290855235,33.875327536106425,33.950065781357615,34.024804026608805,34.099542271859995,34.174280517111185,34.249018762362375,34.323757007613565,34.398495252864755,34.473233498115945,34.547971743367135,34.69820366153861,34.84843557971008,34.99866749788155,35.14889941605302,35.29913133422449,35.44936325239596,35.59959517056743,35.749827088738904,35.900059006910375,36.050290925081846,36.20052284325332,36.35075476142479,36.50098667959626,36.65121859776773,36.8014505159392,36.95168243411067,37.101914352282144,37.252146270453615,37.402378188625086,37.55261010679656,37.70284202496803,37.8530739431395,38.00330586131097,38.12178244578699,38.24025903026301,38.35873561473903,38.45440543651417,38.55007525828931,38.64574508006445,38.74141490183959,38.83708472361473,38.93275454538987,39.02842436716501,39.12409418894015,39.20756318131114,39.291032173682126,39.374501166053115,39.457970158424104,39.54143915079509,39.62490814316608,39.70837713553707,39.79184612790806,39.87531512027905,39.95878411265004,40.0],"y":[1.0,0.9998747431007446,0.9997495126869005,0.9994865983245752,0.9992237210303021,0.9989609219885746,0.9984092662069921,0.9978579190324182,0.9973068772128695,0.9961506858380855,0.9949958508829877,0.9938423752680023,0.9914245162082755,0.9890126858750552,0.9866069171556474,0.9842072347975981,0.979187830913809,0.9741956163133451,0.9692308141299637,0.9642936402944485,0.954016405330207,0.9438637145010668,0.9338371687989497,0.923938223653656,0.9141681696165339,0.8940754481034088,0.8745643658454791,0.8556407267947496,0.8373078225282337,0.8195666226975682,0.7842292848587918,0.7514590514812235,0.7211933960569882,0.6933480714080964,0.6678244419742204,0.6445144488872342,0.6233049323978089,0.6040811008892494,0.5867292228590828,0.5711386498421663,0.5572032824836018,0.5448225794023508,0.533902196881197,0.5243543389368545,0.5160978867842599,0.5090583638371149,0.503167780864586,0.4983643973246675,0.4945924278536425,0.4898986157305457,0.48891835337197503,0.49137220461973324,0.4970490166329218,0.505795980396245,0.5175087651446592,0.5321235942339823,0.549611309318098,0.5699722721122006,0.5932313702097591,0.6194331932596513,0.6486375636950233,0.6809152255339871,0.716343251204078,0.7549997995656603,0.7969579902517925,0.8422786390643745,0.8910014674486499,0.9431342852492056,0.9986395878506292,1.0574179609493364,1.119287621123014,1.183959374377134,1.2510063228119763,1.3198278809723931,1.3896082005146222,1.4592701371020131,1.527427707527354,1.5923429179488795,1.6518971872985617,1.691585724354489,1.7256774878937378,1.7529120341353805,1.7720046041722584,1.7817091760319201,1.7809017721717078,1.7712013532999868,1.7527895378303098,1.7255300338871409,1.6895614057231698,1.6453196012444735,1.5935366128825106,1.5465590729858696,1.495915086806834,1.4423376057388722,1.3865991062691794,1.3294841935920165,1.2717640685737548,1.2141685894859626,1.157360791368751,1.1019192945291336,1.0483293298440195,0.9969801006932737,0.9478674352499132,0.901524359028508,0.8580901126678216,0.8176226098635475,0.7801229653206321,0.742738454422017,0.7086739305688194,0.6778094600051318,0.649975074079749,0.6249988118101174,0.6027042798857812,0.582914327385284,0.5654567019201714,0.5501685486811644,0.5368982249641395,0.525505544688649,0.5158619233606018,0.5078506642882226,0.5013669146196095,0.4963171177830236,0.4926182340490718,0.4901970029197726,0.48898927831430283,0.4889393534068184,0.48999925471477085,0.4921280571484413,0.4952912621971216,0.4994602366733424,0.5046116925339192,0.5107272010196845,0.5177927460037854,0.5257983186736673,0.5347375480955237,0.5446073600765141,0.555407659349617,0.5798268288301128,0.6080326718495639,0.6401036467922041,0.6761395554755691,0.7162525657882928,0.7605578506903181,0.8091622803024376,0.8621501587644769,0.9195653293894127,0.981388662835483,1.0475094591582912,1.117689023777759,1.1915146256474534,1.2683421860794626,1.347226613423537,1.4268402126286546,1.5053828332449133,1.580493419234518,1.6359159024916374,1.6854750001129113,1.71625321558969,1.7421632208728854,1.7623660468163946,1.7760303241566016,1.7823662705735432,1.7806680802195918,1.7703677631917827,1.751093168030511,1.7227211345724505,1.6854189132998099,1.645477937137365,1.5994932044427872,1.548179423648262,1.4923980412493827,1.433119587079319,1.3713789781245136,1.308225606228795,1.2446738722279407,1.1816603636765775,1.1200114726205879,1.066335915621878,1.0147345952269153,0.9655225664711053,0.9189295769045108,0.8751068194430625,0.8341351314990569,0.7960358178942426,0.7607824567427245,0.7283117076513963,0.69853251813195,0.6713340878821211,0.6465928517203076,0.6241783514416629,0.6039578468139103,0.5857997676374023,0.5695762624344654,0.5551650531009317,0.5424507077691096,0.5313254161847601,0.521689373434723,0.513450883448174,0.5065262675596791,0.5008396328978573,0.49632254056315733,0.4929136096288296,0.4905580879040541,0.4892074113490849,0.4888187656261263,0.4893546585887206,0.49078251033420006,0.49307426549890937,0.4962060302103731,0.5001577342412107,0.5049128178708915,0.5104579424671559,0.523979853599261,0.5406121086981193,0.5603396629503516,0.5831782684612936,0.6091684756916012,0.6383707125991954,0.6708603410045246,0.7067220871346279,0.7460437799226685,0.7889092763722084,0.8353901399530628,0.8855354667874366,0.9393592358709948,0.9968245276798411,1.0578238476738497,1.1221546676877348,1.1894892408969098,1.2593378255174859,1.3310047728904897,1.4035376862585784,1.4756713382871778,1.545770665534518,1.6117814246038942,1.6594130997414462,1.7015207146298497,1.736533750603863,1.7584859240641775,1.773859900863091,1.781804820743234,1.7815566495685653,1.7724921075720521,1.7541850505457317,1.7264648426565603,1.6894665936193514,1.649944435052287,1.604231557530226,1.5530404104839608,1.4972369575946365,1.4378031975402739,1.3757917205143604,1.3122740919419298,1.248289249469938,1.1847986383992268,1.1226521109466543,1.0687794096364436,1.0169723882424604,0.9675520686864738,0.9207531954646001,0.8767310611630711,0.8355695692786143,0.7972921307352728,0.7618736487373476,0.7292514917491073,0.6993348157573664,0.6720126284879666,0.6471608792161648,0.6246484327847495,0.6043417599456946,0.5861084443206557,0.5698197711447932,0.5553526138396139,0.5425907308914585,0.5314255563301926,0.5217565911722422,0.5134915101780737,0.5065460711763082,0.5008438823099381,0.49631606740777356,0.4929008660615121,0.49054320000906776,0.48919422812356644,0.48881090362161334,0.48935554233933704,0.4907954087802869,0.4931023246997679,0.4962523026742729,0.5002252051857231,0.5050044286975819,0.5105766117121973,0.5241348797163042,0.5408044182924546,0.5605705481158196,0.5834493453112326,0.6094816448821876,0.6387281177954294,0.6712643202437389,0.7071751130309537,0.7465483847556778,0.7894679566043802,0.8360052327450884,0.8862089893020771,0.9400926763177666,0.9976185747804869,1.0586780426109388,1.1230669601508991,1.1904554294061602,1.2603508631887883,1.3320539257006931,1.404607545835835,1.476740721716393,1.5468114894603593,1.6127577300823468,1.66021531693067,1.7021430242681914,1.7369768469714544,1.758813905123053,1.774066001538655,1.7818846580802343,1.7815088213540902,1.7723187712711554,1.7538923804633413,1.7260632239776297,1.688970460873305,1.6494044478292307,1.6036697827540447,1.5524786624041074,1.4966956749742077,1.43730043049987,1.375342341285959,1.3118892834009326,1.2479762980005211,1.1845610289236477,1.1224898832429,1.0686307614423243,1.0168377489810871,0.9674314722042217,0.9206463297518569,0.8766373326817652,0.8354881852660399,0.7972221733596628,0.7618141284505,0.7292013858199617,0.6992931005882627,0.6719783069140076,0.6471329999787078,0.6246261016187208,0.6043241447825705,0.5860947772518348,0.5698093481945122,0.5553447926813988,0.5425849268758772,0.5314212375798686,0.521753273396292,0.5134887514901832,0.5065434669890653,0.5008410603861211,0.49631268319196953,0.49289659837973737,0.490537747151502,0.4891873042866572,0.4888022356878157,0.48934486698154234,0.49078246987401974,0.49308687101678184,0.49623408582798556,0.5002039778027684,0.5049799427944651,0.5105486172584087,0.5241010694447735,0.5407645505339599,0.5605243282851828,0.58339643138157,0.6094216531363955,0.6386606294240249,0.6711888895197201,0.707091277760846,0.7464556797889288,0.7893659314354597,0.8358934745575537,0.8860871531251218,0.9399605243243483,0.9974760271825317,1.0585252430719894,1.1229043590498782,1.1902838884923266,1.260171784895466,1.3318694091560324,1.4044205686323499,1.4765553405774974,1.5466330424421497,1.6125930060655829,1.6600847601475357,1.7020476048042026,1.7369162413012085,1.758775446992624,1.774050909403517,1.7818936831802847,1.7815421322177942,1.772375842220511,1.753971903972649,1.7261630745505878,1.6890877284793753,1.6495292862427462,1.603797825650984,1.5526056011099016,1.4968174784590396,1.4374135437800584,1.3754438399071296,1.3119769734526225,1.2480487564434368,1.1846175846302214,1.1225305467263607,1.092601232065255]},{"type":"scatter","name":"Predator","mode":"lines","x":[0.0,0.0001878853488829644,0.0003757706977659288,0.000770329930420154,0.0011648891630743792,0.0015594483957286046,0.0023880227843024776,0.0032165971728763507,0.004045171561450223,0.005785177777455357,0.0075251839934604905,0.009265190209465625,0.012919203263076405,0.016573216316687185,0.020227229370297965,0.023881242423908745,0.031554669836491384,0.03922809724907402,0.04690152466165666,0.0545749520742393,0.07068914964066284,0.08680334720708638,0.10291754477350992,0.11903174233993347,0.135145939906357,0.16898575479584646,0.2028255696853359,0.23666538457482536,0.2705051994643148,0.30434501435380423,0.37540862562173205,0.44647223688965987,0.5175358481575877,0.5885994594255155,0.6596630706934433,0.7307266819613711,0.801790293229299,0.8728539044972268,0.9439175157651546,1.0149811270330824,1.0860447383010103,1.1571083495689383,1.2281719608368662,1.2992355721047941,1.370299183372722,1.44136279464065,1.512426405908578,1.5834900171765058,1.6545536284444338,1.7991961753895858,1.9438387223347378,2.0884812692798898,2.2331238162250417,2.3777663631701937,2.5224089101153457,2.6670514570604977,2.8116940040056497,2.9563365509508017,3.1009790978959537,3.2456216448411057,3.3902641917862577,3.5349067387314097,3.6795492856765617,3.8241918326217137,3.9688343795668657,4.113476926512018,4.25811947345717,4.402762020402323,4.547404567347475,4.692047114292627,4.83668966123778,4.981332208182932,5.125974755128085,5.270617302073237,5.41525984901839,5.559902395963542,5.7045449429086945,5.849187489853847,5.993830036798999,6.102367349878065,6.210904662957131,6.319441976036197,6.427979289115263,6.536516602194329,6.645053915273395,6.737815460778981,6.8305770062845665,6.9233385517901525,7.016100097295738,7.108861642801324,7.20162318830691,7.277034801966158,7.352446415625406,7.427858029284653,7.503269642943901,7.578681256603149,7.654092870262397,7.7295044839216445,7.804916097580892,7.88032771124014,7.955739324899388,8.031150938558635,8.107043735763774,8.182936532968913,8.258829330174052,8.334722127379191,8.41061492458433,8.492985249278702,8.575355573973074,8.657725898667445,8.740096223361817,8.82246654805619,8.904836872750561,8.987207197444933,9.069577522139305,9.151947846833677,9.234318171528049,9.31668849622242,9.399058820916792,9.481429145611164,9.563799470305536,9.646169794999908,9.72854011969428,9.810910444388652,9.893280769083024,9.975651093777396,10.058021418471768,10.14039174316614,10.222762067860511,10.305132392554883,10.387502717249255,10.469873041943627,10.552243366637999,10.63461369133237,10.716984016026743,10.799354340721115,10.881724665415486,11.046556109528849,11.211387553642211,11.376218997755574,11.541050441868936,11.705881885982299,11.870713330095661,12.035544774209024,12.200376218322386,12.365207662435749,12.530039106549111,12.694870550662474,12.859701994775836,13.024533438889199,13.189364883002561,13.354196327115924,13.519027771229286,13.683859215342649,13.848690659456011,13.980027416450215,14.111364173444418,14.20545344695306,14.299542720461702,14.393631993970343,14.487721267478985,14.581810540987627,14.675899814496269,14.76998908800491,14.864078361513553,14.958167635022194,15.052256908530836,15.135246127846514,15.218235347162192,15.30122456647787,15.384213785793548,15.467203005109226,15.550192224424904,15.633181443740582,15.71617066305626,15.799159882371939,15.882149101687617,15.956752220895607,16.031355340103598,16.10595845931159,16.180561578519583,16.255164697727576,16.32976781693557,16.40437093614356,16.478974055351554,16.553577174559546,16.62818029376754,16.70278341297553,16.777386532183524,16.851989651391516,16.92659277059951,17.0011958898075,17.075799009015494,17.150402128223487,17.22500524743148,17.29960836663947,17.374211485847464,17.448814605055457,17.52341772426345,17.598020843471442,17.672623962679435,17.747227081887427,17.82183020109542,17.896433320303412,17.971036439511405,18.045639558719397,18.12024267792739,18.194845797135383,18.269448916343375,18.344052035551368,18.41865515475936,18.493258273967353,18.64346614122167,18.793674008475985,18.943881875730302,19.094089742984618,19.244297610238934,19.39450547749325,19.544713344747567,19.694921212001884,19.8451290792562,19.995336946510516,20.145544813764833,20.29575268101915,20.445960548273465,20.59616841552778,20.746376282782098,20.896584150036414,21.04679201729073,21.196999884545047,21.347207751799363,21.49741561905368,21.647623486307996,21.797831353562312,21.94803922081663,22.06669381746252,22.185348414108415,22.304003010754307,22.39972003377019,22.495437056786074,22.591154079801957,22.68687110281784,22.782588125833723,22.878305148849606,22.97402217186549,23.06973919488137,23.153287249280734,23.236835303680095,23.320383358079457,23.40393141247882,23.48747946687818,23.571027521277543,23.654575575676905,23.738123630076267,23.82167168447563,23.90521973887499,23.979971395780975,24.05472305268696,24.129474709592944,24.20422636649893,24.278978023404914,24.3537296803109,24.428481337216883,24.503232994122868,24.577984651028853,24.652736307934838,24.727487964840822,24.802239621746807,24.876991278652792,24.951742935558777,25.02649459246476,25.101246249370746,25.17599790627673,25.250749563182715,25.3255012200887,25.400252876994685,25.47500453390067,25.549756190806654,25.62450784771264,25.699259504618624,25.77401116152461,25.848762818430593,25.923514475336578,25.998266132242563,26.073017789148548,26.147769446054532,26.222521102960517,26.2972727598665,26.372024416772486,26.44677607367847,26.521527730584456,26.67176665820358,26.822005585822705,26.97224451344183,27.122483441060954,27.27272236868008,27.422961296299203,27.573200223918327,27.723439151537452,27.873678079156576,28.0239170067757,28.174155934394825,28.32439486201395,28.474633789633074,28.6248727172522,28.775111644871323,28.925350572490448,29.075589500109572,29.225828427728697,29.37606735534782,29.526306282966946,29.67654521058607,29.826784138205195,29.97702306582432,30.095458841459074,30.21389461709383,30.332330392728583,30.427991033104767,30.523651673480952,30.619312313857137,30.71497295423332,30.810633594609506,30.90629423498569,31.001954875361875,31.09761551573806,31.181067280121802,31.264519044505544,31.347970808889286,31.43142257327303,31.51487433765677,31.598326102040513,31.681777866424255,31.765229630807998,31.84868139519174,31.932133159575482,32.006871404826676,32.081609650077866,32.156347895329056,32.231086140580246,32.305824385831436,32.380562631082626,32.455300876333816,32.530039121585006,32.604777366836196,32.679515612087386,32.754253857338576,32.828992102589766,32.903730347840956,32.978468593092146,33.053206838343336,33.127945083594525,33.202683328845715,33.277421574096905,33.352159819348095,33.426898064599285,33.501636309850475,33.576374555101665,33.651112800352855,33.725851045604045,33.800589290855235,33.875327536106425,33.950065781357615,34.024804026608805,34.099542271859995,34.174280517111185,34.249018762362375,34.323757007613565,34.398495252864755,34.473233498115945,34.547971743367135,34.69820366153861,34.84843557971008,34.99866749788155,35.14889941605302,35.29913133422449,35.44936325239596,35.59959517056743,35.749827088738904,35.900059006910375,36.050290925081846,36.20052284325332,36.35075476142479,36.50098667959626,36.65121859776773,36.8014505159392,36.95168243411067,37.101914352282144,37.252146270453615,37.402378188625086,37.55261010679656,37.70284202496803,37.8530739431395,38.00330586131097,38.12178244578699,38.24025903026301,38.35873561473903,38.45440543651417,38.55007525828931,38.64574508006445,38.74141490183959,38.83708472361473,38.93275454538987,39.02842436716501,39.12409418894015,39.20756318131114,39.291032173682126,39.374501166053115,39.457970158424104,39.54143915079509,39.62490814316608,39.70837713553707,39.79184612790806,39.87531512027905,39.95878411265004,40.0],"y":[1.0,1.0,0.9999999602844765,0.9999997727010445,0.999999529655254,0.9999991694976114,0.9999980807454262,0.9999965314501048,0.999994527186046,0.9999888339963283,0.9999811311263735,0.999971420609226,0.9999445055069007,0.9999087640360145,0.9998642244042266,0.9998109087208866,0.9996704841456721,0.9994916853479026,0.9992747441649329,0.9990198965797357,0.9983624174701636,0.9975411464477388,0.9965585090222228,0.9954170162046078,0.9941192731486538,0.9908974981467121,0.9870245758079437,0.9825275936606023,0.9774346831607108,0.9717748154994861,0.9581750143669537,0.9424824142866103,0.9249730840515158,0.9059174507611261,0.8855742613752663,0.8641876865181898,0.8419851632341886,0.8191758885435192,0.7959499866773978,0.7724783869750674,0.748913261222149,0.725388796258804,0.7020221605369605,0.6789146146580959,0.6561527312789078,0.6338096672636434,0.6119464290080237,0.590613095510346,0.5698499855402098,0.5294741356243424,0.49176029920524444,0.45678287710701526,0.42454248125295835,0.3949888452714105,0.3680367936020022,0.3435778800277273,0.32149024083594674,0.30164699391359295,0.28392258778359886,0.2681971883221117,0.2543598898775472,0.24231141780960525,0.2319665202618452,0.22325605908234938,0.2161289333156678,0.21055409295296446,0.2065228755670492,0.204051816060811,0.20318605270497508,0.2040034771903118,0.20661978488924965,0.21119453207711522,0.2179381916554137,0.227119996907027,0.23907600919009575,0.2542162370859678,0.2730286486887843,0.296076438699212,0.32398289137472547,0.34849678691245756,0.37637529008435583,0.40784768829712403,0.443071363040383,0.48209377207643617,0.5248088526398468,0.5640138951100083,0.6053612088319794,0.6483663890835357,0.6923925340845948,0.7366594993190027,0.7802692389121029,0.8145709655435992,0.8472506920567768,0.8777772034975485,0.9056560621708768,0.9304485564434731,0.9517861536448322,0.9693844664407203,0.9830534672320367,0.9927005304639809,0.9983265441062027,1.0000175283123602,0.9979164210254571,0.992211216870496,0.9831842804090675,0.9711412749982333,0.9564107000158688,0.9377616013291723,0.9167932558600997,0.8938962526938629,0.8694710067160392,0.8438777997631753,0.8174449252076372,0.790468914757086,0.7632125660475837,0.7359041946823993,0.7087395562661267,0.6818849929963077,0.6554801829446151,0.6296403715579904,0.6044587120844479,0.5800089037026919,0.5563477907871238,0.533517634804214,0.5115480847714345,0.49045798943569074,0.47025709038774127,0.45094754157942224,0.43252522249140885,0.4149808727652739,0.39830109107672196,0.38246921664419953,0.367466094314735,0.3532707292231552,0.33986084724032645,0.3272133779852153,0.31530487110655253,0.2936002878107086,0.2745785470498665,0.2580673284095789,0.24391275440481167,0.2319849419132815,0.22218077374295722,0.21442672287445977,0.208683146248652,0.2049496063335301,0.20327076417951118,0.20374333838111855,0.20652499148457013,0.21184558297544914,0.22002065222738967,0.2314665012673034,0.24671539691019292,0.26642758827914254,0.2913935982300715,0.31564018062503957,0.34427661725816006,0.3677515575105174,0.3938816847327763,0.4227908150937893,0.45454952702931967,0.48915575873004,0.5265129245912992,0.5664050464935263,0.6084738627507006,0.6522037148517297,0.6969181679394506,0.7365225148982962,0.7756045127004729,0.8134636612497735,0.8493815265124921,0.8826555978355954,0.9126330868939065,0.9387444141581718,0.9605320327622013,0.9776701356125996,0.9899734996623237,0.9968640898753249,0.9998662900619472,0.9991129619178317,0.9947986403666017,0.9871672099377155,0.9765001298494219,0.9631035881681964,0.9472960527698253,0.9293979700285403,0.9097239009092527,0.8885764316255744,0.8662414014111529,0.842984466049541,0.819049045508978,0.7946554387041481,0.7700007557944644,0.7452594114638124,0.7205840517715356,0.6961068199658739,0.6719408422350971,0.6481818149879728,0.6249096133680359,0.6021898782706168,0.5800755536835753,0.5586083480934372,0.5378200991574192,0.5177340315913982,0.498365907090345,0.4797250686046765,0.4618153820497744,0.44463607970962804,0.4281825114607615,0.4124468111809891,0.397418485824028,0.38308493424007084,0.35627434400182845,0.33209233521083076,0.31039783564205625,0.29104822835915023,0.27390661565256186,0.25884530131207545,0.2457483441164009,0.23451470669760083,0.22506145904865466,0.2173263341809053,0.21126991082817886,0.20687815961654674,0.20416576202320477,0.203180232140692,0.2040068742464904,0.20677478356672885,0.2116641143956792,0.21891463685217985,0.22883526622589895,0.2418137546641921,0.25832490245002937,0.27893424656906995,0.30429205038839063,0.32814084635608287,0.35575360829713554,0.38746749400386166,0.41622353333521406,0.4479165262167611,0.4825661248092586,0.5200918291479179,0.5602876279566423,0.6028001155029243,0.6471109926672962,0.6925296536075811,0.7324186341659132,0.771849310626755,0.8101106038354333,0.8464701333908282,0.8802085958523227,0.9106544719153408,0.9372190793032469,0.9594271127462267,0.9769377123153321,0.9895541777868101,0.9966449153604064,0.9998272798777692,0.9992317888225383,0.9950516692575342,0.9875303722585779,0.9769498216595863,0.9636174018381043,0.9478532670735046,0.9299798494565127,0.9103138762224833,0.8891601860285884,0.8668068603050416,0.8435217025067531,0.8195501315187772,0.7951142697257803,0.7704128626907922,0.7456217661314455,0.7208948731248004,0.6963653880763578,0.6721473262257843,0.6483371167413262,0.625015227155623,0.6022477661938708,0.5800880368415232,0.5585780129059562,0.5377497176568341,0.5176264942490627,0.49822416683897447,0.4795520948516239,0.46161412351343795,0.44440943492565566,0.42793330588312956,0.41217777993259747,0.3971322612746158,0.38278403768301694,0.35599648224336466,0.33183716443024863,0.3101648534109492,0.2908368559541597,0.27371626163972623,0.25867541294270896,0.24559845488173332,0.23438448284663654,0.22495074498590764,0.21723519839003172,0.21119869623073675,0.20682754246670654,0.20413682259720284,0.20317454031619966,0.2040265936319961,0.20682279805359138,0.21174417998806233,0.21903155885632805,0.22899509637934715,0.24202399253389703,0.2585946673449976,0.279274356589272,0.3047149008609068,0.32858566479156515,0.3562127784323955,0.3879309376329246,0.4167192491199531,0.44844211124601957,0.4831177775153909,0.5206641895389115,0.5608736697378504,0.6033911471183463,0.6476968455957863,0.6930990923264301,0.7329418005614169,0.7723183654049928,0.8105196034070786,0.846815543472686,0.880489638349832,0.9108732490178649,0.937380465031753,0.9595384270545487,0.9770082152995773,0.9895944442024293,0.9966726442118834,0.9998439662630707,0.9992390487098464,0.9950511847586238,0.9875238335219608,0.9769388571473937,0.9636035236730178,0.947837842152274,0.9299640867199381,0.9102988192035905,0.8891467092940057,0.8667956728769833,0.8435133583472654,0.8195450437387314,0.7951127255345816,0.7704150382858722,0.7456277417279185,0.7209046478679347,0.6963788940903135,0.6721644412655176,0.6483576754001499,0.6250390307842234,0.6022745916028007,0.5801176437769852,0.5586101503354233,0.5377841289858104,0.5176629216133977,0.49826235458706153,0.4795917923046707,0.46165508709101233,0.4444514297289901,0.427976106822392,0.41222117246956524,0.3971760418398304,0.3828280138198036,0.3560369339658229,0.3318741234407662,0.31019837164371716,0.2908669942710618,0.27374308050111806,0.25869896432707734,0.24561877462320658,0.23440158301433367,0.22496460612886043,0.2172457612950054,0.21120585263437988,0.20683112412662905,0.2041365881629074,0.20317015941909966,0.2040176275527077,0.2068086763425058,0.21172417262935705,0.2190047441005874,0.22896032544408954,0.24197985436502,0.2585394600980982,0.2792060780915125,0.30463127860485595,0.3284982935797078,0.3561232105567485,0.38784121736293353,0.41662374316443934,0.44834133339321797,0.4830125186232125,0.5205555479970122,0.5607630715066557,0.6032803442141108,0.6475878776551542,0.692994204502231,0.7328467588934265,0.7722347287439297,0.8104485534864624,0.8467577832639093,0.8804453231075966,0.9108419610585853,0.9373612342366676,0.9595297942285048,0.9770083311082836,0.9896011919497011,0.9939878701605112]}],"layout":{"xaxis":{"title":{"text":"t"}},"yaxis":{"title":{"text":"population"}}},"config":{}});
</script>
<p>A phase plane plot of the predator-prey system is a useful visualisation of the dynamics of the system. This plot shows the prey population on the x-axis and the predator population on the y-axis. Trajectories in the phase plane represent the evolution of the populations over time. Lets reframe the equations to introduce a new parameter \(y_0\) which is the initial predator and prey population. We can then plot the phase plane for different values of \(y_0\) to see how the system behaves for different initial conditions.</p>
<p>Our initial conditions are now:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} y_0 \\ y_0 \end{bmatrix}
\]</p>
<p>so we can solve this system for different values of \(y_0\) and plot the phase plane for each case. We will use similar code as above, but we will introduce our new parameter and loop over different values of \(y_0\)</p>
<pre><code class="language-rust ignore">
fn phase_plane() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
    in = [ y0 ]
    y0 { 1.0 }
    a { 2.0/3.0 } b { 4.0/3.0 } c { 1.0 } d { 1.0 }
    u_i {
        y1 = y0,
        y2 = y0,
    }
    F_i {
        a * y1 - b * y1 * y2,
        c * y1 * y2 - d * y2,
    }
",
    )
    .unwrap();

    let mut problem = OdeBuilder::&lt;M&gt;::new().p([1.0]).build_from_eqn(eqn).unwrap();

    let mut plot = Plot::new();
    for y0 in (1..6).map(f64::from) {
        let p = nalgebra::DVector::from_element(1, y0);
        problem.eqn_mut().set_params(&amp;p);

        let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
        let (ys, _ts) = solver.solve(40.0).unwrap();

        let prey: Vec&lt;_&gt; = ys.row(0).into_iter().copied().collect();
        let predator: Vec&lt;_&gt; = ys.row(1).into_iter().copied().collect();

        let phase = Scatter::new(prey, predator)
            .mode(Mode::Lines)
            .name(format!("y0 = {}", y0));
        plot.add_trace(phase);
    }

    let layout = Layout::new()
        .x_axis(Axis::new().title("x"))
        .y_axis(Axis::new().title("y"));
    plot.set_layout(layout);
    let plot_html = plot.to_inline_html(Some("prey-predator2"));
    fs::write("book/src/primer/images/prey-predator2.html", plot_html)</code></pre>
<div id="prey-predator2" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("prey-predator2", {"data":[{"type":"scatter","name":"y0 = 1","mode":"lines","x":[1.0,0.9998747431007446,0.9997495126869005,0.9994865983245752,0.9992237210303021,0.9989609219885746,0.9984092662069921,0.9978579190324182,0.9973068772128695,0.9961506858380855,0.9949958508829877,0.9938423752680023,0.9914245162082755,0.9890126858750552,0.9866069171556474,0.9842072347975981,0.979187830913809,0.9741956163133451,0.9692308141299637,0.9642936402944485,0.954016405330207,0.9438637145010668,0.9338371687989497,0.923938223653656,0.9141681696165339,0.8940754481034088,0.8745643658454791,0.8556407267947496,0.8373078225282337,0.8195666226975682,0.7842292848587918,0.7514590514812235,0.7211933960569882,0.6933480714080964,0.6678244419742204,0.6445144488872342,0.6233049323978089,0.6040811008892494,0.5867292228590828,0.5711386498421663,0.5572032824836018,0.5448225794023508,0.533902196881197,0.5243543389368545,0.5160978867842599,0.5090583638371149,0.503167780864586,0.4983643973246675,0.4945924278536425,0.4898986157305457,0.48891835337197503,0.49137220461973324,0.4970490166329218,0.505795980396245,0.5175087651446592,0.5321235942339823,0.549611309318098,0.5699722721122006,0.5932313702097591,0.6194331932596513,0.6486375636950233,0.6809152255339871,0.716343251204078,0.7549997995656603,0.7969579902517925,0.8422786390643745,0.8910014674486499,0.9431342852492056,0.9986395878506292,1.0574179609493364,1.119287621123014,1.183959374377134,1.2510063228119763,1.3198278809723931,1.3896082005146222,1.4592701371020131,1.527427707527354,1.5923429179488795,1.6518971872985617,1.691585724354489,1.7256774878937378,1.7529120341353805,1.7720046041722584,1.7817091760319201,1.7809017721717078,1.7712013532999868,1.7527895378303098,1.7255300338871409,1.6895614057231698,1.6453196012444735,1.5935366128825106,1.5465590729858696,1.495915086806834,1.4423376057388722,1.3865991062691794,1.3294841935920165,1.2717640685737548,1.2141685894859626,1.157360791368751,1.1019192945291336,1.0483293298440195,0.9969801006932737,0.9478674352499132,0.901524359028508,0.8580901126678216,0.8176226098635475,0.7801229653206321,0.742738454422017,0.7086739305688194,0.6778094600051318,0.649975074079749,0.6249988118101174,0.6027042798857812,0.582914327385284,0.5654567019201714,0.5501685486811644,0.5368982249641395,0.525505544688649,0.5158619233606018,0.5078506642882226,0.5013669146196095,0.4963171177830236,0.4926182340490718,0.4901970029197726,0.48898927831430283,0.4889393534068184,0.48999925471477085,0.4921280571484413,0.4952912621971216,0.4994602366733424,0.5046116925339192,0.5107272010196845,0.5177927460037854,0.5257983186736673,0.5347375480955237,0.5446073600765141,0.555407659349617,0.5798268288301128,0.6080326718495639,0.6401036467922041,0.6761395554755691,0.7162525657882928,0.7605578506903181,0.8091622803024376,0.8621501587644769,0.9195653293894127,0.981388662835483,1.0475094591582912,1.117689023777759,1.1915146256474534,1.2683421860794626,1.347226613423537,1.4268402126286546,1.5053828332449133,1.580493419234518,1.6359159024916374,1.6854750001129113,1.71625321558969,1.7421632208728854,1.7623660468163946,1.7760303241566016,1.7823662705735432,1.7806680802195918,1.7703677631917827,1.751093168030511,1.7227211345724505,1.6854189132998099,1.645477937137365,1.5994932044427872,1.548179423648262,1.4923980412493827,1.433119587079319,1.3713789781245136,1.308225606228795,1.2446738722279407,1.1816603636765775,1.1200114726205879,1.066335915621878,1.0147345952269153,0.9655225664711053,0.9189295769045108,0.8751068194430625,0.8341351314990569,0.7960358178942426,0.7607824567427245,0.7283117076513963,0.69853251813195,0.6713340878821211,0.6465928517203076,0.6241783514416629,0.6039578468139103,0.5857997676374023,0.5695762624344654,0.5551650531009317,0.5424507077691096,0.5313254161847601,0.521689373434723,0.513450883448174,0.5065262675596791,0.5008396328978573,0.49632254056315733,0.4929136096288296,0.4905580879040541,0.4892074113490849,0.4888187656261263,0.4893546585887206,0.49078251033420006,0.49307426549890937,0.4962060302103731,0.5001577342412107,0.5049128178708915,0.5104579424671559,0.523979853599261,0.5406121086981193,0.5603396629503516,0.5831782684612936,0.6091684756916012,0.6383707125991954,0.6708603410045246,0.7067220871346279,0.7460437799226685,0.7889092763722084,0.8353901399530628,0.8855354667874366,0.9393592358709948,0.9968245276798411,1.0578238476738497,1.1221546676877348,1.1894892408969098,1.2593378255174859,1.3310047728904897,1.4035376862585784,1.4756713382871778,1.545770665534518,1.6117814246038942,1.6594130997414462,1.7015207146298497,1.736533750603863,1.7584859240641775,1.773859900863091,1.781804820743234,1.7815566495685653,1.7724921075720521,1.7541850505457317,1.7264648426565603,1.6894665936193514,1.649944435052287,1.604231557530226,1.5530404104839608,1.4972369575946365,1.4378031975402739,1.3757917205143604,1.3122740919419298,1.248289249469938,1.1847986383992268,1.1226521109466543,1.0687794096364436,1.0169723882424604,0.9675520686864738,0.9207531954646001,0.8767310611630711,0.8355695692786143,0.7972921307352728,0.7618736487373476,0.7292514917491073,0.6993348157573664,0.6720126284879666,0.6471608792161648,0.6246484327847495,0.6043417599456946,0.5861084443206557,0.5698197711447932,0.5553526138396139,0.5425907308914585,0.5314255563301926,0.5217565911722422,0.5134915101780737,0.5065460711763082,0.5008438823099381,0.49631606740777356,0.4929008660615121,0.49054320000906776,0.48919422812356644,0.48881090362161334,0.48935554233933704,0.4907954087802869,0.4931023246997679,0.4962523026742729,0.5002252051857231,0.5050044286975819,0.5105766117121973,0.5241348797163042,0.5408044182924546,0.5605705481158196,0.5834493453112326,0.6094816448821876,0.6387281177954294,0.6712643202437389,0.7071751130309537,0.7465483847556778,0.7894679566043802,0.8360052327450884,0.8862089893020771,0.9400926763177666,0.9976185747804869,1.0586780426109388,1.1230669601508991,1.1904554294061602,1.2603508631887883,1.3320539257006931,1.404607545835835,1.476740721716393,1.5468114894603593,1.6127577300823468,1.66021531693067,1.7021430242681914,1.7369768469714544,1.758813905123053,1.774066001538655,1.7818846580802343,1.7815088213540902,1.7723187712711554,1.7538923804633413,1.7260632239776297,1.688970460873305,1.6494044478292307,1.6036697827540447,1.5524786624041074,1.4966956749742077,1.43730043049987,1.375342341285959,1.3118892834009326,1.2479762980005211,1.1845610289236477,1.1224898832429,1.0686307614423243,1.0168377489810871,0.9674314722042217,0.9206463297518569,0.8766373326817652,0.8354881852660399,0.7972221733596628,0.7618141284505,0.7292013858199617,0.6992931005882627,0.6719783069140076,0.6471329999787078,0.6246261016187208,0.6043241447825705,0.5860947772518348,0.5698093481945122,0.5553447926813988,0.5425849268758772,0.5314212375798686,0.521753273396292,0.5134887514901832,0.5065434669890653,0.5008410603861211,0.49631268319196953,0.49289659837973737,0.490537747151502,0.4891873042866572,0.4888022356878157,0.48934486698154234,0.49078246987401974,0.49308687101678184,0.49623408582798556,0.5002039778027684,0.5049799427944651,0.5105486172584087,0.5241010694447735,0.5407645505339599,0.5605243282851828,0.58339643138157,0.6094216531363955,0.6386606294240249,0.6711888895197201,0.707091277760846,0.7464556797889288,0.7893659314354597,0.8358934745575537,0.8860871531251218,0.9399605243243483,0.9974760271825317,1.0585252430719894,1.1229043590498782,1.1902838884923266,1.260171784895466,1.3318694091560324,1.4044205686323499,1.4765553405774974,1.5466330424421497,1.6125930060655829,1.6600847601475357,1.7020476048042026,1.7369162413012085,1.758775446992624,1.774050909403517,1.7818936831802847,1.7815421322177942,1.772375842220511,1.753971903972649,1.7261630745505878,1.6890877284793753,1.6495292862427462,1.603797825650984,1.5526056011099016,1.4968174784590396,1.4374135437800584,1.3754438399071296,1.3119769734526225,1.2480487564434368,1.1846175846302214,1.1225305467263607,1.092601232065255],"y":[1.0,1.0,0.9999999602844765,0.9999997727010445,0.999999529655254,0.9999991694976114,0.9999980807454262,0.9999965314501048,0.999994527186046,0.9999888339963283,0.9999811311263735,0.999971420609226,0.9999445055069007,0.9999087640360145,0.9998642244042266,0.9998109087208866,0.9996704841456721,0.9994916853479026,0.9992747441649329,0.9990198965797357,0.9983624174701636,0.9975411464477388,0.9965585090222228,0.9954170162046078,0.9941192731486538,0.9908974981467121,0.9870245758079437,0.9825275936606023,0.9774346831607108,0.9717748154994861,0.9581750143669537,0.9424824142866103,0.9249730840515158,0.9059174507611261,0.8855742613752663,0.8641876865181898,0.8419851632341886,0.8191758885435192,0.7959499866773978,0.7724783869750674,0.748913261222149,0.725388796258804,0.7020221605369605,0.6789146146580959,0.6561527312789078,0.6338096672636434,0.6119464290080237,0.590613095510346,0.5698499855402098,0.5294741356243424,0.49176029920524444,0.45678287710701526,0.42454248125295835,0.3949888452714105,0.3680367936020022,0.3435778800277273,0.32149024083594674,0.30164699391359295,0.28392258778359886,0.2681971883221117,0.2543598898775472,0.24231141780960525,0.2319665202618452,0.22325605908234938,0.2161289333156678,0.21055409295296446,0.2065228755670492,0.204051816060811,0.20318605270497508,0.2040034771903118,0.20661978488924965,0.21119453207711522,0.2179381916554137,0.227119996907027,0.23907600919009575,0.2542162370859678,0.2730286486887843,0.296076438699212,0.32398289137472547,0.34849678691245756,0.37637529008435583,0.40784768829712403,0.443071363040383,0.48209377207643617,0.5248088526398468,0.5640138951100083,0.6053612088319794,0.6483663890835357,0.6923925340845948,0.7366594993190027,0.7802692389121029,0.8145709655435992,0.8472506920567768,0.8777772034975485,0.9056560621708768,0.9304485564434731,0.9517861536448322,0.9693844664407203,0.9830534672320367,0.9927005304639809,0.9983265441062027,1.0000175283123602,0.9979164210254571,0.992211216870496,0.9831842804090675,0.9711412749982333,0.9564107000158688,0.9377616013291723,0.9167932558600997,0.8938962526938629,0.8694710067160392,0.8438777997631753,0.8174449252076372,0.790468914757086,0.7632125660475837,0.7359041946823993,0.7087395562661267,0.6818849929963077,0.6554801829446151,0.6296403715579904,0.6044587120844479,0.5800089037026919,0.5563477907871238,0.533517634804214,0.5115480847714345,0.49045798943569074,0.47025709038774127,0.45094754157942224,0.43252522249140885,0.4149808727652739,0.39830109107672196,0.38246921664419953,0.367466094314735,0.3532707292231552,0.33986084724032645,0.3272133779852153,0.31530487110655253,0.2936002878107086,0.2745785470498665,0.2580673284095789,0.24391275440481167,0.2319849419132815,0.22218077374295722,0.21442672287445977,0.208683146248652,0.2049496063335301,0.20327076417951118,0.20374333838111855,0.20652499148457013,0.21184558297544914,0.22002065222738967,0.2314665012673034,0.24671539691019292,0.26642758827914254,0.2913935982300715,0.31564018062503957,0.34427661725816006,0.3677515575105174,0.3938816847327763,0.4227908150937893,0.45454952702931967,0.48915575873004,0.5265129245912992,0.5664050464935263,0.6084738627507006,0.6522037148517297,0.6969181679394506,0.7365225148982962,0.7756045127004729,0.8134636612497735,0.8493815265124921,0.8826555978355954,0.9126330868939065,0.9387444141581718,0.9605320327622013,0.9776701356125996,0.9899734996623237,0.9968640898753249,0.9998662900619472,0.9991129619178317,0.9947986403666017,0.9871672099377155,0.9765001298494219,0.9631035881681964,0.9472960527698253,0.9293979700285403,0.9097239009092527,0.8885764316255744,0.8662414014111529,0.842984466049541,0.819049045508978,0.7946554387041481,0.7700007557944644,0.7452594114638124,0.7205840517715356,0.6961068199658739,0.6719408422350971,0.6481818149879728,0.6249096133680359,0.6021898782706168,0.5800755536835753,0.5586083480934372,0.5378200991574192,0.5177340315913982,0.498365907090345,0.4797250686046765,0.4618153820497744,0.44463607970962804,0.4281825114607615,0.4124468111809891,0.397418485824028,0.38308493424007084,0.35627434400182845,0.33209233521083076,0.31039783564205625,0.29104822835915023,0.27390661565256186,0.25884530131207545,0.2457483441164009,0.23451470669760083,0.22506145904865466,0.2173263341809053,0.21126991082817886,0.20687815961654674,0.20416576202320477,0.203180232140692,0.2040068742464904,0.20677478356672885,0.2116641143956792,0.21891463685217985,0.22883526622589895,0.2418137546641921,0.25832490245002937,0.27893424656906995,0.30429205038839063,0.32814084635608287,0.35575360829713554,0.38746749400386166,0.41622353333521406,0.4479165262167611,0.4825661248092586,0.5200918291479179,0.5602876279566423,0.6028001155029243,0.6471109926672962,0.6925296536075811,0.7324186341659132,0.771849310626755,0.8101106038354333,0.8464701333908282,0.8802085958523227,0.9106544719153408,0.9372190793032469,0.9594271127462267,0.9769377123153321,0.9895541777868101,0.9966449153604064,0.9998272798777692,0.9992317888225383,0.9950516692575342,0.9875303722585779,0.9769498216595863,0.9636174018381043,0.9478532670735046,0.9299798494565127,0.9103138762224833,0.8891601860285884,0.8668068603050416,0.8435217025067531,0.8195501315187772,0.7951142697257803,0.7704128626907922,0.7456217661314455,0.7208948731248004,0.6963653880763578,0.6721473262257843,0.6483371167413262,0.625015227155623,0.6022477661938708,0.5800880368415232,0.5585780129059562,0.5377497176568341,0.5176264942490627,0.49822416683897447,0.4795520948516239,0.46161412351343795,0.44440943492565566,0.42793330588312956,0.41217777993259747,0.3971322612746158,0.38278403768301694,0.35599648224336466,0.33183716443024863,0.3101648534109492,0.2908368559541597,0.27371626163972623,0.25867541294270896,0.24559845488173332,0.23438448284663654,0.22495074498590764,0.21723519839003172,0.21119869623073675,0.20682754246670654,0.20413682259720284,0.20317454031619966,0.2040265936319961,0.20682279805359138,0.21174417998806233,0.21903155885632805,0.22899509637934715,0.24202399253389703,0.2585946673449976,0.279274356589272,0.3047149008609068,0.32858566479156515,0.3562127784323955,0.3879309376329246,0.4167192491199531,0.44844211124601957,0.4831177775153909,0.5206641895389115,0.5608736697378504,0.6033911471183463,0.6476968455957863,0.6930990923264301,0.7329418005614169,0.7723183654049928,0.8105196034070786,0.846815543472686,0.880489638349832,0.9108732490178649,0.937380465031753,0.9595384270545487,0.9770082152995773,0.9895944442024293,0.9966726442118834,0.9998439662630707,0.9992390487098464,0.9950511847586238,0.9875238335219608,0.9769388571473937,0.9636035236730178,0.947837842152274,0.9299640867199381,0.9102988192035905,0.8891467092940057,0.8667956728769833,0.8435133583472654,0.8195450437387314,0.7951127255345816,0.7704150382858722,0.7456277417279185,0.7209046478679347,0.6963788940903135,0.6721644412655176,0.6483576754001499,0.6250390307842234,0.6022745916028007,0.5801176437769852,0.5586101503354233,0.5377841289858104,0.5176629216133977,0.49826235458706153,0.4795917923046707,0.46165508709101233,0.4444514297289901,0.427976106822392,0.41222117246956524,0.3971760418398304,0.3828280138198036,0.3560369339658229,0.3318741234407662,0.31019837164371716,0.2908669942710618,0.27374308050111806,0.25869896432707734,0.24561877462320658,0.23440158301433367,0.22496460612886043,0.2172457612950054,0.21120585263437988,0.20683112412662905,0.2041365881629074,0.20317015941909966,0.2040176275527077,0.2068086763425058,0.21172417262935705,0.2190047441005874,0.22896032544408954,0.24197985436502,0.2585394600980982,0.2792060780915125,0.30463127860485595,0.3284982935797078,0.3561232105567485,0.38784121736293353,0.41662374316443934,0.44834133339321797,0.4830125186232125,0.5205555479970122,0.5607630715066557,0.6032803442141108,0.6475878776551542,0.692994204502231,0.7328467588934265,0.7722347287439297,0.8104485534864624,0.8467577832639093,0.8804453231075966,0.9108419610585853,0.9373612342366676,0.9595297942285048,0.9770083311082836,0.9896011919497011,0.9939878701605112]},{"type":"scatter","name":"y0 = 2","mode":"lines","x":[2.0,1.9996802541092977,1.99936053699432,1.9986892066347666,1.9980179167329115,1.9973467121823987,1.9959374251640785,1.9945284765510658,1.993119863762313,1.9901628733807386,1.9872073903131346,1.9842534265432847,1.9780551117352205,1.9718636420548075,1.9656791603469097,1.959501775634388,1.9465528866430155,1.9336368598634337,1.9207547338907613,1.9079075331324264,1.8810465338592144,1.8543530752285384,1.8278358566824098,1.8015032748029,1.7753633736662444,1.721130580533268,1.6678472085734923,1.6155725137079344,1.5643589279814911,1.5142521336626191,1.4127952791226956,1.3166520089811304,1.225980198969384,1.1408364151263606,1.061188750184112,0.9698335516028362,0.8864395501059171,0.8106172360813244,0.7418757275613681,0.6797039887615314,0.6235790094652888,0.5729805457828417,0.5274047315110945,0.4863741843958836,0.4494433063878382,0.41620020843203154,0.3814982280186496,0.3507847650613834,0.3235700839650217,0.29942803947404895,0.27798361780267367,0.2549952566589381,0.23503107546347088,0.2176486389315275,0.20248526093208524,0.18923013982810244,0.17762065696508864,0.16743549405150632,0.15848756443313836,0.15061792399285037,0.1436912340940604,0.13759227670163374,0.13222288831464885,0.12749918287136208,0.1233492253855401,0.11971119866225852,0.11653192234982952,0.11376558070071768,0.11137261757792936,0.1093188100860173,0.10757451005865629,0.10611401307910069,0.10491501887503313,0.10395816790329364,0.10322664911194145,0.1027058704501298,0.10238317956289153,0.10224762409434547,0.10251287657397812,0.10345389854085044,0.10502522575684516,0.10719542413199129,0.10994379720970719,0.11325912441971954,0.11713874958306378,0.12158726353636902,0.12661525421596292,0.13223860889043038,0.13847824566731862,0.14535992180085264,0.1529139993120725,0.16117526933710002,0.17018291440683733,0.179980572819556,0.1906164390297465,0.20214338324250428,0.21461911041823298,0.22810637030329392,0.24267320931222985,0.25839325222533477,0.27534601177900603,0.2936172301964786,0.3132992543410826,0.3344914424863017,0.3573006005579992,0.4085857643128705,0.46793643430085324,0.5365510316941522,0.6158030318699409,0.7072604705996687,0.8127060446718257,0.9341543374857024,1.0738608731477652,1.2153954591706746,1.3752007562769284,1.4952668018150355,1.6252855539838922,1.7658242233234758,1.9173629413725122,2.032157767336167,2.152744936305646,2.2790712335368655,2.4109405642433024,2.5479579515200097,2.689453738360895,2.796465226942549,2.9047569456663593,3.0135119683522085,3.1216475957894936,3.2277484671654215,3.3299912329274415,3.42605028117117,3.5129950028753916,3.587195973756737,3.6335810864825615,3.667060141852808,3.681636237439407,3.687159671621021,3.6825588535454026,3.66677428092577,3.6387997746996765,3.597730223022809,3.5428238995917254,3.473572360610642,3.3897693495045615,3.2915722796291647,3.179550102690349,3.0679933626610842,2.947123662186145,2.818236125133802,2.6828453269349732,2.5426308547392873,2.399371760689117,2.254871972178563,2.11088413251475,1.9690405488643996,1.8307972480828634,1.6973939824378566,1.5834936349434654,1.4747685561008081,1.3716073784948515,1.2742609252112085,1.1828543579724198,1.0974011091609788,1.0178208179131585,0.9439586978209363,0.8756031063739841,0.8125004650732849,0.754368267117879,0.7009066154957219,0.6518079926426452,0.606764945633638,0.5654758450709806,0.5276491470625281,0.49300648954885085,0.4612847811002322,0.43223740875991806,0.3958166888867606,0.36357555227736754,0.3350081695437803,0.3096686071190261,0.28716374136214046,0.264203925863195,0.2441262963150326,0.22652869739149487,0.2110781352035502,0.19748666947578558,0.18550883103276886,0.17493598805262303,0.16559029030308292,0.157319424443725,0.14999272529431587,0.14349815969983304,0.13773961075698132,0.13263438232709393,0.12811109922213154,0.12410804429020804,0.12057179967418633,0.11745606503963554,0.11472062355623516,0.11233047083165686,0.11025509687853433,0.10846788354127546,0.10694558527857659,0.10566788091613402,0.10461699237103289,0.10377736240435453,0.10313537967482946,0.10239712804809398,0.10232759765288488,0.10286798397477204,0.10397427347773126,0.10561372906207085,0.10776342227207154,0.11040909274010538,0.1135436459156034,0.11716576025547962,0.12127904767451467,0.12589163907867462,0.13101586237449206,0.13666789479254055,0.14286747349895612,0.14963773479908718,0.1570051524342758,0.1649995148243964,0.17365392073297373,0.18300480686574733,0.1930920173897635,0.20395890848911388,0.2156524768123369,0.24177696623915937,0.27188515611638925,0.3065055911919712,0.34624521466225044,0.39179820648702857,0.44395684467458296,0.5036235121102218,0.5718233102992314,0.6497172616190343,0.7386158621231396,0.8399919489190042,0.9554908490930322,1.0869340561755283,1.2131682357927864,1.3537697421265602,1.5100989209663633,1.6415494332076532,1.7836125614748575,1.9367612928455002,2.0644330503372634,2.199100480865395,2.3406385693745486,2.4886851592295565,2.5948861588117027,2.703531675717905,2.8141114626784054,2.9259205364816454,3.0380093537883224,3.1491218514084114,3.2576112875143326,3.3613384219669364,3.457559361878058,3.5428114870162832,3.594832398834564,3.6371906804990592,3.6678043248040946,3.684400005180652,3.686085694576424,3.6766562950322625,3.654979073449004,3.620008640027005,3.5708476532013984,3.506814838222944,3.4275233308164736,3.332958723445644,3.223543476406802,3.1001775234089775,2.9863186134761066,2.8646078820889236,2.736342643677901,2.602976734062214,2.46607009155425,2.32723337099768,2.1880651003884615,2.050089021024327,1.9147004490626625,1.7831258771729126,1.656396111674452,1.5353323113016257,1.4258240457579494,1.3223463688456485,1.2251343787983069,1.1342548229280127,1.0496646047114682,0.9643491659069157,0.8860663520421134,0.8144983317972798,0.7492321432356492,0.6898438587413367,0.6358983688636138,0.5869589583971923,0.5425992967549867,0.5024130005164955,0.4660181477983997,0.4330585701146095,0.40320453282621105,0.36737226144712043,0.335968624038373,0.3084091634954399,0.28418762351986737,0.26286512857440947,0.24038336220905027,0.22103941685897166,0.20434312303318647,0.1899030716171968,0.1773858360344869,0.16651317327134085,0.15705373563845368,0.14881421398771802,0.1416318751047307,0.13536935125064595,0.12991081751137218,0.12515856662602823,0.12102984149568669,0.11745422710164594,0.11437167870266662,0.1117309676819738,0.10948833596687722,0.10760631811041808,0.10605276688213144,0.10480007482909642,0.10382453556595476,0.10310579680248767,0.10262639038090607,0.10237133848677642,0.10232782764887531,0.1024849348193261,0.10283339286211753,0.1040993055189961,0.1060735540471883,0.10872419762640806,0.11203299180666718,0.11599234084662198,0.12060425917035265,0.12587966013411378,0.13183720782362515,0.13850222711316823,0.14590617296031147,0.15408652794989747,0.16308676556699753,0.17295626606548054,0.18375029892888517,0.19553015444862745,0.2083633840680876,0.2223240815750219,0.2374931922026922,0.25395887410356455,0.2718169245738439,0.29117126081577605,0.31213444331431756,0.33482824129012084,0.35938424518928874,0.3859445274754661,0.41466234849645506,0.44570290375949106,0.47924411006852174,0.5154774271169235,0.5546087080590991,0.5968590687970675,0.6424657615840669,0.6916830330008211,0.7447829381762907,0.802056071479809,0.8638121578164568,0.9303804262662262,1.00210965615378,1.079367740441791,1.162540546389127,1.252029759329394,1.3482492578422751,1.4516193654232772,1.5625577341737726,1.6814670338459292,1.808713413200646,1.9445978755507622,2.089312366574474,2.2222477861556804,2.3617136460203674,2.5073327920128543,2.6243767178551267,2.744200408341309,2.8660569007164054,2.9888939854189736,3.1112629579870594,3.231204456790545,3.3260109847281227,3.4155832950237373,3.497622201154044,3.569313929306644,3.6272858414405,3.658669516864773,3.6789945248832323,3.686445097814235,3.6791545538106822,3.6612421297393563,3.631581206611015,3.5893564647164413,3.5339180783472823,3.464837683801257,3.3819622605320045,3.285468171594011,3.1759052310108276,3.0542193618788436,2.926983074447304,2.8196342319852463,2.7077810454583817,2.592386863912879,2.474459324219053,2.3550268362610494,2.2210888441996337,2.0879620369694503,1.9568722860717134,1.8289801981554166,1.7052582352889922,1.5865026696987874,1.4733330233761945,1.3544414882113338,1.2433759522890575,1.1689262251455568,1.09854934915326,1.0321956376544703,0.9697822738820535,0.9111995473988737,0.8397655303532467,0.7743644608844212,0.7146275514183679,0.6601553208614923,0.610553521277408,0.5654331281189732,0.5244166108338458,0.48714475660286544,0.4532809600739316,0.42251240883663904,0.3866301050195438,0.3549278228495651,0.32688903993100177,0.3020612942548826,0.28004728703111936,0.2571850777260983,0.23728463393072613,0.2199185897093636,0.2047365103046958,0.19143678387829646,0.17976389922836056,0.16950200268446564,0.16046811712590575,0.1525063357302648,0.14548355981469094,0.1392862219734057,0.13381735209397594,0.1289938936155149,0.1247444603611352,0.12100757627866013,0.11773024866363209,0.1148667321940841,0.11237745052531499,0.11022809237373761,0.10838887156847228,0.10683390969652679,0.10554070587210246,0.10448968020021424,0.10366378703318055,0.10304818974713982,0.10262998443040933,0.10239796214737389,0.10246389994403553,0.10320288621254894,0.10456674153467481,0.10652146058460539,0.10904386252077149,0.11212027925226328,0.11574560191929413,0.11992193094663947,0.1246572961584058,0.12996492645192467,0.13586294924208242,0.14237417156364315,0.14952582168066797,0.15734934795007113,0.16588035285885583,0.1751586286262135,0.1852282296330942,0.19613756354997397,0.20793951963113308,0.22069164565457997,0.23445636513765963,0.24930122299001675,0.2652991570737127,0.2825287991930185,0.3010748072380617,0.3210282267459139,0.36572510589214685,0.4173737037419975,0.4769874139309004,0.5457278651979868,0.6249221687826227,0.716081803583421,0.820920941200212,0.9413713216871945,1.0795894760101163,1.2206462626083279,1.3797443388521216,1.4996195061447584,1.6293763303891722,1.7695719754480594,1.9206762088189797,2.0353639964039907,2.1558149748252022,2.2819725273586386,2.41363709082931,2.5504101920395756,2.69161887857949,2.7985052868332008,2.9066483634326796,3.015228321406645,3.123159526521361,3.229023678546549,3.330994773116178,3.4267453148610243,3.513344312630621,3.587164505445208,3.6331202884633282,3.6662359519751506,3.680642938050173,3.6859951238275226,3.681223826581131,3.665272991398593,3.637140506660458,3.595925954253969,3.5408927455781787,3.471537716837143,3.387659681185783,3.2894205152101588,3.177392588142315,3.0658824751463616,2.9450933225631544,2.8163183859596064,2.681068922660358,2.549822463971821],"y":[2.0,2.000159872945351,2.0003196811760873,2.0006551086320363,2.0009904455176053,2.0013255912150423,2.0020288542999674,2.002731363545579,2.003433126983191,2.004904396501148,2.006372354382468,2.007836994209996,2.010901904577039,2.013952107513317,2.016987530565421,2.0200081188824996,2.0263028058852814,2.0325312926845647,2.0386930731984787,2.044787654160184,2.0573654521303637,2.069640601461911,2.0816092591216298,2.093267858563786,2.1046131519323197,2.1274057624023275,2.1487813362700314,2.168722972802936,2.187219515204914,2.2042653780380848,2.235346221618395,2.2601051957918408,2.2786930517477617,2.2913332956038572,2.2983096197388075,2.2995720388129555,2.2933258193799477,2.280271314109493,2.261157763342317,2.2367093073238014,2.2076229799175793,2.174559188529838,2.13813267102068,2.0989066750474827,2.057391589834872,2.014046369433226,1.9615852881131342,1.907753508557145,1.853045900533006,1.7978838177168954,1.7426230596838195,1.6755061041011723,1.6091163959649344,1.543819362780234,1.4798822208812146,1.4175154188982622,1.3568756005710754,1.2980740460176894,1.2411856968912742,1.1862568325220981,1.133310507523293,1.0823505879408184,1.0333653769173994,0.9863309697596492,0.9412140235754303,0.8979738552755759,0.8565640912313054,0.8169340859798476,0.7790301521283954,0.7427965627373789,0.7081763345207417,0.6751118532721508,0.6435453941430763,0.6134195530829076,0.5846775907449645,0.5572636988894015,0.5311232075790855,0.5062027478966679,0.45894714050898816,0.4161311565405941,0.37736124030690327,0.3422726318730556,0.31052971099368926,0.2818241583097091,0.25587294273486666,0.23241707090055125,0.21122050985332072,0.19206865793537803,0.17476650902141286,0.15913695453307383,0.1450193601187631,0.13226826017286444,0.1207520490452013,0.11035170973281153,0.10095966179234328,0.09247873841909324,0.08482125076836344,0.07790811349096731,0.07166803823933193,0.06603680619686952,0.06095661509398634,0.05637548781469033,0.05224673475518128,0.04852846878778,0.04518317207639794,0.039448233293215916,0.034861005868869116,0.031242714575584033,0.028458556316622696,0.026412914026493012,0.025049283599986476,0.02435417093554092,0.02436597125820917,0.02505757893361081,0.02653743151779068,0.02811886122018078,0.030290508799384882,0.03321810423289302,0.03714015536872119,0.04072965581873135,0.04516411841038908,0.050666782232584674,0.05753660610600781,0.06617503046164097,0.07712152910475953,0.08713730991244545,0.09919528423976512,0.1137801087607346,0.13150310707743487,0.1531335356184186,0.17963108701177272,0.21218538563220526,0.25225536655975933,0.3015968037232783,0.3480004454039893,0.4024273098630781,0.446996511506641,0.4967045306910189,0.5519562979847745,0.6131125253290682,0.6804608107640976,0.7541843778436139,0.8343229329137262,0.9207308354718844,1.0130387664196219,1.110623492132984,1.2125899262441764,1.3069331423752568,1.4028519555792482,1.4991863118217652,1.5946793152643408,1.6880241184294023,1.77791593794462,1.863108023025867,1.9424657056684114,2.015011956306894,2.079960449752643,2.136734887140359,2.1801114639191765,2.216604198000433,2.2462225102946136,2.269082054795234,2.28539038696082,2.295432293516612,2.299552578021953,2.2981384440493633,2.291604132455087,2.280378374432077,2.2648938617460073,2.2455782445616372,2.222846848023775,2.197097315658031,2.168705971713384,2.138025473765185,2.105383437696116,2.0710818837550997,2.0353973823830263,1.9838779586457074,1.9307649899121098,1.8765809233225825,1.8217728631884678,1.7667197990521906,1.7031283961914292,1.6400322721819653,1.5777747706330014,1.516611986825915,1.4567504106354459,1.3983485762312657,1.3415240074081003,1.2863609419316975,1.2329169722522237,1.1812277585483935,1.1313105603518752,1.0831674661844661,1.0367884215616907,0.992153751857356,0.9492360956823458,0.9080019477986975,0.8684130024521532,0.8304273289955986,0.7940003415998129,0.759085569957759,0.7256352860107766,0.6936010331260669,0.6629340715036193,0.6335857407770289,0.6055077490695698,0.5786524051558236,0.5283152259439061,0.4823380079008076,0.4403724890949236,0.40209103934718216,0.36718817390509473,0.3353796876796457,0.3064015307033044,0.2800093466571099,0.2559780745895389,0.23410100613990853,0.21418845572552372,0.1960664914664449,0.17957587543521947,0.1645710737456099,0.15091922336596222,0.1384990950197385,0.127200135101091,0.1169216047783122,0.1075717827413502,0.09906720848026222,0.09133197272962841,0.08429706767874702,0.07206296658037036,0.06195613341472537,0.05361776328542086,0.046753822318746203,0.04112351669461208,0.03653158894775347,0.032822436011431776,0.02987488843676564,0.027598199151993758,0.025930157050700328,0.02483770110530803,0.02432035625838866,0.024417903129440068,0.02505725175516031,0.026314333404985246,0.028352999502003953,0.030609869226510492,0.033651903504626914,0.037727047393361766,0.041866006665212716,0.047096693462403055,0.053745176082251725,0.062261774987559165,0.06959825061907295,0.0784016706598618,0.08901635105686538,0.1018815062408253,0.11755421368368617,0.13673780184856818,0.1603199333907703,0.1894172935629227,0.22542164222176553,0.270040483822159,0.3084542351098393,0.35319479647192675,0.40519540443071933,0.4654262826448018,0.5186292391411624,0.5778281906017925,0.6433882654385232,0.7155743025486233,0.7945121832896664,0.8801478543941506,0.9722021037538635,1.070128784746259,1.1730860219654466,1.279927152728766,1.3719860561066777,1.4647869637701667,1.5572275393561927,1.6481500835558502,1.7363829067603864,1.8207825971611435,1.9002797230824235,1.9739220302215317,2.0409084323647693,2.1006111301852046,2.152586446880281,2.1965755531658355,2.2309809092916324,2.2581312762122367,2.2781970586683884,2.291452332694302,2.298246384449734,2.298744564667758,2.2926313299952286,2.2804812190522536,2.2629240808298614,2.2405649558932477,2.213988975894976,2.183755286162605,2.1503886002731134,2.1143731351737314,2.0761511933855044,2.0361244124750435,1.9946551989159427,1.9370849326412494,1.8781718880910805,1.8185008127911568,1.7585616005917317,1.6987591544227805,1.627022474353923,1.556426538940514,1.4873558800117925,1.4200745377095996,1.3547846106427937,1.2916278965297,1.2306959357875842,1.1720411524610925,1.1156861733734016,1.0616300304837574,1.0098525263626266,0.9603182224797507,0.9129802123816084,0.8677831774094096,0.8246655856044853,0.7835613587707345,0.744401314138137,0.7071144217619794,0.6716288038491028,0.6378724789868802,0.6057739349755494,0.5752625995854306,0.5462692244682575,0.5187261771071804,0.49256765069047287,0.4677298148660223,0.4441509251177135,0.39988336636691024,0.3600968288200925,0.32435657926863276,0.2922648897193367,0.26346007178505937,0.23761357744596032,0.21442708828253865,0.1936304680285666,0.17497997542993685,0.15825612363280675,0.14326133623024798,0.12981782885100104,0.11776582832900744,0.10696195724992714,0.09727766092743781,0.08859771837201182,0.08081891327458267,0.07384886527018811,0.06760497297282869,0.06201344095336244,0.05700839666476361,0.052531105832314566,0.04852927841040004,0.04495645012588752,0.04177143130191852,0.03893782187033384,0.03642359175834719,0.034200723253029114,0.032244912076158275,0.030535326824590873,0.02905442933428839,0.02778786039982205,0.026724397401667238,0.025855994061010835,0.025177917982845566,0.024689008837475577,0.024392089677483353,0.02429457752443268,0.024409359070200844,0.024756025933069376,0.025362605660926456,0.02626798633159761,0.027525324703789898,0.029207064353831396,0.03141107435087255,0.034271741654236784,0.03797351641456752,0.04277178293324802,0.04810917683797847,0.054867501457007715,0.06348799302629475,0.07186620613290569,0.08211454132346857,0.09472312013708592,0.11033006808378899,0.12976374487300937,0.15409471382292772,0.17868468089589717,0.20844198620229343,0.24451389838263338,0.2882675674063331,0.34129260218044044,0.38677972464507965,0.43887091211561047,0.4983145123133455,0.5658185101586128,0.6266734545640834,0.6934456363776162,0.7662842714124595,0.8451976890619878,0.930020590017672,1.0203852148646362,1.1156950962416974,1.215108130744976,1.3175364593987478,1.4176624536900777,1.4975754283717515,1.5769225641946611,1.654954935948444,1.7309230749270406,1.8040979517047897,1.8816970801474304,1.9540500729060484,2.020444862516484,2.080259534014966,2.1330483577959436,2.178523925855487,2.2165495689065904,2.250141277378077,2.274702938264954,2.2868968696295777,2.294836036421481,2.2987180243347205,2.2987586623681926,2.2951862444690576,2.2853851359081125,2.270317929915916,2.2505312735822605,2.2265706400612832,2.198951144684514,2.1681608609012506,2.1346572364059364,2.0988625524172315,2.06116196266003,2.0219045401657145,1.9689982118114373,1.9145978070069867,1.8592307120660274,1.8033460730262136,1.7473223495986112,1.6813817995185862,1.616103884393372,1.5518452187589713,1.488866670554432,1.4273756673430193,1.3675280446075377,1.309435926241092,1.2531763383446277,1.1987985350284458,1.1463291392511337,1.0957759561616405,1.0471314441988955,1.0003759567217891,0.9554804203825228,0.9124083616206448,0.8711175061718633,0.8315611651493791,0.7936894430909555,0.7574502251321394,0.7227899507994817,0.6896542355123604,0.6579883911046429,0.6277378600740127,0.5988485639316506,0.5712671753756949,0.5449413323526837,0.5198198083539023,0.47195217835367165,0.428511787952729,0.38911380962744896,0.3534005545306599,0.3210420745105226,0.2917345348811631,0.26519837870172946,0.24117723069265593,0.21943695868320723,0.1997642672327657,0.18196496532129586,0.16586235291702742,0.15129586872363238,0.138119847425612,0.12620226604206003,0.11542351862860005,0.105675301305215,0.09685962003878282,0.08888788136092561,0.08168004027567154,0.07516381170383632,0.06927395686068764,0.06395164103052582,0.05914385054897187,0.054802861235519265,0.05088575704187831,0.044151377432451754,0.038707595126400866,0.0343446641604147,0.030898968004856874,0.02824646020754353,0.02630019742548361,0.025010681686570838,0.024368993822068964,0.02441511590003672,0.02512918021734267,0.02662620524156863,0.02822206259794322,0.03040850718055549,0.033351055560041476,0.037287629002493675,0.040895432007592325,0.045350825657476876,0.050877471235264586,0.057774678586234474,0.06644416630813953,0.07742549848595953,0.0874811365600022,0.09958534792542426,0.11422374062033033,0.13200855897279185,0.1537099235799856,0.18028815433337836,0.21293298349093584,0.2531025240824338,0.3025502192213706,0.34889946418846907,0.4032223635903457,0.4478380290637776,0.4975898927704798,0.5528810508009983,0.6140701288067626,0.6814423573095356,0.7551783212826606,0.8353149673712746,0.9217040041670008,1.0139738196607084,1.111499505533238,1.2133851913273908,1.3076219629114993,1.4034179180479787,1.49961565876774,1.594961825506578,1.6824546858989473]},{"type":"scatter","name":"y0 = 3","mode":"lines","x":[3.0,2.999476026565595,2.9989520964070797,2.997851956765479,2.996751878038578,2.9956519277950697,2.9933423974483406,2.9910333771631414,2.9887248633984314,2.9838786385085423,2.979034692598938,2.9741930468646616,2.9640331909116076,2.953883735868691,2.9437449353629557,2.933616983233667,2.912384516374784,2.8912026776132485,2.870073322993928,2.848998286218282,2.8049254889011968,2.7611165407999803,2.717587179908622,2.674352658585226,2.6314276599609547,2.5423546915638315,2.4548304535925842,2.3689656046550125,2.2848590639580437,2.202597882576315,2.1222574103097216,1.9600634885594748,1.8070389902441157,1.6634214009672845,1.5292727831286383,1.404501690719323,1.276472417751144,1.1593018887141877,1.052484103601876,0.9553776336448582,0.867321571581457,0.7876373963756886,0.7156451898739035,0.6506811861522608,0.5921114334047214,0.5393388871653187,0.49180619132972936,0.44899718816994316,0.4020254440902624,0.3607186866033054,0.3243618221541822,0.2923296333528603,0.2640733015224869,0.23490705091350947,0.20967227948747105,0.1877791489182933,0.16874445932186274,0.15215286738510206,0.1376529389196839,0.12494831393088426,0.1137883526968068,0.10396004132394275,0.09528202491091159,0.08760003361975455,0.08078278695265452,0.07471822871769417,0.06931037003887795,0.06447681529481165,0.06014676126288019,0.05625926202198834,0.052761712327277936,0.04960857806581435,0.046760361089185534,0.04418273798410368,0.04184582070153439,0.039723520534016225,0.03779301120135558,0.03603427944245858,0.03442974444528009,0.032963930998366905,0.03162318855243229,0.029241144056187288,0.027240075566777173,0.025554547439916656,0.024132499602428296,0.022931460340014278,0.021917063951539622,0.02106197004074205,0.020344289535151147,0.019746056044079825,0.019252319113289597,0.01885072019828568,0.018531129988338203,0.018285204486771827,0.01810598749262303,0.01798765823093315,0.017925377682634785,0.017959725302359123,0.018195730873966292,0.0186165018387912,0.019211258187170996,0.019973872942424416,0.020902068404714886,0.02199832248310757,0.023267508817223528,0.024717437791492672,0.02635801092882462,0.028201105770589933,0.030260835460483665,0.03255362559931701,0.03509809461209698,0.037915044644382424,0.04102765612898948,0.04446172324838085,0.04824581918860802,0.05241145331400208,0.0569933067898133,0.062029536584340676,0.06756209337787665,0.073637044338702,0.08030493356779345,0.08762119905693926,0.09564663572113903,0.10444789392116528,0.11409802120229602,0.12467706134192606,0.13627271621919254,0.14898107007294453,0.16290737973766384,0.1781669400313605,0.19488603351614953,0.21320297127213664,0.2332692313666421,0.2552507042355714,0.2793290559789994,0.3057032206715214,0.3345910328899191,0.36623101286936927,0.400884318318738,0.4388368780446498,0.48040172326859004,0.5259215334284392,0.5757714143771989,0.6303619277952512,0.6901423909963181,0.7556044660482109,0.8272860560314733,0.9057755236874129,0.9917162426046574,1.0858114819165943,1.1888296097682935,1.301609574350886,1.4250665768369981,1.5601977755028047,1.7080877324431079,1.8699130932502803,2.046945274535839,2.2405511112517655,2.452184559545563,2.683371117518345,2.9058851583973886,3.0983487415260407,3.3028195832857103,3.519709089415509,3.6762897060996877,3.8388671635796827,4.007343398661297,4.1814707364203105,4.360790366057566,4.488504214007886,4.618010946140975,4.748798819692751,4.88017767252923,5.011228163101655,5.1407395544717165,5.250236218187426,5.356087314394326,5.456641382286843,5.549834857448125,5.6331130211892315,5.703347950392534,5.756760883425568,5.786642471597485,5.795759633616743,5.790596573737425,5.76916026676686,5.729402867689487,5.669294408228486,5.586922316894843,5.500357560593782,5.396518025770327,5.274918258505546,5.135408308534897,4.978233459181972,4.8040795553464,4.614104741281504,4.426860952251284,4.229287671735463,4.023219911618095,3.860544232832847,3.6951412218566086,3.5280644234564122,3.3603704912199377,3.1930961804549405,2.977675133151847,2.766734780538903,2.5620492361435603,2.3651752793998955,2.177339827874848,1.999461982071323,1.8137075545882388,1.674981043783259,1.5450199947170877,1.4237497298162585,1.3109905598520109,1.2064774540887182,1.0706494474441468,0.949835692869564,0.842819895546432,0.7662117153101103,0.696955500978925,0.6344212555357864,0.5779997017275965,0.5271146243394322,0.48123369260723725,0.4319408467270343,0.3884241683666783,0.349982180196283,0.31599615273789866,0.28591858570502937,0.2567657809556047,0.2312139642592022,0.20877144789679888,0.18902698040886254,0.171621504067157,0.1562462977614307,0.14263672724144877,0.13056532904685525,0.11983585222337775,0.11027886543833726,0.1017482700819991,0.09411804993440055,0.08727923805731623,0.08113735850994225,0.07561038793374082,0.0706270612636017,0.06612537211573034,0.06205124938144957,0.05835743831855488,0.055002572469188535,0.0519503867076219,0.04916903276136686,0.04663048527777086,0.04431003513556316,0.04218585940247652,0.04023865228837076,0.03845130506760476,0.03528431788384813,0.032598408992791754,0.030311868321585528,0.028359102329798363,0.026686367589833306,0.025249905257919984,0.02401451354183178,0.02295169593455217,0.02203791676263327,0.021253507962676572,0.020582083620035118,0.020010054298729596,0.019526093433483337,0.019120663157564485,0.01878568953840456,0.01851434779359072,0.018300878878982022,0.01802514699333909,0.01793761872109698,0.01801600538562554,0.018244383965442708,0.018611050672845342,0.019108269165183607,0.01973198704239901,0.020480938761215817,0.021355777342728515,0.022358718397125617,0.023493518031135092,0.024765429871763757,0.02618105628912847,0.027748217274804466,0.029475918489438816,0.03137438282677836,0.03345508446995089,0.03573077368484861,0.038215514851507634,0.04092475094022529,0.043875387464224244,0.0470858856514344,0.05057636358438564,0.05436870974460039,0.05848671156780202,0.06295619825877342,0.06780519680736037,0.07306410184346568,0.0787658609800933,0.08494617702289768,0.09164372795486006,0.09890040568338893,0.10676157494412353,0.12471409732891801,0.1458034699623574,0.1705690966705791,0.19964385949887256,0.23376974670766995,0.27381695999346833,0.32080634555914095,0.3759352541910784,0.44060761603321796,0.516469235685557,0.6054491573788714,0.6976577013909605,0.8039392200981074,0.9264329472201667,1.067598928875212,1.230265118586055,1.417676168785245,1.633546072489405,1.882109898992685,2.168160846807271,2.372607023883057,2.5959608315293394,2.8397661067550546,3.019022979281338,3.209013747261825,3.4101380412175284,3.622679585278155,3.775164534577666,3.933023428147805,4.0961029410538785,4.264099669504124,4.43650002703103,4.561107513091038,4.687130878065014,4.814022238506785,4.941053687586955,5.067267638370458,5.191417221253396,5.29755286748185,5.399453926258819,5.495378374321942,5.583164962999859,5.660158283754521,5.723134445571165,5.768236844383984,5.789155441997628,5.792190428620336,5.781139540159973,5.7541802872721775,5.70946471366632,5.645188636795669,5.559683212157637,5.467936883026807,5.358705947946858,5.231597077576112,5.086572765629372,4.92400918940391,4.744737898599619,4.550069817421612,4.343429858504347,4.16862495348254,3.98782105303207,3.802456434463025,3.614038180698451,3.424105827921555,3.2181578164675364,3.0141728964044443,2.8138354356034623,2.6187526581305733,2.4302783596494333,2.2495295785445206,2.0773832382778457,1.9060215370551445,1.7453521999532464,1.5956091420426726,1.4831474671741853,1.3776406206489589,1.2789268185487228,1.186794740569254,1.100994609528134,0.981355425130539,0.874760155282946,0.7800828819969301,0.6961704739650377,0.6219274419260112,0.5563173241391063,0.4983726500828492,0.44720664511647484,0.4031352965471014,0.36408273133021096,0.3294417777413442,0.29868960381244825,0.2713613407852799,0.24267611711850304,0.21768246783151965,0.19585444158679857,0.1767545400583235,0.16000413825086782,0.1452799768049625,0.13230709418746384,0.12085105485822273,0.11071108269861098,0.10171495836120355,0.09371509667917587,0.08658500489318707,0.0802159848911953,0.07451433331394622,0.06939912427455283,0.06480040212046759,0.060657604292218434,0.056918172686868114,0.05353638067968364,0.05047236772969192,0.04769133032685311,0.04516282375661966,0.042860158106646014,0.04075988476751139,0.03884136344216327,0.0370863933020941,0.03547889475646826,0.03400463461426594,0.03134823200930302,0.029108009675358072,0.027212665480479667,0.02560529623122032,0.024239422235401303,0.02307734554259855,0.022088931035812366,0.02124994444283381,0.02054045851172784,0.01994387104678978,0.019446407842211955,0.01903671471467332,0.01870539135131933,0.018444571290124497,0.01824763915861568,0.0181090501282287,0.01798837780878426,0.018063324205863762,0.018313791182204026,0.018726266136396216,0.019291469432175638,0.020004223467707465,0.020863290934201296,0.021870471617066786,0.02302968971916936,0.02434665099930539,0.025828883374754908,0.02748575378960092,0.029328357374963945,0.03136941981748476,0.03362331131887977,0.03610613545610177,0.03883582372076856,0.04183222156628533,0.04511719202712427,0.04871475343353318,0.052651244599923756,0.05695550649379502,0.06165907944630966,0.06679642168953556,0.07240515317781199,0.07852632487127109,0.08520471326174255,0.09248914188326633,0.10043283282611415,0.10909379110548799,0.11853522431140436,0.12882600015667436,0.14004114512797608,0.1522623879146145,0.1655787515353677,0.1800871983181122,0.1958933322523094,0.21311216368837654,0.23186894181491763,0.2523000607917221,0.27455404589130816,0.2987926265275747,0.3251919036178337,0.35394361931778406,0.38525653778227203,0.4193579462375032,0.45649528629520575,0.4969379260767223,0.5409790843155574,0.5889379181284263,0.6411617865250743,0.6980287018701059,0.7599499812686739,0.8273731089964371,0.9007848192848716,0.980714405462883,1.0677372557877602,1.1624786069019368,1.265617490502691,1.3778908238451562,1.500097553973382,1.6331026986127903,1.7778410152413955,1.9353198416612738,2.106620327826784,2.2928957111621844,2.495363923522815,2.7152920128616627,2.9128846850889896,3.124218339714111,3.3499441673968517,3.5291327726444592,3.716827862019962,3.913002091727972,4.07074102157149,4.233170435195424,4.399862803878401,4.570137743500441,4.689999687745638,4.810628061174411,4.93140049312928,5.0515041101743625,5.169889640335527,5.285214545511906,5.395765862001599,5.489308847763489,5.575267896582368,5.651233905931623,5.714290928369485,5.7609600006069535,5.783467106203528,5.791212460050822,5.781786318802448,5.752641068871141,5.714203265843613,5.660725273634511,5.591035521092587,5.504105612511854,5.399116106987455,5.2755261691928625,5.13315146746702,4.972239176419043,4.79352662992679,4.598274644052016,4.409777131453837,4.21101945640671,4.043878467733175,3.8723750725606827,3.69771599427129,3.5211429176429316,3.3439044517759497,3.1311447209875483,2.9212889832978974,2.716153575179113,2.5174066815245233,2.3264231220923848,2.1442970229460965,1.97184383974774,1.7763798855566966,1.6410244008700254,1.514284151900493,1.3960582814981697,1.2861495095259463,1.1842836844283438,1.0606891935855771,0.9497843008381243,0.8506175257286536,0.7621576274348519,0.683408669499098,0.6134094533974698,0.5512469097092978,0.496071154106846,0.4471049628917263,0.4014845641576977,0.3612393379902562,0.3257011369844996,0.2942904870517729,0.2664961085491003,0.2375612152062563,0.2124584740317692,0.190623951100359,0.1715930814375748,0.15496545667422382,0.14040116177038142,0.12761263399128223,0.11635589372327283,0.10642295215498004,0.09763622808868093,0.08984424886694871,0.08291776514853798,0.07674616334501819,0.07123445545661322,0.06630091558453034,0.06596425166891419],"y":[3.0,3.0003143840606428,3.0006286846980474,3.001288497071733,3.0019481925781393,3.00260764142046,3.0039917834781353,3.005374951848182,3.0067571562966564,3.009656639824383,3.0125518336269685,3.015442723994277,3.021499514274268,3.0275371632264467,3.0335555112468393,3.0395544368073018,3.0520883820950653,3.0645349351946494,3.0768929490566057,3.089161296436647,3.1146281102769207,3.139684767225553,3.164321944696313,3.1885307523756294,3.2123028026436686,3.260767993033177,3.30720708892793,3.351564047937323,3.393792624982969,3.4338563072462023,3.47172804071847,3.544056919952854,3.6066110755087837,3.659496025560231,3.7029475373314495,3.7373121386148234,3.7653698442788497,3.7834314964822324,3.7921986934864735,3.792461777204521,3.7849980740711713,3.7705738928960755,3.749933012473106,3.7237838247662545,3.692789838455783,3.6575658185579663,3.6186774364238743,3.5766417293327226,3.5211839792713366,3.4624342105634422,3.401078825817416,3.3377127112047025,3.27284940114158,3.194924652630197,3.116127359187041,3.036983778296371,2.957907865130831,2.8792463253243583,2.8012815737820334,2.7242407939642055,2.64830575683362,2.573621282688089,2.500301333945918,2.4284336148252517,2.3580837426201335,2.289299135788446,2.222112267512262,2.156543184274112,2.0926015303688525,2.0302883142873456,1.9695974611389007,1.9105171073531821,1.8530306467205,1.7971175955721237,1.7427543349348544,1.6899147473523148,1.6385707498429631,1.5886927344317523,1.5402499368221665,1.4932107496589622,1.447542988157765,1.3590645335974794,1.2758133803526126,1.1975184668147265,1.123914279268441,1.0547438915161307,0.9897595782993592,0.9287230143162601,0.8714060365413706,0.8175914039206583,0.767072925994192,0.719655105178961,0.6751527530573558,0.6333907381169676,0.5942037216940891,0.5574357694740736,0.5229398890826499,0.4573350749235197,0.3999682393324162,0.3498127132086459,0.3059676573301692,0.2676429294340843,0.23414605251602277,0.20486975943024752,0.1792830346269346,0.15692100494321204,0.13737711261162802,0.12029593815967768,0.1053667008691219,0.09231765766358276,0.0809113209349602,0.07094022011372038,0.06222308463586562,0.05460150168192761,0.047937058877593156,0.04210886406080645,0.0370113365449908,0.03255224973665183,0.028651036608409668,0.025237330328711,0.022249684967498212,0.01963444224510674,0.01734473865892208,0.015339646811409481,0.013583429893049418,0.012044886564876471,0.010696774713525332,0.009515309444145637,0.008479727824035362,0.007571909335448385,0.0067760430611703785,0.006078336776131371,0.005466764315792471,0.004930846411258713,0.004461459936111276,0.004050671936999349,0.0036915961322286756,0.003378269745824104,0.003105548388492156,0.0028690170997726773,0.0026649164541676677,0.002490083228264452,0.002341905484524071,0.002218292449415854,0.0021176604829906097,0.0020389377025108574,0.001981591456977739,0.0019456851802374482,0.0019319747321038926,0.0019420598971402565,0.00197861538574335,0.002045739489278957,0.002149481042314766,0.002298642781807464,0.002506022730711978,0.0027903654040636293,0.0031797119369343777,0.0037158710228212114,0.004464402001019422,0.005527739811008521,0.00686854884239188,0.00835629336179087,0.010361856525860285,0.013112475587258176,0.015620448642951404,0.01880522579463312,0.022888011159583763,0.028178097528288214,0.03510679873820341,0.04122848360085526,0.04870457202381843,0.05788367503370236,0.06921497151815155,0.08327682221125582,0.10081134308082981,0.11949742670061064,0.14226508775632604,0.17007894577245547,0.20413106237862924,0.24588157853564171,0.29709825507887455,0.359888972694323,0.42787046573682475,0.489422156978397,0.5598659456449493,0.6402184460560537,0.7314806659461135,0.8345843423048246,0.9503212338834754,1.0564929568539956,1.1719294873328863,1.2965744315070922,1.4301208854608887,1.5719766238011865,1.7212412919017612,1.8766954148030675,2.023775787996477,2.173374195037701,2.323956709747055,2.439212520697068,2.553275434443497,2.6653632705933514,2.774713317333642,2.880599130225418,3.012102391866151,3.1352351459301273,3.248913730756117,3.3522589689788806,3.4446698708323646,3.5257975080558634,3.6027937444481877,3.654247278996303,3.696951147381506,3.73120706595659,3.7573893841516948,3.775926049921818,3.7900685914705656,3.791001112467303,3.7801710866387914,3.7640268721424524,3.741990270458067,3.714731258926389,3.6828845647344197,3.6470406440808936,3.6077377035830125,3.5565154987388246,3.5017489344818618,3.444117129642655,3.3842147148896533,3.3225596390480963,3.25324615419515,3.182854055313246,3.111830827213191,3.0405377321875795,2.969284160213313,2.8983285875589586,2.827885012182434,2.7581302232330764,2.6892100543786133,2.621243896026176,2.554328217149214,2.4885398780393873,2.4239392598578444,2.3605729026669837,2.2984755861538244,2.2376720494129625,2.1781785204038706,2.120004072680242,2.063151770566684,2.007619613358284,1.9534013331481959,1.900487089111831,1.848864069752848,1.7985170044389005,1.7494285945992551,1.7015798815073733,1.6549505636113588,1.5648866624555997,1.479473829559823,1.3985211562746425,1.3218347381400155,1.249221617995566,1.1804911912622047,1.1154561320756977,1.0539337913042777,0.9957475098268374,0.9407272488958105,0.8887096865051342,0.8395382292660345,0.7930631037504932,0.7491414040355303,0.7076369919877816,0.6684202956528917,0.631368095868349,0.5620462632867242,0.5003253513725296,0.4453818903219537,0.3964788563756317,0.3529577450479161,0.3142302317251316,0.2797707971927331,0.2491105532087718,0.22183164971766917,0.19756189023273601,0.17596971584294482,0.15675978954936418,0.13966915171237743,0.12446377098334749,0.11093539270285145,0.09889869654821985,0.08818878133258191,0.07865894246396261,0.0701786859521911,0.06263194438739117,0.05591548316081974,0.049937485815645576,0.04461629811148168,0.039879308483607594,0.03566194869207292,0.03190680378738254,0.028562821168332236,0.025584607492799116,0.022931802804896165,0.020568523236688743,0.01846286523687974,0.016586464869430894,0.014914106011906196,0.012065845054388158,0.009806531385897776,0.008014062175369027,0.006592179251481954,0.005464188152834115,0.0045695047514627,0.0038610559009172652,0.003302476804234482,0.0028655741148833087,0.0025286740599626076,0.002275759195353457,0.0021120898680016226,0.0020024515735842722,0.001944960637298189,0.0019429960209606898,0.002004974951264864,0.0021474379872119392,0.0024006966200125165,0.0028194038773195233,0.0035053365171631777,0.0041744585589220855,0.005113323783159488,0.006459252316419801,0.007734942394627206,0.009420965281484953,0.011681484946066136,0.01476406554031569,0.017550362557219215,0.02106596556343506,0.025541814484954625,0.03129597147978111,0.03876728930918566,0.04544369976226316,0.053568357346810785,0.06350463600526303,0.07571720957403423,0.09080008843941678,0.1095096408371998,0.12970854669102327,0.15427069224753515,0.1842081938867474,0.22076347286359746,0.26544688624403695,0.3200708850153371,0.3867734975607875,0.4547077539572808,0.5177633303491358,0.5895067950909045,0.6708536113008915,0.7626889891655716,0.8658176083958685,0.9808991056681964,1.0899340460704678,1.2082558072413734,1.335736549961848,1.4719855735121374,1.6163165308163747,1.767727883824262,1.9248979225714358,2.0849437281836614,2.215645375231078,2.3467345201474346,2.4770899624092118,2.6055710203602933,2.7310478985209707,2.86249500878632,2.9877906946788166,3.1058372397170735,3.215631633638476,3.316394439872016,3.4075498350190423,3.488721525329183,3.563246137701583,3.6265024200802896,3.678679025650587,3.712821523854177,3.740286815351008,3.7613673095760527,3.77638510210118,3.785683093352886,3.7896478243874046,3.782393359098495,3.7652056013373283,3.739342982629221,3.705971656373897,3.666170755227419,3.6209286628507287,3.571136598549729,3.5190456345165226,3.464034044859814,3.4066789395233794,3.3474799140154894,3.286873791620239,3.213292896771038,3.138788267901412,3.0638319478197147,2.9888029824527695,2.914021723468368,2.83975253679736,2.7662112407723582,2.693573343796534,2.6219811735232867,2.5515490387637403,2.482367186181892,2.4145054414764355,2.348016625708188,2.2829394304924002,2.2193006680745175,2.1571171046507507,2.096397073782262,2.037141901204196,1.9793471015005502,1.923003355660698,1.8680973284345652,1.8146123744339024,1.7625291474993985,1.7118261148642964,1.6624799866736404,1.614466079039966,1.5677586250061344,1.522331040358098,1.4331356711297187,1.3489613857887979,1.2695673868593345,1.1947150732203378,1.1241714565346748,1.057710107848776,0.9951116473339456,0.936164741598998,0.8806670715469573,0.8284256669867003,0.7792567390867137,0.7329854508973113,0.6894457908310729,0.6484804270571968,0.6099404360257412,0.5736849456748454,0.5059143728601635,0.44614870130780926,0.3934514078638403,0.3469928555002648,0.30603922063794264,0.2699414583134807,0.238125640315379,0.21008479415704062,0.18537157645043364,0.16359140504543537,0.14439619891360722,0.12747891919402368,0.11256883979170955,0.09942734570916086,0.08784414800416394,0.07763391443399971,0.06863331685196927,0.06069844445067611,0.053702514913517324,0.04753384079706511,0.042094032150634036,0.03729641679154663,0.03306465105115429,0.029331493397576826,0.026037720663239852,0.02313117246250002,0.02056591030238891,0.01830147730175378,0.016302245587022524,0.014536840874020372,0.012977635611837096,0.011600302854124894,0.010383423524093431,0.00930814055343669,0.008357854350468508,0.007517954825793325,0.006775585718401133,0.006119437398914638,0.005539564791930448,0.005027227518022931,0.004574749742378609,0.004175397532097885,0.003823271810149253,0.003513215275123768,0.0032407319281360547,0.003001918105756581,0.0027934041707461986,0.002612306280207009,0.0024561879527080915,0.0023230315118330422,0.002211219922881315,0.0021195301091669508,0.002047139605522133,0.0019936494851237755,0.0019591280436048845,0.001944181995619068,0.0019500653382798392,0.0019788412167090798,0.0020336201611313104,0.002118910740505107,0.002241139030100468,0.0024094265682961177,0.0026367719318258257,0.0029418753248277446,0.003352009211870775,0.003907628407019577,0.004670177346286372,0.005734075692278187,0.00696000517679664,0.008633821469791024,0.010960370842979541,0.01333095331381453,0.0164514188860344,0.020612233100812217,0.024824280063760633,0.03019412869038299,0.03709931111781962,0.04606147586390788,0.053878300098629206,0.06334470646555375,0.07485816770710225,0.08892348601190843,0.10617818528691425,0.1274239401619867,0.15366896994469142,0.18257695826257697,0.2176799261232452,0.26034917013265335,0.3122258298357572,0.375242005840995,0.43383950724043596,0.5018208755907242,0.5804467312050702,0.6710041969825528,0.7513747224726292,0.8404534376813029,0.9387182013356521,1.046516635350531,1.1640221704752658,1.2911891805170657,1.4277043346125533,1.5729421757450397,1.7259345170585088,1.8853598326396999,2.033037373307108,2.183135624916075,2.3053541716735033,2.4272412076484104,2.547873361277166,2.6663272529626956,2.7817015229079662,2.915450928773744,3.0420692377694105,3.160395879994792,3.2694234127438175,3.3683991487331424,3.456806959085342,3.534357755004262,3.6137851899773454,3.6625567120181795,3.7027865081152918,3.7347890646157103,3.7589442825793684,3.7756786899321915,3.787219040405668,3.7876205439272255,3.778015020222351,3.7595562608201467,3.7333275236076053,3.7003477601130266,3.6615644785865387,3.617844072678316,3.569966901237139,3.5158338809234206,3.4585833050590167,3.398852461474852,3.337193782096496,3.274086493783394,3.1978268480059038,3.120681287441163,3.0431539239759338,2.965644398936468,2.8884885724478124,2.8119613046522614,2.7362849085037335,2.661638389738456,2.5881653555001214,2.515979691483915,2.4451698936074386,2.375803043515321,2.3079285187483487,2.241581089698461,2.1767833223578292,2.172146582097144]},{"type":"scatter","name":"y0 = 4","mode":"lines","x":[4.0,3.9992675720240163,3.9985352041391202,3.9969973894582647,3.9954596593938305,3.993922107792264,3.9906937566675427,3.9874661142997314,3.9842391759215863,3.9774649042629484,3.9706938024788165,3.963925901402356,3.9497238919297075,3.9355363719304406,3.9213637108167405,3.907206191061584,3.8775260269656626,3.8479167000870915,3.8183809201953016,3.7889213659855008,3.7273160808067898,3.6660825134264803,3.6052437370179278,3.5448221422301605,3.4848393169723746,3.3603949338978905,3.238156419722761,3.1182874217004555,3.000934586169223,2.8862272438032224,2.774277562666573,2.548561564285653,2.3360512087080916,2.1371015088582337,1.9518056611881505,1.7800275441481348,1.6173501543364661,1.4680259624857313,1.3314793336103898,1.206964207399408,1.0937140445729219,0.9909366494401229,0.8978313185271476,0.8136099657331178,0.7375141065376126,0.6688236311297233,0.6068604610313744,0.5509911639722952,0.500629241201052,0.4401615232937383,0.38763609591393305,0.34198455181162074,0.30227640578365145,0.26770292894117265,0.23404020207511275,0.20516606595687314,0.1803352704366027,0.15894598598971224,0.14048021483270598,0.1245013737893707,0.11064315827637838,0.09859711364748396,0.08810197010866463,0.07893612499344284,0.07091201737735671,0.06387094372673846,0.057678173976533055,0.052218888980076886,0.047395075909375944,0.043123041057035606,0.03933122295063796,0.03595826193014573,0.03295139659459068,0.03026517566044423,0.027860391840100633,0.025703161856035755,0.023764133484587467,0.02201782089761618,0.020442053769350953,0.01901751286892751,0.017727331256253632,0.016556752270202348,0.015492839553741802,0.013621309407087731,0.012062648236322667,0.010757006200224743,0.009657380116009749,0.008725778709420769,0.007931802884532149,0.007251638974605135,0.006666507362135236,0.0061611380256460496,0.005722895537301123,0.005341407856920917,0.005008245651600094,0.004716500607597898,0.004460405625939771,0.004235106688333024,0.004036535296552979,0.0036917984542624263,0.0034254030238599106,0.0032209306913266386,0.0030659018115864567,0.002950473993057849,0.0028669368506352064,0.002810486354910596,0.0027772670881550453,0.0027646577919292095,0.0027704968836927807,0.0027929941348848806,0.0028309089455298975,0.00288349268889903,0.0029502453290747676,0.0030307909950649387,0.003124927892434368,0.0032326747624730604,0.0033542191596564372,0.0034898458129010946,0.0036399268224537704,0.0038049487951773036,0.003985516815417979,0.004182331365220582,0.004396174104362093,0.004627915552755852,0.0048785257249247095,0.005149073414271345,0.0054407214946268585,0.005754729363549398,0.006092461155192091,0.006455392195615939,0.006845112226469164,0.007263329677542538,0.007711879200268899,0.008719670382002814,0.009877768479207296,0.011206992511686394,0.012731217534535471,0.014477770888615299,0.01647793156624567,0.018767494742482703,0.021387404104822177,0.02438447194281306,0.027812209300967002,0.031731780540238785,0.0362130939286429,0.04133604526762963,0.047191938351147905,0.05388510955794668,0.0615347854700203,0.07027720539002306,0.080268045944121,0.09168519129721073,0.1047318987730936,0.11964041618789856,0.13667611491736598,0.1561422120483597,0.17838516570634377,0.20380083963304538,0.2328415465804623,0.26602409558043727,0.303938985995626,0.34726091163600314,0.39676076136195915,0.45331932889637644,0.5179429745312409,0.5917815154926868,0.676148660303757,0.7725453458927709,0.8826863846456608,1.0085308818848002,1.1523169411694536,1.3166012319777607,1.5043040435527018,1.7187604706678568,1.963778325854869,2.2437031356149015,2.5634898668981676,2.9287790649944148,3.345967796442634,3.71164092271405,3.9852370624504636,4.2787398161008445,4.593425241439232,4.817117481393295,5.051233995011329,5.29603557606456,5.482231995103992,5.674223318176759,5.871907725135926,6.075048316715148,6.2265876425988145,6.3805507762194145,6.536567720369442,6.6941180717689575,6.852481175931064,7.010671231112105,7.129132823221836,7.245991898058882,7.360302302395019,7.470872989091254,7.576211998835781,7.67446215680802,7.763320217594982,7.839944744145897,7.900860675314956,7.941869813742522,7.957039451090793,7.953261738991195,7.927258582540401,7.889107635954665,7.833381896856626,7.758279136666085,7.662045459675411,7.543050065334894,7.399875576218522,7.231428998151112,7.037064348977739,6.816703747206786,6.570944877402465,6.301142630066377,6.045768297473751,5.775432524651307,5.492546609767106,5.199884285055312,4.900492646754476,4.59758514427323,4.294417516648334,3.9941588463925983,3.6997725654483613,3.413917493358553,3.1388737304583,2.9022723093436062,2.6769630294129465,2.4636944436889574,2.262947118113722,2.0749529463135206,1.8997208674689106,1.7370697114511215,1.5866642312603552,1.4480490065595633,1.320678435469252,1.2039435155297138,1.0971958176506134,0.9997680465070203,0.9109906222968384,0.8302044933728217,0.7567708543795048,0.6900783350935273,0.6295479827113462,0.5746363210848935,0.5248368586402243,0.4653634571534131,0.4131955966678048,0.36741971683160823,0.32723072710937073,0.29191989673803703,0.25732796245199896,0.22735178290800628,0.2013244391308865,0.17869396089061546,0.15898144859598987,0.1417779116156995,0.12673549362457526,0.11355763521505294,0.10199045169127435,0.09181639339319303,0.0828493397393937,0.07493009031990007,0.06792214118980625,0.06170811604033297,0.05618695127766706,0.05127158968921586,0.046886950724453036,0.042968139827328236,0.03945894116426101,0.03631058006530074,0.03348068358958341,0.03093238065802997,0.028633523957727836,0.026556030541800845,0.024675327203841427,0.022969878185281685,0.02142077776636301,0.020011399139266986,0.01872709406906746,0.016452131075924782,0.014550221685979432,0.012951442116394714,0.011600504829202057,0.010452602126887716,0.009471718400737817,0.008629391364700579,0.007902990826574176,0.00727406327061305,0.006727331628750399,0.006250211045640966,0.00583240856066364,0.00546545022493502,0.005142255955906281,0.004856863400909454,0.004604259311455382,0.004172946698042365,0.003832888156480502,0.0035646354382809636,0.0033537185101433185,0.003188396782408157,0.003059665362254373,0.0029612483237643683,0.0028887192210922752,0.0028385496953885164,0.002807781162813068,0.002794104308720973,0.0027958517561400705,0.00281179919141689,0.0028409789932911157,0.0028826284854086134,0.0029362036431270725,0.003001361930043171,0.0030779105009666615,0.003165766459947121,0.0032649466354919216,0.003375567205151312,0.0034978354516713986,0.003632036575809214,0.003778525349215857,0.003937724184659201,0.004110122660609781,0.004296275546564087,0.004496800635630159,0.004712378246470039,0.004943752251647424,0.005191731493600725,0.005745112201603417,0.006377442867951549,0.007097943958984967,0.007917161841880896,0.008847090681451463,0.009901343742090694,0.011095358996672437,0.012446615837479955,0.013974872441820205,0.015702446867354534,0.01765454623314184,0.019859634783136612,0.022349841660712758,0.025161422334174892,0.02833528562613698,0.03191758998255976,0.03596041278302425,0.0405225035679017,0.04567013565673365,0.051478068765826154,0.05803063427233296,0.0654229579714356,0.07376233930356653,0.08316980800214496,0.09378188018570251,0.10575253855699786,0.11925546553449425,0.1344865622460983,0.151666789982459,0.1710453749445909,0.19290342256337922,0.21755799393431055,0.24536670356999163,0.27673290496915093,0.3121117053230476,0.3520157445385493,0.39702452696028456,0.44779017229067697,0.5050491556075362,0.5696318797629326,0.6424748419632281,0.7246342860925657,0.8173015076976293,0.9218200516794501,1.039705336293732,1.172665630746636,1.322628152938238,1.4917654352563812,1.6825268240125772,1.8976732028564585,2.140315445753418,2.4139565969413947,2.722536995906657,3.0704796905855947,3.462728046033476,3.764423427210276,4.092147075858928,4.342875662577408,4.608627492297475,4.890110081920525,5.096321418756258,5.310656426788304,5.533189900663349,5.763865292636916,5.928924273829567,6.097630058231955,6.269707882748328,6.444735537768441,6.622088766355372,6.751179505332816,6.880567345161249,7.009658491184677,7.137685064298413,7.26365952603201,7.386320084495323,7.491348323728556,7.591063563369472,7.683707635082095,7.767116080693318,7.838644212426849,7.895090268269391,7.932621878249051,7.94672145285122,7.937261854633136,7.905567681363722,7.862086359830666,7.8005161285594875,7.719073808218002,7.616044660456485,7.48986420688876,7.339214051113367,7.163135847050489,6.961153623998794,6.733391296001212,6.480672816410235,6.2045921676599916,5.950145113575605,5.682140375191944,5.402945224889728,5.115231711662623,4.821892404536342,4.525943323857216,4.230412018045243,3.9382225974919245,3.6520920095776273,3.374445920267284,3.1073569879071825,2.852506463261037,2.636204770655162,2.4313343944333203,2.2382917844954173,2.057260462420221,1.8882322084682608,1.7310321871135992,1.5853484795772657,1.45076266538013,1.3267770363517566,1.2128375922837642,1.108354073058716,1.0127176557285194,0.9253158471021883,0.8455441500636766,0.7728147985470206,0.7065632131290436,0.6462526488499079,0.5913772559855897,0.5414637497812684,0.4822966943182172,0.43012283588974404,0.38410410831706865,0.34349721745003897,0.3076431061904672,0.2723428721812688,0.2415909343358342,0.2147566379848793,0.1913111874082467,0.17079374472050537,0.15280808983639935,0.13701477708292645,0.12312250399607196,0.11088047668237913,0.10007263202440354,0.09051306470987112,0.08204184191787846,0.07452110674140991,0.06783175463651336,0.06187076046375976,0.05654896176295455,0.051789109700223636,0.04752415054479174,0.04369576722521761,0.04025316701067662,0.037152055811746965,0.03435374905593972,0.03182440125296172,0.029534348840691494,0.027457553091075754,0.025571123328086552,0.023854904652441018,0.022291121539502516,0.02086407146849438,0.018326421210162046,0.016200429670054466,0.01440983397110165,0.012894120742493494,0.011604157836603625,0.010500342592479747,0.009551238915173078,0.008731750756014763,0.008021373049605115,0.007403113810647884,0.0068629500862577774,0.006389380970285294,0.0059729156649453415,0.005605614968460529,0.005280787784173802,0.004992800815353698,0.0045068465710236365,0.004120396840623135,0.003812310847599249,0.003566751594749309,0.0033708989902810054,0.00321489434401899,0.003091765028591158,0.0029965049314683865,0.0029251064428232392,0.002874215783972008,0.0028411905893369824,0.00282407457417672,0.002821389265975421,0.0028319420149869176,0.0028547676492931165,0.002889135306010976,0.0029345264763760786,0.0029905804037734973,0.0030570518692364236,0.003133798180460068,0.0032207762866881345,0.003318032723710048,0.0034256890019727514,0.0035439317991005494,0.003673009517451591,0.0038132304333801763,0.003964959516719031,0.004128615095383706,0.004304667137302406,0.004699659995108542,0.005152169710421327,0.005667992515640727,0.006253838175927598,0.006917371332341034,0.007667302988135732,0.008513511948219296,0.00946716346565703,0.010540833035698596,0.011748661500455419,0.013106544912601685,0.014632344570829939,0.016346113584351684,0.01827035222960137,0.020430302210821216,0.02285427924420765,0.025574042300392702,0.028625205351941407,0.0320477012278963,0.033898304565253855],"y":[4.0,4.00047084655599,4.000941592615204,4.001929895527186,4.00291805755655,4.003905922264887,4.0059795936879485,4.008052090518148,4.010123424023127,4.0144694274910515,4.018810245727091,4.02314585760967,4.032233584594,4.041298098476687,4.050339150942383,4.05935655258225,4.078215211731278,4.0969668540185795,4.115609679566989,4.1341419153391445,4.172691973426431,4.210731013916865,4.248244128872212,4.285217000684408,4.321636001461225,4.396256380738592,4.468268310507124,4.537575908415579,4.604097236043161,4.667764361819655,4.728523084290994,4.846485907368096,4.951266341713389,5.042891706642838,5.121586120049672,5.187742629564764,5.243164266358569,5.286636291776931,5.31885840088378,5.340652628960943,5.352834814114636,5.356221756979274,5.351618726799183,5.339803575654512,5.321514291820153,5.297443359283561,5.268236244079672,5.234490562064059,5.196755365123117,5.1400810460301125,5.078096802322164,5.011778999691075,4.941972783258598,4.869405580168134,4.7851861328293355,4.698991467816497,4.611477120926304,4.5231599128152205,4.43447938636832,4.34579901832869,4.257416646861397,4.16957630603401,4.082478379079978,3.9962866542356488,3.9111335431568826,3.8271249288898375,3.7443447800798118,3.662858991165488,3.582718297419321,3.503960602190974,3.426613033162454,3.3506937669109034,3.2762135443745826,3.203176883975712,3.131583084161832,3.061427090213738,2.9927002424353826,2.9253909022023676,2.8594849689588937,2.7949663147927453,2.731817156940833,2.6700183763171,2.609549786123294,2.4912042284884337,2.378034882919882,2.2698537345179415,2.1664708056492263,2.0676975122347363,1.9733476823397307,1.8832381652976071,1.7971899738816814,1.7150294127340797,1.6365885827936992,1.5617054003293764,1.4902235762094298,1.4219927065076867,1.3568683332652676,1.2947118656198953,1.2353904118202634,1.1194835441550042,1.0144212878363457,0.9191973974699575,0.832896902797025,0.7546886118076379,0.6838176633322498,0.6195978901822079,0.5614068656374234,0.5086797797771944,0.46090457682828023,0.4176170545722434,0.378396248769968,0.34286043614952255,0.3106636415570325,0.2814923685637877,0.2550625022987462,0.23111651387381385,0.20942100813785075,0.1897645143230803,0.1719554315746359,0.15582013857349108,0.14120130202567582,0.1279563670505306,0.1159561815592157,0.10508373152814904,0.09523299327191498,0.08630790384206748,0.07822143198531624,0.07089473065192244,0.06425636460196497,0.05824161255624343,0.052791838201496556,0.04785391992523763,0.043379731844263095,0.03557552268565566,0.029180871886537712,0.02394153886538421,0.019649213037357213,0.01613223773919195,0.013249678365447859,0.010886597866906026,0.00894929777776622,0.007360985247932596,0.0060585282819594615,0.004990159205249129,0.004113582729129513,0.003394232878552674,0.002803774211312888,0.002318948619417856,0.0019206987384488916,0.0015934381314534581,0.0013244129215031913,0.0011031689841252564,0.0009211331796181644,0.0007712828687800479,0.0006478710865647203,0.0005461933249785056,0.0004623956263556932,0.00039332156253644486,0.0003363893348056269,0.00028949027124437884,0.00025090457555250245,0.00021923300917866103,0.00019334276924003863,0.00017232491899441769,0.0001554612792352603,0.00014220008394859662,0.00013214076470444798,0.0001250289553795437,0.0001207640801174248,0.00011942454306100719,0.00012132041912556846,0.00012709252960622184,0.00013789442421686376,0.0001557303754267393,0.0001841018445650316,0.00022929533735597252,0.00030307733499841156,0.00042866258382648787,0.0006559925604061894,0.00097702025525355,0.001334690024092721,0.001869299234027579,0.00269844528031544,0.003527543871016669,0.004682692813216405,0.006318538494434765,0.00796241551176483,0.01013223744216403,0.013023323014681846,0.016915069602866734,0.020619656197916236,0.025280089185925173,0.03117536625882642,0.03867590625101444,0.04827397218000612,0.060622989504868656,0.07228909236226883,0.08649007816137096,0.10382399414651573,0.1250372005039668,0.15105819828180675,0.18303569201954464,0.22238609568330123,0.2708466584019288,0.3305284426989575,0.40396223157686934,0.4747874748149858,0.5581053908350435,0.6558235673273716,0.7436896568674473,0.8426127244402255,0.9535661859468025,1.0774540475944865,1.2150570166982504,1.3669689891100225,1.5335204899456532,1.7146958398717833,1.9100539646938228,2.1186617965164776,2.3390489932167426,2.540946999678371,2.748682324856421,2.960258329122457,3.1734612908541764,3.385932675905433,3.5952524910183206,3.7990334042115292,3.9950161708288046,4.181155028630589,4.355685803740671,4.517173745975809,4.650376659431719,4.7716171926371835,4.880592690774218,4.977208614248544,5.0615592968615255,5.133904682257435,5.194642026635597,5.244275733681889,5.283389539251757,5.3126223502664605,5.332647025838924,5.344151672660944,5.347823882517703,5.344338312262656,5.334347375522281,5.318474449001753,5.29730910546042,5.27140409650417,5.241273844162379,5.207394129551937,5.156930491800915,5.101473438054146,5.0418612532278715,4.978828510564392,4.913016163810791,4.836548321011794,4.757943448438234,4.677792850905764,4.596576325805442,4.514706052920383,4.432528709499801,4.3503337485138625,4.2683627937425905,4.186817858856772,4.1058673066768305,4.025650412272133,3.946281583562146,3.8678543490663526,3.790444728280883,3.714113874646683,3.6389102344456514,3.564871454049688,3.4920260700179657,3.420394932169016,3.34999236919881,3.280827166826649,3.2129034161487673,3.146221248418678,3.080777457397557,3.0165660218026322,2.9535785495766995,2.8918046608978636,2.8312323178813346,2.7718481058135658,2.654868800338871,2.5425945893063697,2.4348817553731217,2.3315806973323214,2.2325397051643825,2.13760634942862,2.0466284183390986,1.9594553252184426,1.8759394635802367,1.795936928071563,1.7193077327768096,1.645915954253217,1.5756299557290658,1.508322571339755,1.443871147921907,1.3821574867008086,1.2641211626013156,1.1561258907063614,1.057327850691835,0.9669513079361657,0.8842846787651685,0.8086750423252165,0.7395231163880083,0.6762794104282004,0.6184407762975477,0.5655467122338604,0.5171756286481425,0.4729415196209735,0.43249109569731525,0.39550114822033816,0.3616760134366373,0.3307451952825122,0.30246122448219565,0.27659773518014047,0.25294769400790273,0.23132175191742196,0.21154672848465744,0.1934642349929375,0.17692942091743896,0.1618098229638278,0.1479843063271528,0.13534209557249532,0.12378189055698925,0.11321105862508422,0.10354489448001539,0.09470594208288924,0.08662337453047644,0.07238467440922873,0.06049212262528414,0.05055961150017706,0.0422646088586786,0.03533666533335695,0.029549584438611005,0.0247150008947463,0.020676080803536896,0.017301810896100757,0.014482546216753815,0.012126665238403944,0.010157767827360926,0.008512138073590872,0.007136549943577788,0.005986507699981339,0.005024846755209654,0.004220556304988193,0.003547755455174712,0.0029848259842854587,0.0025137046645811183,0.0021193059227423276,0.0017890367971738026,0.0015123834247064013,0.0012805637515982762,0.0010862413430271069,0.0009232891989046502,0.0007865917172528813,0.000671877505683718,0.0005755795276687604,0.0004947193355337369,0.0004268110953896332,0.00036978131565101576,0.0003219015641075127,0.00028173251173671375,0.00024796823497951213,0.00021996685697850572,0.00019635287409242746,0.0001769467206868428,0.00016102042028633113,0.0001481179634418759,0.00013794935447770785,0.00013031015308565878,0.00012506493460548635,0.00012218561047595226,0.00012164034366577079,0.0001240567158164488,0.000129681459490613,0.00013948588253611101,0.0001550107508411837,0.00017869995121961023,0.00021465814671617694,0.00027007901410052993,0.000358040113722248,0.0005034237236176451,0.0007567933785884249,0.001056247751953223,0.0015289578447939599,0.0020442076180126312,0.0027929005344309176,0.003906705302522594,0.005020437209388065,0.00653290669617442,0.008613557180359081,0.011517071618835922,0.014225481945033439,0.01769367022084938,0.022166155849396817,0.0279774638410758,0.03558529215795327,0.0425521098409179,0.0510847379313717,0.06157361700457335,0.0745148055629563,0.09053776657252381,0.11043827160239185,0.13221057869867017,0.15872748162708564,0.19107445114301935,0.23058040712122826,0.2788598857540737,0.3378551090291267,0.409873060506432,0.49760652761996643,0.5829979455896307,0.682726482919516,0.7738452196206334,0.8762944387385984,0.991023652790587,1.1188988380439986,1.2606438382022573,1.4167731835232955,1.5875139202583464,1.7727238130462397,1.971815608252817,2.1836964848323,2.4067318179967847,2.6059197839528982,2.8100695198419943,3.017245604543347,3.225335724355918,3.432118206594849,3.635336990867843,3.832785983699978,4.022393652196167,4.202296964292444,4.370898702420533,4.52690665267712,4.669354519760662,4.784629481581863,4.8883260204714505,4.980390833166814,5.060931900652828,5.130198975987415,5.188561830314277,5.23648553881334,5.274505449598258,5.303205261509188,5.323198793804845,5.335114364903929,5.3395812184563525,5.33721832461047,5.328625847799331,5.314379001560986,5.295023735654864,5.271073858096774,5.243009403269955,5.211276079044148,5.164342851296651,5.112565904602356,5.056716299154028,4.997474213095136,4.935437667905768,4.863146262222214,4.788623665296727,4.712431568074784,4.63503259927672,4.556826351816078,4.478151772518109,4.399294575278915,4.320495510682779,4.241957662237002,4.163851884451275,4.0863210602442255,4.009484021701725,3.933439231165132,3.858267920629475,3.7840366013482845,3.7107991388585027,3.638598584184573,3.567468795304706,3.4974358135666654,3.4285190052662533,3.3607320268592327,3.29408366324177,3.228578555413047,3.164217821004759,3.1009995795949465,3.0389194019194274,2.9779706982804894,2.9181450541309313,2.8594325180215674,2.7433629859416757,2.6317469343667494,2.5244635442893713,2.421384044541473,2.322375731357963,2.2273035620457864,2.136031258435786,2.048422858922425,1.9643442047103405,1.8836637767231679,1.8062530124727667,1.7319865330284272,1.660742441290617,1.5924025730498914,1.526852598613414,1.4639820174508278,1.345327410781959,1.2362446389676602,1.1359730014156089,1.043809194201769,0.9591046094509073,0.8812609143231476,0.8097259857798834,0.7439909347430599,0.6835874382049189,0.6280847357947598,0.5770865072121922,0.5302280852093567,0.48717407020284226,0.44761612477446633,0.4112708207720539,0.3778776008660708,0.3471969364795031,0.31900866895677904,0.2931104736081497,0.26931641973039705,0.24745563831061093,0.2273711062857879,0.20891853492454313,0.19196534390437678,0.17638971241428736,0.16207970609666375,0.14893247678885427,0.13685352783445967,0.125756037641192,0.10603986279195225,0.08942046104071101,0.07541200811525745,0.0636049045482061,0.053652754928087104,0.04526323220781697,0.03819049572676934,0.0322278254765571,0.027200945956401445,0.022962725748448837,0.019389096050784618,0.01637560285145983,0.013834297993107095,0.011691039881191502,0.009883292265076907,0.008358341297685774,0.00707178445658123,0.005986215516163707,0.005070103177650825,0.0046700284766301595]},{"type":"scatter","name":"y0 = 5","mode":"lines","x":[5.0,4.999057563245705,4.9981152042700145,4.996136454774522,4.994157814820267,4.99217940588923,4.988025403776667,4.983872319311081,4.979720146400431,4.9710035600944815,4.962291079546564,4.953582745405232,4.935308957145971,4.9170539482356,4.898818205962343,4.880602103032257,4.84241398393502,4.804317838263749,4.766317244850599,4.728415742521631,4.649160547649999,4.570389361882609,4.492132721541095,4.414420278217007,4.337280640820525,4.177273039935689,4.020150944867017,3.8661317377418967,3.7154103718441505,3.568158860247083,3.4245264126968813,3.1352134379372973,2.86324800013489,2.6090974771992057,2.3728785170721474,2.1989282364303877,2.0358269853453557,1.8832834746254556,1.7409453645010315,1.6084124316410089,1.4427579911871509,1.2932854137716294,1.1587865172625715,1.0380162240638395,0.9297761855715879,0.8329129849151602,0.7463300922886387,0.6690021359787629,0.5999831123783987,0.5324119783354748,0.472858829076915,0.4203653209724048,0.37408624958087333,0.33327060684765814,0.292649689113848,0.25739566446941686,0.22675856613578857,0.2001085838020577,0.1768972124630592,0.15665297390485217,0.13897194100672294,0.12350758268464132,0.1099617996131364,0.09807805247031734,0.08763586337640439,0.07844580349456294,0.07034485560882185,0.06319245293457729,0.05686727204740956,0.05126456346143815,0.04629380932026248,0.041876662687756604,0.037945196833103906,0.03444044627929956,0.03131117158173986,0.028512790095342713,0.026006450687884805,0.02375824464518957,0.021738536705689995,0.019921393024834335,0.018284087336660117,0.01680667474011991,0.015471625831741763,0.01426351295776289,0.012148245261293895,0.010405883562996132,0.008963528993804756,0.007763848685244766,0.006760644969838885,0.0059170100764328075,0.005203998510727868,0.004598798128750761,0.004082962495463385,0.003641344506118205,0.0032615873385449527,0.002933700614876831,0.0026495522548227236,0.0024024147008990114,0.0021866785629338125,0.001997682499959359,0.0016806964121609102,0.0014330452353120498,0.0012380090756870664,0.0010834476046475531,0.0009594276001674165,0.0008583705125082654,0.0007752682736333674,0.000706779334951899,0.0006501624501111718,0.000603000704299013,0.0005289062814653032,0.0004759231502755802,0.00043921260986080977,0.0004155283121797935,0.000400971711075454,0.00039254536822661565,0.00038909989491173376,0.000390470426474185,0.00039637264588432446,0.0004062480662065999,0.00041968217044603754,0.0004366017834732741,0.0004571081889163488,0.00048128749552425184,0.0005092052030910352,0.0005409908250015837,0.0005768677127965437,0.0006171176210036433,0.0006620492362566959,0.0007120030277961165,0.0007673696408069058,0.0008285961676173891,0.0008961816377493081,0.00097067520201997,0.001052681557453703,0.0011428685280277123,0.001241972501618138,0.0013508026311117043,0.0014702463541371182,0.0016012768011593012,0.001744961066276772,0.0019024687089484779,0.002075080824304724,0.0022642002060770075,0.002471362717803633,0.002698249745202121,0.002946701725146395,0.0032187329277083877,0.003516547687596912,0.003842558210185099,0.004593364269913606,0.005493322674283316,0.006571877281475611,0.007864299953001282,0.009412800803943579,0.011267923331737331,0.013490226617725485,0.01615226282306783,0.019340926279023438,0.02316028157530301,0.02773496658207774,0.033214265584461604,0.03977697818214264,0.04763724909715878,0.0570517222707655,0.06832726198224631,0.08183204796675972,0.09800667464488277,0.11737883354579688,0.14058060638505804,0.1683690533807879,0.2016508679086279,0.24151195732341477,0.2892531214098173,0.3464316278563473,0.41491346137188734,0.49693295202946103,0.5834372589555946,0.68499846856792,0.8042364906246169,0.9442291022516262,1.108590466756245,1.301562719243184,1.5036380500603914,1.7370841935958161,2.006769861784394,2.3183215749358537,2.6782393503717117,3.094028995895729,3.574356002238838,4.129219560141513,4.770133770556146,5.181430153848023,5.6280293484125945,5.985683577548513,6.36576494918528,6.631278750035865,6.907503310905945,7.194663988881987,7.404338024091988,7.619497739734469,7.840029015102397,8.065684510112819,8.230099479000735,8.39667200779094,8.565052504407806,8.734747353855237,8.905072155136057,9.075087245970526,9.213317654120596,9.349543067482157,9.482548639335032,9.610761894676298,9.732158301364267,9.823114811784793,9.906320382317666,9.979739770118181,10.040912880200441,10.086891471695703,10.114180133344185,10.118683030759225,10.099595387756642,10.054770260391704,9.998953871956214,9.922668550100008,9.823760568238196,9.700099778979407,9.549661813436686,9.370629177514699,9.16151786856611,8.921320706731306,8.649654384629164,8.346897690907563,8.014307039141272,7.654092347695059,7.330546648840614,6.991976420204229,6.6412438164168535,6.281536987589606,5.9162729972313235,5.548989067736079,5.183216401566973,4.82235083897416,4.469537567557424,4.127578819755384,3.798866420881693,3.4853395937496026,3.188468639015529,2.900455346145325,2.6318711052220007,2.4306330140167707,2.241975404737475,2.0656821873848363,1.9014302708134159,1.7488103905817596,1.5529587503760678,1.3776266964089978,1.2212493649482843,1.0821687524015215,0.9587756205006783,0.8495170900763622,0.7529183888092953,0.6762939324933508,0.6077532961027552,0.5464713574974268,0.49169187957746546,0.44272619837586696,0.3989526359090502,0.3598125526931609,0.3248044004486459,0.2934783751055891,0.2654322547228948,0.24030748177160471,0.21778491434817265,0.19758057121316677,0.1794418471070203,0.16314424932253466,0.1484884370068674,0.1352974420948523,0.12341412207949708,0.11269890992008995,0.1030278413574728,0.09429079586839939,0.08638991299001943,0.07923817941787967,0.07275818397437447,0.06688102218989524,0.06154532650247541,0.05669640513513829,0.05228548006932729,0.0482690153908216,0.04460812523336589,0.04126805054408394,0.03821769612982299,0.035429221441986736,0.03050666395486159,0.026374161347472645,0.02289237031731089,0.0199484924549957,0.017449993234347063,0.015321241124830803,0.013500929886944787,0.011939194690340932,0.010594943983887023,0.009434032811105632,0.008428128961225953,0.007553785211209917,0.006791519368734963,0.00612501350552549,0.0055405335003754054,0.005026516172793907,0.00457322210763234,0.004172417743601488,0.003817106939443596,0.0035013251549730713,0.002951921933852818,0.0025144995297148656,0.0021635261411616273,0.001879992164266797,0.0016487795606956515,0.0014582290099341027,0.001299900042996728,0.0011676485452180192,0.0010566310421334937,0.0009174355163833577,0.0008087445838598566,0.0007227128403784242,0.0006537377642702857,0.0005985353745809219,0.0005452488059804905,0.000505471547722524,0.0004748165697881904,0.000451629796857423,0.00043447129096554644,0.0004222061832416166,0.0004140117456597337,0.0004093259504000921,0.0004077416429749805,0.00040893331796599305,0.00041264468874288823,0.0004186945650279849,0.0004269653911866613,0.0004373810064435181,0.00044989348655185716,0.0004644819094498071,0.00048115275972698617,0.0004999361260617911,0.0005208806517307848,0.0005440511693405902,0.0005695286743193421,0.0005974102638451894,0.0006278082526022324,0.0006608493626388449,0.0006966746690595074,0.0007354400213678443,0.0007773164413108346,0.0008224904418527,0.000871164494439852,0.0009235577411749559,0.0009799068554444629,0.001040466958826428,0.001105512609330824,0.0011753389140089728,0.00133090023145137,0.001509777305742328,0.0017152310038761659,0.0019510042489079918,0.0022213845239129316,0.0025312811251440724,0.002886317161553436,0.0032929314166829787,0.0037584915819396103,0.004291425793701681,0.0049013763722996545,0.005599375260898978,0.006398042245030162,0.007311811354002098,0.008357191595652583,0.009553065975984893,0.010921032442393836,0.012485792928373287,0.01427559881566061,0.0163227612195332,0.018664234464847485,0.021342282759348654,0.024405242550860292,0.027908394842161028,0.03191496302462937,0.03649725380407323,0.041737961807992996,0.04773166173145846,0.05458651503935287,0.062426221816958144,0.07139225285874272,0.08164640238206167,0.09337370755519633,0.10678578747598118,0.12212481171064653,0.1396671375879902,0.15972997797163274,0.1826748148764508,0.20891587448737184,0.23892671015781525,0.27324882407235795,0.31250152296470673,0.35739311800321866,0.40873388136718386,0.4674498367230524,0.5346008311564973,0.6113984918705427,0.699228533700858,0.7996758120690869,0.9145528687187162,1.0459325862501592,1.1961855844980565,1.368023001670877,1.5645453932721192,1.7892986189887115,2.0463377169563493,2.3402998728873694,2.676487678465559,3.0609638870858906,3.500658617066594,4.003488789481491,4.578483429568248,5.107603665150891,5.475025148439697,5.868696590891932,6.165176893991333,6.476364710011102,6.802811449178018,7.033733699611414,7.271997764807634,7.517605253890556,7.770423283556515,7.9476469909611716,8.12791427005153,8.310934490441387,8.496273698133392,8.683301698674924,8.818068917767615,8.952808157248409,9.086945443917122,9.219739387479155,9.350239277323736,9.477231776201483,9.585407767533946,9.68828773519316,9.784206930942737,9.871111099003238,9.946479992113156,10.00724312486,10.049690495277797,10.06938896173923,10.065119206429488,10.039365763487755,9.98864140354382,9.927773082058913,9.846629874770311,9.743188137521184,9.615469391368748,9.46161997307269,9.280007095381084,9.069336630524562,8.828784493674897,8.55812913910588,8.257873263038883,7.929342269371664,7.5747448798256665,7.254006251486089,6.9189572710484635,6.572404052631884,6.217453687848117,5.857420114905777,5.49571983445571,5.135752465280458,4.780779312087204,4.4338156740563,4.0975449788972815,3.7742563497869877,3.4658058774768086,3.1736020533956775,2.8836540714493166,2.613522227525719,2.413821000430038,2.226614377827251,2.0516833910000294,1.8887039129116499,1.737267381782304,1.547312951790289,1.3767900270247058,1.224256331155542,1.0881800812949824,0.9670728946275876,0.8594945050368932,0.7640727305062824,0.6795243816189548,0.604668430567664,0.5399849801678043,0.48259813553048897,0.4316731651241673,0.3864781135109345,0.3463565102637635,0.30527176502939574,0.26946590557043076,0.23822499454150076,0.2109430719052711,0.18709077057866322,0.16621058623068274,0.14790848654337027,0.13184484006250693,0.11772623630779133,0.10529908482434132,0.09434446770635518,0.08467347313658144,0.07612286986762648,0.06855137111654862,0.06183657305504343,0.05587239377974002,0.05056682639247461,0.04583995721624529,0.041622270109155944,0.03785322244659679,0.034480034297900225,0.03145663841221816,0.028742768885446773,0.026303179983108566,0.02410698036986695,0.022127061743844108,0.0203396043568962,0.01872364896952969,0.01726072796051042,0.016172923213709906],"y":[5.0,5.00062829116953,5.001256465712846,5.002575326070313,5.003894022847406,5.005212374429334,5.00797993223245,5.01074612547753,5.01351096679972,5.019312720856403,5.025108441878984,5.030898101270951,5.043036504254944,5.0551478316270915,5.0672317455117035,5.079287987960533,5.104514800034007,5.129615877135343,5.154588759918124,5.179431022887103,5.231164094351471,5.282289134891789,5.332785588780687,5.382633648938492,5.431814385572903,5.532842653109368,5.630695459474451,5.725236587544252,5.816347961910858,5.903929851232564,5.987900594265115,6.152223554486514,6.300014844450962,6.431223888596899,6.546064602758398,6.625446847327871,6.6952040680318134,6.755693218169989,6.8073117759065465,6.850487426029035,6.8965506494196145,6.92897082069033,6.948920085478395,6.957576264091436,6.956058563100508,6.945431449081942,6.92669681369352,6.900784012973892,6.8685449019761045,6.826550566420929,6.778731584174301,6.725933816156907,6.668903366571544,6.608299487367394,6.535785479368489,6.460129535998468,6.381982883058712,6.301886548348579,6.220309458634012,6.137651619662345,6.054252627676853,5.970400899836736,5.886341787175891,5.802283709073738,5.718403025516747,5.634848506872251,5.551745495666376,5.469199457331491,5.387298840122363,5.306117451562026,5.2257165509796755,5.14614669646529,5.067449313885453,4.9896580023774435,4.912799639761961,4.836895341369636,4.7619612912336455,4.688009451137424,4.6150481615343555,4.543082655582554,4.472115503350075,4.402146995450887,4.333175472337118,4.265197606558322,4.130346187151683,3.999508653134853,3.8726154251315767,3.7495866469937815,3.6303361507841996,3.5147730723118524,3.4028029844041168,3.294329481415117,3.189255708962888,3.087485253827486,2.988922522959148,2.8934730440019503,2.8010438439727854,2.7115437788201184,2.6248837094520674,2.540976571584823,2.3787650858394165,2.226868242240254,2.0846402969253055,1.9514730422565318,1.8267954162589952,1.7100709542120303,1.600795335390365,1.4984950732109095,1.4027264580884016,1.313073893844578,1.1476526648504726,1.0030619786548043,0.8766826524238822,0.7662238558946235,0.6696815573570616,0.5853028145308443,0.5115551805899997,0.4470995031237026,0.3907654389214365,0.34152988892563535,0.2984984253331946,0.26088926264980467,0.2280191835636954,0.1992910886884644,0.17418307644205502,0.15223896046475063,0.13306002926781269,0.1162978300023131,0.10164782757259248,0.08884385448155187,0.07765327454590114,0.06787276661106668,0.059324635901811855,0.05185358251517824,0.04532387564092021,0.03961688733977659,0.0346289393399233,0.030269420171781372,0.026459137878803923,0.02312888010863266,0.02021815647820322,0.01767409987168847,0.01545050592967137,0.013506993219489352,0.011808269229470656,0.01032348905280645,0.009025694975976814,0.007891326624022093,0.006899792764557634,0.006033097080264213,0.004607854724021646,0.0035193624693283733,0.0026886023908082473,0.0020551998104056364,0.001572101131097023,0.0012030840110712584,0.000920972116769252,0.0007054283984461664,0.0005408681941987605,0.0004151678632984558,0.00031902278776533454,0.0002454363273202791,0.00018913863053745102,0.00014607916964948909,0.00011301402289621488,0.00008777966349302556,0.00006835836860422207,0.00005342532655827002,0.00004198212321563169,0.0000332104192468841,0.000026460216230015102,0.00002125642001841481,0.00001725877188712474,0.000014065630404934643,0.000011781091178108569,9.959765400520683e-6,8.557313203288311e-6,7.656422174204726e-6,7.02541500054963e-6,6.61108353294234e-6,6.4047091851443815e-6,6.435462539362129e-6,6.7568616058401915e-6,7.371639199973354e-6,8.425214522874135e-6,0.000010161435028727503,0.000013044016577267193,0.000017992581987879838,0.000026954376837225175,0.00004438847814675243,0.00008145660332695502,0.0001717093354072951,0.0002943706570757685,0.0005151059429735561,0.0008096780081221197,0.0013109036001952934,0.0018480904943156133,0.0026401771209644733,0.0038308620098987693,0.005043281039827854,0.006697637168581733,0.008974861593306582,0.012141905603208119,0.015173061683061177,0.01905480380180494,0.024050047474950615,0.030513247334071184,0.03891999426540468,0.0499079438828418,0.061438209627524665,0.07589391064648374,0.09406901711456038,0.11698453530848972,0.1459480853133784,0.1747584734092997,0.2096262631081747,0.2518512545109609,0.30299902657492916,0.3649382683916559,0.43987374702157034,0.5303730063811262,0.6267798342776555,0.7402799641428445,0.8428565058974791,0.9587427241183575,1.0891985252330483,1.2354330987125468,1.398544658822658,1.5794477476765012,1.7787835081171361,1.9968197723781658,2.2333508244987526,2.4876061898960926,2.7581785624272035,3.042983000969838,3.292681752043674,3.548564903906692,3.808341629839412,4.069524240077822,4.329504637320539,4.585637623860935,4.835335763107709,5.076164840367561,5.305926839542995,5.522724006578707,5.725003131128441,5.911580214433746,6.081645407694116,6.2394635911198355,6.379090178532311,6.478054464690528,6.5656653773260585,6.642260449147301,6.708252024375349,6.764110205696941,6.826495921012382,6.871423746641269,6.900442059012674,6.915137458593505,6.9170242654822305,6.907542876828861,6.88804553757209,6.863215939641807,6.832219085396682,6.7957950828292715,6.754618664660422,6.709301369661648,6.6603929738200955,6.608385565689625,6.553719179580865,6.496786842206447,6.437938550042572,6.377484969162581,6.315701350707538,6.252831402148138,6.189090723408525,6.124669770617968,6.05973653575763,5.994439048493266,5.928907661808027,5.8632570695367585,5.797588074971524,5.731989166459625,5.66653793404062,5.601302332422082,5.536341793961083,5.471708208165503,5.40744678892903,5.34359684457498,5.280192459425156,5.217263094815808,5.154834119172208,5.092927276691428,5.031561102219326,4.970751288161494,4.849955387311726,4.731552188256443,4.615593621275804,4.502109101119567,4.391111182267788,4.282598593936187,4.1765585624463855,4.0729694052948755,3.97180293182929,3.873026084309539,3.7766019507111914,3.6824905896798303,3.590649848096284,3.501036069648536,3.4136046017198027,3.328310148785273,3.2451070658367853,3.163949625134365,3.0847922373816727,3.007589615136214,2.8537992531399854,2.7078033743740826,2.5692231877853917,2.4376940010339636,2.3128667370658196,2.1944074295533995,2.081996554328909,1.9753290387978701,1.874114383624517,1.7261741667553074,1.5898961168010446,1.4643650202131493,1.3487359080614487,1.2422303190630828,1.1235071521425248,1.0161321704415711,0.9190138571881977,0.8311767647267255,0.7517337526603515,0.6798824796844903,0.6148979266386446,0.5561244722564125,0.5029687524665554,0.45489380423024284,0.41141399700910675,0.37209022868869357,0.3365253695024388,0.3043601639567691,0.27526963900760604,0.24895988893780163,0.2251651211089509,0.20364494678567857,0.18418193845194175,0.16657944213985482,0.15065960341562135,0.13626157258247767,0.12323987494525064,0.11146293880504991,0.10081176812872221,0.09117874262938572,0.08246653065334553,0.07458710485720725,0.06746085242174614,0.06101577104156503,0.05518674181395268,0.049914871260209825,0.045146896048550295,0.04083464471609029,0.03339575792288317,0.02731217348696369,0.02233762637050656,0.018270644118158742,0.01494542587334716,0.012226062013254258,0.010001916058374543,0.00818295198037803,0.0066954883096958726,0.005479037748304918,0.00448408122669449,0.0036702319965126523,0.0030045405324020157,0.0024600392390973745,0.0020146273399335025,0.0016502261772152968,0.0013520762195927346,0.0011081217116772478,0.0009084974564979314,0.000745126517391526,0.0006114037523467388,0.0005019330020979665,0.0004123038731415324,0.00033890790253089404,0.00027879214640236607,0.00022954182544158806,0.00018918326270946843,0.0001561027626037794,0.0001289801331176152,0.00010673523907934812,0.00008848477996085231,0.00007350664677520799,0.00006121037919636607,0.00005111301905682903,0.00004272232593073782,0.00003602491598534398,0.000030269910599186465,0.00002566076816362572,0.00002187397414016135,0.000018731403933438554,0.000016145088391944015,0.000014041942306924316,0.000012335857784243656,0.000010817712084106966,9.737270253357003e-6,8.797425187931249e-6,8.03847359190144e-6,7.4932639074290615e-6,7.139592989377469e-6,6.944430063500875e-6,6.909300391686661e-6,7.069931957929769e-6,7.479624442283581e-6,8.214874484291713e-6,9.408802384679599e-6,0.000011305724738019373,0.00001435519406124576,0.000019412273738129647,0.000028201910800262267,0.00004445313257097822,0.00007687467461954582,0.0001489023495840476,0.00028373079183475754,0.00045684083434613,0.0007492096429687943,0.0010915821467953055,0.0016218709903927507,0.0024634272625105643,0.003326767902503744,0.004540122368235831,0.006265980291985464,0.00875537172724285,0.011102755778684326,0.014160239483097645,0.01816753987515073,0.023455431019437093,0.030479313960239934,0.03693798558834005,0.044909604048802884,0.054778807182455695,0.06703654992001722,0.08230659849294004,0.10137930191843145,0.12222035370770405,0.14768546442835068,0.17884386180703923,0.21701031183641964,0.2637921411178129,0.32114010515947666,0.3914006709691864,0.47736194040862834,0.560709865524407,0.6584366731956286,0.7726781748423193,0.8771658943696427,0.9947874222565513,1.126715521552362,1.274058850439986,1.4378038727096945,1.6187461506359457,1.8174073581077788,2.0339441871384514,2.2680585628802183,2.518918055354227,2.7850955422683272,3.0645385114030543,3.3113768136749093,3.563949689847578,3.820018480830839,4.0771649595779955,4.332865235659466,4.584569479844082,4.829791534981279,5.066198339285078,5.291687253851176,5.504445489977197,5.702990906457124,5.886194406269304,6.053283921670477,6.21181854606024,6.3517922774223035,6.449587226297202,6.536104559846994,6.611683498472433,6.676736555498559,6.731732636514893,6.791780707167442,6.835291063460447,6.86369353797066,6.878456621760005,6.880983820621115,6.872613856713342,6.854607441146746,6.8281325903278605,6.794256260322443,6.755031585827364,6.710491911887453,6.661373436090979,6.608324448674443,6.551922994193876,6.482743859720636,6.41041544968003,6.3355593511358546,6.258698040210046,6.18028578001695,6.100712303124767,6.020310453125858,5.939364486344081,5.858117472784617,5.77677700335968,5.6955197662978065,5.61449573064482,5.533832039736342,5.453636361730846,5.373999621074713,5.294998283380897,5.216696368100495,5.139147227708115,5.062395068560698,4.986476226290287,4.911420251056102,4.837250850713975,4.763986710527381,4.69164219581055,4.620227950676309,4.549751412226555,4.480217256039324,4.411627782045021,4.343983247065382,4.289687170077291]}],"layout":{"xaxis":{"title":{"text":"x"}},"yaxis":{"title":{"text":"y"}}},"config":{}});
</script>
<div style="break-before: page; page-break-before: always;"></div><h1 id="higher-order-odes"><a class="header" href="#higher-order-odes">Higher Order ODEs</a></h1>
<p>The <em>order</em> of an ODE is the highest derivative that appears in the equation. So far, we have only looked at first order ODEs, which involve only the first derivative of the state variable with respect to time. However, many physical systems are described by higher order ODEs, which involve second or higher derivatives of the state variable. A simple example of a second order ODE is the motion of a mass under the influence of gravity. The equation of motion for the mass can be written as:</p>
<p>\[
\frac{d^2x}{dt^2} = -g
\]</p>
<p>where \(x\) is the position of the mass, \(t\) is time, and \(g\) is the acceleration due to gravity. This is a second order ODE because it involves the second derivative of the position with respect to time.</p>
<p>Higher order ODEs can always be rewritten as a system of first order ODEs by introducing new variables. For example, we can rewrite the second order ODE above as a system of two first order ODEs by introducing a new variable for the velocity of the mass:</p>
<p>\[
\begin{align*}
\frac{dx}{dt} &amp;= v \\
\frac{dv}{dt} &amp;= -g
\end{align*}
\]</p>
<p>where \(v = \frac{dx}{dt}\) is the velocity of the mass. This is a system of two first order ODEs, which can be written in vector form as:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>where</p>
<p>\[
\mathbf{y} = \begin{bmatrix} x \\ v \end{bmatrix}
\]</p>
<p>and</p>
<p>\[
\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} v \\ -g \end{bmatrix}
\]</p>
<p>In the next section, we'll look at another example of a higher order ODE system: the spring-mass system, and solve this using DiffSol.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-spring-mass-systems"><a class="header" href="#example-spring-mass-systems">Example: Spring-mass systems</a></h1>
<p>We will model a <a href="https://en.wikipedia.org/wiki/Mass-spring-damper_model">damped spring-mass system</a> using a second order ODE. The system consists of a mass \(m\) attached to a spring with spring constant \(k\), and a damping force proportional to the velocity of the mass with damping coefficient \(c\).</p>
<img src="primer/images/Mass_spring_damper.svg" width="350">
<p>The equation of motion for the mass can be written as:</p>
<p>\[
m \frac{d^2x}{dt^2} = -k x - c \frac{dx}{dt}
\]</p>
<p>where \(x\) is the position of the mass, \(t\) is time, and the negative sign on the right hand side indicates that the spring force and damping force act in the opposite direction to the displacement of the mass.</p>
<p>We can convert this to a system of two first order ODEs by introducing a new variable for the velocity of the mass:</p>
<p>\[
\begin{align*}
\frac{dx}{dt} &amp;= v \\
\frac{dv}{dt} &amp;= -\frac{k}{m} x - \frac{c}{m} v
\end{align*}
\]</p>
<p>where \(v = \frac{dx}{dt}\) is the velocity of the mass.</p>
<p>We can solve this system of ODEs using DiffSol with the following code:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use std::fs;
</span>use diffsol::{
    DiffSl, CraneliftModule, OdeBuilder, OdeSolverMethod
};
use plotly::{
    Plot, Scatter, common::Mode, layout::Layout, layout::Axis
};
type M = nalgebra::DMatrix&lt;f64&gt;;
type CG = CraneliftModule;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
        
let eqn = DiffSl::&lt;M, CG&gt;::compile("
    k { 1.0 } m { 1.0 } c { 0.1 }
    u_i {
        x = 1,
        v = 0,
    }
    F_i {
        v,
        -k/m * x - c/m * v,
    }
").unwrap();
let problem = OdeBuilder::&lt;M&gt;::new()
    .build_from_eqn(eqn).unwrap();
let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
let (ys, ts) = solver.solve(40.0).unwrap();

let x: Vec&lt;_&gt; = ys.row(0).into_iter().copied().collect();
let time: Vec&lt;_&gt; = ts.into_iter().collect();

let x_line = Scatter::new(time.clone(), x).mode(Mode::Lines);

let mut plot = Plot::new();
plot.add_trace(x_line);

let layout = Layout::new()
    .x_axis(Axis::new().title("t"))
    .y_axis(Axis::new().title("x"));
plot.set_layout(layout);
let plot_html = plot.to_inline_html(Some("sping-mass-system"));
<span class="boring">fs::write("../src/primer/images/spring-mass-system.html", plot_html).expect("Unable to write file");
</span><span class="boring">}</span></code></pre></pre>
<div id="sping-mass-system" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("sping-mass-system", {"data":[{"type":"scatter","mode":"lines","x":[0.0,0.00011892071150027212,0.00023784142300054423,0.0004875749171511157,0.0007373084113016871,0.0009870419054522587,0.0015114822431684586,0.002035922580884659,0.002560362918600859,0.0036616876278048795,0.0047630123370089,0.00586433704621292,0.008177118935541362,0.010489900824869804,0.012802682714198247,0.015115464603526689,0.01997230657111642,0.02482914853870615,0.029685990506295883,0.034542832473885614,0.044742200605824047,0.05494156873776248,0.06514093686970092,0.07534030500163935,0.09675897807871006,0.11817765115578077,0.13959632423285148,0.1610149973099222,0.1824336703869929,0.2274128838488414,0.2723920973106899,0.31737131077253844,0.36235052423438696,0.4073297376962355,0.5017860859661174,0.5962424342359993,0.6906987825058812,0.7851551307757632,0.8796114790456451,0.974067827315527,1.068524175585409,1.1629805238552908,1.2574368721251727,1.3518932203950547,1.4463495686649366,1.5408059169348185,1.6352622652047004,1.7297186134745823,1.8241749617444643,1.9186313100143462,2.013087658284228,2.10754400655411,2.202000354823992,2.296456703093874,2.3909130513637558,2.4853693996336377,2.5798257479035196,2.6742820961734015,2.7687384444432834,2.8631947927131653,2.9576511409830473,3.052107489252929,3.146563837522811,3.241020185792693,3.335476534062575,3.429932882332457,3.5243892306023388,3.6188455788722207,3.7133019271421026,3.8077582754119845,3.9022146236818664,3.9966709719517484,4.09112732022163,4.185583668491511,4.280040016761393,4.374496365031274,4.468952713301156,4.563409061571037,4.657865409840919,4.7523217581108,4.846778106380682,4.941234454650563,5.035690802920445,5.130147151190326,5.2246034994602075,5.319059847730089,5.4135161959999705,5.507972544269852,5.602428892539733,5.696885240809615,5.791341589079496,5.885797937349378,5.980254285619259,6.074710633889141,6.169166982159022,6.263623330428904,6.358079678698785,6.452536026968667,6.546992375238548,6.64144872350843,6.735905071778311,6.830361420048193,6.924817768318074,7.0192741165879555,7.113730464857837,7.2081868131277185,7.3026431613976,7.397099509667481,7.491555857937363,7.586012206207244,7.680468554477126,7.774924902747007,7.869381251016889,7.96383759928677,8.058293947556653,8.152750295826534,8.247206644096416,8.341662992366297,8.436119340636179,8.53057568890606,8.625032037175941,8.719488385445823,8.813944733715704,8.908401081985586,9.002857430255467,9.097313778525349,9.19177012679523,9.286226475065112,9.380682823334993,9.475139171604875,9.569595519874756,9.664051868144638,9.75850821641452,9.8529645646844,9.947420912954282,10.041877261224164,10.136333609494045,10.230789957763927,10.325246306033808,10.41970265430369,10.514159002573571,10.608615350843452,10.703071699113334,10.797528047383215,10.891984395653097,10.986440743922978,11.08089709219286,11.175353440462741,11.269809788732623,11.364266137002504,11.458722485272386,11.553178833542267,11.647635181812149,11.74209153008203,11.836547878351912,11.931004226621793,12.025460574891675,12.119916923161556,12.214373271431437,12.308829619701319,12.4032859679712,12.497742316241082,12.592198664510963,12.686655012780845,12.781111361050726,12.875567709320608,12.97002405759049,13.06448040586037,13.158936754130252,13.253393102400134,13.347849450670015,13.442305798939897,13.536762147209778,13.63121849547966,13.725674843749541,13.820131192019423,13.914587540289304,14.009043888559185,14.103500236829067,14.197956585098948,14.29241293336883,14.386869281638711,14.481325629908593,14.575781978178474,14.670238326448356,14.764694674718237,14.859151022988119,14.953607371258,15.048063719527882,15.142520067797763,15.236976416067645,15.331432764337526,15.425889112607408,15.520345460877289,15.61480180914717,15.709258157417052,15.803714505686933,15.898170853956815,15.992627202226696,16.08708355049658,16.181539898766463,16.275996247036346,16.37045259530623,16.464908943576113,16.559365291845996,16.65382164011588,16.748277988385762,16.842734336655646,16.93719068492553,17.031647033195412,17.126103381465295,17.22055972973518,17.315016078005062,17.409472426274945,17.50392877454483,17.59838512281471,17.692841471084595,17.787297819354478,17.88175416762436,17.976210515894245,18.070666864164128,18.16512321243401,18.259579560703894,18.354035908973778,18.44849225724366,18.542948605513544,18.637404953783427,18.73186130205331,18.826317650323194,18.920773998593077,19.01523034686296,19.109686695132844,19.204143043402727,19.29859939167261,19.393055739942493,19.487512088212377,19.58196843648226,19.676424784752143,19.770881133022026,19.86533748129191,19.959793829561793,20.054250177831676,20.14870652610156,20.243162874371443,20.337619222641326,20.43207557091121,20.526531919181092,20.620988267450976,20.71544461572086,20.809900963990742,20.904357312260625,20.99881366053051,21.093270008800392,21.187726357070275,21.28218270534016,21.37663905361004,21.471095401879925,21.565551750149808,21.66000809841969,21.754464446689575,21.848920794959458,21.94337714322934,22.037833491499224,22.132289839769108,22.22674618803899,22.321202536308874,22.415658884578757,22.51011523284864,22.604571581118524,22.699027929388407,22.79348427765829,22.887940625928174,22.982396974198057,23.07685332246794,23.171309670737823,23.265766019007707,23.36022236727759,23.454678715547473,23.549135063817356,23.64359141208724,23.738047760357123,23.832504108627006,23.92696045689689,24.021416805166773,24.115873153436656,24.21032950170654,24.304785849976422,24.399242198246306,24.49369854651619,24.588154894786072,24.682611243055955,24.77706759132584,24.871523939595722,24.965980287865605,25.06043663613549,25.15489298440537,25.249349332675255,25.343805680945138,25.43826202921502,25.532718377484905,25.627174725754788,25.72163107402467,25.816087422294554,25.910543770564438,26.00500011883432,26.099456467104204,26.193912815374087,26.28836916364397,26.382825511913854,26.477281860183737,26.57173820845362,26.666194556723504,26.760650904993387,26.85510725326327,26.949563601533153,27.044019949803037,27.13847629807292,27.232932646342803,27.327388994612686,27.42184534288257,27.516301691152453,27.610758039422336,27.70521438769222,27.799670735962103,27.894127084231986,27.98858343250187,28.083039780771752,28.177496129041636,28.27195247731152,28.366408825581402,28.460865173851285,28.55532152212117,28.649777870391052,28.744234218660935,28.83869056693082,28.9331469152007,29.027603263470585,29.122059611740468,29.21651596001035,29.310972308280235,29.405428656550118,29.49988500482,29.594341353089884,29.688797701359768,29.78325404962965,29.877710397899534,29.972166746169417,30.0666230944393,30.161079442709184,30.255535790979067,30.34999213924895,30.444448487518834,30.538904835788717,30.6333611840586,30.727817532328483,30.822273880598367,30.91673022886825,31.011186577138133,31.105642925408016,31.2000992736779,31.294555621947783,31.389011970217666,31.48346831848755,31.577924666757433,31.672381015027316,31.7668373632972,31.861293711567082,31.955750059836966,32.050206408106845,32.144662756376725,32.239119104646605,32.333575452916484,32.428031801186364,32.522488149456244,32.616944497726124,32.711400845996,32.80585719426588,32.90031354253576,32.99476989080564,33.08922623907552,33.1836825873454,33.27813893561528,33.37259528388516,33.46705163215504,33.56150798042492,33.6559643286948,33.75042067696468,33.84487702523456,33.93933337350444,34.03378972177432,34.1282460700442,34.22270241831408,34.31715876658396,34.41161511485384,34.50607146312372,34.6005278113936,34.69498415966348,34.78944050793336,34.883896856203236,34.978353204473116,35.072809552742996,35.167265901012875,35.261722249282755,35.356178597552635,35.450634945822515,35.545091294092394,35.639547642362274,35.734003990632154,35.82846033890203,35.92291668717191,36.01737303544179,36.11182938371167,36.20628573198155,36.30074208025143,36.39519842852131,36.48965477679119,36.58411112506107,36.67856747333095,36.77302382160083,36.86748016987071,36.96193651814059,37.05639286641047,37.15084921468035,37.24530556295023,37.33976191122011,37.43421825948999,37.52867460775987,37.62313095602975,37.71758730429963,37.81204365256951,37.90650000083939,38.000956349109266,38.095412697379146,38.189869045649026,38.284325393918905,38.378781742188785,38.473238090458665,38.567694438728545,38.662150786998424,38.756607135268304,38.851063483538184,38.94551983180806,39.03997618007794,39.13443252834782,39.2288888766177,39.32334522488758,39.41780157315746,39.51225792142734,39.60671426969722,39.7011706179671,39.79562696623698,39.89008331450686,39.98453966277674,40.0],"y":[1.0,1.0,0.9999999761316565,0.9999998633888559,0.9999997172919343,0.9999995007709888,0.9999988461551069,0.9999979143551637,0.9999967085923813,0.9999932826640254,0.9999886444701968,0.9999827940197562,0.9999665627743147,0.9999449867820753,0.9999180677729104,0.99988580710062,0.9998006787295965,0.999692013229619,0.9995598247198555,0.9994041277278006,0.9990007088862611,0.9984938315411832,0.9978836562329193,0.9971703515586058,0.9953375440394794,0.993052527289201,0.9903173337244726,0.9871341761658243,0.9835054739620812,0.974446839473663,0.9634621999121918,0.9505823499276476,0.9358417773997201,0.9192785883880437,0.8787525027829141,0.8308101638913145,0.7759463590754083,0.7147129350012107,0.6477131334986014,0.5755957957559655,0.49904901840797544,0.4187936496481618,0.3355766567465234,0.2501642990327267,0.16333513155145898,0.07587295179154918,-0.011440208404814786,-0.09783099233716736,-0.18254149185000587,-0.264835830939622,-0.34400649351514484,-0.4193803351461682,-0.4903242305218975,-0.5562503140202864,-0.6166207713321401,-0.6709521420469423,-0.718819098570774,-0.7598576732385115,-0.7937679108922592,-0.8203159288497293,-0.8393353712185327,-0.8507282501772566,-0.854465172621078,-0.8505849560646069,-0.8391936429539402,-0.8204629277280258,-0.794628016081079,-0.7619849407798659,-0.7228873629844706,-0.6777428922915059,-0.6270089626668862,-0.5711883050337728,-0.5108240604851803,-0.44649458086594157,-0.3788079657992763,-0.3083963871087908,-0.23591025299575777,-0.1620122652624865,-0.08737142332054332,-0.012657028688797794,0.06146725682321885,0.13434924702736417,0.2053539105755044,0.2738688445637869,0.3393094958862046,0.40112408637789354,0.45879820083023265,0.5118590003359211,0.5598790270997686,0.6024795707944118,0.6393335707120538,0.6701680323244603,0.6947659413733586,0.7129676632306753,0.7246718199507222,0.7298356421423282,0.7284747974760428,0.7206627022685154,0.7065293271123875,0.6862595119065575,0.6600908098504862,0.6283108839620654,0.5912544834276694,0.5493000305645892,0.5028658523418684,0.4524060932404098,0.39840634871498315,0.3413790606309169,0.2818587177713221,0.2203969058352781,0.1575572522652768,0.0939103117492272,0.030028438337720002,-0.033519310195882515,-0.09617219084003996,-0.15738267286868174,-0.21662117208344853,-0.27338058130080667,-0.3271805587988153,-0.37757153894598394,-0.4241384320362071,-0.46650398342157445,-0.50433176533923,-0.5373287783377986,-0.5652476428902183,-0.5878883655987507,-0.6050996683193562,-0.6167798725207762,-0.6228773352124558,-0.6233904367890334,-0.6183671251118713,-0.6079040240451632,-0.592145118451665,-0.5712800312984757,-0.5455419119955256,-0.5152049583593296,-0.480581597635045,-0.4420193547960567,-0.39989743884993684,-0.35462308009297006,-0.30662765315566176,-0.2563626222548376,-0.2042953463032274,-0.15090478241697577,-0.0966771269007735,-0.04210143297764209,0.012334755632358496,0.06614971668853804,0.11887176921108084,0.1700433644906278,0.21922501323542376,0.26599901554944366,0.30997296249759376,0.3507829803346185,0.3880966910297103,0.4216158654841385,0.4510787487879685,0.4762620399662309,0.4969825118957719,0.5130982604015106,0.5245095749346096,0.5311594266643651,0.5330335732496054,0.5301602829636954,0.5226096841996883,0.5104927496496645,0.4939599276066496,0.47319943585159147,0.4484352364366401,0.4199247123352624,0.38795606937807886,0.3528454891107633,0.3149340601795048,0.2745845175552107,0.2321778203371836,0.18810960002035473,0.14278651195982117,0.09662252331765975,0.050035171027694544,0.0034418232646401784,-0.0427440224418662,-0.08811637194455559,-0.1322802664825302,-0.17485518355814345,-0.21547827774221362,-0.25380743415552603,-0.2895241092929803,-0.32233593598190863,-0.35197907157721015,-0.37822027097076755,-0.4008586686076576,-0.41972725643235315,-0.43469404750920954,-0.44566291794706975,-0.45257412268165237,-0.45540448360517094,-0.45416725145424164,-0.44891164574871356,-0.4397220798905202,-0.42671708125847185,-0.41004791874889457,-0.3898969526908977,-0.366475724388197,-0.3400228046876149,-0.3108014229302448,-0.2790968993892428,-0.24521390582474156,-0.2094735800800031,-0.17221052169435033,-0.1337696963106077,-0.09450327720291221,-0.05476745254243515,-0.014919227053505464,0.024686753506951018,0.06370132708358499,0.10178386202087203,0.13860519942452615,0.1738504660582585,0.2072217340330841,0.23844050512907428,0.26724999935387816,0.2934172292711908,0.31673484370688504,0.3370227266410504,0.3541293393999435,0.3679327966513717,0.37834166915842116,0.3852955087372164,0.38876509337223225,0.3887523929450614,0.3852902585073713,0.3784418404543115,0.3682997433098809,0.3549849271003803,0.33864536744693374,0.31945448853498004,0.2976093850008868,0.2733288504980756,0.24685123225343172,0.21843213228732603,0.1883419771367864,0.15686347888288749,0.1242890110335639,0.0909179233471385,0.05705381999725037,0.023001825575736733,-0.010934136692355533,-0.04445403048496397,-0.077264332181383,-0.10908057418468273,-0.13962978397566403,-0.16865279823592808,-0.19590643268046237,-0.22116548970248873,-0.2442245875407469,-0.2648997964162257,-0.28303006893500976,-0.298478453998907,-0.3111330854876729,-0.32090793905732434,-0.32774335251921416,-0.3316063074050061,-0.3324904714642894,-0.33041600396532705,-0.3254291277565348,-0.3176014740787586,-0.30702920807853346,-0.29383194484371805,-0.2781514675493262,-0.26015026094839566,-0.24000987495682619,-0.2179291344500932,-0.19412221260285037,-0.1688165861503157,-0.14225089182532455,-0.11467270392081161,-0.08633625343981735,-0.057500109621065845,-0.02842484476656818,0.0006292967508539488,0.0294047046556045,0.05764866388275922,0.08511555099674022,0.11156894703375488,0.13678364880564597,0.16054756177266494,0.18266345880238088,0.20295059046941819,0.22124613400292595,0.23740646954163008,0.25130827399530475,0.262849424521157,0.27194970538810187,0.2785513138050781,0.28261916211500554,0.2841409755873463,0.2831271868631826,0.27961062990118096,0.2736460380251674,0.2653093523690447,0.2546968486380288,0.24192409164287335,0.22712472850309243,0.2104491327442986,0.1920629127229238,0.17214529888916993,0.15088742533772767,0.12849052188859564,0.10516403358151084,0.08112368495288105,0.05658950679077057,0.031783843230081994,0.006929357056594609,-0.017752949063576356,-0.04204567802041109,-0.06573693341306672,-0.08862214807590235,-0.11050583037860337,-0.1312032135778317,-0.15054179449650631,-0.1683627489178802,-0.18452221229411817,-0.19889241567137284,-0.2113626681130172,-0.22184017834673686,-0.23025070985620125,-0.23653906517028433,-0.24066939665832662,-0.2426253427047131,-0.24240998969611985,-0.2400456617963321,-0.2355735419930856,-0.22905312936580974,-0.22056153892990285,-0.21019265175030122,-0.1980561242733941,-0.18427626699142108,-0.1689908036178616,-0.15234952290750803,-0.1345128360934438,-0.11565025362869258,-0.09593879550765709,-0.07556134989764195,-0.05470499513092005,-0.03355930029143795,-0.012314619676963135,0.008839603671836603,0.02971651040716888,0.05013345866052676,0.06991360504586037,0.0888874193468823,0.10689412007154896,0.12378301887943693,0.1394147628091019,0.1536624642434687,0.16641270964204483,0.17756643922883866,0.1870396910433634,0.19476420402764094,0.20068787612304337,0.20477507467519926,0.20700679778113823,0.20738068654832428,0.2059108895584382,0.20262778212805366,0.1975775442224373,0.19082160209666002,0.1824359398997216,0.17251028857261666,0.16114720039119076,0.14846101844081733,0.13457675115495593,0.11962886279677637,0.10375999140664392,0.08711960627353957,0.06986261741176461,0.05214794983280994,0.03413709559440874,0.015992656683943233,-0.002123108248057007,-0.020049720445112735,-0.03762988830264161,-0.0547108731147533,-0.07114580158144573,-0.086794913930334,-0.1015267371831494,-0.11521917385989647,-0.12776049725516822,-0.13905024533349672,-0.1490000062649711,-0.1575340896494929,-0.164590078548315,-0.17011925854505008,-0.17408692118501534,-0.1764725402813982,-0.1772698207190348,-0.17648662052145078,-0.17414474806419525,-0.1702796374076735,-0.16493990577622702,-0.15818679821811385,-0.15009352543479426,-0.14074450165958838,-0.1302344902879817,-0.11866766570799696,-0.10615660044323058,-0.09282118729818392,-0.07878750668120217,-0.06418664967110886,-0.049153507687007034,-0.033825539814959324,-0.018341528939601292,-0.0028403378232721797,0.012540323829043175,0.027665110481922786,0.04240221951735625,0.05662452746300837,0.07021067401843958,0.08304608475106388,0.09502392396364798,0.10604596993466966,0.11602340549498427,0.12487751772165884,0.13254030139474013,0.13895496176700892,0.144076313132046,0.14787107063359942,0.15031803373059452,0.1514081607084176,0.15114453459962415,0.14954222183737328,0.14662802590427215,0.142440139149799,0.1370276968232143,0.13045023819852214,0.12277708044659151,0.11408661163061896,0.10446550985881858,0.09400789621732396,0.08281442962223151,0.07099135216855343,0.058649493912477535,0.045903246299278805,0.032869513640833035,0.019666652153054333,0.006413406084548205,-0.0067721495960216364,-0.01977365063356305,-0.03247745994941303,-0.04477365034870928,-0.056556945069672404,-0.06772760822528039,-0.07819227770717548,-0.07983178235080202]}],"layout":{"xaxis":{"title":{"text":"t"}},"yaxis":{"title":{"text":"x"}}},"config":{}});
</script>
<div style="break-before: page; page-break-before: always;"></div><h1 id="discrete-events"><a class="header" href="#discrete-events">Discrete Events</a></h1>
<p>ODEs describe the continuous evolution of a system over time, but many systems also involve discrete events that occur at specific times. For example, in a compartmental model of drug delivery, the administration of a drug is a discrete event that occurs at a specific time. In a bouncing ball model, the collision of the ball with the ground is a discrete event that changes the state of the system. It is normally difficult to model these events using ODEs alone, as they require a different approach to handle the discontinuities in the system. While we can represent discrete events mathematically using delta functions, many ODE solvers are not designed to handle discontinuities, and may produce inaccurate results or fail to converge during the integration.</p>
<p>DiffSol provides a way to model discrete events in a system of ODEs by allowing users to manipulate the internal state of each solver during the time-stepping. Each solver has an internal state that holds information such as the current time \(t\), the current state of the system \(\mathbf{y}\), and other solver-specific information. When a discrete event occurs, the user can update the internal state of the solver to reflect the change in the system, and then continue the integration of the ODE as normal.</p>
<p>DiffSol also provides a way to stop the integration of the ODEs, either at a specific time or when a specific condition is met. This can be useful for modelling systems with discrete events, as it allows the user to control the integration of the ODEs and to handle the events in a flexible way.</p>
<p>The <a href="primer/../solving_the_problem.html">Solving the Problem</a> and <a href="primer/../specify/root_finding.html">Root Finding</a> sections provides an introduction to the API for solving ODEs and detecting events with DiffSol. In the next two sections, we will look at two examples of systems with discrete events: compartmental models of drug delivery and bouncing ball models, and solve them using DiffSol using this API.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-compartmental-models-of-drug-delivery"><a class="header" href="#example-compartmental-models-of-drug-delivery">Example: Compartmental models of Drug Delivery</a></h1>
<p>The field of Pharmacokinetics (PK) provides a quantitative basis for describing the delivery of a drug to a patient, the diffusion of that drug through the plasma/body tissue, and the subsequent clearance of the drug from the patient's system. PK is used to ensure that there is sufficient concentration of the drug to maintain the required efficacy of the drug, while ensuring that the concentration levels remain below the toxic threshold. Pharmacokinetic (PK) models are often combined with Pharmacodynamic (PD) models, which model the positive effects of the drug, such as the  binding of a drug to the biological target, and/or undesirable side effects, to form a full PKPD model of the drug-body interaction. This example will only focus on PK, neglecting the interaction with a PD model.</p>
<p><img src="https://sabs-r3.github.io/software-engineering-projects/fig/pk1.jpg" alt="Fig 1" /></p>
<p>PK enables the following processes to be quantified:</p>
<ul>
<li>Absorption</li>
<li>Distribution</li>
<li>Metabolism</li>
<li>Excretion</li>
</ul>
<p>These are often referred to as ADME, and taken together describe the drug concentration in the body when medicine is prescribed. These ADME processes are typically described by zeroth-order or first-order <em>rate</em> reactions modelling the dynamics of the quantity of drug $q$, with a given rate parameter $k$, for example:</p>
<p>\[
\frac{dq}{dt} = -k^*,
\]</p>
<p>\[
\frac{dq}{dt} = -k q.
\]</p>
<p>The body itself is modelled as one or more <em>compartments</em>, each of which is defined as a kinetically homogeneous unit (these compartments do not relate to specific organs in the body, unlike Physiologically based pharmacokinetic, PBPK, modeling). There is typically a main <em>central</em> compartment into which the drug is administered and from which the drug is excreted from the body, combined with zero or more <em>peripheral</em> compartments to which the drug can be distributed to/from the central compartment (See Fig 2). Each
peripheral compartment is only connected to the central compartment.</p>
<p><img src="primer/images/pk2.svg" alt="Fig 2" /></p>
<p>The following example PK model describes the two-compartment model shown diagrammatically in the figure above. The time-dependent variables to be solved are the drug quantity in the central and peripheral compartments, $q_c$ and $q_{p1}$ (units: [ng]) respectively.</p>
<p>\[
\frac{dq_c}{dt} = \text{Dose}(t) - \frac{q_c}{V_c} CL - Q_{p1} \left ( \frac{q_c}{V_c} - \frac{q_{p1}}{V_{p1}} \right ),
\]</p>
<p>\[
\frac{dq_{p1}}{dt} =  Q_{p1} \left ( \frac{q_c}{V_c} - \frac{q_{p1}}{V_{p1}} \right ).
\]</p>
<p>This model describes an <em>intravenous bolus</em> dosing protocol, with a linear clearance from the central compartment (non-linear clearance processes are also possible, but not considered here). The dose function $\text{Dose}(t)$ will consist of instantaneous doses of $X$ ng of the drug at one or more time points. The other input parameters to the model are:</p>
<ul>
<li>\(V_c\) [mL], the volume of the central compartment</li>
<li>\(V_{p1}\) [mL], the volume of the first peripheral compartment</li>
<li>\(CL\) [mL/h], the clearance/elimination rate from the central compartment</li>
<li>\(Q_{p1}\) [mL/h], the transition rate between central compartment and peripheral compartment 1</li>
</ul>
<p>We will solve this system of ODEs using the DiffSol crate. Rather than trying to write down the dose function as a mathematical function, we will neglect the dose function from the equations and instead using DiffSol's API to specify the dose at specific time points.</p>
<p>First lets write down the equations in the standard form of a first order ODE system:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>where</p>
<p>\[
\mathbf{y} = \begin{bmatrix} q_c \\ q_{p1} \end{bmatrix}
\]</p>
<p>and</p>
<p>\[
\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} - \frac{q_c}{V_c} CL - Q_{p1} \left ( \frac{q_c}{V_c} - \frac{q_{p1}}{V_{p1}} \right ) \\ Q_{p1} \left ( \frac{q_c}{V_c} - \frac{q_{p1}}{V_{p1}} \right ) \end{bmatrix}
\]</p>
<p>We will also need to specify the initial conditions for the system:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} 0 \\ 0 \end{bmatrix}
\]</p>
<p>For the dose function, we will specify a dose of 1000 ng at regular intervals of 6 hours. We will also specify the other parameters of the model:</p>
<p>\[
V_c = 1000 \text{ mL}, \quad V_{p1} = 1000 \text{ mL}, \quad CL = 100 \text{ mL/h}, \quad Q_{p1} = 50 \text{ mL/h}
\]</p>
<p>Let's now solve this system of ODEs using DiffSol. To implement the discrete dose events, we set a stop time for the simulation at each dose event using the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#tymethod.set_stop_time">OdeSolverMethod::set_stop_time</a> method. During timestepping we can check the return value of the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#tymethod.step">OdeSolverMethod::step</a> method to see if the solver has reached the stop time. If it has, we can apply the dose and continue the simulation.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use std::fs;
</span>use diffsol::{
    DiffSl, CraneliftModule, OdeBuilder, OdeSolverMethod, OdeSolverStopReason,
};
use plotly::{
    Plot, Scatter, common::Mode, layout::Layout, layout::Axis
};
type M = nalgebra::DMatrix&lt;f64&gt;;
type CG = CraneliftModule;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
        
let eqn = DiffSl::&lt;M, CG&gt;::compile("
    Vc { 1000.0 } Vp1 { 1000.0 } CL { 100.0 } Qp1 { 50.0 }
    u_i {
        qc = 0,
        qp1 = 0,
    }
    F_i {
        - qc / Vc * CL - Qp1 * (qc / Vc - qp1 / Vp1),
        Qp1 * (qc / Vc - qp1 / Vp1),
    }
").unwrap();

let problem = OdeBuilder::&lt;M&gt;::new().build_from_eqn(eqn).unwrap();
let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
let doses = vec![(0.0, 1000.0), (6.0, 1000.0), (12.0, 1000.0), (18.0, 1000.0)];

let mut q_c = Vec::new();
let mut q_p1 = Vec::new();
let mut time = Vec::new();

// apply the first dose and save the initial state
solver.state_mut().y[0] = doses[0].1;
q_c.push(solver.state().y[0]);
q_p1.push(solver.state().y[1]);
time.push(0.0);

// solve and apply the remaining doses
for (t, dose) in doses.into_iter().skip(1) {
    solver.set_stop_time(t).unwrap();
    loop {
        let ret = solver.step();
        q_c.push(solver.state().y[0]);
        q_p1.push(solver.state().y[1]);
        time.push(solver.state().t);
        match ret {
            Ok(OdeSolverStopReason::InternalTimestep) =&gt; continue,
            Ok(OdeSolverStopReason::TstopReached) =&gt; break,
            _ =&gt; panic!("unexpected solver error"),
        }
    }
    solver.state_mut().y[0] += dose;
}
let mut plot = Plot::new();
let q_c = Scatter::new(time.clone(), q_c).mode(Mode::Lines).name("q_c");
let q_p1 = Scatter::new(time, q_p1).mode(Mode::Lines).name("q_p1");
plot.add_trace(q_c);
plot.add_trace(q_p1);

let layout = Layout::new()
    .x_axis(Axis::new().title("t [h]"))
    .y_axis(Axis::new().title("amount [ng]"));
plot.set_layout(layout);
let plot_html = plot.to_inline_html(Some("drug-delivery"));
<span class="boring">fs::write("../src/primer/images/drug-delivery.html", plot_html).expect("Unable to write file");
</span><span class="boring">}</span></code></pre></pre>
<div id="drug-delivery" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("drug-delivery", {"data":[{"type":"scatter","name":"q_c","mode":"lines","x":[0.0,2.8552463184599252e-8,5.7104926369198504e-8,1.1706509905685694e-7,1.7702527174451537e-7,3.029416343885981e-7,4.2885799703268084e-7,6.932823585852546e-7,9.577067201378283e-7,1.5129978793982332e-6,2.068289038658638e-6,3.2344004731054885e-6,4.400511907552339e-6,6.8493459198907255e-6,9.298179932229111e-6,0.000014440731358139723,0.000019583282784050335,0.00003038264077846262,0.0000411819987728749,0.000051981356767287184,0.00007466000855555299,0.00009733866034381878,0.00014496382909917697,0.00019258899785453516,0.00024021416660989335,0.00034022702099614554,0.00044023987538239774,0.0005402527297686499,0.0007502797239797795,0.000960306718190909,0.0011703337124020386,0.0016113904002454107,0.002052447088088783,0.002493503775932155,0.0034197228204032367,0.004345941864874319,0.005272160909345401,0.006198379953816483,0.008143439947205754,0.010088499940595025,0.012033559933984295,0.013978619927373566,0.01806324591349104,0.02214787189960851,0.02623249788572598,0.03031712387184345,0.038894838442690136,0.047472553013536825,0.056050267584383515,0.0646279821552302,0.0732056967260769,0.09121889732485494,0.10923209792363299,0.12724529852241104,0.14525849912118907,0.1632716997199671,0.201099420977401,0.23892714223483488,0.2767548634922688,0.3145825847497027,0.3524103060071366,0.43184852064774776,0.511286735288359,0.5907249499289702,0.6701631645695814,0.7496013792101925,0.8290395938508037,0.9958598445960872,1.1626800953413707,1.3295003460866541,1.4963205968319375,1.663140847577221,1.8299610983225043,2.1802836248875996,2.530606151452695,2.8809286780177903,3.2312512045828856,3.581573731147981,3.9318962577130763,4.282218784278172,4.632541310843267,4.982863837408363,5.333186363973459,5.683508890538555,6.0,6.000004580373271,6.000009160746542,6.000018779530412,6.0000283983142815,6.000048597760408,6.000068797206534,6.0001112160434,6.000153634880265,6.0002427144376815,6.000331793995098,6.000518861065673,6.000705928136247,6.000892995206821,6.001285836055027,6.001678676903233,6.002503642684466,6.003328608465698,6.0041535742469305,6.005886002387518,6.0076184305281055,6.009350858668693,6.012988957763926,6.016627056859159,6.020265155954392,6.027905164054382,6.0355451721543725,6.043185180254363,6.050825188354353,6.066869205364332,6.082913222374311,6.098957239384291,6.11500125639427,6.148693692115226,6.182386127836183,6.216078563557139,6.249770999278096,6.320525114292104,6.391279229306112,6.46203334432012,6.532787459334128,6.603541574348136,6.752125215877553,6.900708857406969,7.049292498936386,7.1978761404658025,7.346459781995219,7.658485429206993,7.970511076418767,8.282536723630542,8.594562370842317,8.90658801805409,9.218613665265865,9.87386752441059,10.529121383555315,11.18437524270004,11.839629101844766,12.0,12.000008895790494,12.000017791580987,12.000036472741021,12.000055153901055,12.000094384337128,12.000133614773201,12.000215998688954,12.000298382604708,12.00047138882779,12.000644395050873,12.001007708119348,12.001371021187822,12.001734334256296,12.00249729170009,12.003260249143883,12.004023206587677,12.005625417219646,12.007227627851615,12.008829838483583,12.012194480810717,12.01555912313785,12.018923765464983,12.022288407792116,12.029354156679096,12.036419905566076,12.043485654453056,12.050551403340036,12.065389476002693,12.08022754866535,12.095065621328008,12.109903693990665,12.141063646582246,12.172223599173828,12.203383551765409,12.23454350435699,12.265703456948572,12.331139357390892,12.396575257833213,12.462011158275534,12.527447058717854,12.592882959160175,12.730298350089047,12.86771374101792,13.005129131946791,13.142544522875664,13.279959913804536,13.56853223475517,13.857104555705803,14.145676876656436,14.43424919760707,14.722821518557703,15.011393839508337,15.617395713504665,16.223397587500994,16.829399461497324,17.435401335493655,18.0],"y":[1000.0,1000.0,999.9999927715282,999.9999834324651,999.9999742876745,999.9999553825605,999.999936487391,999.9998968228359,999.9998571587926,999.9997738650868,999.9996905714193,999.9995156547666,999.99934073817,999.9989734133578,999.9986060887869,999.9978347073584,999.9970633269944,999.9954434311047,999.9938235367304,999.9922036456567,999.9888018743978,999.985400129899,999.9782565205306,999.9711129391895,999.9639694222972,999.9489682192079,999.9339672682215,999.9189665663866,999.8874659052964,999.8559663466983,999.8244678906515,999.7583247219345,999.6921864150565,999.6260529697054,999.487188556897,999.3483455792402,999.2095240326078,999.0707239138258,998.7793133969723,998.4879973308317,998.1967756841018,997.9056484255224,997.2945882771338,996.6839439541014,996.0737151678609,995.4639016299839,994.1846435520246,992.907212781497,991.6316066561321,990.3578225171647,989.085857709839,986.4206417510387,983.763412864457,981.1141466304981,978.472818704476,975.8394048165075,970.3348883046065,964.8649430835611,959.4293475749366,954.0278816269837,948.6603265063776,937.4978754166569,926.4820217570988,915.6107996511854,904.8822697093121,894.2945186305284,883.8456588685498,862.3468914917631,841.435565915886,821.095267843615,801.3100434141742,782.0643861753356,763.3432246221795,725.6713542078171,690.118564528862,656.56254122159,624.8880627609132,594.9865794860649,566.7558326138483,540.0994968579332,514.9268359256272,491.15237391898387,468.69558820310255,447.4806232596866,429.3226149651812,1429.3223521758746,1429.3209410542852,1429.3189055726482,1429.3169009587264,1429.3127387644286,1429.3085781721425,1429.2998433748405,1429.2911087570337,1429.2727662534835,1429.2544241890844,1429.2159070321236,1429.1773904979568,1429.1388753112608,1429.0579934164953,1428.9771224515898,1428.8073155113366,1428.6375200134532,1428.4677508301872,1428.1113100088226,1427.7549720715624,1427.3987357871063,1426.650971177968,1425.9036559540673,1425.1567898980456,1423.5898318846803,1422.0248516752633,1420.4618461104521,1418.9008127652132,1415.6290508940676,1412.365951629572,1409.1114913744143,1405.8656466074403,1399.0773115627944,1392.3266514480556,1385.613451728312,1378.93749879268,1365.0382935659816,1351.3004594080408,1337.722072288884,1324.301228828781,1311.0360492113298,1283.6776233116868,1256.9806282361128,1230.928597816586,1205.5054793738761,1180.6956249859586,1130.5236884721135,1082.8535611076218,1037.556368729269,994.5099415413256,953.5984187727455,914.7119449489309,839.1850032222959,771.2462731098126,710.1007700429763,655.0374465459801,642.4145325755674,1642.4138323094137,1642.4108949304243,1642.4065340670777,1642.402233349543,1642.3932943775003,1642.3843585753702,1642.3655981914944,1642.3468383732272,1642.3074432844787,1642.2680500034385,1642.1853289781513,1642.102610521439,1642.0198976402019,1641.8462164005537,1641.6725570571168,1641.4989193529939,1641.1343507700449,1640.7698779111472,1640.4055007613783,1639.6406201591544,1638.876161364372,1638.1121240767984,1637.3485080663925,1635.7462846299702,1634.1459157470842,1632.5473991948197,1630.950732754628,1627.6037454864043,1624.2648869806244,1620.9341368328853,1617.6114746773594,1610.6601202988325,1603.744156933803,1596.8633982677654,1590.017658869781,1583.2067543207768,1569.016427326709,1554.9772292089995,1541.0874935476108,1527.3455724313756,1513.7498362976614,1485.667476906312,1458.2080414809504,1431.357198081319,1405.1009479715442,1379.4256186551036,1327.339276866586,1277.6369778279911,1230.205117906542,1184.9355681014167,1141.7253743052142,1100.4765248501997,1019.828436936203,946.6222830699925,880.1354538026047,819.7161757182904,768.3667630541869]},{"type":"scatter","name":"q_p1","mode":"lines","x":[0.0,2.8552463184599252e-8,5.7104926369198504e-8,1.1706509905685694e-7,1.7702527174451537e-7,3.029416343885981e-7,4.2885799703268084e-7,6.932823585852546e-7,9.577067201378283e-7,1.5129978793982332e-6,2.068289038658638e-6,3.2344004731054885e-6,4.400511907552339e-6,6.8493459198907255e-6,9.298179932229111e-6,0.000014440731358139723,0.000019583282784050335,0.00003038264077846262,0.0000411819987728749,0.000051981356767287184,0.00007466000855555299,0.00009733866034381878,0.00014496382909917697,0.00019258899785453516,0.00024021416660989335,0.00034022702099614554,0.00044023987538239774,0.0005402527297686499,0.0007502797239797795,0.000960306718190909,0.0011703337124020386,0.0016113904002454107,0.002052447088088783,0.002493503775932155,0.0034197228204032367,0.004345941864874319,0.005272160909345401,0.006198379953816483,0.008143439947205754,0.010088499940595025,0.012033559933984295,0.013978619927373566,0.01806324591349104,0.02214787189960851,0.02623249788572598,0.03031712387184345,0.038894838442690136,0.047472553013536825,0.056050267584383515,0.0646279821552302,0.0732056967260769,0.09121889732485494,0.10923209792363299,0.12724529852241104,0.14525849912118907,0.1632716997199671,0.201099420977401,0.23892714223483488,0.2767548634922688,0.3145825847497027,0.3524103060071366,0.43184852064774776,0.511286735288359,0.5907249499289702,0.6701631645695814,0.7496013792101925,0.8290395938508037,0.9958598445960872,1.1626800953413707,1.3295003460866541,1.4963205968319375,1.663140847577221,1.8299610983225043,2.1802836248875996,2.530606151452695,2.8809286780177903,3.2312512045828856,3.581573731147981,3.9318962577130763,4.282218784278172,4.632541310843267,4.982863837408363,5.333186363973459,5.683508890538555,6.0,6.000004580373271,6.000009160746542,6.000018779530412,6.0000283983142815,6.000048597760408,6.000068797206534,6.0001112160434,6.000153634880265,6.0002427144376815,6.000331793995098,6.000518861065673,6.000705928136247,6.000892995206821,6.001285836055027,6.001678676903233,6.002503642684466,6.003328608465698,6.0041535742469305,6.005886002387518,6.0076184305281055,6.009350858668693,6.012988957763926,6.016627056859159,6.020265155954392,6.027905164054382,6.0355451721543725,6.043185180254363,6.050825188354353,6.066869205364332,6.082913222374311,6.098957239384291,6.11500125639427,6.148693692115226,6.182386127836183,6.216078563557139,6.249770999278096,6.320525114292104,6.391279229306112,6.46203334432012,6.532787459334128,6.603541574348136,6.752125215877553,6.900708857406969,7.049292498936386,7.1978761404658025,7.346459781995219,7.658485429206993,7.970511076418767,8.282536723630542,8.594562370842317,8.90658801805409,9.218613665265865,9.87386752441059,10.529121383555315,11.18437524270004,11.839629101844766,12.0,12.000008895790494,12.000017791580987,12.000036472741021,12.000055153901055,12.000094384337128,12.000133614773201,12.000215998688954,12.000298382604708,12.00047138882779,12.000644395050873,12.001007708119348,12.001371021187822,12.001734334256296,12.00249729170009,12.003260249143883,12.004023206587677,12.005625417219646,12.007227627851615,12.008829838483583,12.012194480810717,12.01555912313785,12.018923765464983,12.022288407792116,12.029354156679096,12.036419905566076,12.043485654453056,12.050551403340036,12.065389476002693,12.08022754866535,12.095065621328008,12.109903693990665,12.141063646582246,12.172223599173828,12.203383551765409,12.23454350435699,12.265703456948572,12.331139357390892,12.396575257833213,12.462011158275534,12.527447058717854,12.592882959160175,12.730298350089047,12.86771374101792,13.005129131946791,13.142544522875664,13.279959913804536,13.56853223475517,13.857104555705803,14.145676876656436,14.43424919760707,14.722821518557703,15.011393839508337,15.617395713504665,16.223397587500994,16.829399461497324,17.435401335493655,18.0],"y":[0.0,0.0,2.4094905524899124e-6,5.52251165899243e-6,8.570775155362388e-6,0.000014872479739256583,0.00002117086957959074,0.000034392387740521,0.000047613735129675896,0.00007537830280413659,0.00010314285682906128,0.00016144840342430963,0.00021975392767261155,0.00034219551249388896,0.0004646370007023413,0.0007217640579193579,0.000978890689173506,0.001518855465299159,0.0020588196349815477,0.002598782484506931,0.0037327044701745563,0.004866615751848119,0.007247807811585941,0.009628988660666924,0.01201014373018775,0.017010496421911523,0.022010748273065105,0.027010900463951715,0.03751089495996354,0.04801044846098756,0.05850956094367751,0.08055626157206226,0.1026010174815251,0.12464382880103941,0.17092740368937512,0.21720240465664198,0.26346883340247823,0.30972669123418944,0.40684030055719195,0.5039161311329242,0.6009541958508885,0.6979545075822815,0.9015323334005646,1.1049438441179613,1.3081891585531353,1.5112683954679917,1.9371947384652781,2.362390301022237,2.7868561793274966,3.2105934681184727,3.633603260475228,4.519560677082059,5.402324731200425,6.28190547710368,7.158312938071509,8.031557106429817,9.855117618144432,11.664863713893077,13.46088661473144,15.24327695138149,17.01212476765535,20.683021546032947,24.29540984010805,27.850098796918765,31.347886604222342,34.789560655432204,38.175897687934665,45.11047934756012,51.81133912543116,58.28522923258593,64.53871138917981,70.57816221974132,76.40977841368229,88.00625169133973,98.76588485220594,108.73892452629201,117.97268365699084,126.5117158306905,134.39797304367605,141.67095369154404,148.36784522490464,154.52366021766528,160.17136354377476,165.34199086205504,169.6274335054384,169.62749552593766,169.62793977927745,169.62856385998006,169.6291776657664,169.63045084856952,169.6317234967378,169.63439524257313,169.63706692253024,169.6426773816019,169.6482876674592,169.6600688025931,169.67184969193326,169.68363004896307,169.70836879973527,169.73310323306384,169.78503681880335,169.83696588473225,169.8888845561889,169.99788435268988,170.10684351002632,170.2157625150193,170.44436145011423,170.6727828875272,170.90102691719125,171.37976246738242,171.85771689490065,172.334891497404,172.8112872709987,173.80918800015772,174.80366842602322,175.79473824403365,176.7824071181768,178.84548459475235,180.89369512089544,182.92712683159743,184.9458674796529,189.13779053076456,193.26611200420547,197.33162215203845,201.3351026851192,205.27732556829957,213.35998117790132,221.18277431569544,228.75246421435986,236.0756390999998,243.15871980819588,257.2793389648382,270.42427505315146,282.64635819406186,293.9956464863549,304.5195897132152,314.26315510834013,332.3714003801298,347.5869681117296,360.2343906757344,370.6035230567781,372.8239361738171,372.82405937010157,372.82492771960773,372.826149154227,372.82735055385797,372.8298426700929,372.8323337252025,372.8375633382075,372.8427927395839,372.8537742897167,372.8647551352806,372.88781301408477,372.91086989151404,372.93392459438843,372.98233330392213,373.0307334738296,373.0791252043608,373.1807203060602,373.28227807605805,373.3837985206574,373.5968700098925,373.8097770052635,374.0225196297399,374.23509797756094,374.6809782269397,375.12613536067613,375.5705702902302,376.01428392525895,376.9437387872191,377.8700251353128,378.7931513350521,379.71312573600613,381.6348498792845,383.5427881626536,385.43701696327275,387.3176122929546,389.18464974512585,393.06163150102066,396.87984471837126,400.6399723154149,404.34268955780726,407.98866412501985,415.46344069697443,422.6968924736483,429.69488886459004,436.4631615311714,443.0073072706175,456.0446439385876,468.16633364699754,479.41882778608783,489.8463151726937,499.4908461582817,508.3924288739822,524.834556045067,538.4925668366388,549.6605256118783,558.6032478516805,565.1427050960293]}],"layout":{"xaxis":{"title":{"text":"t [h]"}},"yaxis":{"title":{"text":"amount [ng]"}}},"config":{}});
</script>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-bouncing-ball"><a class="header" href="#example-bouncing-ball">Example: Bouncing Ball</a></h1>
<p>Modelling a bouncing ball is a simple and intuitive example of a system with discrete events. The ball is dropped from a height \(h\) and bounces off the ground with a coefficient of restitution \(e\). When the ball hits the ground, its velocity is reversed and scaled by the coefficient of restitution, and the ball rises and then continues to fall until it hits the ground again. This process repeats until halted.</p>
<p>The second order ODE that describes the motion of the ball is given by:</p>
<p>\[
\frac{d^2x}{dt^2} = -g
\]</p>
<p>where \(x\) is the position of the ball, \(t\) is time, and \(g\) is the acceleration due to gravity. We can rewrite this as a system of two first order ODEs by introducing a new variable for the velocity of the ball:</p>
<p>\[
\begin{align*}
\frac{dx}{dt} &amp;= v \\
\frac{dv}{dt} &amp;= -g
\end{align*}
\]</p>
<p>where \(v = \frac{dx}{dt}\) is the velocity of the ball. This is a system of two first order ODEs, which can be written in vector form as:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>where</p>
<p>\[
\mathbf{y} = \begin{bmatrix} x \\ v \end{bmatrix}
\]</p>
<p>and</p>
<p>\[
\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} v \\ -g \end{bmatrix}
\]</p>
<p>The initial conditions for the ball, including the height from which it is dropped and its initial velocity, are given by:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} h \\ 0 \end{bmatrix}
\]</p>
<p>When the ball hits the ground, we need to update the velocity of the ball according to the coefficient of restitution, which is the ratio of the velocity after the bounce to the velocity before the bounce. The velocity after the bounce \(v'\) is given by:</p>
<p>\[
v' = -e v
\]</p>
<p>where \(e\) is the coefficient of restitution. However, to implement this in our ODE solver, we need to detect when the ball hits the ground. We can do this by using DiffSol's event handling feature, which allows us to specify a function that is equal to zero when the event occurs, i.e. when the ball hits the ground. This function \(g(\mathbf{y}, t)\) is called an event or root function, and for our bouncing ball problem, it is given by:</p>
<p>\[
g(\mathbf{y}, t) = x
\]</p>
<p>where \(x\) is the position of the ball. When the ball hits the ground, the event function will be zero and DiffSol will stop the integration, and we can update the velocity of the ball accordingly.</p>
<p>In code, the bouncing ball problem can be solved using DiffSol as follows:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use std::fs;
</span>use diffsol::{
    DiffSl, CraneliftModule, OdeBuilder, OdeSolverMethod, OdeSolverStopReason,
};
use plotly::{
    Plot, Scatter, common::Mode, layout::Layout, layout::Axis
};
type M = nalgebra::DMatrix&lt;f64&gt;;
type CG = CraneliftModule;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
        
let eqn = DiffSl::&lt;M, CG&gt;::compile("
    g { 9.81 } h { 10.0 }
    u_i {
        x = h,
        v = 0,
    }
    F_i {
        v,
        -g,
    }
    stop {
        x,
    }
").unwrap();

let e = 0.8;
let problem = OdeBuilder::&lt;M&gt;::new().build_from_eqn(eqn).unwrap();
let mut solver = problem.bdf::&lt;LS&gt;().unwrap();

let mut x = Vec::new();
let mut v = Vec::new();
let mut t = Vec::new();
let final_time = 10.0;

// save the initial state
x.push(solver.state().y[0]);
v.push(solver.state().y[1]);
t.push(0.0);

// solve until the final time is reached
solver.set_stop_time(final_time).unwrap();
loop {
    match solver.step() {
        Ok(OdeSolverStopReason::InternalTimestep) =&gt; (),
        Ok(OdeSolverStopReason::RootFound(t)) =&gt; {
            // get the state when the event occurred
            let mut y = solver.interpolate(t).unwrap();

            // update the velocity of the ball
            y[1] *= -e;

            // make sure the ball is above the ground
            y[0] = y[0].max(f64::EPSILON);

            // set the state to the updated state
            solver.state_mut().y.copy_from(&amp;y);
            solver.state_mut().dy[0] = y[1];
            *solver.state_mut().t = t;
        },
        Ok(OdeSolverStopReason::TstopReached) =&gt; break,
        Err(_) =&gt; panic!("unexpected solver error"),
    }
    x.push(solver.state().y[0]);
    v.push(solver.state().y[1]);
    t.push(solver.state().t);
}
let mut plot = Plot::new();
let x = Scatter::new(t.clone(), x).mode(Mode::Lines).name("x");
let v = Scatter::new(t, v).mode(Mode::Lines).name("v");
plot.add_trace(x);
plot.add_trace(v);

let layout = Layout::new()
    .x_axis(Axis::new().title("t"))
    .y_axis(Axis::new());
plot.set_layout(layout);
let plot_html = plot.to_inline_html(Some("bouncing-ball"));
<span class="boring">fs::write("../src/primer/images/bouncing-ball.html", plot_html).expect("Unable to write file");
</span><span class="boring">}</span></code></pre></pre>
<div id="bouncing-ball" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("bouncing-ball", {"data":[{"type":"scatter","name":"x","mode":"lines","x":[0.0,0.000037968461110720624,0.00007593692222144125,0.00015567069055395457,0.00023540445888646787,0.00031513822721898117,0.00048257914071725915,0.0006500200542155371,0.000817460967713815,0.0011690868860601987,0.0015207128044065824,0.001872338722752966,0.002610753151280372,0.003349167579807778,0.004087582008335183,0.005638252308242736,0.007188922608150288,0.008739592908057842,0.011996000537863701,0.01525240816766956,0.01850881579747542,0.025347271820067727,0.032185727842660036,0.039024183865252346,0.05338494151269619,0.06774569916014003,0.08210645680758388,0.11226404786721596,0.14242163892684803,0.17257922998648012,0.20273682104611218,0.26606776227133955,0.3293987034965669,0.3927296447217943,0.5257246212947717,0.6587195978677491,0.7917145744407266,1.0710040252439792,1.3502934760472318,1.4278431219206382,1.4281779078441663,1.4285126937676944,1.4292157442071036,1.4299187946465128,1.430621845085922,1.4320982510086815,1.433574656931441,1.4350510628542004,1.4365274687769598,1.4396279212147545,1.4427283736525491,1.4458288260903438,1.4523397762097126,1.4588507263290813,1.46536167644845,1.4718726265678188,1.485545621818493,1.4992186170691673,1.5128916123198415,1.5416049023462575,1.5703181923726734,1.5990314823990894,1.6593293914545628,1.7196273005100362,1.7799252095655096,1.9065508185820037,2.033176427598498,2.1598020366149924,2.4257158155496303,2.6916295944842683,2.9575433734189063,3.5159623091816457,3.7123920246755815,3.7127268105991096,3.7130615965226377,3.713764646962047,3.714467697401456,3.7151707478408653,3.7166471537636245,3.7181235596863838,3.719599965609143,3.721076371531902,3.7241768239696964,3.7272772764074906,3.730377728845285,3.736888678964653,3.743399629084021,3.749910579203389,3.756421529322757,3.7700945245734303,3.7837675198241034,3.7974405150747765,3.82615380510119,3.854867095127603,3.8835803851540165,3.943878294209485,4.0041762032649535,4.064474112320422,4.191099721336905,4.3177253303533885,4.444350939369872,4.7102647183044875,4.976178497239103,5.242092276173719,5.540030957627391,5.54036574355092,5.5407005294744485,5.541403579913858,5.542106630353268,5.542809680792677,5.544286086715437,5.545762492638197,5.547238898560956,5.548715304483716,5.551815756921511,5.554916209359305,5.5580166617971,5.564527611916469,5.571038562035837,5.577549512155206,5.584060462274574,5.597733457525249,5.611406452775923,5.6250794480265975,5.6537927380530135,5.6825060280794295,5.7112193181058455,5.771517227161319,5.831815136216793,5.892113045272267,6.018738654288763,6.145364263305257,6.271989872321752,6.537903651256392,6.803817430191032,7.002141867423656,7.002476653347185,7.0028114392707135,7.003514489710123,7.004217540149533,7.0049205905889425,7.006396996511702,7.007873402434462,7.009349808357221,7.010826214279981,7.013926666717776,7.01702711915557,7.020127571593365,7.026638521712734,7.033149471832102,7.039660421951471,7.046171372070839,7.059844367321514,7.073517362572188,7.0871903578228626,7.1159036478492785,7.1446169378756945,7.1733302279021105,7.233628136957584,7.293926046013058,7.354223955068532,7.480849564085028,7.607475173101523,7.734100782118019,8.00001456105266,8.171830299554179,8.172165085477706,8.172499871401234,8.173202921840643,8.173905972280052,8.17460902271946,8.176085428642219,8.177561834564978,8.179038240487737,8.180514646410495,8.18361509884829,8.186715551286083,8.189816003723877,8.196326953843245,8.202837903962614,8.209348854081982,8.21585980420135,8.229532799452024,8.243205794702696,8.256878789953369,8.285592079979782,8.314305370006196,8.343018660032609,8.403316569088075,8.46361447814354,8.523912387199006,8.650537996215485,8.777163605231964,8.903789214248443,9.107580675625341,9.107915461548869,9.108250247472396,9.108953297911805,9.109656348351214,9.110359398790623,9.111835804713381,9.11331221063614,9.114788616558899,9.116265022481658,9.119365474919451,9.122465927357245,9.125566379795039,9.132077329914408,9.138588280033776,9.145099230153145,9.151610180272513,9.165283175523186,9.178956170773859,9.192629166024531,9.221342456050944,9.250055746077358,9.278769036103771,9.339066945159239,9.399364854214706,9.459662763270174,9.586288372286656,9.712913981303139,9.839539590319621,9.856180514440354,9.856515300363881,9.856850086287409,9.857553136726818,9.858256187166226,9.858959237605635,9.860435643528394,9.861912049451153,9.863388455373912,9.86486486129667,9.867965313734464,9.871065766172258,9.874166218610052,9.88067716872942,9.887188118848789,9.893699068968157,9.900210019087526,9.913883014338198,9.927556009588871,9.941229004839544,9.969942294865957,9.99865558489237],"y":[10.0,10.0,9.999999976131416,9.999999863386595,9.999999717284997,9.999999500754265,9.99999884610086,9.99999791421793,9.99999670831313,9.999993281885121,9.999988642706043,9.999982790655663,9.99996655324365,9.999944966887018,9.999918031559599,9.999844056497581,9.999746492519693,9.9996253396278,9.999294136640964,9.998858906543754,9.998319649336352,9.99684860095688,9.994918793021041,9.992530225528823,9.986020971439133,9.977488587705787,9.966933074328795,9.938181209247043,9.900507342436816,9.853911473898096,9.798393603630908,9.652764960443589,9.467790289633673,9.24346959120115,8.644324804581291,7.871664036145754,6.925487285894543,4.373721589556975,1.0567504134122783,2.220446049250313e-16,0.003751514915514589,0.00750117409999241,0.015370589755655079,0.02323741199270263,0.03109875851672249,0.04759133118021827,0.06406322817253061,0.08051400779069147,0.09694332251183078,0.13137479931702759,0.16571202712258548,0.19995491037181654,0.27155798210875154,0.34274522525162626,0.4135166148374218,0.4838721297046275,0.630265024201539,0.7748239346561543,0.9175488550838975,1.2113015598377943,1.496966379720277,1.7745433157340529,2.331128818785577,2.8520467527079334,3.337297117470721,4.240224945788378,4.985858794046383,5.574198662236343,6.297720480321246,6.327575846319759,5.663764760232407,2.011877177909919,2.220446049250313e-16,0.003001211689854945,0.006000567648673123,0.012294346530450539,0.018585531993612847,0.024871241743747458,0.03805497718208422,0.05121803694923755,0.0643599793422394,0.0774804568382197,0.10496337547058267,0.13235204510330664,0.15964637017970382,0.21665746975368755,0.27325274073361133,0.3294321581564564,0.385195700860711,0.5009454538154258,0.6148612227278449,0.7269430016133919,0.9563451091286775,1.1776593317725517,1.39088567054772,1.8123349193981697,2.19811659911946,2.548230709681188,3.1673724041766382,3.6292201186124604,3.9337738529802664,4.06134479003873,3.495249275010921,2.2354873078973645,2.220446049250313e-16,0.0024009690486883725,0.004800082366339977,0.009833351701667591,0.014864027618380089,0.01988922782206489,0.030425893212857068,0.040941882932465784,0.05143675527792303,0.06191016272635873,0.08383423425887794,0.1056640567917582,0.12739953476831167,0.17273705543262358,0.2176587475028753,0.2621645860160481,0.30625454981063077,0.3974897870550342,0.486891040257141,0.5744583034323758,0.7523799279560047,0.9222136676082202,1.0839595233917279,1.3972997579596873,1.6749724233984804,1.9169775196777026,2.3090902841798715,2.5439090686223875,2.6214338729968554,2.2722440570692135,1.2293877890551728,2.220446049250313e-16,0.0019207748599560804,0.003839693988875392,0.00786455552786519,0.011886823648239873,0.01590361605558686,0.02432262507406961,0.03272095842136893,0.041098174394516775,0.049453925470643055,0.06693091862131254,0.08431366277234306,0.1016020623670467,0.1376007184294742,0.17318354589784143,0.2083505198091297,0.24310161900182778,0.31472524058227375,0.3845148781204231,0.45247052563170037,0.5892077572610184,0.7178571040189227,0.8384185669081197,1.065271576398026,1.2564570167587654,1.4119748879599343,1.6224644797981895,1.675660091576789,1.5715617232873402,0.8409632447654712,2.220446049250313e-16,0.0015366194142212377,0.0030713830974057076,0.006289518200352344,0.009505059884683862,0.012715125855987686,0.01944000935877978,0.026144217190388473,0.03282730764784569,0.039488933208281354,0.05340826277600054,0.06723334334408078,0.08096407935583419,0.10949164189406613,0.13760337583823812,0.16529925622533112,0.19257926189383412,0.2485135870734705,0.30261392821081096,0.35488027932127975,0.4586699885089017,0.5543718128251117,0.6419857532726164,0.7996489656349759,0.9216446088681781,1.0079726829418185,1.073163700812294,0.9810607386231542,0.7316637963660073,2.220446049250313e-16,0.0012292949391974574,0.0024567341473581464,0.005029487852754841,0.007599648139536421,0.010164332713290305,0.015533915281227542,0.020882822177981344,0.026210611700583687,0.03151693632616447,0.04259013393068836,0.05356908253557339,0.06445368658413154,0.08700437199965344,0.10913922882111537,0.13085823208549832,0.15216136063129115,0.1955442438532364,0.23709314303288553,0.27680805218566307,0.3542397332621329,0.4235835294671908,0.4848394418035428,0.5871507951324815,0.653794579332261,0.6847707943724779,0.6337229082727589,0.4253810421134201,0.05974519588606833,2.220446049250313e-16,0.000983435211132787,0.001965014691228806,0.004021462967689693,0.006075317825535463,0.008123696970353542,0.01240903813752556,0.01667370363351418,0.02091725175535132,0.02513933498016691,0.03393562564308392,0.042637667306362016,0.05124536441331324,0.06901454525146063,0.08636789749554803,0.10330539618255645,0.11982702015097481,0.15316874376043343,0.18467648332759604,0.21435023286788696,0.2706954787581348,0.31895283977697086]},{"type":"scatter","name":"v","mode":"lines","x":[0.0,0.000037968461110720624,0.00007593692222144125,0.00015567069055395457,0.00023540445888646787,0.00031513822721898117,0.00048257914071725915,0.0006500200542155371,0.000817460967713815,0.0011690868860601987,0.0015207128044065824,0.001872338722752966,0.002610753151280372,0.003349167579807778,0.004087582008335183,0.005638252308242736,0.007188922608150288,0.008739592908057842,0.011996000537863701,0.01525240816766956,0.01850881579747542,0.025347271820067727,0.032185727842660036,0.039024183865252346,0.05338494151269619,0.06774569916014003,0.08210645680758388,0.11226404786721596,0.14242163892684803,0.17257922998648012,0.20273682104611218,0.26606776227133955,0.3293987034965669,0.3927296447217943,0.5257246212947717,0.6587195978677491,0.7917145744407266,1.0710040252439792,1.3502934760472318,1.4278431219206382,1.4281779078441663,1.4285126937676944,1.4292157442071036,1.4299187946465128,1.430621845085922,1.4320982510086815,1.433574656931441,1.4350510628542004,1.4365274687769598,1.4396279212147545,1.4427283736525491,1.4458288260903438,1.4523397762097126,1.4588507263290813,1.46536167644845,1.4718726265678188,1.485545621818493,1.4992186170691673,1.5128916123198415,1.5416049023462575,1.5703181923726734,1.5990314823990894,1.6593293914545628,1.7196273005100362,1.7799252095655096,1.9065508185820037,2.033176427598498,2.1598020366149924,2.4257158155496303,2.6916295944842683,2.9575433734189063,3.5159623091816457,3.7123920246755815,3.7127268105991096,3.7130615965226377,3.713764646962047,3.714467697401456,3.7151707478408653,3.7166471537636245,3.7181235596863838,3.719599965609143,3.721076371531902,3.7241768239696964,3.7272772764074906,3.730377728845285,3.736888678964653,3.743399629084021,3.749910579203389,3.756421529322757,3.7700945245734303,3.7837675198241034,3.7974405150747765,3.82615380510119,3.854867095127603,3.8835803851540165,3.943878294209485,4.0041762032649535,4.064474112320422,4.191099721336905,4.3177253303533885,4.444350939369872,4.7102647183044875,4.976178497239103,5.242092276173719,5.540030957627391,5.54036574355092,5.5407005294744485,5.541403579913858,5.542106630353268,5.542809680792677,5.544286086715437,5.545762492638197,5.547238898560956,5.548715304483716,5.551815756921511,5.554916209359305,5.5580166617971,5.564527611916469,5.571038562035837,5.577549512155206,5.584060462274574,5.597733457525249,5.611406452775923,5.6250794480265975,5.6537927380530135,5.6825060280794295,5.7112193181058455,5.771517227161319,5.831815136216793,5.892113045272267,6.018738654288763,6.145364263305257,6.271989872321752,6.537903651256392,6.803817430191032,7.002141867423656,7.002476653347185,7.0028114392707135,7.003514489710123,7.004217540149533,7.0049205905889425,7.006396996511702,7.007873402434462,7.009349808357221,7.010826214279981,7.013926666717776,7.01702711915557,7.020127571593365,7.026638521712734,7.033149471832102,7.039660421951471,7.046171372070839,7.059844367321514,7.073517362572188,7.0871903578228626,7.1159036478492785,7.1446169378756945,7.1733302279021105,7.233628136957584,7.293926046013058,7.354223955068532,7.480849564085028,7.607475173101523,7.734100782118019,8.00001456105266,8.171830299554179,8.172165085477706,8.172499871401234,8.173202921840643,8.173905972280052,8.17460902271946,8.176085428642219,8.177561834564978,8.179038240487737,8.180514646410495,8.18361509884829,8.186715551286083,8.189816003723877,8.196326953843245,8.202837903962614,8.209348854081982,8.21585980420135,8.229532799452024,8.243205794702696,8.256878789953369,8.285592079979782,8.314305370006196,8.343018660032609,8.403316569088075,8.46361447814354,8.523912387199006,8.650537996215485,8.777163605231964,8.903789214248443,9.107580675625341,9.107915461548869,9.108250247472396,9.108953297911805,9.109656348351214,9.110359398790623,9.111835804713381,9.11331221063614,9.114788616558899,9.116265022481658,9.119365474919451,9.122465927357245,9.125566379795039,9.132077329914408,9.138588280033776,9.145099230153145,9.151610180272513,9.165283175523186,9.178956170773859,9.192629166024531,9.221342456050944,9.250055746077358,9.278769036103771,9.339066945159239,9.399364854214706,9.459662763270174,9.586288372286656,9.712913981303139,9.839539590319621,9.856180514440354,9.856515300363881,9.856850086287409,9.857553136726818,9.858256187166226,9.858959237605635,9.860435643528394,9.861912049451153,9.863388455373912,9.86486486129667,9.867965313734464,9.871065766172258,9.874166218610052,9.88067716872942,9.887188118848789,9.893699068968157,9.900210019087526,9.913883014338198,9.927556009588871,9.941229004839544,9.969942294865957,9.99865558489237],"y":[0.0,-0.00037247060349616934,-0.0007449412069923387,-0.0015271294743342944,-0.00230931774167625,-0.0030915060090182054,-0.004734101370436312,-0.0063766967318544185,-0.008019292093272526,-0.01146874235225055,-0.01491819261122857,-0.018367642870206594,-0.02561148841406044,-0.032855333957914304,-0.04009917950176817,-0.05531125514386123,-0.07052333078595434,-0.08573540642804743,-0.117680765276443,-0.14962612412483844,-0.18157148297323394,-0.24865673655486448,-0.31574199013649495,-0.38282724371812554,-0.5237062762395499,-0.664585308760974,-0.8054643412823982,-1.101310309577389,-1.3971562778723798,-1.6930022461673706,-1.9888482144623614,-2.610124747881842,-3.2314012813013213,-3.852677814720802,-5.157358534901711,-6.46203925508262,-7.766719975263529,-10.506549487643436,-13.246379000023346,11.205712820833172,11.202428570923361,11.19914432101355,11.192247396202946,11.185350471392342,11.178453546581737,11.163970004479468,11.1494864623772,11.13500292027493,11.120519378172661,11.090103939757896,11.05968850134313,11.029273062928365,10.965400642257357,10.90152822158635,10.837655800915343,10.773783380244335,10.639651296835222,10.505519213426108,10.371387130016995,10.089709754857855,9.808032379698716,9.526355004539576,8.934832516705383,8.343310028871189,7.751787541036995,6.509590316585187,5.2673930921333785,4.02519586768157,1.416581696332773,-1.192032475016024,-3.80064664636482,-9.278736406197295,8.96456953215424,8.961285282244429,8.958001032334618,8.951104107524014,8.94420718271341,8.937310257902805,8.922826715800538,8.90834317369827,8.893859631596003,8.879376089493736,8.848960651078974,8.818545212664212,8.78812977424945,8.724257353578448,8.660384932907446,8.596512512236444,8.532640091565442,8.39850800815634,8.264375924747236,8.130243841338133,7.848566466179017,7.566889091019901,7.285211715860784,6.69368922802664,6.102166740192496,5.510644252358352,4.2684470279066495,3.026249803454943,1.7840525790032387,-0.82456159234534,-3.433175763693919,-6.041789935042498,7.17165472008242,7.168370470172608,7.165086220262796,7.158189295452192,7.151292370641587,7.144395445830983,7.129911903728714,7.115428361626445,7.100944819524176,7.086461277421907,7.056045839007141,7.025630400592376,6.99521496217761,6.931342541506603,6.867470120835596,6.803597700164588,6.739725279493581,6.605593196084466,6.4714611126753505,6.337329029266235,6.055651654107093,5.77397427894795,5.492296903788807,4.900774415954608,4.309251928120409,3.717729440286209,2.475532215834393,1.2333349913825735,-0.008862233069244314,-2.6174764044180625,-5.2260905757668805,5.737322644015145,5.734038394105333,5.730754144195521,5.723857219384917,5.716960294574313,5.710063369763708,5.695579827661439,5.68109628555917,5.666612743456901,5.652129201354632,5.621713762939867,5.591298324525101,5.560882886110336,5.497010465439328,5.433138044768321,5.369265624097314,5.3053932034263065,5.17126112001719,5.037129036608074,4.902996953198958,4.621319578039814,4.33964220288067,4.057964827721526,3.4664423398873248,2.874919852053122,2.2833973642189207,1.0412001397670967,-0.20099708468472532,-1.443194309136548,-4.051808480485378,4.58985670014822,4.586572450238409,4.583288200328598,4.576391275517994,4.569494350707391,4.562597425896787,4.54811388379452,4.533630341692253,4.519146799589985,4.504663257487718,4.474247819072956,4.443832380658194,4.413416942243432,4.349544521572433,4.285672100901434,4.2217996802304345,4.157927259559435,4.023795176150337,3.889663092741238,3.755531009332139,3.4738536341730315,3.1921762590139235,2.9104988838548165,2.31897639602069,1.7274539081865652,1.1359314203524402,-0.1062658040992237,-1.3484630285508872,-2.5906602530025507,3.671883591287939,3.6685993413781275,3.665315091468316,3.6584181666577127,3.6515212418471092,3.644624317036506,3.630140774934238,3.6156572328319703,3.6011736907297025,3.5866901486274347,3.5562747102126724,3.52585927179791,3.4954438333831477,3.431571412712147,3.3676989920411464,3.303826571370146,3.239954150699145,3.105822067290044,2.971689983880943,2.837557900471842,2.5558805253127295,2.274203150153617,1.992525774994505,1.4010032871603706,0.8094807993262347,0.21795831149209896,-1.024238912959586,-2.266436137411271,-3.5086333618629553,2.9375046619898737,2.9342204120800623,2.930936162170251,2.924039237359647,2.917142312549043,2.9102453877384393,2.8957618456361716,2.881278303533904,2.866794761431636,2.8523112193293683,2.821895780914606,2.7914803424998436,2.761064904085081,2.6971924834140806,2.63332006274308,2.5694476420720793,2.5055752214010787,2.371443137991977,2.2373110545828756,2.103178971173774,1.8215015960146606,1.539824220855547]}],"layout":{"xaxis":{"title":{"text":"t"}},"yaxis":{}},"config":{}});
</script><div style="break-before: page; page-break-before: always;"></div><h1 id="daes-via-the-mass-matrix"><a class="header" href="#daes-via-the-mass-matrix">DAEs via the Mass Matrix</a></h1>
<p>Differential-algebraic equations (DAEs) are a generalisation of ordinary differential equations (ODEs) that include algebraic equations, or equations that do not involve derivatives. Algebraic equations can arise in many physical systems and often are used to model constraints on the system, such as conservation laws or other relationships between the state variables. For example, in an electrical circuit, the current flowing into a node must equal the current flowing out of the node, which can be written as an algebraic equation.</p>
<p>DAEs can be written in the general implicit form:</p>
<p>\[
\mathbf{F}(\mathbf{y}, \mathbf{y}', t) = 0
\]</p>
<p>where \(\mathbf{y}\) is the vector of state variables, \(\mathbf{y}'\) is the vector of derivatives of the state variables, and \(\mathbf{F}\) is a vector-valued function that describes the system of equations. However, for the purposes of this primer and the capabilities of DiffSol, we will focus on a specific form of DAEs called index-1 or semi-explicit DAEs, which can be written as a combination of differential and algebraic equations:</p>
<p>\[
\begin{align*}
\frac{d\mathbf{y}}{dt} &amp;= \mathbf{f}(\mathbf{y}, t) \\
0 &amp;= \mathbf{g}(\mathbf{y}, t)
\end{align*}
\]</p>
<p>where \(\mathbf{f}\) is the vector-valued function that describes the differential equations and \(\mathbf{g}\) is the vector-valued function that describes the algebraic equations. The key difference between DAEs and ODEs is that DAEs include algebraic equations that must be satisfied at each time step, in addition to the differential equations that describe the rate of change of the state variables.</p>
<p>How does this relate to the standard form of an explicit ODE that we have seen before? Recall that an explicit ODE can be written as:</p>
<p>\[
\frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>Lets update this equation to include a matrix \(\mathbf{M}\) that multiplies the derivative term:</p>
<p>\[
M \frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>When \(M\) is the identity matrix (i.e. a matrix with ones along the diagonal), this reduces to the standard form of an explicit ODE. However, when \(M\) has diagonal entries that are zero, this introduces algebraic equations into the system and it reduces to the semi-explicit DAE equations show above. The matrix \(M\) is called the <em>mass matrix</em>.</p>
<p>Thus, we now have a general form of a set of differential equations, that includes both ODEs and semi-explicit DAEs. This general form is used by DiffSol to allow users to specify a wide range of problems, from simple ODEs to more complex DAEs. In the next section, we will look at a few examples of DAEs and how to solve them using DiffSol and a mass matrix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-electrical-circuits"><a class="header" href="#example-electrical-circuits">Example: Electrical Circuits</a></h1>
<p>Lets consider the following low-pass LRC filter circuit:</p>
<pre><code class="language-plaintext">    +---L---+---C---+
    |       |       |
V_s =       R       |
    |       |       |
    +-------+-------+
</code></pre>
<p>The circuit consists of a resistor \(R\), an inductor \(L\), and a capacitor \(C\) connected to a voltage source \(V_s\). The voltage across the resistor \(V\) is given by Ohm's law:</p>
<p>\[
V = R i_R
\]</p>
<p>where \(i_R\) is the current flowing through the resistor. The voltage across the inductor is given by:</p>
<p>\[
\frac{di_L}{dt} = \frac{V_s - V}{L}
\]</p>
<p>where \(di_L/dt\) is the rate of change of current with respect to time. The voltage across the capacitor is the same as the voltage across the resistor and the equation for an ideal capacitor is:</p>
<p>\[
\frac{dV}{dt} = \frac{i_C}{C}
\]</p>
<p>where \(i_C\) is the current flowing through the capacitor. The sum of the currents flowing into and out of the top-center node of the circuit must be zero according to Kirchhoff's current law:</p>
<p>\[
i_L = i_R + i_C
\]</p>
<p>Thus we have a system of two differential equations and two algebraic equation that describe the evolution of the currents through the resistor, inductor, and capacitor; and the voltage across the resistor. We can write these equations in the general form:</p>
<p>\[
M \frac{d\mathbf{y}}{dt} = \mathbf{f}(\mathbf{y}, t)
\]</p>
<p>where</p>
<p>\[
\mathbf{y} = \begin{bmatrix} i_R \\ i_L \\ i_C \\ V \end{bmatrix}
\]</p>
<p>and</p>
<p>\[
\mathbf{f}(\mathbf{y}, t) = \begin{bmatrix} V - R i_R \\ \frac{V_s - V}{L} \\ i_L - i_R - i_C \\ \frac{i_C}{C} \end{bmatrix}
\]</p>
<p>The mass matrix \(M\) has one on the diagonal for the differential equations and zero for the algebraic equation.</p>
<p>\[
M = \begin{bmatrix} 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}
\]</p>
<p>Instead of providing the mass matrix explicitly, the DiffSL language specifies the multiplication of the mass matrix with the derivative term, \(M \frac{d\mathbf{y}}{dt}\), which is given by:</p>
<p>\[
M \frac{d\mathbf{y}}{dt} = \begin{bmatrix} 0 \\ \frac{di_L}{dt} \\ 0 \\ \frac{dV}{dt} \end{bmatrix}
\]</p>
<p>The initial conditions for the system are:</p>
<p>\[
\mathbf{y}(0) = \begin{bmatrix} 0 \\ 0 \\ 0 \\ 0 \end{bmatrix}
\]</p>
<p>The voltage source \(V_s\) acts as a forcing function for the system, and we can specify this as sinusoidal function of time.</p>
<p>\[
V_s(t) = V_0 \sin(\omega t)
\]</p>
<p>where \(\omega\) is the angular frequency of the source. Since this is a low-pass filter, we will choose a high frequency for the source, say \(\omega = 200\), to demonstrate the filtering effect of the circuit.</p>
<p>We can solve this system of equations using DiffSol and plot the current and voltage across the resistor as a function of time.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use std::fs;
</span>use diffsol::{
    DiffSl, CraneliftModule, OdeBuilder, OdeSolverMethod
};
use plotly::{
    Plot, Scatter, common::Mode, layout::Layout, layout::Axis
};
type M = nalgebra::DMatrix&lt;f64&gt;;
type CG = CraneliftModule;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
        
let eqn = DiffSl::&lt;M, CG&gt;::compile("
    R { 100.0 } L { 1.0 } C { 0.001 } V0 { 10 } omega { 100.0 }
    Vs { V0 * sin(omega * t) }
    u_i {
        iR = 0,
        iL = 0,
        iC = 0,
        V = 0,
    }
    dudt_i {
        diRdt = 0,
        diLdt = 0,
        diCdt = 0,
        dVdt = 0,
    }
    M_i {
        0,
        diLdt,
        0,
        dVdt,
    }
    F_i {
        V - R * iR,
        (Vs - V) / L,
        iL - iR - iC,
        iC / C,
    }
    out_i {
        iR,
    }
").unwrap();
let problem = OdeBuilder::&lt;M&gt;::new()
    .build_from_eqn(eqn).unwrap();
let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
let (ys, ts) = solver.solve(1.0).unwrap();

let ir: Vec&lt;_&gt; = ys.row(0).into_iter().copied().collect();
let t: Vec&lt;_&gt; = ts.into_iter().collect();

let ir = Scatter::new(t.clone(), ir).mode(Mode::Lines);

let mut plot = Plot::new();
plot.add_trace(ir);

let layout = Layout::new()
    .x_axis(Axis::new().title("t"))
    .y_axis(Axis::new().title("current"));
plot.set_layout(layout);
let plot_html = plot.to_inline_html(Some("electrical-circuit"));
<span class="boring">fs::write("../src/primer/images/electrical-circuit.html", plot_html).expect("Unable to write file");
</span><span class="boring">}</span></code></pre></pre>
<div id="electrical-circuit" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("electrical-circuit", {"data":[{"type":"scatter","mode":"lines","x":[0.0,4.47213595872636e-6,8.94427191745272e-6,0.000018335757430778077,0.000027727242944103434,0.00003711872845742879,0.00005684084803541204,0.0000765629676133953,0.00009628508719137854,0.00013770153830514336,0.00017911798941890817,0.000220534440532673,0.00026195089164643783,0.000348925438985344,0.00043589998632425015,0.0005228745336631563,0.0006098490810020625,0.0007924956304137653,0.0009751421798254681,0.001157788729237171,0.0013404352786488738,0.0017239930324134498,0.002107550786178026,0.002491108539942602,0.002874666293707178,0.003258224047471754,0.0040636953303773635,0.004869166613282973,0.005674637896188583,0.006480109179094193,0.007285580461999803,0.008091051744905412,0.00889652302781102,0.00970199431071663,0.010507465593622239,0.011312936876527848,0.012118408159433457,0.012923879442339066,0.013729350725244675,0.014534822008150284,0.015340293291055893,0.016145764573961503,0.016951235856867114,0.017756707139772725,0.018562178422678335,0.019367649705583946,0.020173120988489557,0.020978592271395168,0.021784063554300778,0.02258953483720639,0.023395006120112,0.02420047740301761,0.02500594868592322,0.025811419968828832,0.027430128004061444,0.029048836039294056,0.030667544074526668,0.03228625210975928,0.03390496014499189,0.0355236681802245,0.037142376215457115,0.03876108425068973,0.04037979228592234,0.04199850032115495,0.04361720835638756,0.045235916391620175,0.04685462442685279,0.0484733324620854,0.05009204049731801,0.05171074853255062,0.053329456567783234,0.054948164603015846,0.05656687263824846,0.05818558067348107,0.05980428870871368,0.061422996743946294,0.0630417047791789,0.06466041281441151,0.06627912084964412,0.06789782888487672,0.06951653692010933,0.07113524495534193,0.07275395299057454,0.07437266102580714,0.07599136906103975,0.07743987755183677,0.0788883860426338,0.08033689453343083,0.08178540302422786,0.08323391151502489,0.08468242000582192,0.08613092849661895,0.08757943698741598,0.08902794547821301,0.09047645396901004,0.09192496245980707,0.0933734709506041,0.09482197944140112,0.09627048793219815,0.09771899642299518,0.09916750491379221,0.10061601340458924,0.10206452189538627,0.1035130303861833,0.10496153887698033,0.10641004736777736,0.10785855585857439,0.10930706434937142,0.11075557284016845,0.11220408133096547,0.1136525898217625,0.11510109831255953,0.11654960680335656,0.11799811529415359,0.11944662378495062,0.12089513227574765,0.12234364076654468,0.12379214925734171,0.12524065774813872,0.12668916623893575,0.12813767472973278,0.1295861832205298,0.13103469171132684,0.13248320020212387,0.1339317086929209,0.13538021718371793,0.13682872567451496,0.13827723416531199,0.13972574265610901,0.14117425114690604,0.14262275963770307,0.1440712681285001,0.14551977661929713,0.14696828511009416,0.1484167936008912,0.14986530209168822,0.15131381058248525,0.15276231907328228,0.1542108275640793,0.15565933605487633,0.15710784454567336,0.1585563530364704,0.16000486152726742,0.16145337001806445,0.16290187850886148,0.1643503869996585,0.16579889549045554,0.16724740398125257,0.1686959124720496,0.17014442096284663,0.17159292945364366,0.17304143794444068,0.1744899464352377,0.1757828730652674,0.1770757996952971,0.1783687263253268,0.1796616529553565,0.1809545795853862,0.18224750621541588,0.18354043284544558,0.18483335947547527,0.18612628610550497,0.18741921273553466,0.18871213936556436,0.19000506599559405,0.19129799262562375,0.19259091925565344,0.19388384588568314,0.19517677251571283,0.19646969914574253,0.19776262577577222,0.19905555240580192,0.2003484790358316,0.2016414056658613,0.202934332295891,0.2042272589259207,0.2055201855559504,0.20681311218598009,0.20810603881600978,0.20939896544603948,0.21069189207606917,0.21198481870609887,0.21327774533612856,0.21457067196615826,0.21586359859618795,0.21715652522621764,0.21844945185624734,0.21974237848627703,0.22103530511630673,0.22232823174633642,0.22362115837636612,0.22491408500639581,0.2262070116364255,0.2274999382664552,0.2287928648964849,0.2300857915265146,0.2313787181565443,0.23267164478657398,0.23396457141660368,0.23525749804663337,0.23655042467666307,0.23784335130669276,0.23913627793672246,0.24042920456675215,0.24172213119678185,0.24301505782681154,0.24430798445684124,0.24560091108687093,0.24689383771690063,0.24818676434693032,0.24947969097696002,0.2507726176069897,0.25206554423701943,0.25335847086704916,0.2546513974970789,0.2559443241271086,0.2572372507571383,0.25853017738716805,0.25982310401719777,0.2611160306472275,0.2624089572772572,0.26370188390728694,0.26499481053731666,0.2662877371673464,0.2675806637973761,0.26887359042740583,0.27016651705743555,0.2714594436874653,0.272752370317495,0.2740452969475247,0.27533822357755444,0.27663115020758416,0.2779240768376139,0.2792170034676436,0.28050993009767333,0.28180285672770305,0.2830957833577328,0.2843887099877625,0.2856816366177922,0.28697456324782195,0.28826748987785167,0.2895604165078814,0.2908533431379111,0.29214626976794084,0.29343919639797056,0.2947321230280003,0.29602504965803,0.2973179762880597,0.29861090291808945,0.29990382954811917,0.3011967561781489,0.3024896828081786,0.30378260943820834,0.30507553606823806,0.3063684626982678,0.3076613893282975,0.30895431595832723,0.31024724258835695,0.3115401692183867,0.3128330958484164,0.3141260224784461,0.31541894910847584,0.31671187573850557,0.3180048023685353,0.319297728998565,0.32059065562859473,0.32188358225862446,0.3231765088886542,0.3244694355186839,0.3257623621487136,0.32705528877874335,0.32834821540877307,0.3296411420388028,0.3309340686688325,0.33222699529886224,0.33351992192889196,0.3348128485589217,0.3361057751889514,0.33739870181898113,0.33869162844901085,0.3399845550790406,0.3412774817090703,0.3425704083391,0.34386333496912974,0.34515626159915946,0.3464491882291892,0.3477421148592189,0.34903504148924863,0.35032796811927835,0.3516208947493081,0.3529138213793378,0.3542067480093675,0.35549967463939725,0.35679260126942697,0.3580855278994567,0.3593784545294864,0.36067138115951614,0.36196430778954586,0.3632572344195756,0.3645501610496053,0.365843087679635,0.36713601430966475,0.36842894093969447,0.3697218675697242,0.3710147941997539,0.37230772082978364,0.37360064745981336,0.3748935740898431,0.3761865007198728,0.37747942734990253,0.37877235397993225,0.380065280609962,0.3813582072399917,0.3826511338700214,0.38394406050005114,0.38523698713008087,0.3865299137601106,0.3878228403901403,0.38911576702017003,0.39040869365019976,0.3917016202802295,0.3929945469102592,0.3942874735402889,0.39558040017031865,0.39687332680034837,0.3981662534303781,0.3994591800604078,0.40075210669043754,0.40204503332046726,0.403337959950497,0.4046308865805267,0.40592381321055643,0.40721673984058615,0.4085096664706159,0.4098025931006456,0.4110955197306753,0.41238844636070504,0.41368137299073476,0.4149742996207645,0.4162672262507942,0.41756015288082393,0.41885307951085365,0.4201460061408834,0.4214389327709131,0.4227318594009428,0.42402478603097254,0.42531771266100227,0.426610639291032,0.4279035659210617,0.42919649255109144,0.43048941918112116,0.4317823458111509,0.4330752724411806,0.4343681990712103,0.43566112570124005,0.43695405233126977,0.4382469789612995,0.4395399055913292,0.44083283222135894,0.44212575885138866,0.4434186854814184,0.4447116121114481,0.44600453874147783,0.44729746537150755,0.4485903920015373,0.449883318631567,0.4511762452615967,0.45246917189162644,0.45376209852165617,0.4550550251516859,0.4563479517817156,0.45764087841174533,0.45893380504177506,0.4602267316718048,0.4615196583018345,0.4628125849318642,0.46410551156189395,0.46539843819192367,0.4666913648219534,0.4679842914519831,0.46927721808201284,0.47057014471204256,0.4718630713420723,0.473155997972102,0.4744489246021317,0.47574185123216145,0.4770347778621912,0.4783277044922209,0.4796206311222506,0.48091355775228034,0.48220648438231006,0.4834994110123398,0.4847923376423695,0.48608526427239923,0.48737819090242895,0.4886711175324587,0.4899640441624884,0.4912569707925181,0.49254989742254784,0.49384282405257757,0.4951357506826073,0.496428677312637,0.49772160394266673,0.49901453057269646,0.5003074572027262,0.5016003838327558,0.5028933104627855,0.5041862370928152,0.5054791637228448,0.5067720903528745,0.5080650169829042,0.5093579436129339,0.5106508702429635,0.5119437968729932,0.5132367235030229,0.5145296501330525,0.5158225767630822,0.5171155033931119,0.5184084300231415,0.5197013566531712,0.5209942832832009,0.5222872099132305,0.5235801365432602,0.5248730631732899,0.5261659898033195,0.5274589164333492,0.5287518430633789,0.5300447696934085,0.5313376963234382,0.5326306229534679,0.5339235495834975,0.5352164762135272,0.5365094028435569,0.5378023294735865,0.5390952561036162,0.5403881827336459,0.5416811093636755,0.5429740359937052,0.5442669626237349,0.5455598892537645,0.5468528158837942,0.5481457425138239,0.5494386691438535,0.5507315957738832,0.5520245224039129,0.5533174490339425,0.5546103756639722,0.5559033022940019,0.5571962289240315,0.5584891555540612,0.5597820821840909,0.5610750088141205,0.5623679354441502,0.5636608620741799,0.5649537887042095,0.5662467153342392,0.5675396419642689,0.5688325685942985,0.5701254952243282,0.5714184218543579,0.5727113484843875,0.5740042751144172,0.5752972017444469,0.5765901283744765,0.5778830550045062,0.5791759816345359,0.5804689082645655,0.5817618348945952,0.5830547615246249,0.5843476881546545,0.5856406147846842,0.5869335414147139,0.5882264680447435,0.5895193946747732,0.5908123213048029,0.5921052479348325,0.5933981745648622,0.5946911011948919,0.5959840278249215,0.5972769544549512,0.5985698810849809,0.5998628077150105,0.6011557343450402,0.6024486609750699,0.6037415876050996,0.6050345142351292,0.6063274408651589,0.6076203674951886,0.6089132941252182,0.6102062207552479,0.6114991473852776,0.6127920740153072,0.6140850006453369,0.6153779272753666,0.6166708539053962,0.6179637805354259,0.6192567071654556,0.6205496337954852,0.6218425604255149,0.6231354870555446,0.6244284136855742,0.6257213403156039,0.6270142669456336,0.6283071935756632,0.6296001202056929,0.6308930468357226,0.6321859734657522,0.6334789000957819,0.6347718267258116,0.6360647533558412,0.6373576799858709,0.6386506066159006,0.6399435332459302,0.6412364598759599,0.6425293865059896,0.6438223131360192,0.6451152397660489,0.6464081663960786,0.6477010930261082,0.6489940196561379,0.6502869462861676,0.6515798729161972,0.6528727995462269,0.6541657261762566,0.6554586528062862,0.6567515794363159,0.6580445060663456,0.6593374326963752,0.6606303593264049,0.6619232859564346,0.6632162125864642,0.6645091392164939,0.6658020658465236,0.6670949924765532,0.6683879191065829,0.6696808457366126,0.6709737723666422,0.6722666989966719,0.6735596256267016,0.6748525522567312,0.6761454788867609,0.6774384055167906,0.6787313321468202,0.6800242587768499,0.6813171854068796,0.6826101120369092,0.6839030386669389,0.6851959652969686,0.6864888919269982,0.6877818185570279,0.6890747451870576,0.6903676718170872,0.6916605984471169,0.6929535250771466,0.6942464517071762,0.6955393783372059,0.6968323049672356,0.6981252315972653,0.6994181582272949,0.7007110848573246,0.7020040114873543,0.7032969381173839,0.7045898647474136,0.7058827913774433,0.7071757180074729,0.7084686446375026,0.7097615712675323,0.7110544978975619,0.7123474245275916,0.7136403511576213,0.7149332777876509,0.7162262044176806,0.7175191310477103,0.7188120576777399,0.7201049843077696,0.7213979109377993,0.7226908375678289,0.7239837641978586,0.7252766908278883,0.7265696174579179,0.7278625440879476,0.7291554707179773,0.7304483973480069,0.7317413239780366,0.7330342506080663,0.7343271772380959,0.7356201038681256,0.7369130304981553,0.7382059571281849,0.7394988837582146,0.7407918103882443,0.7420847370182739,0.7433776636483036,0.7446705902783333,0.7459635169083629,0.7472564435383926,0.7485493701684223,0.7498422967984519,0.7511352234284816,0.7524281500585113,0.7537210766885409,0.7550140033185706,0.7563069299486003,0.7575998565786299,0.7588927832086596,0.7601857098386893,0.7614786364687189,0.7627715630987486,0.7640644897287783,0.7653574163588079,0.7666503429888376,0.7679432696188673,0.7692361962488969,0.7705291228789266,0.7718220495089563,0.7731149761389859,0.7744079027690156,0.7757008293990453,0.776993756029075,0.7782866826591046,0.7795796092891343,0.780872535919164,0.7821654625491936,0.7834583891792233,0.784751315809253,0.7860442424392826,0.7873371690693123,0.788630095699342,0.7899230223293716,0.7912159489594013,0.792508875589431,0.7938018022194606,0.7950947288494903,0.79638765547952,0.7976805821095496,0.7989735087395793,0.800266435369609,0.8015593619996386,0.8028522886296683,0.804145215259698,0.8054381418897276,0.8067310685197573,0.808023995149787,0.8093169217798166,0.8106098484098463,0.811902775039876,0.8131957016699056,0.8144886282999353,0.815781554929965,0.8170744815599946,0.8183674081900243,0.819660334820054,0.8209532614500836,0.8222461880801133,0.823539114710143,0.8248320413401726,0.8261249679702023,0.827417894600232,0.8287108212302616,0.8300037478602913,0.831296674490321,0.8325896011203506,0.8338825277503803,0.83517545438041,0.8364683810104396,0.8377613076404693,0.839054234270499,0.8403471609005286,0.8416400875305583,0.842933014160588,0.8442259407906176,0.8455188674206473,0.846811794050677,0.8481047206807066,0.8493976473107363,0.850690573940766,0.8519835005707956,0.8532764272008253,0.854569353830855,0.8558622804608846,0.8571552070909143,0.858448133720944,0.8597410603509736,0.8610339869810033,0.862326913611033,0.8636198402410626,0.8649127668710923,0.866205693501122,0.8674986201311516,0.8687915467611813,0.870084473391211,0.8713774000212406,0.8726703266512703,0.8739632532813,0.8752561799113296,0.8765491065413593,0.877842033171389,0.8791349598014186,0.8804278864314483,0.881720813061478,0.8830137396915076,0.8843066663215373,0.885599592951567,0.8868925195815967,0.8881854462116263,0.889478372841656,0.8907712994716857,0.8920642261017153,0.893357152731745,0.8946500793617747,0.8959430059918043,0.897235932621834,0.8985288592518637,0.8998217858818933,0.901114712511923,0.9024076391419527,0.9037005657719823,0.904993492402012,0.9062864190320417,0.9075793456620713,0.908872272292101,0.9101651989221307,0.9114581255521603,0.91275105218219,0.9140439788122197,0.9153369054422493,0.916629832072279,0.9179227587023087,0.9192156853323383,0.920508611962368,0.9218015385923977,0.9230944652224273,0.924387391852457,0.9256803184824867,0.9269732451125163,0.928266171742546,0.9295590983725757,0.9308520250026053,0.932144951632635,0.9334378782626647,0.9347308048926943,0.936023731522724,0.9373166581527537,0.9386095847827833,0.939902511412813,0.9411954380428427,0.9424883646728723,0.943781291302902,0.9450742179329317,0.9463671445629613,0.947660071192991,0.9489529978230207,0.9502459244530503,0.95153885108308,0.9528317777131097,0.9541247043431393,0.955417630973169,0.9567105576031987,0.9580034842332283,0.959296410863258,0.9605893374932877,0.9618822641233173,0.963175190753347,0.9644681173833767,0.9657610440134063,0.967053970643436,0.9683468972734657,0.9696398239034953,0.970932750533525,0.9722256771635547,0.9735186037935843,0.974811530423614,0.9761044570536437,0.9773973836836733,0.978690310313703,0.9799832369437327,0.9812761635737624,0.982569090203792,0.9838620168338217,0.9851549434638514,0.986447870093881,0.9877407967239107,0.9890337233539404,0.99032664998397,0.9916195766139997,0.9929125032440294,0.994205429874059,0.9954983565040887,0.9967912831341184,0.998084209764148,0.9993771363941777,1.0],"y":[0.0,0.0,1.2738605233267195e-12,1.1970456418295562e-11,3.6807025887636983e-11,8.866698897240143e-11,2.874730797686636e-10,7.261170156022847e-10,1.4753536230498479e-9,4.44121754190864e-9,9.648213919952396e-9,1.796243072502542e-8,3.005038424801141e-8,7.088333912032646e-8,1.3803752938921862e-7,2.3807634566187994e-7,3.775485242515068e-7,8.278684629558427e-7,1.5412153848951822e-6,2.5776743454245053e-6,3.997143916217528e-6,8.489676522285239e-6,0.000015483009003858223,0.0000255186286193561,0.000039131682776771565,0.00005684951312373882,0.00010971206455314417,0.00018761091121174132,0.00029498317124023094,0.00043601812655337036,0.000614623115565891,0.0008343972671495459,0.0010986057298866627,0.0014101557519048268,0.0017715752350726784,0.002184994026475113,0.002652127906314058,0.003174265255070153,0.0037522565106432337,0.004386506547701498,0.0050769700440348505,0.0058231498429175705,0.006624098307852398,0.007478421664932542,0.00838428731284146,0.00933943405519226,0.01034118518687846,0.011386464348438066,0.012471814046320636,0.01359341671998266,0.014747118219626962,0.015928453542413998,0.01713267466032693,0.01835478025934644,0.020843544379374534,0.023338741774746517,0.025793987089012347,0.028162145467342085,0.0303965180168695,0.03245208414384874,0.03428670377369209,0.035862212850298864,0.03714540505210317,0.03810890214388474,0.03873189028083872,0.03900068789132732,0.038909123703017266,0.03845872007869283,0.03765868229336298,0.036525693479964726,0.03508351734878209,0.033362417820900075,0.03139841176018399,0.029232375235691846,0.026909026334778867,0.02447581030796884,0.021981715829192415,0.019476053384436285,0.017007227733149017,0.01462153628912331,0.012362024511293632,0.010267428000788767,0.008371228813509417,0.0067008504936690826,0.005277012657125678,0.004223185789249389,0.0033823658076299386,0.0027543477966860772,0.002334159797475348,0.0021121959281740653,0.0020744349768602867,0.0022027779720994204,0.0024754829791277565,0.0028676678724598474,0.003351869051143673,0.0038986535793557255,0.004477276577809401,0.005056367546916988,0.005604627801861084,0.006091524093745039,0.006487965360142274,0.006766949151160124,0.0069041637157436575,0.006878532511640999,0.006672689630610907,0.006273376381370531,0.005671750804974508,0.004863603523718429,0.003849475261720848,0.002634673523757195,0.001229188085752125,-0.000352492946127139,-0.0020916626984403748,-0.003965764905401643,-0.005948845387077817,-0.008012076190165954,-0.010124341428201948,-0.01225287256800041,-0.014363919871172706,-0.0164234459366308,-0.018397826822149663,-0.020254546061413747,-0.021962867039474296,-0.02349446963983093,-0.024824037821156275,-0.025929785806063706,-0.026793911847123427,-0.02740297004941502,-0.027748152442395868,-0.02782547537081751,-0.02763586627570171,-0.027185149020108785,-0.026483928036903474,-0.025547373692488773,-0.02439491332717631,-0.023049834406237476,-0.02153880805440433,-0.019891342912188303,-0.018139180709881787,-0.016315646174090957,-0.01445496483648227,-0.012591562985189418,-0.010759364371943402,-0.008991098354645335,-0.007317633914426942,-0.005767353443257203,-0.004365579364243824,-0.0031340655394001744,-0.0020905640620117907,-0.0012484764512506964,-0.0006165964984696006,-0.00019895009465016196,5.264662956013389e-6,0.000011693108874220242,-0.00014041836418128255,-0.00044113700651283777,-0.0008779080385485711,-0.00143577079997882,-0.002097607201682975,-0.0028444434773040855,-0.0036557903797692507,-0.004510003020536005,-0.005384653725969808,-0.006256918022833537,-0.007103970305917279,-0.007903380666012576,-0.00863350392240799,-0.009273854317090033,-0.009805460740919923,-0.010211197040627302,-0.010476081510052582,-0.010587540142974652,-0.01053562924486488,-0.0103132138763123,-0.009916099214503241,-0.009343112554740188,-0.008596134496931135,-0.007680078785921148,-0.006602821165113944,-0.005375078431080137,-0.004010239682547229,-0.0025241525566429114,-0.000934868010979485,0.0007376520915836028,0.002471859721365349,0.004244972333526771,0.006033345572645812,0.007812860815168292,0.009559321085280473,0.011248848739965676,0.012858278289441097,0.014365537799470363,0.015750012511390805,0.01699288461157418,0.01807744347952835,0.018989361235987226,0.01971692899078641,0.020251249845508097,0.020586385426988273,0.0207194535027811,0.020650675045546286,0.02038336995647519,0.019923901514175186,0.01928157047070284,0.018468460556280975,0.017499237964787574,0.016390908159612708,0.015162534051392517,0.013834920243310277,0.012430268605562627,0.01097181091863636,0.009483424707314806,0.007989238667435058,0.006513234260669928,0.005078850116125404,0.0037085958302622434,0.0024236815993622755,0.0012436698540858966,0.00018615469803267477,-0.0007335255122435199,-0.001502537661852161,-0.0021107612962649124,-0.0025509505161756436,-0.002818847660754307,-0.002913246896524813,-0.0028360066654964473,-0.0025920108000168536,-0.0021890789688410028,-0.0016378279648173505,-0.0009514861652587099,-0.0001456642777917639,0.0007619137857820202,0.0017517153995151504,0.0028027339788455918,0.003892848398091282,0.004999201054781511,0.006098588254548008,0.0071678563847782945,0.008184297248774392,0.009126035946368436,0.009972404811591423,0.01070429715097957,0.011304494863562917,0.011757964459854508,0.01205211652498573,0.012177024281688506,0.012125597591916814,0.011893709480124382,0.01148027305416341,0.010887267528163887,0.010119712901820814,0.009185593708009192,0.008095733091297165,0.006863619309492033,0.005505187545031439,0.00403856065949563,0.00248375321037229,0.0008623436629416531,-0.0008028797384371938,-0.002488293535162518,-0.004169827809231022,-0.005823362644596779,-0.007425125682409031,-0.008952084138729716,-0.010382324745265821,-0.011695415274748832,-0.012872741619505286,-0.013897814799347347,-0.014756542776398714,-0.015437462541442659,-0.015931928599099296,-0.01623425470647121,-0.01634180649977748,-0.016255043462845113,-0.015977509536496383,-0.015515772524765882,-0.01487931330814448,-0.014080366711502663,-0.013133716680921604,-0.012056449185962772,-0.010867666969191553,-0.009588170901227855,-0.008240113256673641,-0.006846628694591946,-0.005431449099023497,-0.004018508704075889,-0.0026315460899590526,-0.001293709688215275,-0.00002717337549764869,0.001147231433487657,0.002210361058980577,0.0031450764383373795,0.003936526334810767,0.004572392152752993,0.005043090280210289,0.005341928589111381,0.005465214488718298,0.005412312736939249,0.005185652052983866,0.0047906804296746165,0.004235769900244475,0.0035320723583479392,0.0026933288472032924,0.0017356355106359993,0.0006771701223193275,-0.0004621162323462716,-0.00166083716551444,-0.0028965330354638347,-0.004146050981278019,-0.005385936590213514,-0.006592830650164368,-0.007743864354781437,-0.008817046354684221,-0.009791635184384017,-0.010648490838745727,-0.011370399620970232,-0.011942366830376876,-0.01235187239524389,-0.01258908517467197,-0.01264703234352831,-0.01252172102451013,-0.012212210128675946,-0.011720631197180835,-0.011052157888461995,-0.010214924612625785,-0.009219895663881001,-0.008080687028455949,-0.00681334383566215,-0.0054360771604756,-0.0039689645648112995,-0.0024336193702492563,-0.0008528341772027369,0.0007497954242917039,0.002350260676042855,0.00392453650313246,0.005448978775361739,0.006900715351641741,0.008258024383742315,0.009500693568199171,0.010610354352917274,0.01157078552279542,0.012368181099558014,0.012991378086389824,0.01343204025798599,0.013684794930070803,0.013747320427066568,0.013620382789290312,0.013307821108127848,0.012816481734887532,0.012156102462218142,0.011339148611793012,0.010380603764520439,0.009297718626414124,0.00810972222182696,0.006837500234357275,0.005503245863867006,0.004130089026586919,0.0027417100865410014,0.0013619445644864375,0.000014385420934114586,-0.0012780104499392193,-0.0024933049492042642,-0.003610944338772263,-0.004612101544259852,-0.005479989484261151,-0.006200140199037516,-0.006760645122751714,-0.007152352492207751,-0.007369018600770444,-0.0074074103767878255,-0.007267357578556446,-0.006951753739089724,-0.006466505849627855,-0.0058204336266820976,-0.005025120049146832,-0.004094715665592969,-0.0030456999436854273,-0.0018966036508761713,-0.0006676969061189627,0.0006193518845032569,0.0019418405092439357,0.0032764147592917762,0.004599461185252472,0.005887504239472232,0.007117601168923318,0.008267728060907663,0.009317150591518105,0.010246773282164409,0.011039461428253315,0.011680330320332347,0.012156996924031346,0.0124597898118676,0.012581913836942646,0.012519566794127926,0.01227200611588594,0.011841564484043377,0.011233614091669196,0.010456480146507583,0.009521305054836789,0.008441865548035677,0.007234345799798608,0.005917070316712323,0.0045102010565560915,0.003035403825968819,0.0015154895220961548,-0.000025963797091776923,-0.001565001708943587,-0.003077690568922168,-0.004540514374147214,-0.0059307647262765014,-0.00722691738735039,-0.008408989145865235,-0.009458869038856007,-0.010360618403681285,-0.011100734753359688,-0.011668375073037227,-0.012055534812377248,-0.012257179588067211,-0.012271327399878046,-0.01209907998961865,-0.01174460282112151,-0.011215054016890404,-0.010520463438944314,-0.009673563933460895,-0.008689577557187024,-0.007585960354903398,-0.006382109948966617,-0.00509904082256635,-0.003759032717447791,-0.0023852580154921517,-0.0010013943241901498,0.00036877126712011834,0.0017017396545151262,0.0029746922759021997,0.004165872204386909,0.005254947417904271,0.006223350182118382,0.007054586882496484,0.0077345131349097875,0.008251569583877842,0.008596974453957278,0.00876486964185354,0.008752417912511062,0.008559849578810407,0.008190457887890565,0.007650543193505485,0.006949306848836877,0.006098696593646486,0.005113206019449164,0.004009631463077184,0.0028067903897557624,0.0015252059697482168,0.00018676311705543978,-0.0011856582648961062,-0.002568566705080902,-0.0039382528504351075,-0.005271186839979262,-0.006544412730717338,-0.0077359333877023645,-0.008825079409811512,-0.009792855929248695,-0.010622261492126769,-0.011298573693538021,-0.011809596795478727,-0.012145867190635757,-0.012300813278732822,-0.012270867083147941,-0.01205552574115022,-0.01165736183789355,-0.011081982408299171,-0.010337937287898911,-0.009436578339271709,-0.008391871900804291,-0.007220167585425233,-0.005939927285671651,-0.004571418905801514,-0.0031363799305332654,-0.0016576564436007444,-0.00015882361918826543,0.0013362059813255365,0.002803579771248376,0.004219901528470031,0.005562620198904125,0.006810404625568552,0.00794349795025055,0.008944045773947269,0.009796392600226616,0.010487341615023106,0.011006373468317537,0.01134582040744384,0.01150099285699276,0.011470256333997633,0.011255057416056662,0.010859898330404037,0.010292260589528108,0.009562478949404147,0.008683567795575343,0.007671002856347205,0.006542461887984814,0.005317528661579878,0.004017365193770028,0.0026643576934827534,0.0012817421355455242,-0.00010678428802245354,-0.0014774593525767815,-0.0028068530074555277,-0.004072258973859163,-0.005252074196965403,-0.006326159818103562,-0.007276177641405406,-0.00808589647853156,-0.008741463258006435,-0.009231634373989306,-0.009547963413139592,-0.009684942126522843,-0.009640092294091148,-0.009414006949125538,-0.00901034027546227,-0.00843574634723624,-0.007699767734931763,-0.006814675838521047,-0.005795265614363902,-0.004658608123947232,-0.003423765036695251,-0.0021114698542604817,-0.000743781179300828,0.0006562861815314699,0.0020651461205819497,0.0034590357111187087,0.004814412681190207,0.006108349242426049,0.0073189156975992245,0.008425547421358072,0.009409389086060566,0.010253610384466965,0.01094368797683727,0.011467648953779632,0.01181627174861112,0.011983241143285611,0.01196525477826017,0.01176207938622961,0.011376555808922632,0.010814552711142707,0.010084869762641696,0.009199091901980509,0.008171397113138721,0.007018320921673785,0.005758481539748352,0.004412270246250968,0.003001512168618957,0.0015491031270671635,0.00007862860157885263,-0.001386028819548306,-0.002821086958472196,-0.004203259899821778,-0.005510145569660707,-0.006720598573172574,-0.007815082068872707,-0.008775992807058897,-0.009587953908140632,-0.010238070494965086,-0.010716143913295995,-0.011014840965849227,-0.01112981533620228,-0.01105977917695281,-0.010806523668362154,-0.010374888205509861,-0.009772678729491523,-0.009010536567075192,-0.008101759969350874,-0.007062081329454754,-0.005909403799243296,-0.0046635017024945595,-0.003345689746507398,-0.0019784665547514196,-0.0005851384718294015,0.0008105700787386461,0.002184913178989172,0.003514520322503561,0.004776787015868533,0.0059502525548778915,0.007014958668906386,0.007952783046327117,0.008747742173228901,0.00938625843001728,0.009857386987202383,0.010152998712823791,0.010267916038340274,0.010199999515148163,0.00995018361709262,0.009522461191650048,0.008923816819732392,0.008164110197020949,0.007255911484077648,0.0062142913743604145,0.005056569385201984,0.0038020245742865833,0.0024715735114252393,0.0010874208821148208,-0.00032731144373824824,-0.0017489706850062634,-0.0031537683153794083,-0.004518177524695519,-0.0058193263396543755,-0.007035379840431426,-0.008145905091699301,-0.009132212695090985,-0.009977669260372468,-0.010667975578033888,-0.011191405848537327,-0.011539003973535503,-0.011704733631129173,-0.011685579628718119,-0.01148159884031651,-0.011095919876799936,-0.010534691493354115,-0.009806980594133602,-0.008924621535523704,-0.007902019242381536,-0.006755909422644124,-0.005505079881863211,-0.004170057588599713,-0.002772766713346828,-0.001336163348202348,0.000116146996198347,0.0015603027324720196,0.0029725838120288144,0.0043298069780406175,0.005609712058936814,0.006791332855069486,0.007855346428366652,0.008784394965293376,0.009563374841263668,0.010179688062135633,0.010623451886452633,0.010887663130161953,0.01096831441202298,0.010864460400145621,0.010578232954729197,0.010114804915117823,0.009482303136564956,0.008691672229248815,0.007756491274988095,0.006692746582038372,0.005518564272168996,0.004253907164730981,0.0029202410183769064,0.0015401757025862409,0.00013708728961091808,-0.0012652726240816358,-0.002643173844647003,-0.003973304129501759,-0.005233158737629149,-0.006401416478290945,-0.007458295980307088,-0.008385886234294036,-0.009168445889759652,-0.009792666310581497,-0.010247893997426719,-0.010526308664013296,-0.010623053994438277,-0.010536318898745673,-0.010267367910297734,-0.009820520217542128,-0.00920307768026797,-0.008425203032102849,-0.007499750302590539,-0.006442050289847736,-0.0052696546651794084,-0.004002042981645659,-0.00266029747785588,-0.0012667511059089285,0.00015538534059620195,0.0015824107736305618,0.0029905295630365076,0.004356248887203052,0.005656771048554134,0.006870374204310949,0.007976775156354787,0.008957468143483442,0.00979603397993207,0.010478414379026281,0.010993146881988818,0.011331556469535528,0.011487900656983678,0.011459465650091824,0.011246611955801046,0.010852768685786449,0.010284376647216613,0.009550781170003969,0.00866407645889665,0.00763890406795523,0.006492208860803862,0.005242956529744833,0.003911817388523644,0.0025208217165414437,0.0010929924072038074,-0.0003480389480350365,-0.00177842613185809,-0.0031745059518876297,-0.004513192832745389,-0.005772363763070127,-0.006931227172195178,-0.007970669579447892,-0.008873574230076394,-0.009625106399434147,-0.010212960603462393,-0.010627565589409589,-0.010862243685502801,-0.010913321850172858,-0.010780192567720889,-0.010465323574519273,-0.009974216254023493,-0.009315313395735948,-0.008499857858527287,-0.007541704498285158,-0.006457088499991941,-0.005264353982097023,-0.003983647404188487,-0.002636580896519535,-0.0012458711320149874,0.00016504023035562846,0.0015723781943407897,0.002952431628973321,0.004281949393917536,0.00553852877458381,0.0067009897423926205,0.007749728792222456,0.008667046450023006,0.009437442983132914,0.010047877376667026,0.010487985252576841,0.01075025209338968,0.01083013887877942,0.010726158037524063,0.010439898446836416,0.009975999061651766,0.009342071614001937,0.008548573672839893,0.007608634183332371,0.00653783439794866,0.005353947856353809,0.004076643754744585,0.0027271586564477286,0.0013279420241056506,-0.00009771850919477008,-0.0015260858742509608,-0.002933369816112732,-0.004296124045582738,-0.005591637661880881,-0.006798314312116968,-0.007896032757911441,-0.008866482829862462,-0.009693471161397245,-0.010363191598014163,-0.01086445576758732,-0.011188879962437408,-0.011331025213156706,-0.011288488215550604,-0.011061941592464715,-0.010655122818028946,-0.010074771988826406,-0.009330519480406575,-0.008434725364121806,-0.007402273264550465,-0.006250322098283666,-0.004998019837961279,-0.0036661840793459654,-0.002276954743395225,-0.0008534247104423018,0.0005807454480238392,0.0020017222090232658,0.0033858967201375045,0.004710278666773391,0.005952879810145587,0.0070930807939151115,0.008111975096721664,0.008992684389359068,0.009720640032690098,0.01028382601762219,0.010672979292115635,0.01088174413155221,0.01090677797594779,0.010747806967673544,0.01040763026300447,0.009892073045947799,0.009209889029118424,0.008372614069657915,0.007394373344230356,0.006291645302375511,0.005082986339005587,0.004468822605201546]}],"layout":{"xaxis":{"title":{"text":"t"}},"yaxis":{"title":{"text":"current"}}},"config":{}});
</script>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partial-differential-equations-pdes"><a class="header" href="#partial-differential-equations-pdes">Partial Differential Equations (PDEs)</a></h1>
<p>DiffSol is an ODE solver, but it can also solve PDEs. The idea is to discretize the PDE in space and time, and then solve the resulting system of ODEs. This is called the method of lines.</p>
<p>Discretizing a PDE is a large topic, and there are many ways to do it. Common methods include finite difference, finite volume, finite element, and spectral methods. Finite difference methods are the simplest to understand and implement, so some of the examples in this book will demonstrate this method to give you a flavour of how to solve PDEs with DiffSol. However, in general we recommend that you use another package to discretise your PDE, and then import the resulting ODE system into DiffSol for solving.</p>
<h2 id="some-useful-packages"><a class="header" href="#some-useful-packages">Some useful packages</a></h2>
<p>There are many packages in the Python and Julia ecosystems that can help you discretise your PDE. Here are a few, but there are many more out there:</p>
<p>Python</p>
<ul>
<li><a href="https://fenicsproject.org/">FEniCS</a>: A finite element package. Uses the Unified Form Language (UFL) to specify PDEs.</li>
<li><a href="https://firedrakeproject.org/">FireDrake</a>: A finite element package, uses the same UFL as FEniCS.</li>
<li><a href="https://www.ctcms.nist.gov/fipy/">FiPy</a>: A finite volume package.</li>
<li><a href="https://scikit-fdiff.readthedocs.io/en/latest/">scikit-fdiff</a>: A finite difference package.</li>
</ul>
<p>Julia:</p>
<ul>
<li><a href="https://github.com/SciML/MethodOfLines.jl">MethodOfLines.jl</a>: A finite difference package.</li>
<li><a href="https://github.com/gridap/Gridap.jl">Gridap.jl</a>: A finite element package.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-heat-equation"><a class="header" href="#example-heat-equation">Example: Heat equation</a></h1>
<p>Lets consider a simple example, the heat equation. The heat equation is a PDE that describes how the temperature of a material changes over time. In one dimension, the heat equation is</p>
<p>\[
\frac{\partial u}{\partial t} = D \frac{\partial^2 u}{\partial x^2}
\]</p>
<p>where \(u(x, t)\) is the temperature of the material at position \(x\) and time \(t\), and \(D\) is the thermal diffusivity of the material. To solve this equation, we need to discretize it in space and time. We can use a finite difference method to discretise the spatial derivative, and then solve the resulting system of ODEs using DiffSol.</p>
<h2 id="finite-difference-method"><a class="header" href="#finite-difference-method">Finite difference method</a></h2>
<p>The finite difference method is a numerical method for discretising a spatial derivative like \(\frac{\partial^2 u}{\partial x^2}\). It approximates this <em>continuous</em> term by a <em>discrete</em> term, in this case the multiplication of a matrix by a vector. We can use this discretisation method to convert the heat equation into a system of ODEs suitable for DiffSol.</p>
<p>We will not go into the details of the finite difference method here but mearly derive a single finite difference approximation for the term \(\frac{\partial^2 u}{\partial x^2}\), or \(u_{xx}\) using more compact notation.</p>
<p>The central FD approximation of \(u_{xx}\) is:</p>
<p>\[
u_{xx} \approx \frac{u(x + h) - 2u(x) + u(x-h)}{h^2}
\]</p>
<p>where \(h\) is the spacing between points along the x-axis.</p>
<p>We will discretise \(u_{xx} = 0\) at \(N\) regular points along \(x\) from 0 to 1, given by \(x_1\), \(x_2\), ...</p>
<pre><code>          +----+----+----------+----+&gt; x
          0   x_1  x_2    ... x_N   1
</code></pre>
<p>Using this set of points and the discrete approximation, this gives a set of \(N\) equations at each interior point on the domain:</p>
<p>\[
\frac{v_{i+1} - 2v_i + v_{i-1}}{h^2} \text{ for } i = 1...N
\]</p>
<p>where \(v_i \approx u(x_i)\)</p>
<p>We will need additional equations at \(x=0\) and \(x=1\), known as the <em>boundary conditions</em>. For this example we will use \(u(x) = g(x)\) at \(x=0\) and \(x=1\) (also known as a non-homogenous Dirichlet bc), so that \(v_0 = g(0)\), and \(v_{N+1} = g(1)\), and the equation at \(x_1\) becomes:</p>
<p>\[
\frac{v_{i+1} - 2v_i + g(0)}{h^2}
\]</p>
<p>and the equation at \(x_N\) becomes:</p>
<p>\[
\frac{g(1) - 2v_i + v_{i-1}}{h^2}
\]</p>
<p>We can therefore represent the final \(N\) equations in matrix form like so:</p>
<p>\[
\frac{1}{h^2}
\begin{bmatrix} -2      &amp; 1      &amp;         &amp;   &amp;     \\
1      &amp; -2     &amp; 1       &amp;       &amp; \\
&amp;\ddots &amp; \ddots  &amp;  \ddots &amp;\\
&amp;        &amp; 1      &amp;  -2     &amp;  1     \\
&amp;        &amp;        &amp;   1     &amp; -2     \end{bmatrix}
\begin{bmatrix} v_1    \\
v_2    \\
\vdots \\
v_{N-1}\\
v_{N}
\end{bmatrix} + \frac{1}{h^2} \begin{bmatrix} g(0)    \\
0    \\
\vdots \\
0    \\
g(1)
\end{bmatrix}
\]</p>
<p>The relevant sparse matrix here is \(A\), given by</p>
<p>\[
A = \begin{bmatrix} -2      &amp; 1      &amp;         &amp;   &amp;     \\
1      &amp; -2     &amp; 1       &amp;       &amp; \\
&amp;\ddots &amp; \ddots  &amp;  \ddots &amp;\\
&amp;        &amp; 1      &amp;  -2     &amp;  1     \\
&amp;        &amp;        &amp;   1     &amp; -2     \end{bmatrix}
\]</p>
<p>As you can see, the number of non-zero elements grows linearly with the size \(N\), so a sparse matrix format is much preferred over a dense matrix holding all \(N^2\) elements!
The additional vector that encodes the boundary conditions is \(b\), given by</p>
<p>\[
b = \begin{bmatrix} g(0)    \\
0    \\
\vdots \\
0    \\
g(1)
\end{bmatrix}
\]</p>
<h2 id="method-of-lines-approximation"><a class="header" href="#method-of-lines-approximation">Method of Lines Approximation</a></h2>
<p>We can use our FD approximation of the spatial derivative to convert the heat equation into a system of ODEs. Starting from our original definition of the heat equation:</p>
<p>\[
\frac{\partial u}{\partial t} = D \frac{\partial^2 u}{\partial x^2}
\]</p>
<p>and using our finite difference approximation and definition of the sparse matrix \(A\) and vector \(b\), this becomes:</p>
<p>\[
\frac{du}{dt} = \frac{D}{h^2} (A u + b)
\]</p>
<p>where \(u\) is a vector of temperatures at each point in space. This is a system of ODEs that we can solve using DiffSol.</p>
<h2 id="diffsol-implementation"><a class="header" href="#diffsol-implementation">DiffSol Implementation</a></h2>
<pre><code class="language-rust ignore">use diffsol::{CraneliftModule, DiffSl, FaerSparseLU, OdeBuilder, OdeSolverMethod, SparseColMat};
use plotly::{
    layout::{Axis, Layout},
    Plot, Surface,
};
use std::fs;

type M = SparseColMat&lt;f64&gt;;
type LS = FaerSparseLU&lt;f64&gt;;
type CG = CraneliftModule;

fn main() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
    D { 1.0 }
    h { 1.0 }
    g { 0.0 }
    m { 1.0 }
    A_ij {
        (0..20, 1..21): 1.0,
        (0..21, 0..21): -2.0,
        (1..21, 0..20): 1.0,
    }
    b_i { 
        (0): g,
        (1:20): 0.0,
        (20): g,
    }
    u_i {
        (0:5): g,
        (5:15): g + m,
        (15:21): g,
    }
    heat_i { A_ij * u_j }
    F_i {
        D * (heat_i + b_i) / (h * h)
    }",
    )
    .unwrap();

    let problem = OdeBuilder::&lt;M&gt;::new().build_from_eqn(eqn).unwrap();
    let times = (0..50).map(|i| i as f64).collect::&lt;Vec&lt;f64&gt;&gt;();
    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let sol = solver.solve_dense(&amp;times).unwrap();

    let x = (0..21).map(|i| i as f64).collect::&lt;Vec&lt;f64&gt;&gt;();
    let y = times;
    let z = sol
        .col_iter()
        .map(|v| v.iter().copied().collect::&lt;Vec&lt;f64&gt;&gt;())
        .collect::&lt;Vec&lt;Vec&lt;f64&gt;&gt;&gt;();
    let trace = Surface::new(z).x(x).y(y);
    let mut plot = Plot::new();
    plot.add_trace(trace);
    let layout = Layout::new()
        .x_axis(Axis::new().title("x"))
        .y_axis(Axis::new().title("t"))
        .z_axis(Axis::new().title("u"));
    plot.set_layout(layout);
    let plot_html = plot.to_inline_html(Some("heat-equation"));
    fs::write("book/src/primer/images/heat-equation.html", plot_html)
        .expect("Unable to write file");
}</code></pre>
<div id="heat-equation" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("heat-equation", {"data":[{"type":"surface","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0],"y":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0],"z":[[0.0,0.0,0.0,0.0,0.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0015463463081017768,0.008442047178240427,0.03723685123987175,0.13047742457013503,0.3457441740588375,0.6542557726937299,0.8695220733782202,0.9627584868331748,0.9915191420965366,0.9981678776946591,0.998167877694667,0.9915191420966597,0.9627584868349807,0.8695220734034871,0.6542557730238396,0.3457441780562353,0.13047746910815594,0.03723730404148017,0.00844620738365768,0.0015804951316363588,0.000246965273816152],[0.012073448686689432,0.03877042330879236,0.10007450501516935,0.21773904835704824,0.3964956255597279,0.6034920629720768,0.7822044788064743,0.8996513062276279,0.9600187608471236,0.9831296331497578,0.9831296332214665,0.9600187615076176,0.8996513113026824,0.782204515275044,0.6034923072981202,0.3964971439140506,0.21774774987073234,0.10012018473767635,0.03898838355462996,0.01301011223368811,0.0035861073218929865],[0.02806984551061913,0.07242329511835852,0.14820645064456536,0.26449383653198855,0.4166111975408931,0.5832036460922378,0.7349403603304844,0.8498661200821452,0.9214866992007668,0.9544067993018799,0.954406807665097,0.9214867548529093,0.8498664125078869,0.7349417966648276,0.5832102444238094,0.41663942577069624,0.26460574602913334,0.14861532560852123,0.07379151934511902,0.03223385677511615,0.011433633333878201],[0.043325976198188586,0.10056836946409113,0.1825809747796351,0.2935251917450288,0.4279261855049403,0.5710998140870356,0.7041940200267522,0.8112716869316374,0.8837240529547961,0.9195924697021365,0.9195926339387025,0.8837249439706829,0.8112753175380591,0.704207817107819,0.5711490158321587,0.4280903145522897,0.29403532735318993,0.18405189004322678,0.10448411306714145,0.05289997398002528,0.02137743498672799],[0.05567677658093739,0.12214982159863474,0.20720073998229507,0.31301499304543784,0.4348841725764753,0.5621118602251257,0.6811407352178095,0.7795000630192658,0.8485393742662568,0.8838284473978733,0.8838297145557723,0.8485453552793731,0.7795203499910514,0.6812046685029802,0.5623015429368885,0.4354130313865878,0.3143964145062289,0.21056988065907714,0.12979433323952963,0.07175194562882221,0.031202900507175346],[0.06505040343885783,0.13814272353945795,0.22485016685175552,0.3263956614011343,0.43892746828679013,0.5542871841193573,0.6620544705172221,0.752042271114906,0.8162202045354409,0.8494866501195644,0.849492225257514,0.816244037159875,0.7521127355856184,0.6622470300981125,0.5547839128870174,0.44013694378615326,0.3291690872427835,0.2308240028266933,0.15019655485384023,0.087770519059926,0.03989021431649023],[0.0719539212278076,0.14976536426927242,0.23737855943452038,0.3354191776291259,0.4406927403015576,0.5467324388645443,0.6451899198173758,0.7275579593738619,0.7866446641992082,0.8174490352528937,0.8174660486068653,0.7867122942880866,0.7277379253355916,0.6456298050028344,0.5477493850244571,0.4429207256908268,0.34003810033369025,0.24642191242661693,0.16645251957914564,0.1009133747189919,0.047167864078738166],[0.07693469969688459,0.15804839700565643,0.2460572496166552,0.34114507014301143,0.44057093340083414,0.5390378686063744,0.6296722676690375,0.7052867319818394,0.7595630617936353,0.7879109825724872,0.7879513443202344,0.759714995937256,0.705659170790763,0.6305051881957823,0.5408016720184275,0.44412265362893527,0.3479414857355185,0.2583981201614371,0.1792785048886517,0.11148149974080448,0.05309154183929845],[0.08044345482545892,0.16378236451369788,0.25179161873650396,0.34430009626738917,0.4388695053534061,0.5310394946608777,0.6150400470202569,0.6847553354159511,0.734693429193578,0.7607746699337979,0.7608546370870701,0.7349821799738891,0.685418725884859,0.616420837757506,0.5337617792070294,0.4439875515891268,0.35347765678918647,0.26747258157173626,0.1892809228594863,0.11985420477530788,0.05782621704996033],[0.08282440325950148,0.16755790937109236,0.25524523430571155,0.3454231984169222,0.43585590076663944,0.5227003936791571,0.6010405664242147,0.6656434075201122,0.7117611167348616,0.7358293623683622,0.7359680826240534,0.7122460910575291,0.6667013745128245,0.6031171186447447,0.5265598136970141,0.4427112772475239,0.3570741536591582,0.2741803311438354,0.19695791929512046,0.1263919829462377,0.06155463518870821],[0.08433556842952922,0.16981651235435427,0.2569164185996637,0.34493212292919495,0.4317668814985352,0.5140465853357041,0.58753122489416,0.6477195657354414,0.6905155603319206,0.7128335116717609,0.7130511355493138,0.6912572673691355,0.6492713473986498,0.5904331036431901,0.5191807523971752,0.4404627863652461,0.35906174063907864,0.2789382774103807,0.20271573794523934,0.13140739829383138,0.06444406450907074],[0.08517096080921215,0.17089191408039417,0.2571874232002718,0.34315898035589165,0.4268099008817439,0.5051316770117497,0.5744288185071303,0.6308086960045902,0.6707361777801559,0.6915513813100932,0.6918672700666995,0.6717911605230453,0.632942023659294,0.5782608789098566,0.5116361286806975,0.4373914222325181,0.3597091500367359,0.2820816641647602,0.20688599780149836,0.13516188393920514,0.06663742893485369],[0.0854781488097613,0.1710396878023234,0.256355391139204,0.34037011264471717,0.42116369340136983,0.49601926252617295,0.5616849452918532,0.6147750325280107,0.6522320956565312,0.6717662061259629,0.6721975786254256,0.6536493546391487,0.6175618544207842,0.5665249729674043,0.5039503478755178,0.43362877059359517,0.3592387048030025,0.28388417632828467,0.20974065379289678,0.1378722068955796,0.06825442701081617],[0.08537076934385324,0.17045818962762166,0.2546544964216369,0.33678117782472905,0.414980429674238,0.48677244909816986,0.5492701651304764,0.599510532564217,0.6348402207889916,0.6532861461406937,0.6538472171434206,0.636659114974607,0.6030050888002474,0.5551692348079774,0.49615217946746715,0.4292904293752532,0.3578372827120489,0.2845722027529326,0.2115036991070871,0.139717069695927,0.06939394929354009],[0.08493745283269802,0.16930333428297767,0.2522713345468267,0.33256764603605476,0.4083881331939269,0.4774489609205165,0.537165429534939,0.5849275014951016,0.6184221463625009,0.6359449355404956,0.636646495718927,0.6206715426065443,0.5891661717306977,0.5441499669656705,0.48827057447947747,0.42447714290244903,0.3556630029336878,0.2843345313528343,0.2123604844394252,0.14084381097574927,0.07013742185266865],[0.08424825530054576,0.16769901191932846,0.24935554413323155,0.3278722717545716,0.40149341466669497,0.4680994275617844,0.5253578733625525,0.5709540092536587,0.6028606499193324,0.6195996517792747,0.6204490073593975,0.6055590447559331,0.5759564086560457,0.5334326649601876,0.4803328833503045,0.4192758760688984,0.3528494470716293,0.2833290123454979,0.21246513368483486,0.1413745929845986,0.07055226707119729],[0.08335896023956532,0.16574428371733319,0.2460276600344413,0.3228113283686024,0.3943844835689989,0.45876696724142824,0.513838027210901,0.5575303662874187,0.5880565477162072,0.6041282033085315,0.6051293645138377,0.5912128236194791,0.5633011441999134,0.522989549150488,0.4723639399765078,0.4137613006923337,0.3495095538948812,0.2816879446954232,0.21194616119626622,0.1414109837642421,0.07069445788942036],[0.0823142791074254,0.16351884506565298,0.24238521880219574,0.3174795953215062,0.38713386092578894,0.4494874022549986,0.5025980814903239,0.5446064134377399,0.5739259118676844,0.5894268275896211,0.5905808409015377,0.577540439704135,0.5511373708552999,0.5127978214807626,0.4643856896135734,0.40799725924839786,0.3457388937023814,0.27952251232275144,0.21091101062430037,0.14103759564470836,0.07061052855895109],[0.08115026705986345,0.16108708459534826,0.2385072582745613,0.3119541774242868,0.37980079162782393,0.4402899940274166,0.4916311458685787,0.5321396916846449,0.5603975948169393,0.5754073862333443,0.5767127397642722,0.5644634952781071,0.539411982132363,0.5028387277568512,0.45641728762929223,0.4020380944655318,0.34161817868028843,0.2769261806560174,0.20944972193361655,0.1403251807774742,0.0703393387465246],[0.07989600216428691,0.15850100184952096,0.2344577420286092,0.30629761421833884,0.3724333570440488,0.43119824229121334,0.4809307717309851,0.5200940097788653,0.5474112218222723,0.5619951070904943,0.5634481534998065,0.5519156388579414,0.5280802428175897,0.49309675692669813,0.4484752898936149,0.3959299243637462,0.33721549717476024,0.27397749327349263,0.20763775649049449,0.1393329282261981,0.06991336271333577],[0.07857508766865805,0.1558028236920465,0.2302886455769778,0.30056071446228544,0.3650704503361765,0.4222306929317796,0.4704905931484283,0.5084381688298606,0.5349153248535673,0.5491264395488595,0.5507218218486921,0.5398406743161225,0.5171043766673589,0.48355894179359904,0.4405738780710832,0.3897118556728096,0.33258838360469756,0.2707426414588703,0.20553858793522856,0.13811056891900175,0.06935986982170939],[0.07720667804891232,0.1530268304089932,0.2260421456417494,0.294784603408379,0.3577433033187653,0.41340168608536776,0.46030423062716946,0.49714508223025616,0.5228659140089191,0.5367473550124389,0.5384783921177784,0.5281910002211075,0.5064524390958343,0.474214389434062,0.4327251320232196,0.38341700048321914,0.32778543062376025,0.2672774290170096,0.2032056357079214,0.13669989329031393,0.06870175354774857],[0.07580625618732617,0.1502007145618234,0.22175225939165422,0.28900232450002694,0.3504767416189461,0.40472205011577134,0.4503653170298559,0.4861911572755341,0.5112253217457174,0.5248118647993529,0.5266708886011818,0.5169263064123136,0.4960974492935557,0.4650539632820772,0.4249393169819735,0.3770733273122402,0.3228475860437065,0.263628809329489,0.20068379855616605,0.13513599520403527,0.06795822691902088],[0.07438640779304644,0.1473469561272602,0.2174465195493465,0.28324045034978784,0.3432903992587929,0.39619970958819295,0.4406674300792794,0.475555626066637,0.4999610896264607,0.5132806556904492,0.5152593106661616,0.5060123425665958,0.4860165102081032,0.45606990819089777,0.4172251100089872,0.3707044801617265,0.3178094472570306,0.25983642695980397,0.19801096237982285,0.13344847288689493,0.06714548924371867],[0.07295725143159763,0.14448359599812535,0.21314694348656485,0.27752007618935465,0.3361995624641016,0.3878402196715344,0.4312042064842598,0.4652201967429978,0.4890452081974946,0.5021200661095891,0.5042095503089613,0.49541999050304036,0.47619020813092094,0.4472556692829564,0.40958984786211133,0.36433040202343614,0.31270015350012664,0.2559336407036371,0.19521899019192626,0.1316622112635259,0.06627715691633457],[0.07152684188010655,0.14162496868093108,0.20887095523387397,0.2718577342603364,0.32921587645843686,0.3796471302048118,0.42196931522553666,0.4551686783089925,0.4784534818155306,0.49130129471974854,0.4934925676953519,0.4851245312857688,0.4666020805761983,0.4386056624201946,0.4020396693147255,0.35796784335296145,0.30754417592011296,0.25194844055538834,0.19233459558834,0.1297980671099951,0.06536464229370015],[0.07010163409685886,0.13878252846136327,0.20463238302045153,0.26626634887759615,0.3223480833849275,0.3716223769306911,0.41295645046967094,0.44538658527092206,0.4681648362043046,0.4807995458249668,0.4830835038691688,0.47510485488417226,0.45723806143466394,0.4301150592980103,0.3945796767960939,0.3516308877074763,0.3023621259991209,0.24790441442852737,0.18938029008502308,0.12787361111312498,0.06441755725192823],[0.0686867806597883,0.13596538310404038,0.2004421294939238,0.26075591998951914,0.3156025859026828,0.363766619806519,0.4041593771524914,0.43586088408263124,0.4581608066959895,0.47059334952722043,0.4729609629928942,0.46534284038506757,0.4480860659327982,0.4217796443265842,0.38721409259368283,0.34533137772057404,0.2971713812828287,0.24382146389044504,0.18637507052568167,0.125903670970807,0.06344401302916776],[0.06728636725147855,0.13318071564546285,0.19630868959621567,0.2553340328350097,0.30898385535041745,0.3560794752558646,0.39557194681066093,0.42657978811953984,0.4484251529364228,0.460664068281103,0.4631064924107802,0.45582289514377977,0.43913567292237693,0.413595700140807,0.37994636768911816,0.339079232266327,0.2919865591370433,0.23971635758143436,0.18333495334491492,0.1239007473897861,0.06245084597499903],[0.06590357434651846,0.13043407507517873,0.1922385243739989,0.25000625588976316,0.3024947786702125,0.34855974465471107,0.38718815316361366,0.41753262128331436,0.4389435410272693,0.45099545098994287,0.45350410725110507,0.4465315549616344,0.43037787178974074,0.405559936520243,0.3727793011233901,0.3328827280505223,0.2868199126731711,0.23560317330707886,0.18027339677643778,0.12187535154072693,0.06144380657396452],[0.06454084618436876,0.1277296884328062,0.18823645686955182,0.24477653762597823,0.29613697665318606,0.3412055896179407,0.37900213611525996,0.40870965274805665,0.42970324554936185,0.4415732561494925,0.44413989351081695,0.43745712895778593,0.42180481197855096,0.39766939587637246,0.3657151229210071,0.32674875284182925,0.28168170870521636,0.2314937340328361,0.1772017142857646,0.11983632437975478,0.06042773347691424],[0.06320003783726537,0.1250707246051189,0.18430600102354017,0.23964753942593955,0.2899110783016252,0.3340146962299796,0.37100820163804743,0.4001019655478716,0.4206928874617409,0.43238490618481773,0.4350016423099706,0.4285893810866796,0.41340959000494826,0.38992138307679786,0.35875557923761414,0.32068303055939107,0.27658055603259796,0.22739798437711947,0.17412943609524745,0.117791119768005,0.05940670816130893],[0.06188249729301551,0.12245944699568279,0.18044955649088953,0.2346208312692974,0.2838168765760916,0.3269843579781123,0.36320081731703174,0.39170136675924183,0.4119022782290357,0.4234192928037914,0.42607864486624,0.41991934526263647,0.40518611820293376,0.3823134166591364,0.35190197949356833,0.3146902607356127,0.2715236124820668,0.22332422786342837,0.17106453249771128,0.11574597533401099,0.05838414719315216],[0.06058918517732704,0.11989742266009161,0.1766686604366235,0.22969713697234276,0.2778535211808003,0.32011158269841533,0.3555746128501624,0.38350028158824667,0.4033222250631354,0.41466652747774746,0.4173614317044854,0.41143909865517464,0.3971289718236142,0.37484317630070685,0.34515525532342156,0.3087742798781366,0.26651682563311524,0.21927940799803933,0.16801368755615698,0.11370612810427798,0.057362919788171325],[0.05932074264187793,0.11738564596524965,0.17296414613118172,0.22487649908914928,0.27201965805089195,0.31339317774025877,0.3481243918056732,0.3754916852488421,0.3949443907945199,0.40611775236015213,0.40884157275205674,0.4031415918525512,0.3892332797825224,0.36750847232455214,0.3385160135889699,0.30293818905017394,0.26156511274604016,0.2152693103159307,0.16498249084533248,0.11167596614140528,0.05634543247895105],[0.05807756468158111,0.11492467096471129,0.16933630738251784,0.22015844222236003,0.2663135594289724,0.30682582133618785,0.3408451301502412,0.3676690279874653,0.38676115881495027,0.3977649690307762,0.400511497995591,0.3950204912320758,0.3814946175453643,0.3603072100560637,0.33198458040718204,0.29718447190173186,0.2566725337985619,0.21129876142509318,0.16197562775454627,0.10965917630968708,0.055333709356822434],[0.05685982859736082,0.11251466439697548,0.16578496863707493,0.21554204847646302,0.26073319002990364,0.3004061044067913,0.33373198224873046,0.3600261994469656,0.37876555808176404,0.38960093633276666,0.3923643900577067,0.38707008997225806,0.37390895350116354,0.3532373800869889,0.3255610357917071,0.2915150672503524,0.25184238927618996,0.20737173632701997,0.1589969803935068,0.10765882413006082,0.05432943690749167],[0.0556675415049267,0.11015549310972969,0.16230959492435681,0.21102606673089258,0.2552762926443799,0.294130574640643,0.32678027425109485,0.3525574727391252,0.3709511695583123,0.3816190561746232,0.38439406521998043,0.3792852011830954,0.36647257433995784,0.3462970326776921,0.31924524456207415,0.2859314530165013,0.24707734340747414,0.20349149944966083,0.1560497606531086,0.10567745476340394,0.05333401759193854],[0.05450057803594147,0.10784678983618405,0.15890937155478643,0.2066089905598305,0.249940448838921,0.2879957680491405,0.31998549935554055,0.34525746328238643,0.3633120542608018,0.3738132820264486,0.3765948788457741,0.37166107765082057,0.3591820329250432,0.33948426306408874,0.3130368830061388,0.2804347107747078,0.24237951708206837,0.19966071075492225,0.15313661194754363,0.10371717306463654,0.05234861381572792],[0.0533587106296031,0.10558800869714591,0.15558327432775343,0.20228912899072796,0.24472313568453793,0.28199823926749357,0.3133433144755182,0.3381210907190262,0.3558426862249693,0.3661780342820656,0.3689616375619177,0.3641933362527015,0.352034099051374,0.3327971983388741,0.3069354651282176,0.2750255878940643,0.23775057566299063,0.19588152466056633,0.1502597026049769,0.10177971590263493,0.05137418736460889],[0.05224163097005396,0.10337846141371293,0.15233011135479288,0.19806464488676925,0.23962175286540094,0.27613457212498027,0.3068495318542192,0.33114355253981687,0.3485379114692959,0.35870815039838216,0.3614895492501837,0.3568779167638534,0.3450257336887872,0.3262339915405069,0.30094035871447156,0.26970453419626245,0.23319178151946313,0.19215565037806367,0.14742078422812252,0.09986649852392608,0.050411525072675906],[0.051148968918574164,0.10121735316248397,0.1491485699475048,0.19393360370883828,0.23463366324619314,0.2704014025618216,0.3005001180345681,0.32432029656529404,0.3413928972010984,0.35139881965154224,0.35417415554904286,0.3497110251622777,0.3381540542461326,0.3197928152825005,0.2950508080892186,0.26447175014381397,0.22870405948148673,0.18848442432523965,0.14462125976417506,0.09797866762205572,0.04946126813014678],[0.05008030746548494,0.09910380940630521,0.1460372497743159,0.18989400595076616,0.22975621725622108,0.26479542923534877,0.29429118733249354,0.3176469976968966,0.3344030955404316,0.3442455397055347,0.34701128792710184,0.34268909622442334,0.33141631060796223,0.3134718564888118,0.2892659496364653,0.25932722112846285,0.22428804478628908,0.18486886386396398,0.14186223395658645,0.0961171398817057,0.048523932668458315],[0.049035196252123894,0.0970369002668104,0.14299469317267277,0.1859438170915305,0.22498677602284847,0.2593134243142223,0.2882189969752147,0.3111195367862435,0.3275642086528921,0.33724407351810637,0.33999702404110504,0.33580875744478345,0.3248098632887729,0.3072693128954512,0.28358482764102205,0.25427075054511566,0.21994412828638413,0.1813097175885672,0.13914456077219353,0.0942826389651342,0.047599930093507666],[0.0480131560116596,0.09501564817534051,0.1400193940553503,0.18208097537241302,0.22032271552406918,0.25395223224253965,0.2822799398008679,0.30473398827896503,0.3208721733418843,0.33039043299848403,0.33312767228145235,0.32906681632129714,0.31833217569365296,0.30118339249874315,0.2780064021180009,0.24930197532326323,0.21567247753134403,0.17780748844026417,0.13646886452832319,0.09247571112772159,0.04668957515423759],[0.047013686824350344,0.09303904166454295,0.1371098132780134,0.17830340494524138,0.21576143469201867,0.24870877096454985,0.2764705381521542,0.2984866070108163,0.3143231418187853,0.3236808562462822,0.32639974969934626,0.3224602432815458,0.3119808047254243,0.2952123130634027,0.27252955751866403,0.24442038328621415,0.21147306057107815,0.17436246063598793,0.13383556597765536,0.09069674635996201,0.04579309801713291],[0.04603629564601236,0.09110608782729511,0.1342644482281954,0.17460908938270045,0.21130041679275668,0.24358006651520922,0.2707874413824815,0.29237378655810525,0.30791340781666876,0.31711171470901645,0.3198098855203599,0.3159860880691541,0.305753346784328,0.28935428972243,0.267153135293068,0.23962538486318813,0.2073457447192436,0.17097480887351738,0.1312449836096507,0.08894605495353158,0.044910684881969996],[0.045080487999635835,0.08921579466740225,0.1314818066196717,0.17099604075343702,0.20693719988931739,0.23856323123151768,0.26522741718413784,0.2863920656412542,0.30163942594265325,0.31067954079396226,0.3133548523085823,0.3096415091148528,0.2996474587780682,0.2836075426476626,0.2618759269761291,0.2349162940344225,0.2032902694491254,0.16764456837934305,0.1286973063586749,0.08722384769754946,0.04404246799680968],[0.04414575395234669,0.08736714365105643,0.12876036871261512,0.1674622578129481,0.20266933944059218,0.23365543866438368,0.2597873446862082,0.2805381405006272,0.29549783975134397,0.30438106563925466,0.30703160764044896,0.30342381262527746,0.2936608865459899,0.27797030799162004,0.2566966650050342,0.23029230140261994,0.19930620695351542,0.16437159053099598,0.12619255270942303,0.08553020589002902,0.043188510405553146]]}],"layout":{"xaxis":{"title":{"text":"x"}},"yaxis":{"title":{"text":"t"}},"zaxis":{"title":{"text":"u"}}},"config":{}});
</script><div style="break-before: page; page-break-before: always;"></div><h1 id="physics-based-battery-simulation"><a class="header" href="#physics-based-battery-simulation">Physics-based Battery Simulation</a></h1>
<p>Traditional battery models are based on equivalent circuit models, similar to the circuit modelled in section <a href="primer/./electrical_circuits.html">Electrical Circuits</a>.
These models are simple and computationally efficient, but they lack the ability to capture all of the complex electrochemical processes that occur in a battery.
Physics-based models, on the other hand, are based on the electrochemical processes that occur in the battery, and can provide a more detailed description of the battery's behaviour.
They are parameterized by physical properties of the battery, such as the diffusion coefficients of lithium ions in the electrodes, the reaction rate constants, and the surface area of the electrodes,
and can be used to predict the battery's performance under different operating conditions, once these parameters are known.</p>
<p>The Single Particle Model (SPM) is a physics-based model of a lithium-ion battery. It describes the diffusion of lithium ions in the positive and negative electrodes of the battery over a 1D radial domain, assuming that the properties of the electrodes are uniform across the thickness of the electrode. Here we will describe the equations that govern the SPM, and show how to solve them at different current rates to calculate the terminal voltage of the battery.</p>
<h2 id="the-single-particle-model-state-equations"><a class="header" href="#the-single-particle-model-state-equations">The Single Particle Model state equations</a></h2>
<p>The SPM model only needs to solve for the concentration of lithium ions in the positive and negative electrodes, \(c_n\) and \(c_p\). The diffusion of lithium ions in each electrode particle \(c_i\) is given by:</p>
<p>\[
\frac{\partial c_i}{\partial t} = \nabla \cdot (D_i \nabla c_i)
\]</p>
<p>subject to the following boundary and initial conditions:</p>
<p>\[
\left.\frac{\partial c_i}{\partial r}\right\vert_{r=0} = 0, \quad \left.\frac{\partial c}{\partial r}\right\vert_{r=R_i} = -j_i, \quad \left.c\right\vert_{t=0} = c^0_i
\]</p>
<p>where \(c_i\) is the concentration of lithium ions in the positive (\(i=n\)) or negative (\(i=p\)) electrode, \(D_i\) is the diffusion coefficient, \(j_i\) is the interfacial current density, and \(c^0_i\) is the concentration at the particle surface.</p>
<p>The fluxes of lithium ions in the positive and negative electrodes \(j_i\) are dependent on the applied current \(I\):</p>
<p>\[
j_n = \frac{I}{a_n \delta_n F \mathcal{A}}, \qquad
j_p = \frac{-I}{a_p \delta_p F \mathcal{A}},
\]</p>
<p>where \(a_i = 3 \epsilon_i / R_i\) is the specific surface area of the electrode, \(\epsilon_i\) is the volume fraction of active material, \(\delta_i\) is the thickness of the electrode, \(F\) is the Faraday constant, and \(\mathcal{A}\) is the electrode surface area.</p>
<h2 id="output-variables-for-the-single-particle-model"><a class="header" href="#output-variables-for-the-single-particle-model">Output variables for the Single Particle Model</a></h2>
<p>Now that we have defined the equations to solve, we turn to the output variables that we need to calculate from the state variables \(c_n\) and \(c_p\). The terminal voltage of the battery is given by:</p>
<p>\[
V = U_p(x_p^s) - U_n(x_n^s) + \eta_p - \eta_n
\]</p>
<p>where \(U_i\) is the open circuit potential (OCP) of the electrode, \(x_i^s = c_i(r=R_i) / c_i^{max}\) is the surface stoichiometry, and \(\eta_i\) is the overpotential.</p>
<p>Assuming Butler-Volmer kinetics and \(\alpha_i = 0.5\), the overpotential is given by:</p>
<p>\[
\eta_i = \frac{2RT}{F} \sinh^{-1} \left( \frac{j_i F}{2i_{0,i}} \right)
\]</p>
<p>where the exchange current density \(i_{0,i}\) is given by:</p>
<p>\[
i_{0,i} = k_i F \sqrt{c_e} \sqrt{c_i(r=R_i)} \sqrt{c_i^{max} - c_i(r=R_i)}
\]</p>
<p>where \(c_e\) is the concentration of lithium ions in the electrolyte, and \(k_i\) is the reaction rate constant.</p>
<h2 id="stopping-conditions"><a class="header" href="#stopping-conditions">Stopping conditions</a></h2>
<p>We wish to terminate the simulation if the terminal voltage exceeds an upper threshold \(V_{\text{max}}\) or falls below a lower threshold \(V_{\text{min}}\). DiffSol uses a root-finding algorithm to detect when the terminal voltage crosses these thresholds, using the following stopping conditions:</p>
<p>\[
V_{\text{max}} - V = 0, \qquad
V - V_{\text{min}} = 0,
\]</p>
<h2 id="solving-the-single-particle-model-using-diffsol"><a class="header" href="#solving-the-single-particle-model-using-diffsol">Solving the Single Particle Model using DiffSol</a></h2>
<p>The equations above describe the Single Particle Model of a lithium-ion battery, but they are relativly complex and difficult to discretise compared with the simple heat equation PDE that we saw in the <a href="primer/./heat_equation.html">Heat Equation</a> section.</p>
<p>Rather than derive and write down the discretised equations outselves, we will instead rely on the <a href="https://pybamm.org/">PyBaMM library</a> to generate the equations for us. PyBaMM is a Python library that can generate a wide variety of physics-based battery models, using different parameterisations, physics and operating conditions. Combined with <a href="https://github.com/martinjrobins/pybamm2diffsl">a tool</a> that takes a PyBaMM model and writes it out in the DiffSL language, we can generate <a href="primer/src/spm.ds">a DiffSL file</a> that can be used to solve the equations of the SPM model described above. We can then use the DiffSol crate to solve the model and calculate the terminal voltage of the battery over a range of current rates.</p>
<p>The code below reads in the DiffSL file, compiles it, and then solves the equation for different current rates. We wish to stop the simulation when either the final time is reached, or when one of the stopping conditions is met. We will output the terminal voltage of the battery at regular intervals during the simulation, because the terminal voltage can change more rapidly than the state variables \(c_n\) and \(c_p\), particularly during the "knee" of the discharge curve.</p>
<p>The discretised equations result in sparse matrices, so we use the sparse matrix and linear solver modules provided by the <a href="https://github.com/sarah-quinones/faer-rs">faer</a> crate to solve the equations efficiently.</p>
<pre><pre class="playground"><code class="language-rust">use diffsol::{
    DiffSl, OdeBuilder, CraneliftModule, SparseColMat, FaerSparseLU, 
    OdeSolverMethod, OdeSolverStopReason, OdeEquations, NonLinearOp,
};
use plotly::{
    Plot, Scatter, common::Mode, layout::Layout, layout::Axis
};
<span class="boring">use std::fs;
</span><span class="boring">fn main() {
</span>type M = SparseColMat&lt;f64&gt;;
type LS = FaerSparseLU&lt;f64&gt;;
type CG = CraneliftModule;

let file = std::fs::read_to_string("../src/primer/src/spm.ds").unwrap();

let eqn = DiffSl::&lt;M, CG&gt;::compile(&amp;file).unwrap();
let mut problem = OdeBuilder::&lt;M&gt;::new()
    .p([1.0])
    .build_from_eqn(eqn)
    .unwrap();
let currents = vec![0.6, 0.8, 1.0, 1.2, 1.4];
let final_time = 3600.0;
let delta_t = 3.0;
    
let mut plot = Plot::new();
for current in currents {
    problem.eqn.set_params(&amp;faer::Col::from_fn(1, |_| current));

    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let mut v = Vec::new();
    let mut t = Vec::new();

    // save the initial output
    let mut out = problem.eqn.out().unwrap().call(solver.state().y, solver.state().t);
    v.push(out[0]);
    t.push(0.0);

    // solve until the final time is reached
    // or we reach the stop condition
    solver.set_stop_time(final_time).unwrap();
    let mut next_output_time = delta_t;
    let mut finished = false;
    while !finished {
        let curr_t = match solver.step() {
            Ok(OdeSolverStopReason::InternalTimestep) =&gt; solver.state().t,
            Ok(OdeSolverStopReason::RootFound(t)) =&gt; {
                finished = true;
                t
            },
            Ok(OdeSolverStopReason::TstopReached) =&gt; {
                finished = true;
                final_time
            },
            Err(_) =&gt; panic!("unexpected solver error"),
        };
        while curr_t &gt; next_output_time {
            let y = solver.interpolate(next_output_time).unwrap();
            problem.eqn.out().unwrap().call_inplace(&amp;y, next_output_time, &amp;mut out);
            v.push(out[0]);
            t.push(next_output_time);
            next_output_time += delta_t;
        }
    }

    let voltage = Scatter::new(t, v)
        .mode(Mode::Lines)
        .name(format!("current = {} A", current));
    plot.add_trace(voltage);
}

let layout = Layout::new()
    .x_axis(Axis::new().title("t [sec]"))
    .y_axis(Axis::new().title("voltage [V]"));
plot.set_layout(layout);
let plot_html = plot.to_inline_html(Some("battery-simulation"));
<span class="boring">fs::write("../src/primer/images/battery-simulation.html", plot_html).expect("Unable to write file");
</span><span class="boring">}</span></code></pre></pre>
<div id="battery-simulation" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("battery-simulation", {"data":[{"type":"scatter","name":"current = 0.6 A","mode":"lines","x":[0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0,30.0,33.0,36.0,39.0,42.0,45.0,48.0,51.0,54.0,57.0,60.0,63.0,66.0,69.0,72.0,75.0,78.0,81.0,84.0,87.0,90.0,93.0,96.0,99.0,102.0,105.0,108.0,111.0,114.0,117.0,120.0,123.0,126.0,129.0,132.0,135.0,138.0,141.0,144.0,147.0,150.0,153.0,156.0,159.0,162.0,165.0,168.0,171.0,174.0,177.0,180.0,183.0,186.0,189.0,192.0,195.0,198.0,201.0,204.0,207.0,210.0,213.0,216.0,219.0,222.0,225.0,228.0,231.0,234.0,237.0,240.0,243.0,246.0,249.0,252.0,255.0,258.0,261.0,264.0,267.0,270.0,273.0,276.0,279.0,282.0,285.0,288.0,291.0,294.0,297.0,300.0,303.0,306.0,309.0,312.0,315.0,318.0,321.0,324.0,327.0,330.0,333.0,336.0,339.0,342.0,345.0,348.0,351.0,354.0,357.0,360.0,363.0,366.0,369.0,372.0,375.0,378.0,381.0,384.0,387.0,390.0,393.0,396.0,399.0,402.0,405.0,408.0,411.0,414.0,417.0,420.0,423.0,426.0,429.0,432.0,435.0,438.0,441.0,444.0,447.0,450.0,453.0,456.0,459.0,462.0,465.0,468.0,471.0,474.0,477.0,480.0,483.0,486.0,489.0,492.0,495.0,498.0,501.0,504.0,507.0,510.0,513.0,516.0,519.0,522.0,525.0,528.0,531.0,534.0,537.0,540.0,543.0,546.0,549.0,552.0,555.0,558.0,561.0,564.0,567.0,570.0,573.0,576.0,579.0,582.0,585.0,588.0,591.0,594.0,597.0,600.0,603.0,606.0,609.0,612.0,615.0,618.0,621.0,624.0,627.0,630.0,633.0,636.0,639.0,642.0,645.0,648.0,651.0,654.0,657.0,660.0,663.0,666.0,669.0,672.0,675.0,678.0,681.0,684.0,687.0,690.0,693.0,696.0,699.0,702.0,705.0,708.0,711.0,714.0,717.0,720.0,723.0,726.0,729.0,732.0,735.0,738.0,741.0,744.0,747.0,750.0,753.0,756.0,759.0,762.0,765.0,768.0,771.0,774.0,777.0,780.0,783.0,786.0,789.0,792.0,795.0,798.0,801.0,804.0,807.0,810.0,813.0,816.0,819.0,822.0,825.0,828.0,831.0,834.0,837.0,840.0,843.0,846.0,849.0,852.0,855.0,858.0,861.0,864.0,867.0,870.0,873.0,876.0,879.0,882.0,885.0,888.0,891.0,894.0,897.0,900.0,903.0,906.0,909.0,912.0,915.0,918.0,921.0,924.0,927.0,930.0,933.0,936.0,939.0,942.0,945.0,948.0,951.0,954.0,957.0,960.0,963.0,966.0,969.0,972.0,975.0,978.0,981.0,984.0,987.0,990.0,993.0,996.0,999.0,1002.0,1005.0,1008.0,1011.0,1014.0,1017.0,1020.0,1023.0,1026.0,1029.0,1032.0,1035.0,1038.0,1041.0,1044.0,1047.0,1050.0,1053.0,1056.0,1059.0,1062.0,1065.0,1068.0,1071.0,1074.0,1077.0,1080.0,1083.0,1086.0,1089.0,1092.0,1095.0,1098.0,1101.0,1104.0,1107.0,1110.0,1113.0,1116.0,1119.0,1122.0,1125.0,1128.0,1131.0,1134.0,1137.0,1140.0,1143.0,1146.0,1149.0,1152.0,1155.0,1158.0,1161.0,1164.0,1167.0,1170.0,1173.0,1176.0,1179.0,1182.0,1185.0,1188.0,1191.0,1194.0,1197.0,1200.0,1203.0,1206.0,1209.0,1212.0,1215.0,1218.0,1221.0,1224.0,1227.0,1230.0,1233.0,1236.0,1239.0,1242.0,1245.0,1248.0,1251.0,1254.0,1257.0,1260.0,1263.0,1266.0,1269.0,1272.0,1275.0,1278.0,1281.0,1284.0,1287.0,1290.0,1293.0,1296.0,1299.0,1302.0,1305.0,1308.0,1311.0,1314.0,1317.0,1320.0,1323.0,1326.0,1329.0,1332.0,1335.0,1338.0,1341.0,1344.0,1347.0,1350.0,1353.0,1356.0,1359.0,1362.0,1365.0,1368.0,1371.0,1374.0,1377.0,1380.0,1383.0,1386.0,1389.0,1392.0,1395.0,1398.0,1401.0,1404.0,1407.0,1410.0,1413.0,1416.0,1419.0,1422.0,1425.0,1428.0,1431.0,1434.0,1437.0,1440.0,1443.0,1446.0,1449.0,1452.0,1455.0,1458.0,1461.0,1464.0,1467.0,1470.0,1473.0,1476.0,1479.0,1482.0,1485.0,1488.0,1491.0,1494.0,1497.0,1500.0,1503.0,1506.0,1509.0,1512.0,1515.0,1518.0,1521.0,1524.0,1527.0,1530.0,1533.0,1536.0,1539.0,1542.0,1545.0,1548.0,1551.0,1554.0,1557.0,1560.0,1563.0,1566.0,1569.0,1572.0,1575.0,1578.0,1581.0,1584.0,1587.0,1590.0,1593.0,1596.0,1599.0,1602.0,1605.0,1608.0,1611.0,1614.0,1617.0,1620.0,1623.0,1626.0,1629.0,1632.0,1635.0,1638.0,1641.0,1644.0,1647.0,1650.0,1653.0,1656.0,1659.0,1662.0,1665.0,1668.0,1671.0,1674.0,1677.0,1680.0,1683.0,1686.0,1689.0,1692.0,1695.0,1698.0,1701.0,1704.0,1707.0,1710.0,1713.0,1716.0,1719.0,1722.0,1725.0,1728.0,1731.0,1734.0,1737.0,1740.0,1743.0,1746.0,1749.0,1752.0,1755.0,1758.0,1761.0,1764.0,1767.0,1770.0,1773.0,1776.0,1779.0,1782.0,1785.0,1788.0,1791.0,1794.0,1797.0,1800.0,1803.0,1806.0,1809.0,1812.0,1815.0,1818.0,1821.0,1824.0,1827.0,1830.0,1833.0,1836.0,1839.0,1842.0,1845.0,1848.0,1851.0,1854.0,1857.0,1860.0,1863.0,1866.0,1869.0,1872.0,1875.0,1878.0,1881.0,1884.0,1887.0,1890.0,1893.0,1896.0,1899.0,1902.0,1905.0,1908.0,1911.0,1914.0,1917.0,1920.0,1923.0,1926.0,1929.0,1932.0,1935.0,1938.0,1941.0,1944.0,1947.0,1950.0,1953.0,1956.0,1959.0,1962.0,1965.0,1968.0,1971.0,1974.0,1977.0,1980.0,1983.0,1986.0,1989.0,1992.0,1995.0,1998.0,2001.0,2004.0,2007.0,2010.0,2013.0,2016.0,2019.0,2022.0,2025.0,2028.0,2031.0,2034.0,2037.0,2040.0,2043.0,2046.0,2049.0,2052.0,2055.0,2058.0,2061.0,2064.0,2067.0,2070.0,2073.0,2076.0,2079.0,2082.0,2085.0,2088.0,2091.0,2094.0,2097.0,2100.0,2103.0,2106.0,2109.0,2112.0,2115.0,2118.0,2121.0,2124.0,2127.0,2130.0,2133.0,2136.0,2139.0,2142.0,2145.0,2148.0,2151.0,2154.0,2157.0,2160.0,2163.0,2166.0,2169.0,2172.0,2175.0,2178.0,2181.0,2184.0,2187.0,2190.0,2193.0,2196.0,2199.0,2202.0,2205.0,2208.0,2211.0,2214.0,2217.0,2220.0,2223.0,2226.0,2229.0,2232.0,2235.0,2238.0,2241.0,2244.0,2247.0,2250.0,2253.0,2256.0,2259.0,2262.0,2265.0,2268.0,2271.0,2274.0,2277.0,2280.0,2283.0,2286.0,2289.0,2292.0,2295.0,2298.0,2301.0,2304.0,2307.0,2310.0,2313.0,2316.0,2319.0,2322.0,2325.0,2328.0,2331.0,2334.0,2337.0,2340.0,2343.0,2346.0,2349.0,2352.0,2355.0,2358.0,2361.0,2364.0,2367.0,2370.0,2373.0,2376.0,2379.0,2382.0,2385.0,2388.0,2391.0,2394.0,2397.0,2400.0,2403.0,2406.0,2409.0,2412.0,2415.0,2418.0,2421.0,2424.0,2427.0,2430.0,2433.0,2436.0,2439.0,2442.0,2445.0,2448.0,2451.0,2454.0,2457.0,2460.0,2463.0,2466.0,2469.0,2472.0,2475.0,2478.0,2481.0,2484.0,2487.0,2490.0,2493.0,2496.0,2499.0,2502.0,2505.0,2508.0,2511.0,2514.0,2517.0,2520.0,2523.0,2526.0,2529.0,2532.0,2535.0,2538.0,2541.0,2544.0,2547.0,2550.0,2553.0,2556.0,2559.0,2562.0,2565.0,2568.0,2571.0,2574.0,2577.0,2580.0,2583.0,2586.0,2589.0,2592.0,2595.0,2598.0,2601.0,2604.0,2607.0,2610.0,2613.0,2616.0,2619.0,2622.0,2625.0,2628.0,2631.0,2634.0,2637.0,2640.0,2643.0,2646.0,2649.0,2652.0,2655.0,2658.0,2661.0,2664.0,2667.0,2670.0,2673.0,2676.0,2679.0,2682.0,2685.0,2688.0,2691.0,2694.0,2697.0,2700.0,2703.0,2706.0,2709.0,2712.0,2715.0,2718.0,2721.0,2724.0,2727.0,2730.0,2733.0,2736.0,2739.0,2742.0,2745.0,2748.0,2751.0,2754.0,2757.0,2760.0,2763.0,2766.0,2769.0,2772.0,2775.0,2778.0,2781.0,2784.0,2787.0,2790.0,2793.0,2796.0,2799.0,2802.0,2805.0,2808.0,2811.0,2814.0,2817.0,2820.0,2823.0,2826.0,2829.0,2832.0,2835.0,2838.0,2841.0,2844.0,2847.0,2850.0,2853.0,2856.0,2859.0,2862.0,2865.0,2868.0,2871.0,2874.0,2877.0,2880.0,2883.0,2886.0,2889.0,2892.0,2895.0,2898.0,2901.0,2904.0,2907.0,2910.0,2913.0,2916.0,2919.0,2922.0,2925.0,2928.0,2931.0,2934.0,2937.0,2940.0,2943.0,2946.0,2949.0,2952.0,2955.0,2958.0,2961.0,2964.0,2967.0,2970.0,2973.0,2976.0,2979.0,2982.0,2985.0,2988.0,2991.0,2994.0,2997.0,3000.0,3003.0,3006.0,3009.0,3012.0,3015.0,3018.0,3021.0,3024.0,3027.0,3030.0,3033.0,3036.0,3039.0,3042.0,3045.0,3048.0,3051.0,3054.0,3057.0,3060.0,3063.0,3066.0,3069.0,3072.0,3075.0,3078.0,3081.0,3084.0,3087.0,3090.0,3093.0,3096.0,3099.0,3102.0,3105.0,3108.0,3111.0,3114.0,3117.0,3120.0,3123.0,3126.0,3129.0,3132.0,3135.0,3138.0,3141.0,3144.0,3147.0,3150.0,3153.0,3156.0,3159.0,3162.0,3165.0,3168.0,3171.0,3174.0,3177.0,3180.0,3183.0,3186.0,3189.0,3192.0,3195.0,3198.0,3201.0,3204.0,3207.0,3210.0,3213.0,3216.0,3219.0,3222.0,3225.0,3228.0,3231.0,3234.0,3237.0,3240.0,3243.0,3246.0,3249.0,3252.0,3255.0,3258.0,3261.0,3264.0,3267.0,3270.0,3273.0,3276.0,3279.0,3282.0,3285.0,3288.0,3291.0,3294.0,3297.0,3300.0,3303.0,3306.0,3309.0,3312.0,3315.0,3318.0,3321.0,3324.0,3327.0,3330.0,3333.0,3336.0,3339.0,3342.0,3345.0,3348.0,3351.0,3354.0,3357.0,3360.0,3363.0,3366.0,3369.0,3372.0,3375.0,3378.0,3381.0,3384.0,3387.0,3390.0,3393.0,3396.0,3399.0,3402.0,3405.0,3408.0,3411.0,3414.0,3417.0,3420.0,3423.0,3426.0,3429.0,3432.0,3435.0,3438.0,3441.0,3444.0,3447.0,3450.0,3453.0,3456.0,3459.0,3462.0,3465.0,3468.0,3471.0,3474.0,3477.0,3480.0,3483.0,3486.0,3489.0,3492.0,3495.0,3498.0,3501.0,3504.0,3507.0,3510.0,3513.0,3516.0,3519.0,3522.0,3525.0,3528.0,3531.0,3534.0,3537.0,3540.0,3543.0,3546.0,3549.0,3552.0,3555.0,3558.0,3561.0,3564.0,3567.0,3570.0,3573.0,3576.0,3579.0,3582.0,3585.0,3588.0,3591.0,3594.0,3597.0],"y":[3.786192865322104,3.784171209380628,3.7830410275285806,3.7821709138276036,3.781426247058275,3.780759381598234,3.780147529787919,3.7795765006132624,3.779036653365985,3.7785216578091436,3.7780271197172692,3.7775502132658465,3.7770887036677228,3.776640100427943,3.7762031093722004,3.7757759998540683,3.775357786789078,3.7749474245674817,3.774544654275732,3.7741482581146184,3.773757762668152,3.773372879113941,3.7729927491604465,3.7726173997448282,3.7722462978507254,3.771879027361638,3.771515545083741,3.7711555532997822,3.770798768324876,3.770444950315203,3.7700940005578873,3.769745796361902,3.7694000182973593,3.7690566249120425,3.7687155108614947,3.768376528743276,3.768039513988679,3.7677044049788564,3.767371114690631,3.767039513132112,3.7667095331856473,3.7663811025989493,3.7660541474719853,3.7657285903134254,3.76540438002078,3.765081464930502,3.7647597771462085,3.764439271997209,3.764119909895367,3.7638016482928016,3.7634844338029074,3.7631682383581544,3.7628530298092184,3.762538768710588,3.762225423970048,3.7619129705656067,3.7616013824694394,3.7612906284537635,3.760980688935293,3.76067154313841,3.760363161277873,3.760055524053336,3.7597486200774064,3.759442434768953,3.759136955417606,3.7588321711727213,3.7585280730320334,3.758224639152022,3.7579218337084357,3.7576196714381207,3.757318145367939,3.7570172499260828,3.756716980932621,3.7564173355898522,3.756118310950023,3.7558198443147743,3.7555219695094766,3.755224682785999,3.7549279812473744,3.754631862841655,3.7543363263556215,3.754041371408405,3.7537469673094757,3.753453116529369,3.7531598258385084,3.7528670934212522,3.752574917928376,3.7522832984734777,3.7519922346292938,3.751701718723569,3.7514117421094855,3.7511223117653665,3.7508334269906975,3.75054508737513,3.7502572927960753,3.749970043416265,3.74968333867443,3.7493971711482903,3.749111546224074,3.748826464231891,3.7485419257043615,3.7482579313747713,3.7479744821751813,3.747691579234531,3.747409217031196,3.747127398791022,3.7468461265084434,3.7465654011900815,3.746285223967823,3.746005596097529,3.745726518957729,3.7454479904128273,3.745170009802685,3.744892580677927,3.744615704116764,3.744339381258225,3.7440636133014586,3.74378840150502,3.7435137462939068,3.7432396456528942,3.7429661029248282,3.742693119133896,3.742420695326355,3.742148832570209,3.7418775319548896,3.7416067945909255,3.7413366197264564,3.7410670092964486,3.7407979643892966,3.740529485982301,3.740261575057596,3.739994232601993,3.739727459606823,3.739461255030015,3.739195620051448,3.7389305566673947,3.7386660658017137,3.7384021483791647,3.7381388053252933,3.7378760375663247,3.737613846029048,3.737352231640715,3.7370911953289077,3.7368307380214434,3.736570860646249,3.7363115641312596,3.73605284940429,3.7357947173929293,3.735537161314751,3.7352801865680423,3.735023794951375,3.734767987164228,3.7345127638977162,3.734258125834581,3.734004073649194,3.7337506080075626,3.7334977295673313,3.7332454389777765,3.7329937368798163,3.7327426239060033,3.7324921006805325,3.7322421678192326,3.731992825088256,3.7317440649870166,3.7314958947340746,3.7312483146806277,3.7310013251615275,3.7307549264954045,3.7305091189847888,3.730263902916247,3.7300192785604867,3.7297752461724953,3.7295318059916545,3.7292889582418667,3.729046703131672,3.7288050408543683,3.728563971588139,3.7283234940636447,3.7280836062860114,3.727844310815708,3.727605607658798,3.7273674968029944,3.7271299782178353,3.7268930518548675,3.7266567176478165,3.726420975512761,3.726185825348309,3.725951267035772,3.7257173004393347,3.7254839254062198,3.7252511417668703,3.7250189493351087,3.724787347624262,3.7245563363886105,3.7243259155719195,3.7240960849105402,3.723866844124609,3.7236381929182247,3.7234101309796164,3.723182657981301,3.7229557735802565,3.7227294774180835,3.7225037691211638,3.722278648300823,3.722054114553492,3.7218301674608636,3.721606806590051,3.721384031668785,3.7211618421507633,3.720940237527794,3.7207192173157697,3.720498781016942,3.72027892812009,3.7200596581006438,3.7198409704208393,3.719622864529862,3.7194053398639784,3.7191883958466825,3.7189720318888333,3.7187562473887903,3.7185410417325513,3.7183264142780468,3.71811236396296,3.717898890468511,3.7176859931217585,3.717473671237673,3.7172619241192844,3.7170507510578137,3.716840151332795,3.7166301242122097,3.71642066895262,3.7162117847992855,3.7160034709862915,3.7157957267366806,3.7155885512625635,3.715381943765247,3.715175903320006,3.7149704288410885,3.714765519746771,3.7145611751790164,3.71435739426842,3.7141541761342896,3.7139515198847373,3.71374942461676,3.713547889416331,3.7133469133584684,3.7131464955073366,3.7129466349163103,3.7127473306280616,3.7125485816746413,3.7123503870775565,3.71215274623563,3.7119556582328674,3.711759121727965,3.711563135712084,3.711367699166657,3.711172811063452,3.710978470364651,3.7107846760229215,3.7105914269814955,3.710398722174229,3.710206560525677,3.7100149409511674,3.7098238623568545,3.7096333236397965,3.709443323688013,3.709253861380548,3.70906493558753,3.7088765451702383,3.7086886889811477,3.7085013658639987,3.7083145746538437,3.708128314177103,3.7079425832516155,3.7077573806866893,3.707572706343109,3.7073885585984514,3.707204935864447,3.707021836938315,3.7068392606098164,3.7066572056613016,3.7064756708677664,3.7062946549968903,3.7061141568090754,3.7059341750575037,3.705754708488155,3.705575755839862,3.7053973158443343,3.705219387226192,3.7050419687030036,3.704865058985306,3.7046886567766295,3.7045127607735338,3.704337369665608,3.7041624821355104,3.703988096858974,3.7038142125048177,3.703640827734967,3.703467941204452,3.7032955522251463,3.703123658954891,3.7029522599817453,3.702781353943909,3.7026109394731392,3.7024410151947484,3.7022715797275985,3.702102631684104,3.701934169670214,3.7017661922854064,3.701598698122665,3.701431685768473,3.7012651538027814,3.7010991007989893,3.7009335253239177,3.7007684259377718,3.700603801194117,3.700439649639831,3.7002759698150696,3.7001127602532184,3.699950019480842,3.6997877460176443,3.699625938376393,3.699464595031552,3.6993037142529674,3.699143294744637,3.6989833349873305,3.698823833454433,3.6986647886118686,3.698506198918012,3.698348062823603,3.6981903787716592,3.6980331451973796,3.6978763605280336,3.6977200231828697,3.697564131572993,3.6974086841012648,3.6972536791621713,3.6970991151417,3.696944990417219,3.6967913033573345,3.696638052321751,3.6964852356611297,3.69633285171693,3.696180898821265,3.696029375296728,3.6958782794562275,3.695727609522187,3.6955773636685416,3.6954275403317833,3.695278137780632,3.695129154273047,3.6949805880560262,3.694832437365373,3.6946847004254955,3.6945373754491633,3.6943904606372793,3.694243954178625,3.694097854249624,3.693952159014069,3.693806866622863,3.6936619752137396,3.6935174829109765,3.693373387825111,3.6932296880526305,3.693086381675663,3.692943466761667,3.692800941363086,3.6926588035170207,3.692517051244882,3.6923756825520235,3.6922346955118845,3.6920940881103976,3.6919538582339286,3.6918140038222034,3.691674522797043,3.6915354130619304,3.691396672501588,3.691258298981521,3.6911202903475617,3.6909826444254032,3.6908453590201056,3.690708431915607,3.6905718608742015,3.690435643636028,3.69029977791852,3.690164261415854,3.6900290917983893,3.68989426671207,3.689759783777843,3.689625640591028,3.6894918347206995,3.6893583637090286,3.6892252250706314,3.689092416291875,3.688959934990466,3.6888277785255257,3.6886959442411884,3.6885644295065707,3.688433231658996,3.6883023480032033,3.6881717758105514,3.6880415123181773,3.687911554728162,3.6877819002066516,3.687652545882977,3.687523488848734,3.687394726156859,3.6872662548206665,3.6871380718128703,3.687010174064587,3.686882558464304,3.686755221856833,3.686628161042233,3.6865013727747096,3.6863748537614853,3.686248600661659,3.6861226100850124,3.685996878590816,3.6858714027766286,3.6857461790223605,3.6856212037218574,3.6854964732200344,3.6853719838048415,3.685247731705885,3.685123713093022,3.684999924074912,3.68487636069756,3.684753018942799,3.684629894726767,3.6845069838983324,3.684384282237499,3.6842617854537694,3.6841394891844788,3.6840173889930874,3.683895480367455,3.6837737587180617,3.6836522193762002,3.68353085759214,3.683409668533238,3.6832886472820388,3.6831677888343064,3.68304708809705,3.6829265398864894,3.682806138925998,3.6826858798439988,3.682565757171828,3.6824457653415603,3.6823258986837946,3.6822061514254076,3.682086517687254,3.681966991481861,3.6818475667110397,3.6817282371635023,3.6816089965124226,3.6814898383129506,3.6813707559997146,3.6812517428016722,3.681132791933005,3.681013896492611,3.680895049406568,3.680776243467327,3.6806574713309863,3.6805387255145563,3.6804199983931656,3.6803012821972634,3.6801825690097725,3.6800638507632355,3.679945119236924,3.679826366053918,3.679707582678185,3.6795887604116215,3.6794698903910827,3.6793509635853994,3.6792319707923755,3.6791129026357843,3.6789937495623577,3.6788745018387585,3.678755149548566,3.678635682589258,3.6785160906692003,3.6783963633046484,3.6782764898167555,3.678156459328612,3.6780362607623025,3.6779158828359826,3.677795314061011,3.677674542739095,3.6775535569595057,3.677432344596322,3.677310893305754,3.6771891905235154,3.677067223462274,3.6769449791091837,3.676822444223496,3.6766996052511596,3.676576448415697,3.6764529599064213,3.676329125547076,3.6762049309230918,3.6760803613799076,3.675955402021454,3.675830037708798,3.675704253058963,3.675578032443948,3.6754513599899328,3.675324219576714,3.6751965948373604,3.675068469158118,3.674939825678567,3.674810647292059,3.6746809166464276,3.6745506161450296,3.6744197279480804,3.674288233974343,3.6741561159031697,3.6740233551769155,3.673889933003751,3.6737558303608724,3.673621027998155,3.6734855064422502,3.6733492460011568,3.673212226769277,3.6730744286329893,3.6729358312767477,3.6727964141897385,3.672656156673113,3.672515037847806,3.6723730366629908,3.672230131905151,3.672086302207831,3.6719415260620565,3.671795781827478,3.671649047721326,3.671501301680127,3.671352521929158,3.6712026864258682,3.6710517730631,3.670899759684868,3.6707466241029825,3.6705923441145205,3.670436897520175,3.6702802621435042,3.6701224158510595,3.6699633365734528,3.6698030023273276,3.669641391238271,3.6694784815646737,3.669314251722503,3.669148680311059,3.668981746139656,3.6688134282552327,3.6686437059709323,3.668472558895589,3.6682999669641205,3.6681259104688584,3.6679503700917224,3.667773326937284,3.6675947625666527,3.6674146590321706,3.6672329989128816,3.667049765350737,3.6668649420874884,3.6666785135022293,3.6664904646495327,3.666300781298124,3.6661094499700337,3.66591645798016,3.6657217934761763,3.665525445478699,3.6653274039216384,3.6651276596926685,3.6649262046200226,3.664723031654401,3.664518134796983,3.6643115091530905,3.664103150982234,3.663893057737102,3.663681228101928,3.663467662030114,3.6632523607809744,3.663035326955483,3.662816564530889,3.662596078894077,3.662373876873523,3.6621499667697304,3.6619243583839927,3.661697063045355,3.661468093635643,3.6612374646124115,3.6610051920296915,3.6607712935564054,3.6605357884923,3.660298697781316,3.6600600440222197,3.6598198514764335,3.6595781460729278,3.659334955410062,3.6590903087543207,3.6588442370358036,3.658596772840453,3.658347950398877,3.65809780557178,3.6578463758319093,3.657593700242488,3.6573398194321163,3.657084775566133,3.656828612314418,3.656571374815662,3.656313109638139,3.6560538649494334,3.6557936900205554,3.655532635269843,3.6552707525230725,3.655008094788621,3.6547447161984903,3.654480671946395,3.6542160182230354,3.6539508121487114,3.653685111703446,3.6534189756547577,3.6531524634833135,3.6528856353065904,3.6526185518008076,3.6523512741213042,3.652083863821575,3.6518163827712065,3.6515488930729365,3.6512814569790555,3.651014136807398,3.6507469948571662,3.6504800933248025,3.650213494220178,3.649947259283307,3.6496814499018355,3.649416127029532,3.6491513511060125,3.648887181977895,3.648623678821626,3.6483609000681723,3.6480989033297555,3.6478377453288533,3.6475774818296127,3.6473181675718425,3.6470598562077616,3.6468026002416134,3.6465464509722936,3.6462914584391037,3.6460376713707245,3.645785137137502,3.6455339017071235,3.6452840096037336,3.645035503870547,3.644788426035984,3.6445428160833506,3.644298712424074,3.644056151874461,3.643815169636012,3.643575799279199,3.6433380727307068,3.643102020264064,3.64286767049361,3.642635050371707,3.642404185189151,3.6421750985786296,3.641947812521192,3.6417223473555875,3.641498721790364,3.641276952918617,3.6410570562352707,3.6408390456567483,3.640622933542916,3.640408730721158,3.6401964465124705,3.6399860887594055,3.6397776638557495,3.6395711767778067,3.639366631117135,3.639164029114599,3.638963371695642,3.6387646585065827,3.638567887951878,3.6383730572321746,3.6381801623830534,3.637989198314337,3.6378001588498536,3.6376130367675357,3.637427823839765,3.637244510873834,3.6370630877524577,3.6368835435306988,3.636705866578718,3.636530043977889,3.636356062314965,3.6361839074521254,3.6360135645659235,3.6358450181857203,3.6356782522315534,3.635513250051388,3.635349994457696,3.635188467763317,3.63502865181656,3.634870528035535,3.63471407744164,3.6345592806922054,3.6344061181122758,3.6342545697254853,3.6341046152840293,3.6339562342977083,3.633809406062055,3.633664109685505,3.6335203241156213,3.6333780281643957,3.633237200532587,3.633097819833119,3.6329598646135586,3.632823313377645,3.632688144605925,3.632554336775452,3.632421868378621,3.632290717941095,3.632160864038889,3.6320322853145868,3.6319049604927343,3.6317788683944237,3.6316539879510694,3.631530298217419,3.6314077783838083,3.6312864077876794,3.631166165924383,3.6310470324572943,3.6309289872272528,3.630812010261358,3.6306960817811333,3.630581182210079,3.6304672921806604,3.6303543925407085,3.6302424643592937,3.630131488932074,3.630021447786147,3.6299123226844205,3.629804095629514,3.629696748867245,3.6295902648896714,3.6294846264377387,3.629379816503562,3.6292758183323106,3.6291726154237844,3.6290701915336356,3.6289685306742796,3.6288676171155223,3.6287674353848995,3.6286679702677507,3.6285692068070414,3.6284711303029606,3.6283737263122813,3.628276980647521,3.628180879375911,3.6280854088181735,3.6279905555471266,3.6278963063861434,3.6278026484074486,3.6277095689302796,3.627617055518926,3.627525095980649,3.627433678363481,3.627342790953943,3.627252422274652,3.627162561081869,3.627073196362942,3.6269843173337,3.6268959134667598,3.626807974404409,3.626720490023721,3.6266334504272195,3.6265468459320602,3.6264606670671484,3.626374904570226,3.6262895493849348,3.6262045926578654,3.6261200257355983,3.626035840161724,3.6259520276738653,3.6258685802007053,3.6257854898589965,3.625702748950601,3.6256203499595183,3.6255382855489287,3.6254565485582533,3.625375132000232,3.6252940290580065,3.6252132330822366,3.625132737588231,3.6250525362531003,3.6249726229129364,3.6248929915600203,3.6248136363400523,3.624734551549417,3.6246557316324726,3.624577171178869,3.6244988649209047,3.6244208077309135,3.624342994618681,3.624265420728893,3.6241880813386254,3.624110971854863,3.6240340878120536,3.6239574248697,3.623880978809979,3.6238047455354083,3.6237287210665405,3.623652901539694,3.6235772832047175,3.623501862422796,3.6234266356642895,3.6233515995066004,3.6232767506320878,3.6232020858260037,3.6231276019744794,3.6230532960625323,3.622979165172106,3.622905206480164,3.622831417256787,3.6227577948633334,3.622684336750603,3.622611040457063,3.6225379036070744,3.6224649239091797,3.6223920991543976,3.6223194272145594,3.622246906040679,3.6221745336613393,3.622102308181114,3.6220302277790255,3.621958290707019,3.621886495288467,3.621814839916704,3.621743323053579,3.6216719432280495,3.62160069903478,3.6215295891327823,3.6214586122440693,3.621387767152336,3.6213170527016634,3.6212464677952445,3.6211760113941276,3.6211056825159917,3.6210354802339313,3.6209654036752608,3.6208954520203536,3.620825624501479,3.6207559204006743,3.6206863390501347,3.6206168798324505,3.620547542176324,3.6204783255568644,3.6204092294945216,3.6203402535540694,3.6202713973435765,3.6202026605133955,3.620134042755182,3.620065543800902,3.619997163421877,3.619928901427821,3.619860757665898,3.6197927320197976,3.619724824408809,3.6196570347869046,3.6195893631418503,3.619521809494307,3.61945437389695,3.6193870564335935,3.619319857218332,3.619252776394664,3.619185814134664,3.619118970638122,3.61905224613171,3.6189856408681504,3.61891915512539,3.6188527892057776,3.6187865434352458,3.6187204181625034,3.618654413758225,3.61858853061424,3.618522769142742,3.618457129775485,3.6183916129629847,3.618326219173734,3.6182609488934014,3.618195802624045,3.618130780883324,3.618065884203713,3.6180011131317045,3.617936468227036,3.6178719500618914,3.617807559220119,3.6177432962964415,3.6176791618956665,3.617615156631896,3.6175512811277404,3.617487536013512,3.617423921926444,3.6173604395098837,3.617297089412499,3.6172338722874646,3.6171707887916664,3.617107839584891,3.6170450253290074,3.6169823466871596,3.616919804322937,3.616857398899558,3.616795131079038,3.616733001521358,3.616671010883628,3.616609159819242,3.616547448977035,3.6164858790004293,3.6164244505265755,3.6163631641854925,3.6163020205991967,3.6162410203808277,3.616180164133773,3.6161194524507763,3.61605888591305,3.615998465089371,3.615938190535187,3.6158780627916944,3.6158180823849295,3.6157582498248386,3.615698565604351,3.615639030198443,3.615579644063015,3.615520407630056,3.6154613213194837,3.6154023855249613,3.615343600617399,3.615284966943995,3.615226484827242,3.615168154563938,3.615109976424185,3.615051950650388,3.6149940774562372,3.6149363570256976,3.614878789511974,3.61482137503648,3.6147641136878037,3.6147070055206583,3.61465005055483,3.6145932487741184,3.6145366001252723,3.6144801045169173,3.6144237618184794,3.6143675718590984,3.6143115344265433,3.6142556492661124,3.61419991607953,3.61414433452385,3.6140889042103277,3.614033624703322,3.6139784955191523,3.613923516124992,3.6138686859377223,3.6138140043228013,3.6137594705931235,3.613705084007874,3.6136508437713837,3.6135967490319767,3.6135427988808124,3.6134889923507285,3.6134353284150835,3.6133818059865908,3.6133284239161565,3.6132751809917036,3.613222075937012,3.613169107410545,3.6131162740042773,3.613063574242522,3.613011006580757,3.612958569404457,3.6129062610279163,3.61285407969308,3.612802023568367,3.612750090747508,3.612698279248372,3.612646587011804,3.6125950119004564,3.6125435516976308,3.6124922041061223,3.6124409667470574,3.6123898371587524,3.6123388127955627,3.6122878910267406,3.612237069135297,3.6121863443168776,3.612135713678631,3.6120851742380924,3.612034722922067,3.6119843565655323,3.611934071910539,3.611883865605112,3.6118337342021825,3.6117836741585054,3.6117336818336008,3.6116837534886983,3.6116338852856913,3.6115840732861098,3.61153431345009,3.6114846016353646,3.611434933596268,3.611385304982741,3.6113357113393567,3.6112861481043605,3.6112366106087155,3.6111870940751722,3.6111375936173347,3.6110881042387626,3.6110386208320726,3.610989138178051,3.6109396509448057,3.6108901536869014,3.6108406408445326,3.6107911067427056,3.610741545590437,3.6106919514799642,3.6106423183859815,3.610592640164891,3.6105429105540563,3.6104931231710977,3.6104432715131893,3.610393348956365,3.610343348754873,3.6102932640405125,3.6102430878220093,3.610192812984408,3.6101424322884705,3.6100919383701098,3.6100413237398232,3.609990580782156,3.60993970175518,3.6098886787899858,3.6098375038901933,3.6097861689314876,3.6097346656611653,3.6096829856976864,3.609631120530273,3.6095790615184864,3.609526799891857,3.6094743267494964,3.6094216330597537,3.609368709659861,3.6093155472556133,3.6092621364210538,3.609208467598162,3.6091545310965816,3.609100317093325,3.6090458156325176,3.60899101662514,3.6089359098487797,3.6088804849473903,3.608824731431067,3.6087686386758207,3.608712195923358,3.6086553922808693,3.6085982167208233,3.6085406580807526,3.6084827050630564,3.6084243462347843,3.6083655700274484,3.6083063647367895,3.608246718522583,3.6081866194084076,3.6081260552814327,3.6080650138921637,3.6080034828542185,3.607941449644051,3.607878901600694,3.6078158259254662,3.607752209681661,3.607688039794236,3.607623303049453,3.6075579860945175,3.6074920754371758,3.6074255574452896,3.6073584183463883,3.60729064422717,3.607222221032986,3.607153134567274,3.6070833704909497,3.607012914321768,3.6069417514336304,3.6068698670558312,3.606797246272277,3.6067238740206227,3.606649735091378,3.606574814126923,3.606499095620485,3.606422563915034,3.6063452032021033,3.6062669975205393,3.606187930755185,3.6061079866349024,3.606027148730891,3.6059454004587956,3.6058627250724222,3.6057791056636046,3.6056945251603407,3.605608966324783,3.6055224117511613,3.605434843863548,3.6053462449135436,3.605256596977798,3.605165881955434,3.60507408156532,3.604981177343208,3.6048871506387217,3.6047919826122072,3.6046956542314113,3.6045981462680134,3.60449943929399,3.6043995136777918,3.6042983495803678,3.6041959269509807,3.604092225522853,3.6039872248086016,3.6038809040954813,3.603773242440413,3.603664218664793,3.6035538113490944,3.6034419988272233,3.6033287591806413,3.6032140702322586,3.6030979095400557,3.602980254390461,3.6028610817914544,3.6027403684654025,3.6026180908416063,3.6024942250485616,3.602368746905919,3.6022416319161383,3.602112855255819,3.6019823917667178,3.6018502159464263,3.6017163019386924,3.60158062352341,3.601443154106231,3.601303866707804,3.6011627339526315,3.6010197280575422,3.600874820819732,3.600727983604424,3.6005791873320723,3.60042840246514,3.60027559899442,3.6001207464249014,3.5999638137611565,3.5998047694922346,3.599643581576062,3.5994802174233236,3.5993146438808217,3.5991468272142875,3.598976733090642,3.5988043265596756,3.598629572035163,3.598452433275357,3.598272873362871,3.598090854683947,3.597906338907039,3.597719286960772,3.597529659011185,3.597337414438293,3.59714251181192,3.5969449088668064,3.596744562476946,3.5965414286291586,3.596335462395863,3.5961266179070335,3.5959148483213204,3.595700105796314,3.595482341457927,3.5952615053688692,3.595037546496208,3.5948104126779685,3.5945800505887613,3.594346405704418,3.5941094222655963,3.5938690432403346,3.5936252102855377,3.5933778637073424,3.5931269424203682,3.592872383905793,3.592614124168244,3.592352097691466,3.592086237392733,3.5918164745759866,3.591542738883643,3.591264958247065,3.590983058835629,3.5906969650043994,3.590406599240325,3.590111882106949,3.5898127321875966]},{"type":"scatter","name":"current = 0.8 A","mode":"lines","x":[0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0,30.0,33.0,36.0,39.0,42.0,45.0,48.0,51.0,54.0,57.0,60.0,63.0,66.0,69.0,72.0,75.0,78.0,81.0,84.0,87.0,90.0,93.0,96.0,99.0,102.0,105.0,108.0,111.0,114.0,117.0,120.0,123.0,126.0,129.0,132.0,135.0,138.0,141.0,144.0,147.0,150.0,153.0,156.0,159.0,162.0,165.0,168.0,171.0,174.0,177.0,180.0,183.0,186.0,189.0,192.0,195.0,198.0,201.0,204.0,207.0,210.0,213.0,216.0,219.0,222.0,225.0,228.0,231.0,234.0,237.0,240.0,243.0,246.0,249.0,252.0,255.0,258.0,261.0,264.0,267.0,270.0,273.0,276.0,279.0,282.0,285.0,288.0,291.0,294.0,297.0,300.0,303.0,306.0,309.0,312.0,315.0,318.0,321.0,324.0,327.0,330.0,333.0,336.0,339.0,342.0,345.0,348.0,351.0,354.0,357.0,360.0,363.0,366.0,369.0,372.0,375.0,378.0,381.0,384.0,387.0,390.0,393.0,396.0,399.0,402.0,405.0,408.0,411.0,414.0,417.0,420.0,423.0,426.0,429.0,432.0,435.0,438.0,441.0,444.0,447.0,450.0,453.0,456.0,459.0,462.0,465.0,468.0,471.0,474.0,477.0,480.0,483.0,486.0,489.0,492.0,495.0,498.0,501.0,504.0,507.0,510.0,513.0,516.0,519.0,522.0,525.0,528.0,531.0,534.0,537.0,540.0,543.0,546.0,549.0,552.0,555.0,558.0,561.0,564.0,567.0,570.0,573.0,576.0,579.0,582.0,585.0,588.0,591.0,594.0,597.0,600.0,603.0,606.0,609.0,612.0,615.0,618.0,621.0,624.0,627.0,630.0,633.0,636.0,639.0,642.0,645.0,648.0,651.0,654.0,657.0,660.0,663.0,666.0,669.0,672.0,675.0,678.0,681.0,684.0,687.0,690.0,693.0,696.0,699.0,702.0,705.0,708.0,711.0,714.0,717.0,720.0,723.0,726.0,729.0,732.0,735.0,738.0,741.0,744.0,747.0,750.0,753.0,756.0,759.0,762.0,765.0,768.0,771.0,774.0,777.0,780.0,783.0,786.0,789.0,792.0,795.0,798.0,801.0,804.0,807.0,810.0,813.0,816.0,819.0,822.0,825.0,828.0,831.0,834.0,837.0,840.0,843.0,846.0,849.0,852.0,855.0,858.0,861.0,864.0,867.0,870.0,873.0,876.0,879.0,882.0,885.0,888.0,891.0,894.0,897.0,900.0,903.0,906.0,909.0,912.0,915.0,918.0,921.0,924.0,927.0,930.0,933.0,936.0,939.0,942.0,945.0,948.0,951.0,954.0,957.0,960.0,963.0,966.0,969.0,972.0,975.0,978.0,981.0,984.0,987.0,990.0,993.0,996.0,999.0,1002.0,1005.0,1008.0,1011.0,1014.0,1017.0,1020.0,1023.0,1026.0,1029.0,1032.0,1035.0,1038.0,1041.0,1044.0,1047.0,1050.0,1053.0,1056.0,1059.0,1062.0,1065.0,1068.0,1071.0,1074.0,1077.0,1080.0,1083.0,1086.0,1089.0,1092.0,1095.0,1098.0,1101.0,1104.0,1107.0,1110.0,1113.0,1116.0,1119.0,1122.0,1125.0,1128.0,1131.0,1134.0,1137.0,1140.0,1143.0,1146.0,1149.0,1152.0,1155.0,1158.0,1161.0,1164.0,1167.0,1170.0,1173.0,1176.0,1179.0,1182.0,1185.0,1188.0,1191.0,1194.0,1197.0,1200.0,1203.0,1206.0,1209.0,1212.0,1215.0,1218.0,1221.0,1224.0,1227.0,1230.0,1233.0,1236.0,1239.0,1242.0,1245.0,1248.0,1251.0,1254.0,1257.0,1260.0,1263.0,1266.0,1269.0,1272.0,1275.0,1278.0,1281.0,1284.0,1287.0,1290.0,1293.0,1296.0,1299.0,1302.0,1305.0,1308.0,1311.0,1314.0,1317.0,1320.0,1323.0,1326.0,1329.0,1332.0,1335.0,1338.0,1341.0,1344.0,1347.0,1350.0,1353.0,1356.0,1359.0,1362.0,1365.0,1368.0,1371.0,1374.0,1377.0,1380.0,1383.0,1386.0,1389.0,1392.0,1395.0,1398.0,1401.0,1404.0,1407.0,1410.0,1413.0,1416.0,1419.0,1422.0,1425.0,1428.0,1431.0,1434.0,1437.0,1440.0,1443.0,1446.0,1449.0,1452.0,1455.0,1458.0,1461.0,1464.0,1467.0,1470.0,1473.0,1476.0,1479.0,1482.0,1485.0,1488.0,1491.0,1494.0,1497.0,1500.0,1503.0,1506.0,1509.0,1512.0,1515.0,1518.0,1521.0,1524.0,1527.0,1530.0,1533.0,1536.0,1539.0,1542.0,1545.0,1548.0,1551.0,1554.0,1557.0,1560.0,1563.0,1566.0,1569.0,1572.0,1575.0,1578.0,1581.0,1584.0,1587.0,1590.0,1593.0,1596.0,1599.0,1602.0,1605.0,1608.0,1611.0,1614.0,1617.0,1620.0,1623.0,1626.0,1629.0,1632.0,1635.0,1638.0,1641.0,1644.0,1647.0,1650.0,1653.0,1656.0,1659.0,1662.0,1665.0,1668.0,1671.0,1674.0,1677.0,1680.0,1683.0,1686.0,1689.0,1692.0,1695.0,1698.0,1701.0,1704.0,1707.0,1710.0,1713.0,1716.0,1719.0,1722.0,1725.0,1728.0,1731.0,1734.0,1737.0,1740.0,1743.0,1746.0,1749.0,1752.0,1755.0,1758.0,1761.0,1764.0,1767.0,1770.0,1773.0,1776.0,1779.0,1782.0,1785.0,1788.0,1791.0,1794.0,1797.0,1800.0,1803.0,1806.0,1809.0,1812.0,1815.0,1818.0,1821.0,1824.0,1827.0,1830.0,1833.0,1836.0,1839.0,1842.0,1845.0,1848.0,1851.0,1854.0,1857.0,1860.0,1863.0,1866.0,1869.0,1872.0,1875.0,1878.0,1881.0,1884.0,1887.0,1890.0,1893.0,1896.0,1899.0,1902.0,1905.0,1908.0,1911.0,1914.0,1917.0,1920.0,1923.0,1926.0,1929.0,1932.0,1935.0,1938.0,1941.0,1944.0,1947.0,1950.0,1953.0,1956.0,1959.0,1962.0,1965.0,1968.0,1971.0,1974.0,1977.0,1980.0,1983.0,1986.0,1989.0,1992.0,1995.0,1998.0,2001.0,2004.0,2007.0,2010.0,2013.0,2016.0,2019.0,2022.0,2025.0,2028.0,2031.0,2034.0,2037.0,2040.0,2043.0,2046.0,2049.0,2052.0,2055.0,2058.0,2061.0,2064.0,2067.0,2070.0,2073.0,2076.0,2079.0,2082.0,2085.0,2088.0,2091.0,2094.0,2097.0,2100.0,2103.0,2106.0,2109.0,2112.0,2115.0,2118.0,2121.0,2124.0,2127.0,2130.0,2133.0,2136.0,2139.0,2142.0,2145.0,2148.0,2151.0,2154.0,2157.0,2160.0,2163.0,2166.0,2169.0,2172.0,2175.0,2178.0,2181.0,2184.0,2187.0,2190.0,2193.0,2196.0,2199.0,2202.0,2205.0,2208.0,2211.0,2214.0,2217.0,2220.0,2223.0,2226.0,2229.0,2232.0,2235.0,2238.0,2241.0,2244.0,2247.0,2250.0,2253.0,2256.0,2259.0,2262.0,2265.0,2268.0,2271.0,2274.0,2277.0,2280.0,2283.0,2286.0,2289.0,2292.0,2295.0,2298.0,2301.0,2304.0,2307.0,2310.0,2313.0,2316.0,2319.0,2322.0,2325.0,2328.0,2331.0,2334.0,2337.0,2340.0,2343.0,2346.0,2349.0,2352.0,2355.0,2358.0,2361.0,2364.0,2367.0,2370.0,2373.0,2376.0,2379.0,2382.0,2385.0,2388.0,2391.0,2394.0,2397.0,2400.0,2403.0,2406.0,2409.0,2412.0,2415.0,2418.0,2421.0,2424.0,2427.0,2430.0,2433.0,2436.0,2439.0,2442.0,2445.0,2448.0,2451.0,2454.0,2457.0,2460.0,2463.0,2466.0,2469.0,2472.0,2475.0,2478.0,2481.0,2484.0,2487.0,2490.0,2493.0,2496.0,2499.0,2502.0,2505.0,2508.0,2511.0,2514.0,2517.0,2520.0,2523.0,2526.0,2529.0,2532.0,2535.0,2538.0,2541.0,2544.0,2547.0,2550.0,2553.0,2556.0,2559.0,2562.0,2565.0,2568.0,2571.0,2574.0,2577.0,2580.0,2583.0,2586.0,2589.0,2592.0,2595.0,2598.0,2601.0,2604.0,2607.0,2610.0,2613.0,2616.0,2619.0,2622.0,2625.0,2628.0,2631.0,2634.0,2637.0,2640.0,2643.0,2646.0,2649.0,2652.0,2655.0,2658.0,2661.0,2664.0,2667.0,2670.0,2673.0,2676.0,2679.0,2682.0,2685.0,2688.0,2691.0,2694.0,2697.0,2700.0,2703.0,2706.0,2709.0,2712.0,2715.0,2718.0,2721.0,2724.0,2727.0,2730.0,2733.0,2736.0,2739.0,2742.0,2745.0,2748.0,2751.0,2754.0,2757.0,2760.0,2763.0,2766.0,2769.0,2772.0,2775.0,2778.0,2781.0,2784.0,2787.0,2790.0,2793.0,2796.0,2799.0,2802.0,2805.0,2808.0,2811.0,2814.0,2817.0,2820.0,2823.0,2826.0,2829.0,2832.0,2835.0,2838.0,2841.0,2844.0,2847.0,2850.0,2853.0,2856.0,2859.0,2862.0,2865.0,2868.0,2871.0,2874.0,2877.0,2880.0,2883.0,2886.0,2889.0,2892.0,2895.0,2898.0,2901.0,2904.0,2907.0,2910.0,2913.0,2916.0,2919.0,2922.0,2925.0,2928.0,2931.0,2934.0,2937.0,2940.0,2943.0,2946.0,2949.0,2952.0,2955.0,2958.0,2961.0,2964.0,2967.0,2970.0,2973.0,2976.0,2979.0,2982.0,2985.0,2988.0,2991.0,2994.0,2997.0,3000.0,3003.0,3006.0,3009.0,3012.0,3015.0,3018.0,3021.0,3024.0,3027.0,3030.0,3033.0,3036.0,3039.0,3042.0,3045.0,3048.0,3051.0,3054.0,3057.0,3060.0,3063.0,3066.0,3069.0],"y":[3.7718615645514055,3.769176206232646,3.767678887920786,3.766525485853095,3.7655379999677376,3.7646552219740563,3.7638456938140434,3.7630896029190155,3.762374591737599,3.76169316776679,3.761039435583843,3.7604096727043705,3.759800090366821,3.759207673460931,3.758630380378115,3.7580666478519253,3.7575150395557024,3.756974022255974,3.756442955759919,3.7559204570486586,3.7554062996388136,3.7548993645031405,3.7543994087859818,3.753905892827122,3.753418207134852,3.7529360228710016,3.7524590953893973,3.7519869261329317,3.7515192916052653,3.7510560004468436,3.750596678101553,3.7501411433581797,3.7496892189745257,3.7492406596966865,3.7487953113206296,3.748353024936904,3.747913629335854,3.7474770039980743,3.747043035652072,3.746611583182995,3.7461825576626975,3.7457558698478457,3.745331404437125,3.744909090623355,3.74448885451275,3.744070607173037,3.7436542885393354,3.7432398372821014,3.742827184786247,3.74241628053662,3.7420070727550754,3.7415994926010177,3.7411935108229115,3.740789088758163,3.740386192214443,3.7399847914319087,3.739584861044228,3.7391863156852674,3.7387891558105717,3.7383933653150305,3.737998925409238,3.7376058206583114,3.7372140389487365,3.7368235140243242,3.7364342284364307,3.7360461886255223,3.7356593825074755,3.735273800116625,3.7348894335838274,3.734506250912389,3.734124219250093,3.7337433513230027,3.733363638471774,3.7329850732940417,3.7326076496311873,3.7322313562676483,3.7318561671862764,3.7314820900415344,3.7311091193676442,3.7307372505316785,3.7303664797243417,3.7299968034990676,3.72962820420597,3.7292606872146092,3.7288942497998163,3.728528889834405,3.7281646057819553,3.7278013966894847,3.7274392507439433,3.7270781698335886,3.7267181546818833,3.7263592045569696,3.726001319115004,3.725644498395016,3.7252887358417492,3.724934029343374,3.7245803817859993,3.724227792945393,3.7238762628167557,3.723525791611663,3.7231763770581052,3.7228280155305242,3.722480709922119,3.7221344602010573,3.7217892664499557,3.721445128864185,3.7211020471405867,3.7207600183908074,3.7204190446265355,3.7200791259294252,3.7197402624405713,3.7194024543595314,3.719065701943336,3.7187300030225834,3.7183953589512386,3.718061769873671,3.71772923590403,3.717397757181535,3.7170673338699345,3.716737960929028,3.716409640471669,3.7160823739748623,3.7157561614731494,3.7154310030148485,3.715106898661637,3.7147838484881555,3.714461852581578,3.7141409110412016,3.713821023978006,3.7135021915142254,3.7131844137829244,3.71286769092754,3.7125520109611414,3.7122373777222624,3.7119237948162076,3.7116112618881267,3.7112997785722492,3.710989344491866,3.71067995925929,3.7103716224758334,3.7100643337317636,3.709758092606266,3.709452898667398,3.7091487514720463,3.708845650565872,3.7085435841290195,3.708242554370506,3.7079425645673,3.7076436136978734,3.707345700710685,3.707048824524535,3.706752984028921,3.706458178084368,3.706164405522781,3.705871665147764,3.705579955734961,3.705289276032364,3.7049996247606445,3.704710995488374,3.704423387725158,3.7041368020829646,3.703851236930052,3.703566690600121,3.703283161392801,3.7030006475741093,3.7027191473769285,3.702438659001456,3.7021591806156597,3.701880710355719,3.7016032463264636,3.7013267866017965,3.7010513284750357,3.7007768700232013,3.7005034095615277,3.700230945006277,3.699959474243418,3.6996889951290175,3.699419505489661,3.6991510031228256,3.698883485797274,3.6986169512534177,3.698351397203695,3.6980868213329234,3.697823221298643,3.6975605947201435,3.697298939200696,3.697038252323231,3.696778531638433,3.6965197746712253,3.696261978921058,3.696005141862183,3.695749260943927,3.695494333590958,3.695240357203532,3.6949873291577386,3.6947352468057275,3.6944841074759447,3.6942339079817517,3.6939846455567524,3.6937363177420517,3.693488921745441,3.693242454750905,3.692996913918799,3.692752296386013,3.692508599266121,3.6922658196495264,3.6920239546035796,3.6917830011727037,3.6915429563784934,3.691303817219802,3.6910655802815016,3.690828242413769,3.6905918007856355,3.690356252268585,3.690121593708877,3.689887821927474,3.6896549337199764,3.6894229258565208,3.689191795081676,3.6889615381143215,3.6887321516475025,3.6885036323482905,3.6882759768575957,3.6880491823619947,3.6878232455703572,3.6875981625905703,3.6873739299790467,3.687150544265939,3.6869280019548727,3.686706299522654,3.6864854334189605,3.6862654000660156,3.686046195858222,3.6858278171617944,3.6856102603143484,3.6853935216244835,3.685177597371324,3.6849624838040373,3.6847481771413433,3.684534673570958,3.684321969249048,3.6841100602996355,3.683898942813968,3.683688613466338,3.6834790691981434,3.6832703048803297,3.683062316505471,3.6828551000316434,3.68264865138162,3.682442966442048,3.6822380410625697,3.6820338710549136,3.6818304521919356,3.681627780206634,3.6814258507910997,3.6812246595954328,3.681024202226611,3.680824474247307,3.680625471174666,3.6804271884790123,3.6802296215825203,3.680032765857827,3.6798366166265857,3.6796411692815285,3.679446419861039,3.679252362793308,3.6790589932020263,3.678866306152981,3.678674296652279,3.6784829596444917,3.678292290010745,3.678102282566724,3.677912932060618,3.677724233170971,3.6775361805044713,3.677348768593654,3.6771619918945078,3.6769758447840193,3.6767903215576094,3.6766054164264896,3.6764211235149196,3.6762374368573676,3.6760543503955807,3.675871857975541,3.675689953096365,3.675508629586876,3.675327880999506,3.6751477007614186,3.674968082187256,3.6747890184754697,3.6746105027045077,3.674432527828889,3.674255086675134,3.6740781719375857,3.6739017761740826,3.6737258918014923,3.6735505110911135,3.6733756261639257,3.673201228985689,3.6730273113618965,3.6728538649325797,3.672680881166929,3.6725083513577794,3.6723362666159223,3.6721646176172826,3.6719933951923447,3.6718225899442056,3.6716521921889953,3.671482192029505,3.671312579348434,3.671143343801449,3.670974474810045,3.6708059615541977,3.670637792964857,3.670469957716194,3.670302444217669,3.670135240605895,3.6699683347362844,3.669801714174489,3.669635366187627,3.6694692777353084,3.669303435460423,3.669137825679748,3.6689724343743095,3.6688072472878703,3.6686422497172564,3.6684774264980726,3.6683127621729184,3.668148240897695,3.667983846430751,3.667819562121811,3.667655370900737,3.6674912552660865,3.6673271972734858,3.667163178523851,3.666999180151424,3.666835182811678,3.6666711666690577,3.6665071113846057,3.666342996103485,3.6661787994423687,3.6660144994767925,3.6658500737284077,3.665685499152224,3.66552075225199,3.6653558089851264,3.66519064432196,3.6650252328348323,3.6648595484668745,3.6646935645196344,3.664527253640883,3.664360587812631,3.664193538339413,3.664026075836875,3.663858170220726,3.663689790696099,3.663520905747385,3.663351483128595,3.6631814898543222,3.6630108921913846,3.6628396556511764,3.6626677449828757,3.6624951241675303,3.662321756413143,3.6621476041730245,3.661972629228852,3.661796792345881,3.661620053621636,3.6614423723751943,3.661263707150378,3.661084015720709,3.6609032550962017,3.66072138153218,3.6605383505402,3.660354116901261,3.6601686346814164,3.6599818572499583,3.6597937373003093,3.659604226873774,3.65941327738633,3.6592208396586003,3.65902686394915,3.6588312999913164,3.6586340970336915,3.658435203884443,3.6582345684069977,3.6580321391283586,3.657827863862732,3.6576216901756493,3.6574135654763738,3.657203437088414,3.656991252324868,3.6567769585687526,3.6565605033583837,3.656341834477911,3.656120900053077,3.655897648652244,3.6556720293927323,3.655443992052459,3.6552134871868764,3.654980466251162,3.6547448817275776,3.6545066872579017,3.6542658377807835,3.654022289673859,3.6537760009003835,3.653526931160166,3.6532750420444597,3.653020297194505,3.6527626624633074,3.65250210608024,3.65223859881795,3.65197211416107,3.651702628476136,3.6514301211820723,3.651154574920585,3.650875975725695,3.6505943131916965,3.6503095806386536,3.6500217752746393,3.649730898353759,3.649436955329077,3.6491399559994666,3.64883991159869,3.6485368435706613,3.6482307756387993,3.647921736271407,3.647609758890309,3.6472948819602298,3.6469771490650835,3.646656608970194,3.646333315669565,3.646007328417294,3.645678711742349,3.64534753544595,3.6450138745808993,3.644677809412271,3.6443394253589902,3.643998812915923,3.643656067556191,3.6433112896135937,3.642964584145101,3.642616060773519,3.6422658335105824,3.6419140205608524,3.6415607441069273,3.6412061300766365,3.6408503078929875,3.6404934102078164,3.6401355726201707,3.6397769333806074,3.6394176330827004,3.6390578143431416,3.6386976214719278,3.638337200134196,3.6379766970053833,3.6376162594213555,3.6372560350252967,3.636896171413104,3.63653681577908,3.6361781145636978,3.63582020937735,3.6354632474116473,3.635107370858091,3.6347527197170244,3.6343994315661807,3.634047641256297,3.6336974806199533,3.6333490781948887,3.6330025589629384,3.6326580441056064,3.632315650777119,3.6319754918957576,3.631637675954043,3.631302306848251,3.630969483727608,3.6306393008633515,3.630311847537717,3.6299872079528113,3.6296654611591537,3.6293466810036157,3.6290309360963144,3.628718289795967,3.6284088002131005,3.6281025202304056,3.6277994975394825,3.6274997746931597,3.627203389172481,3.6269103734674375,3.626620755170483,3.6263345570818473,3.6260517973256166,3.6257724894755867,3.6254966426898565,3.62522426185316,3.6249553477259244,3.6246898970991004,3.6244279029537863,3.6241693546247467,3.6239142370724835,3.62366253367632,3.623414223849326,3.6231692840249465,3.6229276878366905,3.622689406287822,3.6224544079196526,3.622222658977867,3.6219941235763655,3.6217687638581415,3.6215465401527864,3.6213274111302525,3.6211113339505276,3.620898264408945,3.6206881570768994,3.6204809654377392,3.6202766420176915,3.6200751385116896,3.6198764059039945,3.61968039458355,3.6194870544540545,3.6192963350387095,3.619108185579688,3.6189225551323445,3.618739392654221,3.6185586470889546,3.6183802674451275,3.6182042028702153,3.6180304027197123,3.617858816621599,3.617689394536245,3.61752208681193,3.617356844236108,3.617193618082591,3.6170323601547887,3.6168730228251627,3.6167155590711015,3.616559922507378,3.6164060674469294,3.6162539488339576,3.616103522357524,3.6159547444423237,3.6158075722662226,3.6156619637752883,3.615517877696448,3.6153752735479396,3.6152341116476574,3.615094353119557,3.6149559598982486,3.6148188947318673,3.6146831211833885,3.614548603630464,3.6144153072639083,3.6142831980849377,3.614152242901257,3.6140224093220827,3.6138936657522165,3.6137659813852254,3.613639326195834,3.6135136709315896,3.6133889871038707,3.613265246978338,3.6131424235648404,3.6130204906068863,3.6128994225706963,3.6127791946339283,3.612659782674086,3.612541163256693,3.6124233136232418,3.6123062116789897,3.6121898359806073,3.6120741657237434,3.6119591807305174,3.611844861436973,3.6117311888805284,3.61161814468652,3.6115057109972635,3.6113938706373028,3.6112826069245836,3.6111719037163037,3.6110617453967544,3.6109521168652745,3.610843003524337,3.6107343912678056,3.6106262664693163,3.6105186159708462,3.610411427071438,3.6103046875161127,3.6101983854849675,3.6100925095824423,3.6099870488268064,3.6098819926398162,3.6097773308365824,3.6096730536156274,3.6095691515491475,3.609465615573479,3.6093624369797457,3.6092596074047325,3.6091571188219276,3.609054963532789,3.6089531341581873,3.6088516236300388,3.6087504251831612,3.6086495323472665,3.6085489389391863,3.6084486390552524,3.6083486270638625,3.608248897598226,3.6081494455492775,3.6080502660587617,3.6079513545124757,3.6078527065336856,3.607754317976691,3.6076561849205397,3.607558303662898,3.6074606707140684,3.6073632827911326,3.6072661368122536,3.60716922989109,3.607072559331352,3.6069761226214703,3.606879917429404,3.6067839415975347,3.6066881931377006,3.606592670226326,3.606497371199651,3.606402294549069,3.6063074389165535,3.60621280309018,3.606118385999733,3.6060241867124,3.6059302044285415,3.6058364384775454,3.605742888313736,3.605649553512379,3.605556433765723,3.6054635288791284,3.6053708387672327,3.6052783634501857,3.6051861030499293,3.6050940577865296,3.6050022279745444,3.6049106140194476,3.6048192164140755,3.604728035735127,3.6046370726396746,3.6045463278617222,3.6044558022087845,3.6043654965584833,3.60427541185518,3.6041855491066035,3.604095909380519,3.6040064938013967,3.603917303547081,3.6038283398454927,3.6037396039093723,3.603651096918691,3.6035628204220327,3.6034747758144903,3.603386964524714,3.6032993880115955,3.603212047760957,3.6031249452822154,3.603038082105044,3.602951459776024,3.6028650798552717,3.6027789439130564,3.6026930535263952,3.6026074102756365,3.602522015741005,3.602436871499147,3.6023519791196303,3.6022673401614322,3.602182956169392,3.6020988286706435,3.602014959171015,3.60193134915139,3.6018480000640603,3.6017649133290153,3.601682090330231,3.601599532411899,3.6015172408746357,3.6014352169716566,3.601353461904902,3.60127197682115,3.6011907628080686,3.6011098208902474,3.6010291520251854,3.6009487570992476,3.6008686369235803,3.6007887922299866,3.6007092236667737,3.6006299317945567,3.6005509170820296,3.600472179901696,3.600393720525569,3.600315539120839,3.60023763574549,3.6001600103439095,3.6000826627424405,3.600005592644915,3.59992879962815,3.599852283137424,3.5997760424819107,3.5997000768300893,3.5996243852051384,3.5995489664802927,3.5994738193741838,3.5993989424461494,3.5993243340915413,3.599249992536993,3.599175915835687,3.5991021018625986,3.5990285483097337,3.598955252681348,3.5988822122891704,3.598809424247608,3.598736885468955,3.598664592658601,3.5985925423102305,3.5985207307010456,3.598449153886978,3.5983778076979207,3.5983066877329644,3.598235789355659,3.5981651076892853,3.5980946376121525,3.5980243737529163,3.5979543104859304,3.5978844419266216,3.597814761926908,3.5977452640706433,3.597675941669112,3.5976067877565616,3.597537795085788,3.597468956102861,3.5974002629820743,3.59733170762965,3.5972632816294587,3.5971949762626485,3.5971267825035764,3.597058691015818,3.596990692148254,3.596922775931232,3.596854932072804,3.596787149955058,3.5967194186305296,3.59665172681871,3.5965840629026475,3.5965164149256448,3.596448770588052,3.596381117244175,3.596313441899275,3.596245731206687,3.596177971465046,3.596110148615625,3.5960422482397876,3.595974255556562,3.595906155420337,3.5958379323186676,3.5957695703702157,3.595701053322808,3.5956323645516233,3.595563487057506,3.595494403465401,3.595425096022921,3.5953555465990457,3.595285736682942,3.5952156473829087,3.595145259425461,3.595074553154528,3.595003508530786,3.5949321051311007,3.594860322148108,3.594788138389906,3.5947155322798605,3.5946424818565292,3.594568964773693,3.594494958300509,3.594420439321739,3.594345384338102,3.5942697694667136,3.594193570441604,3.594116762614332,3.59403932095467,3.593961220051358,3.593882434112928,3.593802936968572,3.593722702069067,3.5936417024877385,3.593559910921448,3.5934772996916147,3.5933938407452186,3.593309505655844,3.593224265624678,3.5931380914815034,3.593050953685649,3.592962822326893,3.592873667126315,3.59278345743705,3.592692162244982,3.592599750169303,3.592506189462974,3.592411448013035,3.5923154933407675,3.5922182926016877,3.592119812585328,3.5920200197148473,3.5919188800463746,3.59181635926813,3.5917124226992603,3.5916070352883906,3.5915001616118563,3.5913917658716037,3.5912818118927263,3.591170263124485,3.5910570826252126,3.59094223306843,3.5908256767388456,3.590707375525693,3.5905872909175605,3.5904653839966754,3.5903416154326084,3.5902159454753644,3.59008833394784,3.589958740237607,3.5898271232879777,3.589693441588348,3.589557653163745,3.5894197155635745,3.589279585849517,3.589137220582529,3.5889925758089265,3.588845607045489,3.5886962692635658,3.588544516872126,3.5883903036997102,3.58823358297525,3.588074307307686,3.5879124286643713,3.5877478983481836,3.5875806669732895,3.5874106844395586,3.587237899905511,3.587062261759784,3.5868837175910526,3.58670221415634,3.5865176973476784,3.5863301121570212,3.5861394026393865,3.58594551187414,3.585748381924362,3.5855479537942245,3.585344167384314,3.585136961444815,3.584926273526501,3.5847120399294283,3.584494195649284,3.584272674321271,3.5840474081614744,3.5838183279056137,3.583585362745075,3.5833484402601647,3.583107486350439,3.582862425162064,3.582613179012065,3.5823596683093712,3.58210181147256,3.581839524844152,3.581572722601398,3.5813013166633683,3.581025216594282,3.5807443295029007,3.580458559937896,3.580167809779003,3.579871978123862,3.579570961170396,3.579264652094534,3.5789529409231653,3.5786357144021514,3.578312855859218,3.5779842450615513,3.5776497580679414,3.5773092670752593,3.576962640259098,3.576609741608364,3.576250430753619,3.5758845627889637,3.5755119880872432,3.5751325521083364,3.5747460952003105,3.5743524523931898,3.573951453185087,3.573542921320444,3.573126674560112,3.572702524640815,3.572270276465497,3.5718297283633755,3.5713806716891643,3.5709228905319685,3.5704561614302777,3.5699802530766473,3.569494926011739,3.5689999323073742,3.5684950152382138,3.5679799089416857,3.5674543380657995,3.5669180174043893,3.5663706515194287,3.5658119343499535,3.565241548807155,3.5646591663552067,3.5640644465773432,3.5634570367267107,3.5628365712615078,3.562202671363896,3.561554944442164,3.5608929836156142,3.5602163671816114,3.5595246580642335,3.5588174032439563,3.5580941331677707,3.5573543611391045,3.556597582686985,3.5558232749137333,3.5550308958205954,3.5542198836106293,3.5533896559681546,3.552539609314101,3.5516691180365316,3.5507775336956264,3.549864184202412,3.5489283729704733,3.5479693780399244,3.546986451172847,3.5459788169194564,3.544945671654186,3.5438861825809433,3.5427994867067056,3.541684689782696,3.5405408652123276,3.539367052925109,3.538162258215746,3.536925450547619,3.535655562319864,3.534351487597278,3.533012080802294,3.531636155368258,3.5302224823533006,3.5287697890140786,3.527276757338716,3.525742022538285,3.5241641714962397,3.5225417411751994,3.5208732169805828,3.5191570310806144,3.517391560682302,3.515575126263033,3.513705989757555,3.511782352700121,3.5098023543217454,3.5077640696025907,3.5056655072795855,3.5035046078095644,3.5012792412883282,3.498987205326123,3.496626222880305,3.494193940046029,3.491687923806099,3.4891056597411696,3.4864445497019516,3.4837019094450676,3.480874966234644,3.4779608564119453,3.474956622892106,3.471859212527142,3.4686654742489043,3.4653721558583497,3.461975901705823,3.4584732501363655,3.4548606309292436,3.4511343627370987,3.4472906505308396,3.4433255830567258,3.4392351303128232,3.4350151410526326,3.4306613403242405,3.4261693270541795,3.4215345716857706,3.416752413882631,3.4118180603086814,3.4067265824969937,3.401472914820522,3.3960518525788097,3.3904580502156842,3.3846860196838753,3.3787301289735594,3.3725846008229676,3.3662435116300147,3.35970079058539,3.3529502190483123,3.345985430187511,3.3387999089112084,3.331386992110717,3.3237398692439375,3.3158515832856787,3.3077150320733546,3.2993229700773274,3.290668010626538,3.281742628621023,3.272539163763843,3.263049824345962,3.2532666916183794,3.2431817247866057,3.2327867666630143,3.222073550013326,3.211033704633487,3.1996587651936053,3.1879401798851035,3.1758693199074677,3.1634374898299,3.1506359388625316,3.1374558730706346,3.123888468563805,3.109924885690046]},{"type":"scatter","name":"current = 1 A","mode":"lines","x":[0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0,30.0,33.0,36.0,39.0,42.0,45.0,48.0,51.0,54.0,57.0,60.0,63.0,66.0,69.0,72.0,75.0,78.0,81.0,84.0,87.0,90.0,93.0,96.0,99.0,102.0,105.0,108.0,111.0,114.0,117.0,120.0,123.0,126.0,129.0,132.0,135.0,138.0,141.0,144.0,147.0,150.0,153.0,156.0,159.0,162.0,165.0,168.0,171.0,174.0,177.0,180.0,183.0,186.0,189.0,192.0,195.0,198.0,201.0,204.0,207.0,210.0,213.0,216.0,219.0,222.0,225.0,228.0,231.0,234.0,237.0,240.0,243.0,246.0,249.0,252.0,255.0,258.0,261.0,264.0,267.0,270.0,273.0,276.0,279.0,282.0,285.0,288.0,291.0,294.0,297.0,300.0,303.0,306.0,309.0,312.0,315.0,318.0,321.0,324.0,327.0,330.0,333.0,336.0,339.0,342.0,345.0,348.0,351.0,354.0,357.0,360.0,363.0,366.0,369.0,372.0,375.0,378.0,381.0,384.0,387.0,390.0,393.0,396.0,399.0,402.0,405.0,408.0,411.0,414.0,417.0,420.0,423.0,426.0,429.0,432.0,435.0,438.0,441.0,444.0,447.0,450.0,453.0,456.0,459.0,462.0,465.0,468.0,471.0,474.0,477.0,480.0,483.0,486.0,489.0,492.0,495.0,498.0,501.0,504.0,507.0,510.0,513.0,516.0,519.0,522.0,525.0,528.0,531.0,534.0,537.0,540.0,543.0,546.0,549.0,552.0,555.0,558.0,561.0,564.0,567.0,570.0,573.0,576.0,579.0,582.0,585.0,588.0,591.0,594.0,597.0,600.0,603.0,606.0,609.0,612.0,615.0,618.0,621.0,624.0,627.0,630.0,633.0,636.0,639.0,642.0,645.0,648.0,651.0,654.0,657.0,660.0,663.0,666.0,669.0,672.0,675.0,678.0,681.0,684.0,687.0,690.0,693.0,696.0,699.0,702.0,705.0,708.0,711.0,714.0,717.0,720.0,723.0,726.0,729.0,732.0,735.0,738.0,741.0,744.0,747.0,750.0,753.0,756.0,759.0,762.0,765.0,768.0,771.0,774.0,777.0,780.0,783.0,786.0,789.0,792.0,795.0,798.0,801.0,804.0,807.0,810.0,813.0,816.0,819.0,822.0,825.0,828.0,831.0,834.0,837.0,840.0,843.0,846.0,849.0,852.0,855.0,858.0,861.0,864.0,867.0,870.0,873.0,876.0,879.0,882.0,885.0,888.0,891.0,894.0,897.0,900.0,903.0,906.0,909.0,912.0,915.0,918.0,921.0,924.0,927.0,930.0,933.0,936.0,939.0,942.0,945.0,948.0,951.0,954.0,957.0,960.0,963.0,966.0,969.0,972.0,975.0,978.0,981.0,984.0,987.0,990.0,993.0,996.0,999.0,1002.0,1005.0,1008.0,1011.0,1014.0,1017.0,1020.0,1023.0,1026.0,1029.0,1032.0,1035.0,1038.0,1041.0,1044.0,1047.0,1050.0,1053.0,1056.0,1059.0,1062.0,1065.0,1068.0,1071.0,1074.0,1077.0,1080.0,1083.0,1086.0,1089.0,1092.0,1095.0,1098.0,1101.0,1104.0,1107.0,1110.0,1113.0,1116.0,1119.0,1122.0,1125.0,1128.0,1131.0,1134.0,1137.0,1140.0,1143.0,1146.0,1149.0,1152.0,1155.0,1158.0,1161.0,1164.0,1167.0,1170.0,1173.0,1176.0,1179.0,1182.0,1185.0,1188.0,1191.0,1194.0,1197.0,1200.0,1203.0,1206.0,1209.0,1212.0,1215.0,1218.0,1221.0,1224.0,1227.0,1230.0,1233.0,1236.0,1239.0,1242.0,1245.0,1248.0,1251.0,1254.0,1257.0,1260.0,1263.0,1266.0,1269.0,1272.0,1275.0,1278.0,1281.0,1284.0,1287.0,1290.0,1293.0,1296.0,1299.0,1302.0,1305.0,1308.0,1311.0,1314.0,1317.0,1320.0,1323.0,1326.0,1329.0,1332.0,1335.0,1338.0,1341.0,1344.0,1347.0,1350.0,1353.0,1356.0,1359.0,1362.0,1365.0,1368.0,1371.0,1374.0,1377.0,1380.0,1383.0,1386.0,1389.0,1392.0,1395.0,1398.0,1401.0,1404.0,1407.0,1410.0,1413.0,1416.0,1419.0,1422.0,1425.0,1428.0,1431.0,1434.0,1437.0,1440.0,1443.0,1446.0,1449.0,1452.0,1455.0,1458.0,1461.0,1464.0,1467.0,1470.0,1473.0,1476.0,1479.0,1482.0,1485.0,1488.0,1491.0,1494.0,1497.0,1500.0,1503.0,1506.0,1509.0,1512.0,1515.0,1518.0,1521.0,1524.0,1527.0,1530.0,1533.0,1536.0,1539.0,1542.0,1545.0,1548.0,1551.0,1554.0,1557.0,1560.0,1563.0,1566.0,1569.0,1572.0,1575.0,1578.0,1581.0,1584.0,1587.0,1590.0,1593.0,1596.0,1599.0,1602.0,1605.0,1608.0,1611.0,1614.0,1617.0,1620.0,1623.0,1626.0,1629.0,1632.0,1635.0,1638.0,1641.0,1644.0,1647.0,1650.0,1653.0,1656.0,1659.0,1662.0,1665.0,1668.0,1671.0,1674.0,1677.0,1680.0,1683.0,1686.0,1689.0,1692.0,1695.0,1698.0,1701.0,1704.0,1707.0,1710.0,1713.0,1716.0,1719.0,1722.0,1725.0,1728.0,1731.0,1734.0,1737.0,1740.0,1743.0,1746.0,1749.0,1752.0,1755.0,1758.0,1761.0,1764.0,1767.0,1770.0,1773.0,1776.0,1779.0,1782.0,1785.0,1788.0,1791.0,1794.0,1797.0,1800.0,1803.0,1806.0,1809.0,1812.0,1815.0,1818.0,1821.0,1824.0,1827.0,1830.0,1833.0,1836.0,1839.0,1842.0,1845.0,1848.0,1851.0,1854.0,1857.0,1860.0,1863.0,1866.0,1869.0,1872.0,1875.0,1878.0,1881.0,1884.0,1887.0,1890.0,1893.0,1896.0,1899.0,1902.0,1905.0,1908.0,1911.0,1914.0,1917.0,1920.0,1923.0,1926.0,1929.0,1932.0,1935.0,1938.0,1941.0,1944.0,1947.0,1950.0,1953.0,1956.0,1959.0,1962.0,1965.0,1968.0,1971.0,1974.0,1977.0,1980.0,1983.0,1986.0,1989.0,1992.0,1995.0,1998.0,2001.0,2004.0,2007.0,2010.0,2013.0,2016.0,2019.0,2022.0,2025.0,2028.0,2031.0,2034.0,2037.0,2040.0,2043.0,2046.0,2049.0,2052.0,2055.0,2058.0,2061.0,2064.0,2067.0,2070.0,2073.0,2076.0,2079.0,2082.0,2085.0,2088.0,2091.0,2094.0,2097.0,2100.0,2103.0,2106.0,2109.0,2112.0,2115.0,2118.0,2121.0,2124.0,2127.0,2130.0,2133.0,2136.0,2139.0,2142.0,2145.0,2148.0,2151.0,2154.0,2157.0,2160.0,2163.0,2166.0,2169.0,2172.0,2175.0,2178.0,2181.0,2184.0,2187.0,2190.0,2193.0,2196.0,2199.0,2202.0,2205.0,2208.0,2211.0,2214.0,2217.0,2220.0,2223.0,2226.0,2229.0,2232.0,2235.0,2238.0,2241.0,2244.0,2247.0,2250.0,2253.0,2256.0,2259.0,2262.0,2265.0,2268.0,2271.0,2274.0,2277.0,2280.0,2283.0,2286.0,2289.0,2292.0,2295.0,2298.0,2301.0,2304.0,2307.0,2310.0,2313.0,2316.0,2319.0,2322.0,2325.0,2328.0,2331.0,2334.0,2337.0,2340.0,2343.0,2346.0,2349.0,2352.0,2355.0,2358.0,2361.0,2364.0,2367.0,2370.0,2373.0,2376.0,2379.0,2382.0,2385.0,2388.0,2391.0,2394.0,2397.0,2400.0,2403.0,2406.0,2409.0,2412.0,2415.0,2418.0,2421.0,2424.0,2427.0,2430.0,2433.0,2436.0,2439.0],"y":[3.759844477986391,3.7565037801639516,3.754641511885395,3.7532072402961623,3.751982748728272,3.7508868051426933,3.749883240238255,3.748946359173046,3.748060916019682,3.747217569587974,3.7464090027014922,3.745629152726763,3.7448741105073124,3.7441411214880405,3.743427157972796,3.7427305154343755,3.7420491403649705,3.7413816970133573,3.7407267648455163,3.7400832396593846,3.739450183255195,3.7388267411809246,3.7382122295551907,3.7376059838883533,3.737007458755615,3.7364161455683935,3.7358315859085898,3.7352533745696967,3.734681091210749,3.7341144518160414,3.733553192930573,3.7329969660855498,3.732445522372481,3.7318986995659347,3.7313563044196236,3.7308180229793115,3.730283762807628,3.7297533866942967,3.729226681949317,3.7287035028419875,3.7281837466986367,3.7276672925370935,3.7271539884991953,3.7266437514994455,3.726136488488167,3.7256320968515397,3.7251304942695245,3.724631611108935,3.7241353767261036,3.723641710530524,3.72315056272936,3.72266188155975,3.722175599638383,3.7216916687302,3.7212100484139916,3.7207306948389833,3.7202535564839647,3.719778601923214,3.7193057971291,3.7188351041054823,3.7183664927550777,3.7178999362345437,3.7174354077468177,3.7169728793528227,3.7165123306916343,3.71605374168575,3.715597088755128,3.7151423544184112,3.714689522999101,3.714238573992593,3.7137894835563863,3.7133422470237045,3.7128968527833,3.712453290699427,3.712011552089707,3.711571629702652,3.7111335132863155,3.7106971592770357,3.7102625855523472,3.7098297859319143,3.709398755246555,3.7089694893214222,3.7085419849590124,3.708116239921979,3.7076922100113943,3.7072699100923807,3.7068493402075156,3.7064304967341126,3.706013376600816,3.705597977277721,3.705184296766424,3.704772313834964,3.7043620245626494,3.7039534334717166,3.703546537332887,3.7031413331874172,3.702737818342136,3.702335990364401,3.701935841333057,3.7015373624645314,3.7011405566475144,3.7007454209280213,3.7003519524876336,3.699960148640798,3.699570006832117,3.699181523325132,3.6987946897036648,3.6984095071860263,3.6980259729325624,3.6976440841679055,3.697263838179457,3.6968852323158563,3.6965082639854305,3.696132924375583,3.695759213976157,3.6953871299142973,3.6950166691555055,3.6946478286756244,3.694280605460296,3.6939149965043785,3.693550995778937,3.6931886001662617,3.6928278068700706,3.69246861218916,3.6921110123378984,3.6917550034417346,3.6914005815328315,3.691047745530215,3.690696492447589,3.6903468156777812,3.6899987110675245,3.6896521743641766,3.6893072012122756,3.6889637871501626,3.688621927606735,3.6882816178982853,3.6879428532254295,3.687605628670134,3.687269939192833,3.6869357796296276,3.6866031446895806,3.6862720289520836,3.6859424417597704,3.6856143718645225,3.6852878101209168,3.684962751304356,3.6846391900929714,3.684317121066043,3.6839965387024654,3.683677437379249,3.6833598113700265,3.683043654843602,3.6827289618625123,3.6824157263816075,3.6821039422466546,3.6817936031929444,3.68148470328617,3.6811772570375245,3.6808712423429926,3.680566653246895,3.680263483723811,3.679961727677961,3.6796613789425097,3.6793624312788555,3.6790648783758715,3.6787687138490894,3.6784739312398416,3.6781805240143592,3.6778884855627973,3.677597809198221,3.677308488155518,3.6770205178354933,3.67673389621865,3.6764486116187967,3.676164657259677,3.675882026299935,3.6756007118319447,3.6753207068805374,3.6750420044016283,3.6747645972807508,3.6744884783314866,3.674213640293779,3.673940075832141,3.673667777533754,3.6733967379064274,3.673126949376456,3.6728584036648577,3.672591092878389,3.6723250096043047,3.6720601458758346,3.671796493629464,3.671534044701912,3.6712727908269405,3.6710127236320256,3.6707538346348265,3.6704961152394917,3.6702395567327795,3.669984150279978,3.6697298869206287,3.669476757564036,3.669224752984565,3.6689738630229196,3.6687240785217066,3.6684753899595473,3.6682277874835822,3.667981261076985,3.6677358005527614,3.667491395547268,3.6672480355134396,3.6670057097137096,3.6667644072126104,3.6665241168690597,3.666284827328285,3.666046527013414,3.6658092041166803,3.6655728467001887,3.66533744438707,3.665102983177203,3.664869450321942,3.6646368327973673,3.6644051172931844,3.664174290201165,3.6639443376031138,3.6637152452583246,3.663486998590538,3.663259582674361,3.6630329822211465,3.6628071815643013,3.662582164644012,3.6623579149913894,3.6621344162480423,3.661911652008837,3.661689603545475,3.661468252653704,3.661247580636667,3.661027568285335,3.6608081958582166,3.6605894430603545,3.6603712890215774,3.660153712274009,3.659936690728809,3.659720201652146,3.6595042216403724,3.6592887265944105,3.659073691693342,3.6588590912417986,3.658644898866353,3.658431087479231,3.6582176290789974,3.658004494797551,3.65779165486896,3.6575790785974953,3.657366734324917,3.657154589397012,3.6569426101294296,3.656730761772808,3.656519008477281,3.6563073132563675,3.6560956379503033,3.6558839431888748,3.655672187118382,3.6554603285432536,3.6552483244182676,3.6550361301143215,3.6548236995980687,3.6546109853932487,3.654397938542202,3.6541845085677025,3.653970643435259,3.653756289516087,3.6535413915509194,3.653325892614891,3.6531097340837237,3.6528928556014537,3.652675195049998,3.652456688520844,3.6522372702891825,3.6520168727908415,3.6517954266023755,3.651572860424732,3.6513490987706545,3.6511240680126633,3.6508976913551465,3.6506698898383867,3.650440582607203,3.6502096869253653,3.6499771181971354,3.64974278999654,3.649506614105038,3.649268500558273,3.64902835770257,3.6487860922619677,3.648541609416463,3.6482948128922468,3.6480456050647203,3.6477938870750273,3.647539558960893,3.647282519802538,3.6470226678844035,3.64675990087342,3.6464941136635605,3.646225204878277,3.645953071622816,3.6456776111333613,3.645398721181994,3.645116300366526,3.64483024842043,3.6445404665430337,3.644246857749955,3.6439493272436154,3.6436477828035194,3.6433421351957436,3.6430322986009473,3.6427181910599074,3.6423997349354185,3.642076857389088,3.641749490871323,3.6414175736225163,3.641081050183145,3.640739871910232,3.6403939956246734,3.640043389266107,3.6396880277142,3.6393278947130043,3.638962983386519,3.638593296723328,3.6382188480418867,3.6378396614318107,3.63745577216649,3.637067227082167,3.636674084918655,3.6362764166168313,3.6358743055681653,3.635467847811668,3.635057152173836,3.634642340347519,3.6342235469059143,3.633800919248411,3.6333746174753934,3.632944814183017,3.6325116939530657,3.6320754535305366,3.63163630103677,3.631194455544771,3.6307501465048646,3.630303613098547,3.6298551035235382,3.629404874213855,3.628953188999537,3.6285003182113464,3.628046537736529,3.6275921280322945,3.6271373731042433,3.626682559457428,3.6262279750281325,3.625773908104628,3.6253206462454006,3.6248684752033475,3.6244176778643253,3.623968533795169,3.6235213224539957,3.6230763065449874,3.6226337474293433,3.622193898782098,3.621757005775664,3.6213233043257174,3.6208930204037224,3.6204663694195727,3.6200435556770683,3.6196247719040535,3.6192101988582897,3.618800005009331,3.6183943462958608,3.6179933659573194,3.6175971944379133,3.6172059493605144,3.616819735567438,3.616438645224569,3.616062757984957,3.6156921412076297,3.6153268502271376,3.6149669286691517,3.6146124088073206,3.614263311956538,3.6139196488977734,3.613581420329684,3.613248617342338,3.6129212219085085,3.612599207388241,3.6122825390425457,3.6119711745523713,3.6116650645392503,3.6113641530842986,3.611068381629757,3.6107776802094813,3.6104919755935554,3.6102111907465355,3.609935244567255,3.6096640523444874,3.6093975261957856,3.6091355754883527,3.6088781072411322,3.6086250265074407,3.6083762367377106,3.6081316401220906,3.6078911379128042,3.6076546307263175,3.6074220188255004,3.607193202382108,3.606968081719955,3.606746557539301,3.6065285311229984,3.6063139045250314,3.606102580742117,3.6058944638690846,3.605689459238767,3.6054874735471603,3.605288414964623,3.6050921932338964,3.604898719755683,3.6047079076625996,3.604519671882193,3.6043339291897993,3.604150598251932,3.6039695996609176,3.603790855961397,3.6036142923703767,3.603439835313124,3.6032674127070923,3.603096955030336,3.602928394745861,3.602761666291975,3.602596706068419,3.6024334524187203,3.6022718456091836,3.602111827804885,3.6019533430430557,3.601796337204162,3.601640757981016,3.6014865548461823,3.6013336790179475,3.601182083425127,3.6010317226708635,3.6008825529956967,3.600734532240041,3.6005876198062574,3.60044177662046,3.6002969650942274,3.6001531490862995,3.600010293864401,3.5998683660672826,3.59972733366708,3.5995871659320327,3.599447833389682,3.5993093077905707,3.5991715620725047,3.5990345703254336,3.5988983077569725,3.5987627506586013,3.5986278764470145,3.5984936636245264,3.598360091349363,3.598227139925541,3.598094790582822,3.5979630254473602,3.5978318275130885,3.5977011806138823,3.5975710693964666,3.5974414792940803,3.5973123965008718,3.5971838079470175,3.5970557012745843,3.59692806481405,3.5968008875615483,3.596674159156763,3.596547869861493,3.596422010538832,3.596296572632989,3.596171548149699,3.596046929637209,3.595922710167837,3.595798883320061,3.5956754431611455,3.595552384230253,3.595429701522053,3.5953073904707793,3.595185446934751,3.595063867181289,3.5949426478720663,3.5948217860488185,3.5947012791194353,3.5945811248443933,3.5944613213235193,3.5943418668050877,3.5942227602044263,3.5941040005634566,3.593985587213094,3.5938675197617163,3.5937497980835196,3.5936324223070963,3.5935153928041763,3.5933987101785734,3.593282375255272,3.593166389069672,3.5930507528569486,3.592935468041551,3.5928205362267858,3.592705959184494,3.5925917388448094,3.592477877285978,3.592364376724227,3.5922512395036716,3.592138468086262,3.592026065041729,3.5919140330375443,3.591802374828883,3.591691093248558,3.5915801911969396,3.591469671631835,3.5913595375583336,3.5912497920185893,3.5911404380815495,3.5910314788326247,3.590922917363267,3.59081475676048,3.590707000096232,3.5905996504167828,3.5904927107319047,3.590386184003995,3.5902800731370847,3.590174380965732,3.5900691102437863,3.589964263633045,3.5898598436917672,3.5897558528630715,3.589652293463196,3.589549167669634,3.58944647750911,3.5893442248454615,3.589242411367342,3.58914103857582,3.5890401077718246,3.588939620043465,3.588839576253219,3.58873997702498,3.588640822730988,3.588542113478633,3.588443849097131,3.588346029124096,3.588248652791982,3.5881517190144376,3.5880552263725445,3.587959173100973,3.5878635570740407,3.587768375791699,3.587673626365442,3.587579305504155,3.587485409499912,3.587391934213724,3.587298875061253,3.587206226998512,3.5871139845075373,3.5870221415761563,3.5869306916610357,3.5868396277801327,3.5867489423767234,3.5866586273487666,3.58656867403478,3.586479073199794,3.586389815021418,3.586300889076,3.5862122843249273,3.5861239891010688,3.5860359910953714,3.585948277343643,3.585860834213531,3.585773647391706,3.5856867018712744,3.5855999819394513,3.585513471165481,3.5854271523888572,3.5853410077078225,3.5852550184682124,3.585169165252611,3.585083427869874,3.5849977853450166,3.5849122159094913,3.5848266969918674,3.58474120520893,3.584655716357222,3.58457020540503,3.584484646484837,3.5843990128862555,3.584313277049468,3.58422741055915,3.58414138413893,3.5840551676463717,3.583968730068496,3.583882039517849,3.583795063229133,3.583707767556388,3.5836201179707543,3.583532079058794,3.5834436145213897,3.5833546871732227,3.5832652589428236,3.5831752908731813,3.5830847431229413,3.582993574968149,3.582901744804549,3.582809210150433,3.5827159276500122,3.5826218530773217,3.5825269413406042,3.582431146487198,3.5823344217088784,3.5822367193476365,3.5821379909018845,3.582038187033029,3.581937257572417,3.5818351515285998,3.581731817094879,3.581627201657114,3.5815212518017203,3.5814139133238516,3.581305131235686,3.5811948497747825,3.58108301241246,3.5809695618621293,3.580854440087531,3.58073758831081,3.5806189470203713,3.580498455966281,3.5803760541624468,3.5802516799735247,3.5801252710239857,3.579996764237975,3.5798660958442925,3.579733201380599,3.5795980156967935,3.579460472957421,3.579320506643044,3.5791780495504697,3.579033033791733,3.5788853907917075,3.578735051284271,3.578581945306877,3.578426002193422,3.578267150565302,3.578105318320517,3.5779404326206854,3.5777724198758647,3.5776012057270066,3.577426715025929,3.5772488718126296,3.577067599289836,3.5768828197945823,3.5766944547666895,3.5765024247139627,3.5763066491739566,3.5761070466720994,3.575903534676026,3.575696029545914,3.5754844464806324,3.5752686994595058,3.5750487011794845,3.5748243629875,3.5745955948078127,3.574362305064075,3.5741244005959256,3.573881786569827,3.5736343663839336,3.573382041566683,3.5731247116688776,3.5728622741489526,3.572594624251148,3.572321654876266,3.572043256444729,3.5717593167515624,3.5714697208130235,3.5711743507044593,3.5708730853890733,3.5705658005371976,3.5702523683356664,3.5699326572868872,3.5696065319971897,3.5692738529539603,3.5689344762911364,3.5685882535425604,3.568235031382661,3.5678746513539643,3.5675069495808542,3.5671317564690175,3.566748896389967,3.5663581873500156,3.565959440643045,3.565552460486365,3.5651370436389938,3.564712979001566,3.564280047197111,3.5638380201318873,3.5633866605354325,3.5629257214393193,3.5624549457228474,3.5619740656697068,3.561482802255377,3.560980864634623,3.560467949536804,3.559943740633348,3.559407907876173,3.5588601068058487,3.5582999778281836,3.5577271454579003,3.557141217528006,3.5565417843633864,3.555928417917112,3.555300670867875,3.554658075676908,3.5540001436026873,3.5533263636716197,3.5526362016028865,3.5519290986855148,3.551204470605693,3.5504617062222383,3.549700166288105,3.5489191821156805,3.5481180541835804,3.547296050682552,3.54645240599802,3.545586319126707,3.544696952024728,3.5437834278843785,3.5428448293368615,3.541880196578023,3.540888525414129,3.5398687652246137,3.538819816838638,3.5377405303222584,3.5366297026728417,3.535486075417375,3.534308332111204,3.5330950957336293,3.53184492597682,3.5305563164243297,3.529227691615557,3.5278574039923565,3.5264437307240786,3.5249848704071596,3.5234789396355204,3.521923969437939,3.520317901578607,3.518658584717164,3.5169437704244944,3.5151711090507423,3.513338145442024,3.511442314502542,3.5094809365989126,3.507451212803786,3.5053502199760374,3.5031749056751424,3.5009220829076773,3.4985884247042747,3.496170458525828,3.4936645604982814,3.4910669494758713,3.488373680933407,3.4855806406889194,3.4826835384588084,3.4796779012485954,3.476559066583427,3.4733221755836015,3.4699621658917006,3.4664737644593435,3.462851480203051,3.459089596540521,3.4551821638204263,3.4511229916609,3.4469056412140997,3.4425234173767087,3.4379693609688173,3.4332362409064636,3.428316546396273,3.4232024791838924,3.417885945891435,3.4123585504831295,3.4066115869022635,3.4006360319270286,3.3944225382974005,3.387961428170207,3.3812426869645944,3.3742559576657274,3.3669905356601597,3.3594353641823718,3.3515790304582276,3.343409762637515,3.334915427614385,3.3260835298413793,3.3169012112496064,3.3073552523946024,3.2974320749544925,3.287117745713947,3.2763979821741973,3.2652581599359904,3.2536833220084795,3.2416581902028168,3.229167178774235,3.2161944104809628,3.202723735231387,3.188738751493559,3.1742228306418525,3.1591591444151295,3.143530695658497,3.1273203525165276,3.110510886239028]},{"type":"scatter","name":"current = 1.2 A","mode":"lines","x":[0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0,30.0,33.0,36.0,39.0,42.0,45.0,48.0,51.0,54.0,57.0,60.0,63.0,66.0,69.0,72.0,75.0,78.0,81.0,84.0,87.0,90.0,93.0,96.0,99.0,102.0,105.0,108.0,111.0,114.0,117.0,120.0,123.0,126.0,129.0,132.0,135.0,138.0,141.0,144.0,147.0,150.0,153.0,156.0,159.0,162.0,165.0,168.0,171.0,174.0,177.0,180.0,183.0,186.0,189.0,192.0,195.0,198.0,201.0,204.0,207.0,210.0,213.0,216.0,219.0,222.0,225.0,228.0,231.0,234.0,237.0,240.0,243.0,246.0,249.0,252.0,255.0,258.0,261.0,264.0,267.0,270.0,273.0,276.0,279.0,282.0,285.0,288.0,291.0,294.0,297.0,300.0,303.0,306.0,309.0,312.0,315.0,318.0,321.0,324.0,327.0,330.0,333.0,336.0,339.0,342.0,345.0,348.0,351.0,354.0,357.0,360.0,363.0,366.0,369.0,372.0,375.0,378.0,381.0,384.0,387.0,390.0,393.0,396.0,399.0,402.0,405.0,408.0,411.0,414.0,417.0,420.0,423.0,426.0,429.0,432.0,435.0,438.0,441.0,444.0,447.0,450.0,453.0,456.0,459.0,462.0,465.0,468.0,471.0,474.0,477.0,480.0,483.0,486.0,489.0,492.0,495.0,498.0,501.0,504.0,507.0,510.0,513.0,516.0,519.0,522.0,525.0,528.0,531.0,534.0,537.0,540.0,543.0,546.0,549.0,552.0,555.0,558.0,561.0,564.0,567.0,570.0,573.0,576.0,579.0,582.0,585.0,588.0,591.0,594.0,597.0,600.0,603.0,606.0,609.0,612.0,615.0,618.0,621.0,624.0,627.0,630.0,633.0,636.0,639.0,642.0,645.0,648.0,651.0,654.0,657.0,660.0,663.0,666.0,669.0,672.0,675.0,678.0,681.0,684.0,687.0,690.0,693.0,696.0,699.0,702.0,705.0,708.0,711.0,714.0,717.0,720.0,723.0,726.0,729.0,732.0,735.0,738.0,741.0,744.0,747.0,750.0,753.0,756.0,759.0,762.0,765.0,768.0,771.0,774.0,777.0,780.0,783.0,786.0,789.0,792.0,795.0,798.0,801.0,804.0,807.0,810.0,813.0,816.0,819.0,822.0,825.0,828.0,831.0,834.0,837.0,840.0,843.0,846.0,849.0,852.0,855.0,858.0,861.0,864.0,867.0,870.0,873.0,876.0,879.0,882.0,885.0,888.0,891.0,894.0,897.0,900.0,903.0,906.0,909.0,912.0,915.0,918.0,921.0,924.0,927.0,930.0,933.0,936.0,939.0,942.0,945.0,948.0,951.0,954.0,957.0,960.0,963.0,966.0,969.0,972.0,975.0,978.0,981.0,984.0,987.0,990.0,993.0,996.0,999.0,1002.0,1005.0,1008.0,1011.0,1014.0,1017.0,1020.0,1023.0,1026.0,1029.0,1032.0,1035.0,1038.0,1041.0,1044.0,1047.0,1050.0,1053.0,1056.0,1059.0,1062.0,1065.0,1068.0,1071.0,1074.0,1077.0,1080.0,1083.0,1086.0,1089.0,1092.0,1095.0,1098.0,1101.0,1104.0,1107.0,1110.0,1113.0,1116.0,1119.0,1122.0,1125.0,1128.0,1131.0,1134.0,1137.0,1140.0,1143.0,1146.0,1149.0,1152.0,1155.0,1158.0,1161.0,1164.0,1167.0,1170.0,1173.0,1176.0,1179.0,1182.0,1185.0,1188.0,1191.0,1194.0,1197.0,1200.0,1203.0,1206.0,1209.0,1212.0,1215.0,1218.0,1221.0,1224.0,1227.0,1230.0,1233.0,1236.0,1239.0,1242.0,1245.0,1248.0,1251.0,1254.0,1257.0,1260.0,1263.0,1266.0,1269.0,1272.0,1275.0,1278.0,1281.0,1284.0,1287.0,1290.0,1293.0,1296.0,1299.0,1302.0,1305.0,1308.0,1311.0,1314.0,1317.0,1320.0,1323.0,1326.0,1329.0,1332.0,1335.0,1338.0,1341.0,1344.0,1347.0,1350.0,1353.0,1356.0,1359.0,1362.0,1365.0,1368.0,1371.0,1374.0,1377.0,1380.0,1383.0,1386.0,1389.0,1392.0,1395.0,1398.0,1401.0,1404.0,1407.0,1410.0,1413.0,1416.0,1419.0,1422.0,1425.0,1428.0,1431.0,1434.0,1437.0,1440.0,1443.0,1446.0,1449.0,1452.0,1455.0,1458.0,1461.0,1464.0,1467.0,1470.0,1473.0,1476.0,1479.0,1482.0,1485.0,1488.0,1491.0,1494.0,1497.0,1500.0,1503.0,1506.0,1509.0,1512.0,1515.0,1518.0,1521.0,1524.0,1527.0,1530.0,1533.0,1536.0,1539.0,1542.0,1545.0,1548.0,1551.0,1554.0,1557.0,1560.0,1563.0,1566.0,1569.0,1572.0,1575.0,1578.0,1581.0,1584.0,1587.0,1590.0,1593.0,1596.0,1599.0,1602.0,1605.0,1608.0,1611.0,1614.0,1617.0,1620.0,1623.0,1626.0,1629.0,1632.0,1635.0,1638.0,1641.0,1644.0,1647.0,1650.0,1653.0,1656.0,1659.0,1662.0,1665.0,1668.0,1671.0,1674.0,1677.0,1680.0,1683.0,1686.0,1689.0,1692.0,1695.0,1698.0,1701.0,1704.0,1707.0,1710.0,1713.0,1716.0,1719.0,1722.0,1725.0,1728.0,1731.0,1734.0,1737.0,1740.0,1743.0,1746.0,1749.0,1752.0,1755.0,1758.0,1761.0,1764.0,1767.0,1770.0,1773.0,1776.0,1779.0,1782.0,1785.0,1788.0,1791.0,1794.0,1797.0,1800.0,1803.0,1806.0,1809.0,1812.0,1815.0,1818.0,1821.0,1824.0,1827.0,1830.0,1833.0,1836.0,1839.0,1842.0,1845.0,1848.0,1851.0,1854.0,1857.0,1860.0,1863.0,1866.0,1869.0,1872.0,1875.0,1878.0,1881.0,1884.0,1887.0,1890.0,1893.0,1896.0,1899.0,1902.0,1905.0,1908.0,1911.0,1914.0,1917.0,1920.0,1923.0,1926.0,1929.0,1932.0,1935.0,1938.0,1941.0,1944.0,1947.0,1950.0,1953.0,1956.0,1959.0,1962.0,1965.0,1968.0,1971.0,1974.0,1977.0,1980.0,1983.0,1986.0,1989.0,1992.0,1995.0,1998.0,2001.0,2004.0,2007.0,2010.0,2013.0,2016.0,2019.0],"y":[3.7494896731334,3.745499418282586,3.743277796529387,3.741569018828815,3.740108662739655,3.738805180176489,3.7376106622241867,3.7364952473565642,3.7354427401937955,3.734440369338788,3.7334793150629064,3.732553270538692,3.731657812839069,3.730788797416371,3.7299433096750327,3.729118827662529,3.728313034851219,3.727524199185029,3.7267507398982342,3.725991337357626,3.7252449039625923,3.7245104501422444,3.7237871036709707,3.723074132088219,3.7223708479932465,3.7216765889390158,3.7209908586680496,3.7203132352251393,3.7196431790308853,3.718980327733235,3.7183244124615746,3.7176750300551964,3.7170318607581256,3.7163947098318877,3.7157632900402207,3.7151373229926117,3.7145166427141474,3.7139010408313693,3.713290301625683,3.712684278926403,3.712082815369419,3.7114857506157586,3.710892965420733,3.7103043393750363,3.709719740510985,3.7091390776853173,3.708562257553006,3.707989165459797,3.7074197290062316,3.7068538722500044,3.706291502916482,3.705732558736146,3.7051769757744304,3.7046246852664093,3.7040756322523083,3.7035297648083687,3.7029870291309837,3.7024473791517756,3.7019107733461416,3.7013771562783426,3.700846491713733,3.7003187508872775,3.699793903221494,3.6992719215084082,3.6987527818485186,3.698236440642186,3.69772284776855,3.6972120055010813,3.696703894261377,3.6961984968535084,3.6956957984169776,3.6951957797976824,3.694698369015614,3.6942035861701594,3.6937114164352516,3.6932218464129827,3.69273486410467,3.692250458881641,3.6917685851226243,3.6912892406526585,3.690812419105636,3.6903381089579277,3.689866299483106,3.689396980735144,3.688930132994088,3.6884657399598164,3.68800379836939,3.6875442983158213,3.6870872303782773,3.686632585611317,3.6861803530778623,3.6857305150053783,3.6852830684140967,3.684838004505127,3.6843953147788606,3.6839549910276768,3.683517025328594,3.683081399889615,3.6826481109287146,3.6822171505292984,3.6817885103769545,3.6813621823051177,3.680938158290689,3.6805164262497607,3.680096976610952,3.6796798021276964,3.679264893736595,3.6788522422748713,3.678441838465494,3.678033675031381,3.6776277460031928,3.6772240386853023,3.6768225436591253,3.6764232513608133,3.6760261520694897,3.675631235895798,3.6752384927707467,3.6748479124348354,3.6744594844274756,3.674073198076654,3.6736890479280544,3.6733070313087417,3.67292712964751,3.672549332448613,3.6721736290485074,3.6718000086088303,3.671428460109429,3.6710589723414726,3.6706915339005914,3.6703261331800636,3.669962758364024,3.669601403176055,3.669242063623621,3.668884720029673,3.668529360816487,3.6681759742567666,3.6678245484687664,3.66747507141123,3.667127530878136,3.6667819144932534,3.666438209704462,3.6660964037778516,3.6657564862219205,3.6654184471418394,3.6650822703536403,3.6647479427985012,3.6644154512406653,3.6640847822606784,3.6637559222482365,3.6634288573946234,3.6631035736847113,3.662780056888505,3.6624582925522198,3.6621382659426773,3.6618199620738263,3.6615033658138465,3.6611884617061046,3.6608752340169284,3.6605636667232684,3.660253743499703,3.659945447704725,3.659638762366306,3.6593336701666823,3.6590301534263334,3.6587281940959278,3.6584277737329876,3.6581288734609987,3.65783147397948,3.6575355555332574,3.6572410978908034,3.6569480803214707,3.656656481571565,3.656366279839208,3.6560774527479345,3.65578997731896,3.6555038306971515,3.6552189893987235,3.6549354277134087,3.65465312008606,3.654372040211567,3.6540921609985757,3.6538134545314542,3.6535358920304986,3.653259443810281,3.652984079236092,3.6527097666784014,3.6524364740774535,3.652164168258939,3.651892813747795,3.6516223745503558,3.651352813429765,3.651084091847981,3.6508161699054855,3.650549006278614,3.6502825581545046,3.650016781163608,3.6497516293097907,3.649487054870011,3.6492230083529784,3.6489594384658552,3.6486962919557895,3.6484335135576518,3.648171045909917,3.647908829468382,3.6476468024178414,3.6473849005818253,3.6471230573306266,3.646861203487745,3.6465992669279546,3.646337172872829,3.646074844211564,3.6458122005929954,3.645549158638183,3.6452856318446654,3.645021530491891,3.6447567615484764,3.644491228581951,3.644224831671801,3.643957467326613,3.6436890275705323,3.6434194010892296,3.6431484739980515,3.6428761277338038,3.6426022398380957,3.6423266839218735,3.642049329642848,3.6417700426975115,3.64148868482962,3.64120511385709,3.6409191837193995,3.64063074454772,3.640339642760103,3.640045721184182,3.639748819209915,3.6394487729750042,3.639145415585697,3.6388385772389773,3.638528082190194,3.638213758795895,3.6378954308642526,3.6375729208825383,3.6372460505062096,3.63691464110191,3.6365785143464597,3.636237492883691,3.6358914010405137,3.6355400656032413,3.6351833166546017,3.6348209884713008,3.634452920481254,3.634078958278872,3.633698954695843,3.633312770923932,3.632920277685273,3.632521352428259,3.6321158885707616,3.6317037947730584,3.631284992006817,3.6308594170750874,3.630427023906627,3.6299877848327116,3.6295416918323022,3.6290887577303783,3.6286290173334006,3.6281625284851486,3.627689373025712,3.6272096576361674,3.6267235145515837,3.6262311021253417,3.6257326052285106,3.6252282354691303,3.6247182300201612,3.624202848693222,3.623682387168921,3.623157161965965,3.6226275143262696,3.6220938091450643,3.6215564336757513,3.621015796015225,3.620472323378895,3.619926460178144,3.6193786659164138,3.618829412923299,3.6182791839489905,3.6177284696440117,3.61717776595134,3.6166275714396767,3.616078384607786,3.615530701190339,3.6149850084931265,3.6144417901238732,3.6139015186686203,3.613364652901025,3.612831636419597,3.6123028955614083,3.6117788374988553,3.6112598485353056,3.6107462926120104,3.6102385100352,3.6097368164286596,3.609241501913747,3.6087528305153747,3.6082710397894804,3.6077963406646254,3.607328917487881,3.6068689282629527,3.6064165045117793,3.6059717521780894,3.6055347544247236,3.6051055695914003,3.604684233224064,3.604270759138623,3.6038651405625193,3.603467351337503,3.6030773471676585,3.602695066897643,3.6023204338071135,3.6019533569085076,3.6015937322364917,3.6012414441186804,3.600896366418474,3.600558363742158,3.6002272926035386,3.5999030025406666,3.599585336498266,3.5992741336785636,3.5989692289201103,3.59867045392771,3.5983776381756427,3.5980906096775787,3.597809195696505,3.597533223395683,3.5972625204321123,3.5969969154943557,3.5967362387868436,3.596480322463042,3.5962290010099833,3.5959821115868644,3.5957394943203984,3.595500992559736,3.595266453093676,3.5950357265039496,3.5948086670171455,3.5945851325204505,3.594364985075093,3.594148090796494,3.593934319900455,3.5937235467291506,3.593515649758986,3.5933105115923056,3.593108018934716,3.592908062559777,3.5927105372625756,3.5925153418036886,3.592322378844832,3.592131554877448,3.591942780145331,3.5917559685623406,3.591571037626094,3.5913879083285054,3.5912065050639033,3.5910267555354056,3.5908485906601646,3.590671944474005,3.590496754035937,3.590322959332936,3.590150503185399,3.5899793311535344,3.5898093914450118,3.589640634824062,3.589473014522229,3.589306486150969,3.589141007616175,3.5889765390347885,3.5888130426535305,3.5886504832482666,3.5884888270473407,3.5883280418763643,3.5881680977376345,3.588008966390711,3.5878506212846824,3.5876930374926905,3.587536191648648,3.5873800618861296,3.5872246277793702,3.587069870286352,3.586915771693876,3.5867623155645956,3.5866094866859384,3.586457271020841,3.5863056556602393,3.5861546287772414,3.58600417958291,3.5858542982835924,3.5857049760397155,3.5855562049259833,3.5854079778929013,3.5852602887295606,3.5851131320276153,3.58496650314637,3.5848203981789353,3.584674813919349,3.584529747830638,3.584385198013729,3.584241163177149,3.5840976426074636,3.5839546361403887,3.5838121441325135,3.5836701674335805,3.58352870795793,3.583387767242247,3.583247347170061,3.5831074502988076,3.5829680795467658,3.5828292381675597,3.5826909297248553,3.5825531580672134,3.5824159273030665,3.582279241775759,3.5821431060386306,3.582007524830101,3.5818725030486998,3.5817380457280414,3.5816041580116877,3.5814708451278627,3.581338112364022,3.581205965041203,3.581074408488179,3.5809434480153377,3.580813088888329,3.5806833363013877,3.5805541953503695,3.580425671005459,3.580297768083516,3.580170491220109,3.5800438448411316,3.57991783313408,3.5797924600189317,3.5796677291186287,3.579543643729178,3.5794202067893526,3.5792974208499935,3.5791752880429217,3.5790538102693636,3.578932988591827,3.5788128236271795,3.5786933155110985,3.5785744637989563,3.5784562674325566,3.5783387247065552,3.578221833234615,3.578105589915274,3.577989990897588,3.5778750315465717,3.5777607064084447,3.577647009175744,3.5775339326523317,3.5774214687183226,3.5773096082949922,3.5771983413096944,3.5770876566608414,3.5769775421829912,3.576867984612081,3.576758969550893,3.5766504814347595,3.5765425034976053,3.5764350177383455,3.576328004887749,3.576221444375768,3.5761153142994537,3.576009591391475,3.575904250989333,3.575799267005337,3.5756946118973856,3.575590256640646,3.575486170700182,3.575382322004606,3.5752786769258056,3.5751752002405968,3.5750718551205902,3.574968603107928,3.574865404094249,3.5747622163018486,3.5746589962663284,3.5745556988207627,3.5744522770814657,3.574348682435382,3.57424486452917,3.5741407712600255,3.574036348768269,3.57393154143175,3.573826291862099,3.5737205409028405,3.5736142276294163,3.5735072893511024,3.5733996616148644,3.573291278211118,3.5731820711814306,3.5730719708281247,3.572960905725768,3.572848802734552,3.572735587015481,3.572621182047373,3.572505509645597,3.5723884899824787,3.5722700416093436,3.572150081480078,3.572028524976123,3.571905285932857,3.5717802766671687,3.571653408006182,3.571524589304172,3.571393728503603,3.571260732142547,3.571125505392021,3.5709879520885104,3.5708479747662962,3.5707054746897606,3.5705603518854634,3.570412505173791,3.5702618321999253,3.570108229463915,3.56995159234957,3.569791815151947,3.5696287911031233,3.5694624123959873,3.5692925702057474,3.569119154708841,3.568942055098933,3.5687611595996485,3.5685763554737338,3.568387529028248,3.5681945656154253,3.5679973496288544,3.5677957644945293,3.567589692656412,3.5673790155560554,3.567163613605859,3.566943366155512,3.5667181514511634,3.566487846586813,3.5662523274474798,3.566011468643577,3.5657651434360136,3.5655132236587237,3.5652555797328747,3.564992080221013,3.564722592035973,3.5644469802077285,3.5641651077405525,3.5638768354566217,3.5635820218253595,3.563280522777765,3.562972191504987,3.5626568782403285,3.562334430023872,3.562004690448812,3.561667499388664,3.5613226927043193,3.560970101930003,3.5606095539371063,3.5602408705747495,3.559863868285986,3.559478357698433,3.5590841431880564,3.5586810224148033,3.558268785828695,3.5578472161449084,3.5574160877863066,3.556975166291823,3.556524207688971,3.5560629578287015,3.5555911516807166,3.555108512587253,3.5546147514732316,3.5541095660105855,3.553592639734416,3.5530636411085466,3.5525222226268998,3.55196802001247,3.551400649916367,3.550819710070595,3.550224777609211,3.549615407770914,3.548991132529808,3.5483514591505827,3.5476958686642606,3.5470238142603843,3.546334719591313,3.5456279769841146,3.544902945555248,3.5441589492230694,3.5433952746128443,3.5426111688487913,3.5418058372273227,3.5409784407654374,3.540128093617864,3.539253860356318,3.5383547531038637,3.5374297285170893,3.536477684608469,3.535497457400939,3.5344878174063483,3.533447465919149,3.5323750311162563,3.5312690639537205,3.5301280338503984,3.528950324148528,3.527734227340669,3.52647794005214,3.5251795577677028,3.523837069290917,3.522448350924172,3.5210111603571552,3.5195231302511565,3.517981761506336,3.516384416198802,3.514728310174203,3.5130105052842255,3.511227901252451,3.5093772271557855,3.5074550325078304,3.505457677930586,3.5033813254010946,3.501221928059961,3.4989752195691093,3.49663670300672,3.4942016392880584,3.491665035101846,3.4890216303529793,3.486265885211337,3.483391967514421,3.480393735202472,3.477264725357853,3.4739981378786693,3.4705868198652357,3.467023249505047,3.4632995194677214,3.4594073198260284,3.455337920524224,3.4510821534209146,3.4466303939401786,3.4419725423720418,3.4370980048717072,3.431995674216057,3.426653910386053,3.4210605210548892,3.4152027420740763,3.4090672180631043,3.402639983223162,3.3959064425114045,3.3888513533297706,3.3814588079011463,3.3737122165260662,3.365594291934759,3.3570870349727024,3.3481717218822764,3.338828893469305,3.3290383464702584,3.318779127464437,3.3080295297046507,3.2967670932698923,3.284968608973941,3.2726101264942242,3.259666967215124,3.2461137423091264,3.231924376606324,3.2170721388280024,3.2015296787818506,3.1852690721336305,3.1682618733831958,3.150479177677741,3.13189169209425,3.1124698170110934]},{"type":"scatter","name":"current = 1.4 A","mode":"lines","x":[0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0,30.0,33.0,36.0,39.0,42.0,45.0,48.0,51.0,54.0,57.0,60.0,63.0,66.0,69.0,72.0,75.0,78.0,81.0,84.0,87.0,90.0,93.0,96.0,99.0,102.0,105.0,108.0,111.0,114.0,117.0,120.0,123.0,126.0,129.0,132.0,135.0,138.0,141.0,144.0,147.0,150.0,153.0,156.0,159.0,162.0,165.0,168.0,171.0,174.0,177.0,180.0,183.0,186.0,189.0,192.0,195.0,198.0,201.0,204.0,207.0,210.0,213.0,216.0,219.0,222.0,225.0,228.0,231.0,234.0,237.0,240.0,243.0,246.0,249.0,252.0,255.0,258.0,261.0,264.0,267.0,270.0,273.0,276.0,279.0,282.0,285.0,288.0,291.0,294.0,297.0,300.0,303.0,306.0,309.0,312.0,315.0,318.0,321.0,324.0,327.0,330.0,333.0,336.0,339.0,342.0,345.0,348.0,351.0,354.0,357.0,360.0,363.0,366.0,369.0,372.0,375.0,378.0,381.0,384.0,387.0,390.0,393.0,396.0,399.0,402.0,405.0,408.0,411.0,414.0,417.0,420.0,423.0,426.0,429.0,432.0,435.0,438.0,441.0,444.0,447.0,450.0,453.0,456.0,459.0,462.0,465.0,468.0,471.0,474.0,477.0,480.0,483.0,486.0,489.0,492.0,495.0,498.0,501.0,504.0,507.0,510.0,513.0,516.0,519.0,522.0,525.0,528.0,531.0,534.0,537.0,540.0,543.0,546.0,549.0,552.0,555.0,558.0,561.0,564.0,567.0,570.0,573.0,576.0,579.0,582.0,585.0,588.0,591.0,594.0,597.0,600.0,603.0,606.0,609.0,612.0,615.0,618.0,621.0,624.0,627.0,630.0,633.0,636.0,639.0,642.0,645.0,648.0,651.0,654.0,657.0,660.0,663.0,666.0,669.0,672.0,675.0,678.0,681.0,684.0,687.0,690.0,693.0,696.0,699.0,702.0,705.0,708.0,711.0,714.0,717.0,720.0,723.0,726.0,729.0,732.0,735.0,738.0,741.0,744.0,747.0,750.0,753.0,756.0,759.0,762.0,765.0,768.0,771.0,774.0,777.0,780.0,783.0,786.0,789.0,792.0,795.0,798.0,801.0,804.0,807.0,810.0,813.0,816.0,819.0,822.0,825.0,828.0,831.0,834.0,837.0,840.0,843.0,846.0,849.0,852.0,855.0,858.0,861.0,864.0,867.0,870.0,873.0,876.0,879.0,882.0,885.0,888.0,891.0,894.0,897.0,900.0,903.0,906.0,909.0,912.0,915.0,918.0,921.0,924.0,927.0,930.0,933.0,936.0,939.0,942.0,945.0,948.0,951.0,954.0,957.0,960.0,963.0,966.0,969.0,972.0,975.0,978.0,981.0,984.0,987.0,990.0,993.0,996.0,999.0,1002.0,1005.0,1008.0,1011.0,1014.0,1017.0,1020.0,1023.0,1026.0,1029.0,1032.0,1035.0,1038.0,1041.0,1044.0,1047.0,1050.0,1053.0,1056.0,1059.0,1062.0,1065.0,1068.0,1071.0,1074.0,1077.0,1080.0,1083.0,1086.0,1089.0,1092.0,1095.0,1098.0,1101.0,1104.0,1107.0,1110.0,1113.0,1116.0,1119.0,1122.0,1125.0,1128.0,1131.0,1134.0,1137.0,1140.0,1143.0,1146.0,1149.0,1152.0,1155.0,1158.0,1161.0,1164.0,1167.0,1170.0,1173.0,1176.0,1179.0,1182.0,1185.0,1188.0,1191.0,1194.0,1197.0,1200.0,1203.0,1206.0,1209.0,1212.0,1215.0,1218.0,1221.0,1224.0,1227.0,1230.0,1233.0,1236.0,1239.0,1242.0,1245.0,1248.0,1251.0,1254.0,1257.0,1260.0,1263.0,1266.0,1269.0,1272.0,1275.0,1278.0,1281.0,1284.0,1287.0,1290.0,1293.0,1296.0,1299.0,1302.0,1305.0,1308.0,1311.0,1314.0,1317.0,1320.0,1323.0,1326.0,1329.0,1332.0,1335.0,1338.0,1341.0,1344.0,1347.0,1350.0,1353.0,1356.0,1359.0,1362.0,1365.0,1368.0,1371.0,1374.0,1377.0,1380.0,1383.0,1386.0,1389.0,1392.0,1395.0,1398.0,1401.0,1404.0,1407.0,1410.0,1413.0,1416.0,1419.0,1422.0,1425.0,1428.0,1431.0,1434.0,1437.0,1440.0,1443.0,1446.0,1449.0,1452.0,1455.0,1458.0,1461.0,1464.0,1467.0,1470.0,1473.0,1476.0,1479.0,1482.0,1485.0,1488.0,1491.0,1494.0,1497.0,1500.0,1503.0,1506.0,1509.0,1512.0,1515.0,1518.0,1521.0,1524.0,1527.0,1530.0,1533.0,1536.0,1539.0,1542.0,1545.0,1548.0,1551.0,1554.0,1557.0,1560.0,1563.0,1566.0,1569.0,1572.0,1575.0,1578.0,1581.0,1584.0,1587.0,1590.0,1593.0,1596.0,1599.0,1602.0,1605.0,1608.0,1611.0,1614.0,1617.0,1620.0,1623.0,1626.0,1629.0,1632.0,1635.0,1638.0,1641.0,1644.0,1647.0,1650.0,1653.0,1656.0,1659.0,1662.0,1665.0,1668.0,1671.0,1674.0,1677.0,1680.0,1683.0,1686.0,1689.0,1692.0,1695.0,1698.0,1701.0,1704.0,1707.0,1710.0,1713.0,1716.0,1719.0],"y":[3.7403690371288736,3.7357356017799104,3.7331595068331276,3.731179490296291,3.729488177460923,3.727979600181759,3.7265975320060916,3.7253080481494703,3.7240916154859587,3.722933814041911,3.721824675854579,3.7207572346894717,3.719725593931397,3.7187254641864014,3.7177533043582183,3.716805942223554,3.715880864458354,3.714976007992995,3.714089610400252,3.713220146448355,3.7123663373852747,3.711527043926639,3.7107012610310948,3.70988810064806,3.7090867532146983,3.708296499878119,3.7075167783431766,3.7067469953475114,3.7059866034558797,3.7052352601835308,3.704492499071861,3.7037578796676733,3.7030311529267976,3.702311952271102,3.701599939007043,3.700894890963031,3.700196532416683,3.6995046150202064,3.6988189445542203,3.6981393114618353,3.6974655297395023,3.69679744467508,3.696134886760055,3.695477708797814,3.6948257891115395,3.6941789869341792,3.693537182234202,3.6929002738364236,3.6922681474355152,3.6916407048912494,3.6910178597827605,3.6903995204727593,3.6897856069393233,3.689176046712802,3.68857074929208,3.687969656417157,3.6873727115000325,3.6867798600489436,3.6861910528309045,3.685606245758259,3.6850253337696772,3.6844482997453185,3.6838751098967273,3.6833057284575355,3.682740123436893,3.682178266529524,3.6816200493581936,3.681065479768935,3.6805145311520415,3.679967175969581,3.6794233889990937,3.678883147005476,3.6783463678467245,3.6778130586329443,3.6772831944273103,3.676756751669372,3.676233708141319,3.675714041492449,3.675197703438757,3.6746846876869257,3.674174972879291,3.6736685385097423,3.673165364901169,3.672665431653222,3.6721687059789314,3.671675176811746,3.6711848252724675,3.6706976330220127,3.6702135822446684,3.6697326536888712,3.6692548189619814,3.6687800666900166,3.6683083790352002,3.667839738450511,3.6673741276676117,3.666911527906673,3.666451914632768,3.6659952736246715,3.6655415863717153,3.665090834240204,3.66464299844363,3.6641980619028707,3.6637560101780506,3.663316820601151,3.6628804741315664,3.662446951494394,3.662016233154902,3.6615882992932307,3.6611631297792897,3.660740704147754,3.6603210015731666,3.659904011486548,3.659489712693964,3.6590780801436944,3.658669092809913,3.65826272931667,3.6578589679156153,3.6574577864631896,3.657059162397263,3.656663072713078,3.6562694945697647,3.6558784198853087,3.6554898147771326,3.655103655605637,3.6547199182889587,3.6543385782771893,3.6539596105252556,3.653582989464361,3.653208688971905,3.65283668233978,3.652466944699068,3.6520994507211215,3.6517341695582743,3.651371072363913,3.651010129571917,3.650651310854557,3.6502945850779316,3.6499399202548095,3.6495872834947574,3.649236640951376,3.648887957741795,3.648541197943162,3.648196324495048,3.647853299132958,3.647512082323546,3.6471726331912198,3.6468349094406878,3.6464988672752843,3.6461644613108737,3.6458316445675996,3.645500368606736,3.645170582475213,3.644842233533377,3.644515267056931,3.644189626120867,3.6438652514776906,3.6435420814298225,3.643220051695982,3.642899095271441,3.6425791434834607,3.6422601238933225,3.641941959890264,3.6416245722826703,3.6413078783898305,3.640991791866509,3.6406762225215514,3.6403610761307497,3.6400462542442518,3.6397316539889086,3.6394171694213275,3.6391026874496015,3.63878809079425,3.638473257013806,3.6381580582243034,3.637842360888219,3.6375260256048576,3.6372089069038562,3.6368908530436554,3.6365717058069404,3.636251300317356,3.635929464909476,3.6356060209203633,3.635280782568082,3.6349535568355895,3.634624143381271,3.6342923344806697,3.6339579150044368,3.633620662437909,3.6332803464311323,3.6329367300414988,3.6325895693756616,3.6322386135999816,3.6318836054450547,3.6315242816150493,3.6311603732883033,3.6307916067174415,3.6304177039372454,3.630038383299675,3.629653357754934,3.629262344466329,3.6288650578988024,3.6284612137043952,3.628050530231761,3.627632730188457,3.62720754245776,3.6267747040696503,3.62633396232314,3.6258850770543276,3.625427823041413,3.624961992534365,3.624487397893163,3.6240038743144343,3.6235112826220544,3.6230095061864813,3.6224984663945508,3.621978119843246,3.621448457483674,3.620909509616418,3.620361348316939,3.6198040896412538,3.619237895560251,3.6186629755708584,3.618079587933205,3.6174880404854974,3.6168886909920968,3.6162819469858034,3.615668265072263,3.615048149672724,3.6144221477786185,3.6137908452889174,3.6131548844848944,3.6125149366020075,3.611871705892425,3.6112259251089736,3.6105783505727715,3.6099297568908657,3.609280931399109,3.6086326684125347,3.607985763370561,3.6073410069670784,3.6066991793558794,3.6060610445199086,3.605427344888497,3.60479879628034,3.6041760747974037,3.603559834663369,3.602950686917608,3.60234919902039,3.601755893504486,3.601171245952548,3.600595683551089,3.600029584210471,3.5994732762302797,3.5989270384806957,3.5983911010630663,3.597865646406998,3.597350810756906,3.5968466859980674,3.596353321770691,3.595870726179223,3.595398870778026,3.5949376951066903,3.594487104943127,3.59404697696198,3.5936171615571766,3.593197485639948,3.5927877553822216,3.592387758879665,3.5919972687129333,3.5916160443898213,3.591243834654881,3.5908803796566406,3.590525412965856,3.590178663441085,3.5898398568919014,3.589508716460318,3.5891849676404166,3.588868336044407,3.5885585496405046,3.588255339743657,3.5879584418804846,3.5876675965361944,3.587382549791545,3.587103053858096,3.586828867519944,3.5865597564899856,3.586295493688601,3.5860358594523007,3.58578064167956,3.585529635920665,3.5852826450756816,3.5850394801218988,3.58479995981071,3.5845639102841473,3.5843311651546665,3.5841015653787793,3.5838749591106587,3.583651201539216,3.583430154711819,3.5832116873474362,3.582995674641744,3.582781998066392,3.582570545164364,3.5823612093431576,3.582153889667246,3.5819484907104817,3.581744922404911,3.5815430993526705,3.5813429411991087,3.581144372236637,3.5809473212137637,3.580751721149043,3.580557509150254,3.580364626239045,3.580173017181209,3.5799826303227116,3.579793417431482,3.5796053335450004,3.5794183368236294,3.579232388409623,3.579047452291686,3.5788634951749887,3.5786804863564705,3.578498397605262,3.5783172030480612,3.5781368790592696,3.5779574041556907,3.5777787588955805,3.5776009257818657,3.577423889169291,3.5772476351753073,3.577072151594492,3.576897427816262,3.576723454745719,3.576550225459692,3.5763777331015274,3.5762059726203606,3.576034940252971,3.5758646333955304,3.5756950505389025,3.5755261912057006,3.575358055888939,3.5751906459920937,3.5750239637704393,3.5748580122734612,3.574692795288239,3.5745283172836184,3.574364583355048,3.5742015991699407,3.574039370913435,3.57387790523442,3.57371720919172,3.5735572902003168,3.573398155977501,3.573239814488858,3.5730822738939847,3.5729255424918476,3.5727696286657054,3.5726145408275047,3.572460287361678,3.572306876568297,3.572154316605479,3.572002615904523,3.571851782049602,3.57170182214143,3.5715527431781187,3.571404551714793,3.5712572538007112,3.571110854915423,3.5709653599039486,3.570820772910981,3.5706770973141353,3.57053433565623,3.5703924895766526,3.570251559741813,3.570111545774756,3.5699724461839426,3.569834258291295,3.569696978159524,3.5695606005188636,3.5694251186932364,3.5692905245259996,3.5691568083053045,3.5690239586892334,3.5688919626307936,3.5687608053029085,3.568630470023517,3.5685009381809487,3.568372189159698,3.568244200266764,3.5681169467001723,3.5679904014412656,3.567864535039015,3.567739315768749,3.567614709474408,3.5674906795019536,3.5673671866346193,3.5672441890301845,3.567121642160485,3.5669994987533746,3.5668777087373273,3.5667562191888904,3.566634974283209,3.5665139152477927,3.5663929803197734,3.5662721047067967,3.5661512205517774,3.566030256901695,3.5659091396805924,3.5657877916669594,3.5656661324756596,3.565544078544537,3.5654215431258427,3.5652984362825935,3.565174664889976,3.565050132641864,3.564924740062545,3.5647983845236575,3.5646709602664006,3.5645423584298777,3.564412467085977,3.5642811712722366,3.564148353037297,3.564013891489037,3.563877662847589,3.5637395405031347,3.563599395078239,3.563457094494545,3.5633125040435685,3.5631654864613163,3.5630159020063985,3.5628636085413294,3.5627084616165927,3.562550314557096,3.5623890185505513,3.5622244227373123,3.562056374301136,3.5618847185603713,3.561709299058932,3.561529957656493,3.561346534617246,3.561158868696531,3.5609667972246535,3.5607701561871163,3.560568780300531,3.560362503083374,3.5601511569207522,3.5599345730961325,3.5597125818992916,3.5594850126376345,3.559251693657526,3.5590124523744024,3.558767115282345,3.5585155079509003,3.5582574550081354,3.557992780108738,3.5577213058860213,3.557442853886651,3.5571572444868194,3.556864296788615,3.556563828495252,3.556255655763768,3.555939593033806,3.5556154528309594,3.555283045543167,3.5549421791685676,3.554592659033109,3.554234287476209,3.553866863502627,3.5534901823986513,3.5531040353105854,3.552708208783451,3.5523024842576905,3.5518866375215383,3.551460438116619,3.551023648812472,3.5505760247749727,3.550117312595439,3.5496472498675375,3.5491655641696274,3.5486719721297204,3.5481661784220306,3.5476478746911395,3.5471167383997306,3.5465724315954126,3.5460145995920134,3.5454428695603233,3.5448568490230348,3.5442561242481982,3.5436402585352464,3.5430087903871588,3.54236123156201,3.541697064996649,3.5410157425948556,3.5403166828717594,3.5395992684458424,3.5388628433693,3.538106710286885,3.5373301274128606,3.536532305314919,3.5357124034933287,3.5348695267428174,3.5340027212839376,3.53311097067287,3.532193191551942,3.5312482285200146,3.5302748496968297,3.5292717413058425,3.528237502097163,3.5271706374227954,3.5260695529434734,3.5249325479452622,3.5237578082429524,3.522543398646062,3.5212872549621013,3.5199871755104555,3.5186408121190484,3.517245660574581,3.515799050495971,3.5142981345992492,3.512739877320918,3.5111210427656103,3.5094381819425813,3.5076876192545394,3.505865438201175,3.5039674662589197,3.501989258897552,3.4999260826937117,3.497772897500949,3.495524337635758,3.4931746920391973,3.4907178833742036,3.4881474460196404,3.4854565029235656,3.4826377412801826,3.479683386997729,3.4765851779279524,3.473334335832249,3.4699215370649945,3.466336881961117,3.4625698629230057,3.4586093312111927,3.454443462454503,3.450059720908368,3.445444822505339,3.440584696961963,3.4354644480567833,3.43006831391274,3.424379626102216,3.418380767937467,3.412053132387603,3.4053770797591354,3.398331895416673,3.3908957478677575,3.3830456475886814,3.374757407026275,3.3660056022744884,3.3567635369943774,3.3470032092216777,3.3366952817878506,3.3258090571677004,3.314312457659594,3.302172011901951,3.289352848831439,3.275818700293409,3.2615319136213565,3.2464534756084533,3.2305430493982445,3.213759025919479,3.1960585915800497,3.177397814011732,3.157731747716716,3.137014561503587,3.1151996896079925]}],"layout":{"xaxis":{"title":{"text":"t [sec]"}},"yaxis":{"title":{"text":"voltage [V]"}}},"config":{}});
</script>
<div style="break-before: page; page-break-before: always;"></div><h1 id="forward-sensitivity-analysis"><a class="header" href="#forward-sensitivity-analysis">Forward Sensitivity Analysis</a></h1>
<p>Recall our general ODE system (we'll define it without the mass matrix for now):</p>
<p>\[
\begin{align*}
\frac{dy}{dt} &amp;= f(t, y, p) \\
y(t_0) &amp;= y_0
\end{align*}
\]</p>
<p>Solving this system gives us the solution \(y(t)\) for a given set of parameters \(p\). However, we often want to know how the solution changes with respect to the parameters (e.g. for model fitting). This is where forward sensitivity analysis comes in. If we take the derivative of the ODE system with respect to the parameters, we get the sensitivity equations:</p>
<p>\[
\begin{align*}
\frac{d}{dt} \frac{dy}{dp} &amp;= \frac{\partial f}{\partial y} \frac{dy}{dp} + \frac{\partial f}{\partial p} \\
\frac{dy}{dp}(t_0) &amp;= \frac{dy_0}{dp}
\end{align*}
\]</p>
<p>Here, \(\frac{dy}{dp}\) is the sensitivity of the solution with respect to the parameters. The sensitivity equations are solved alongside the ODE system to give us the solution and the sensitivity of the solution with respect to the parameters. Note that this is a similar concept to forward-mode automatic differentiation, but whereas automatic differentiation calculates the derivative of the code itself (e.g. the "discretised" ODE system), forward sensitivity analysis calculates the derivative of the continuous equations before they are discretised. This means that the error control for forward sensitivity analysis is decoupled from the forward solve, and the tolerances for both can be set independently. However, both methods have the same scaling properties as the number of parameters increases, each additional parameter requires one additional solve, so the method is not efficient for large numbers of parameters (&gt;100). In this case, adjoint sensitivity analysis is often preferred.</p>
<p>To use forward sensitvity analysis in DiffSol, more equations need to be specified that calculate the gradients with respect to the parameters. If you are using the <code>OdeBuilder</code> struct and rust closures, you need to supply additional closures that calculate the gradient of the right-hand side, and the gradient of the initial state vector with respect to the parameters. You can see an example of this in the <a href="primer/../specify/forward_sensitivity.html">Forward Sensitivity API</a> section. If you are using the DiffSL language, these gradients are calculated automatically and you don't need to worry about them. An example of using forward sensitivity analysis in DiffSL is given in the <a href="primer/./population_dynamics_fitting.html">Fitting a Preditor-Prey Model to Data</a> section next.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fitting-a-predator-prey-model-to-data"><a class="header" href="#fitting-a-predator-prey-model-to-data">Fitting a Predator-Prey Model to data</a></h1>
<p>In this example we will again use the <a href="https://en.wikipedia.org/wiki/Lotka%E2%80%93Volterra_equations">Lotka-Volterra equations</a>, which are described in more detail in the <a href="primer/./population_dynamics.html">Population Dynamics - Predator-Prey Model</a> example.</p>
<p>The equations are</p>
<p>\[
\frac{x}{dt} = a x - b x y \\
\frac{y}{dt} = c x y - d y
\]</p>
<p>We also have initial conditions for the populations at time \(t = 0\).</p>
<p>\[
\frac{x}{dt} = x0 \\
\frac{y}{dt} = y0
\]</p>
<p>This model has six parameters, \(a, b, c, d, x0, y0\). For the purposes of this example, we'll fit two of these parameters \(b, d)\) to some synthetic data. We'll use the model itself to generate the synthetic data, so we'll know the true values of the parameters to verify the fitting process.</p>
<p>We'll use the argmin crate to perform the optimisation. This is a popular rust crate that contains a number of optimisation algorithms. It does have some limitations, such as the lack of support for constraints, so it may not be suitable for many real ODE fitting problems as the solver can easily fail to converge if the parameter vector moves into a difficult region (e.g. the Lotka-Volterra model only makes sense for positive values of the parameters). However, it will be sufficient for this example to demonstrate the sensitivity analysis capabilities of <code>diffsol</code>.</p>
<p>First of all we will need to implement some of the argmin traits to specify the optimisation problem. We'll create a <code>struct Problem</code> and implement the <code>CostFunction</code> and <code>Gradient</code> traits for it. The <code>Problem</code> struct will hold our synthetic data (held by the <code>ys_data</code> and <code>ts_data</code> fields) and the <code>OdeSolverProblem</code> that we'll use to solve the ODEs. We'll also create some type aliases for the nalgebra and diffsol types we'll be using.</p>
<p>Note that the <code>problem</code> field of the <code>Problem</code> struct is wrapped in a <code>RefCell</code> so that we can mutate it in the <code>cost</code> and <code>gradient</code> methods. Setting the parameters of the ODE solver problem is a mutable operation (i.e. you are changing the equations), so we need to use <code>RefCell</code> and interior mutability to do this.</p>
<pre><code class="language-rust ignore">use argmin::{
    core::{observers::ObserverMode, CostFunction, Executor, Gradient},
    solver::{linesearch::MoreThuenteLineSearch, quasinewton::LBFGS},
};
use argmin_observer_slog::SlogLogger;
use diffsol::{
    DiffSl, OdeBuilder, OdeEquations, OdeSolverMethod, OdeSolverProblem,
    SensitivitiesOdeSolverMethod,
};
use nalgebra::{DMatrix, DVector};
use std::cell::RefCell;

type M = DMatrix&lt;f64&gt;;
type V = DVector&lt;f64&gt;;
type T = f64;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
type CG = diffsol::LlvmModule;
type Eqn = DiffSl&lt;M, CG&gt;;

struct Problem {
    ys_data: M,
    ts_data: Vec&lt;T&gt;,
    problem: RefCell&lt;OdeSolverProblem&lt;Eqn&gt;&gt;,
}</code></pre>
<p>The argmin <code>CostFunction</code> trait requires an implementation of the <code>cost</code> method, which will calculate the sum-of-squares difference between the synthetic data and the model output. Since the argmin crate does not support constraints, we'll return a large value if the ODE solver fails to converge.</p>
<pre><code class="language-rust ignore">impl CostFunction for Problem {
    type Output = T;
    type Param = Vec&lt;T&gt;;

    fn cost(&amp;self, param: &amp;Self::Param) -&gt; Result&lt;Self::Output, argmin_math::Error&gt; {
        let mut problem = self.problem.borrow_mut();
        problem.eqn_mut().set_params(&amp;V::from_vec(param.clone()));
        let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
        let ys = match solver.solve_dense(&amp;self.ts_data) {
            Ok(ys) =&gt; ys,
            Err(_) =&gt; return Ok(f64::MAX / 1000.),
        };
        let loss = ys
            .column_iter()
            .zip(self.ys_data.column_iter())
            .map(|(a, b)| (a - b).norm_squared())
            .sum::&lt;f64&gt;();
        Ok(loss)
    }
}</code></pre>
<p>The argmin <code>Gradient</code> trait requires an implementation of the <code>gradient</code> method, which will calculate the gradient of the cost function with respect to the parameters. Our sum-of-squares cost function can be written as</p>
<p>\[
\text{loss} = \sum_i (y_i(p) - \hat{y}_i)^2
\]</p>
<p>where \(y_i(p)\) is the model output as a function of the parameters \(p\), and \(\hat{y}_i\) is the observed data at time index \(i\). Threrefore, the gradient of this cost function with respect to the parameters is</p>
<p>\[
\frac{\partial \text{loss}}{\partial p} = 2 \sum_i (y_i(p) - \hat{y}_i) \cdot \frac{\partial y_i}{\partial p}
\]</p>
<p>where \(\frac{\partial y_i}{\partial p}\) is the sensitivity of the model output with respect to the parameters. We can calculate this sensitivity using the <code>solve_dense_sensitivities</code> method of the ODE solver. The gradient of the cost function is then the sum of the dot product of the residuals and the sensitivities for each time point. Again, if the ODE solver fails to converge, we'll return a large value for the gradient.</p>
<pre><code class="language-rust ignore">impl Gradient for Problem {
    type Gradient = Vec&lt;T&gt;;
    type Param = Vec&lt;T&gt;;

    fn gradient(&amp;self, param: &amp;Self::Param) -&gt; Result&lt;Self::Gradient, argmin_math::Error&gt; {
        let mut problem = self.problem.borrow_mut();
        problem.eqn_mut().set_params(&amp;V::from_vec(param.clone()));
        let mut solver = problem.bdf_sens::&lt;LS&gt;().unwrap();
        let (ys, sens) = match solver.solve_dense_sensitivities(&amp;self.ts_data) {
            Ok((ys, sens)) =&gt; (ys, sens),
            Err(_) =&gt; return Ok(vec![f64::MAX / 1000.; param.len()]),
        };
        let dlossdp = sens
            .into_iter()
            .map(|s| {
                s.column_iter()
                    .zip(ys.column_iter().zip(self.ys_data.column_iter()))
                    .map(|(si, (yi, di))| 2.0 * (yi - di).dot(&amp;si))
                    .sum::&lt;f64&gt;()
            })
            .collect::&lt;Vec&lt;f64&gt;&gt;();
        Ok(dlossdp)
    }
}</code></pre>
<p>With these implementation out of the way, we can now perform the fitting problem. We'll generate some synthetic data using the Lotka-Volterra equations with some true parameters, and then fit the model to this data. We'll use the <code>LBFGS</code> solver from the argmin crate, which is a quasi-Newton method that uses the Broyden-Fletcher-Goldfarb-Shanno (BFGS) update formula. We'll also use the <code>SlogLogger</code> observer to log the progress of the optimisation.</p>
<p>We'll initialise the optimizer a short distance away from the true parameter values, and then check the final optimised parameter values against the true values.</p>
<pre><code class="language-rust ignore">pub fn main() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
            in = [ b, d ]
            a { 2.0/3.0 } b { 4.0/3.0 } c { 1.0 } d { 1.0 } x0 { 1.0 } y0 { 1.0 }
            u_i {
                y1 = x0,
                y2 = y0,
            }
            F_i {
                a * y1 - b * y1 * y2,
                c * y1 * y2 - d * y2,
            }
        ",
    )
    .unwrap();

    let (b_true, d_true) = (4.0 / 3.0, 1.0);
    let t_data = (0..101)
        .map(|i| f64::from(i) * 40. / 100.)
        .collect::&lt;Vec&lt;f64&gt;&gt;();
    let problem = OdeBuilder::&lt;M&gt;::new()
        .p([b_true, d_true])
        .sens_atol([1e-6])
        .sens_rtol(1e-6)
        .build_from_eqn(eqn)
        .unwrap();
    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let ys_data = solver.solve_dense(&amp;t_data).unwrap();

    let cost = Problem {
        ys_data,
        ts_data: t_data,
        problem: RefCell::new(problem),
    };

    let init_param = vec![b_true - 0.1, d_true - 0.1];

    let linesearch = MoreThuenteLineSearch::new().with_c(1e-4, 0.9).unwrap();
    let solver = LBFGS::new(linesearch, 7);
    let res = Executor::new(cost, solver)
        .configure(|state| state.param(init_param))
        .add_observer(SlogLogger::term(), ObserverMode::Always)
        .run()
        .unwrap();

    // print result
    println!("{}", res);
    // Best parameter vector
    let best = res.state().best_param.as_ref().unwrap();
    println!("Best parameter vector: {:?}", best);
    println!("True parameter vector: {:?}", vec![b_true, d_true]);
}</code></pre>
<pre><code>Feb 03 13:16:44.604 INFO L-BFGS
Feb 03 13:16:44.842 INFO iter: 0, cost: 21.574177406963013, best_cost: 21.574177406963013, cost_count: 6, gradient_count: 7, gamma: 1, time: 0.238573908
Feb 03 13:16:44.920 INFO iter: 1, cost: 0.6811721224055488, best_cost: 0.6811721224055488, cost_count: 8, gradient_count: 10, time: 0.077082344, gamma: 0.00036901099013336356
Feb 03 13:16:44.969 INFO iter: 2, cost: 0.6478536174002669, best_cost: 0.6478536174002669, cost_count: 9, gradient_count: 12, time: 0.049218286, gamma: 0.00017983731521908368
Feb 03 13:16:45.018 INFO iter: 3, cost: 0.5515637814971768, best_cost: 0.5515637814971768, cost_count: 10, gradient_count: 14, time: 0.049264513, gamma: 0.00013404417466199433
Feb 03 13:16:45.069 INFO iter: 4, cost: 0.2889819270908579, best_cost: 0.2889819270908579, cost_count: 11, gradient_count: 16, time: 0.050718659, gamma: 0.00019004425867568796
Feb 03 13:16:45.120 INFO iter: 5, cost: 0.06441855702549167, best_cost: 0.06441855702549167, cost_count: 12, gradient_count: 18, gamma: 0.0005522578375180803, time: 0.05102388
Feb 03 13:16:45.172 INFO iter: 6, cost: 0.001969603423448309, best_cost: 0.001969603423448309, cost_count: 13, gradient_count: 20, time: 0.051874014, gamma: 0.002084311472606979
Feb 03 13:16:45.224 INFO iter: 7, cost: 0.00018682781933202676, best_cost: 0.00018682781933202676, cost_count: 14, gradient_count: 22, gamma: 0.00020342834067043386, time: 0.051705468
Feb 03 13:16:45.276 INFO iter: 8, cost: 0.0000004145187755175781, best_cost: 0.0000004145187755175781, cost_count: 15, gradient_count: 24, time: 0.052326582, gamma: 0.00013653160933392906
Feb 03 13:16:45.328 INFO iter: 9, cost: 0.00000019683422285908518, best_cost: 0.00000019683422285908518, cost_count: 16, gradient_count: 26, time: 0.05250708, gamma: 0.0002897867622209216
Feb 03 13:16:45.381 INFO iter: 10, cost: 0.00000018573267264008743, best_cost: 0.00000018573267264008743, cost_count: 17, gradient_count: 28, time: 0.052503364, gamma: 0.0006940640307853263
Feb 03 13:16:47.047 INFO iter: 11, cost: 0.0000001857326722089365, best_cost: 0.0000001857326722089365, cost_count: 74, gradient_count: 86, gamma: 0.00012163138683631344, time: 1.665703414
Feb 03 13:16:47.531 INFO iter: 12, cost: 0.00000018573267291060315, best_cost: 0.0000001857326722089365, cost_count: 90, gradient_count: 103, gamma: 0.000001225820261527594, time: 0.484634742
Feb 03 13:16:49.078 INFO iter: 13, cost: 0.000000185732672314337, best_cost: 0.0000001857326722089365, cost_count: 143, gradient_count: 157, time: 1.5466635069999999, gamma: 0.00000005014738728081247
Feb 03 13:16:49.562 INFO iter: 14, cost: 0.00000018573267355654775, best_cost: 0.0000001857326722089365, cost_count: 159, gradient_count: 174, gamma: 0.00000386732692846693, time: 0.483722743
Feb 03 13:16:51.051 INFO iter: 15, cost: 0.0000001857326728225398, best_cost: 0.0000001857326722089365, cost_count: 210, gradient_count: 226, time: 1.489475966, gamma: -0.00000029042697044185633
Feb 03 13:16:51.880 INFO iter: 16, cost: 0.00000018573267387423262, best_cost: 0.0000001857326722089365, cost_count: 238, gradient_count: 255, time: 0.828862625, gamma: 0.0000014262616055754604
Feb 03 13:16:53.202 INFO iter: 17, cost: 0.00000018573267376814762, best_cost: 0.0000001857326722089365, cost_count: 283, gradient_count: 301, gamma: 0.00000006448722374243354, time: 1.32160584
OptimizationResult:
    Solver:        L-BFGS
    param (best):  [1.3333663799297248, 1.0000008551827637]
    cost (best):   0.0000001857326722089365
    iters (best):  11
    iters (total): 18
    termination:   Solver converged
    time:          8.62392681s

Best parameter vector: [1.3333663799297248, 1.0000008551827637]
True parameter vector: [1.3333333333333333, 1.0]
</code></pre>
<p>So, we've successfully fitted the Lotka-Volterra model to some synthetic data and recovered the original true parameters. This is a simple example and could easily be improved. For example, you will note from the output that the argmin crate is calling both the cost and gradient functions, and this is often done using the exact same parameter vector. Ideally we'd like to cache the results of the <code>solve_dense_sensitivities</code> method and reuse them in both the <code>cost</code> and <code>gradient</code> functions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backwards-sensitivity-analysis"><a class="header" href="#backwards-sensitivity-analysis">Backwards Sensitivity Analysis</a></h1>
<p>Backwards sensitivity analysis, as the name suggests, starts from a given cost or loss function that you want to minimise, and derives the gradient of this function with respect to the parameters of the ODE systems using a lagrangian multiplier approach.</p>
<p>DiffSol supports two different classes of loss functions, the first being an integral of a model output function \(g(t, u)\) over time,</p>
<p>$$
G(p) = \int_0^{t_f} g(t, u) dt
$$</p>
<p>The second being a sum of \(n\) discrete functions \(h_i(t, u)\) at time points \(t_i\),</p>
<p>$$
G(p) = \int_0^{t_f} \sum_{i=1}^n h_i(t_i, u) \delta(t - t_i) dt
$$</p>
<p>Note that the \(h_i\) functions can be a combination of the (continuous) model output function \(g\) and a user-defined discrete function, such as the sum of squares difference between the model output and some observed data.</p>
<p>The derivation below is modified from that given in <a href="https://arxiv.org/abs/2001.04385">(Rackauckas et. al. 2021)</a>, and uses the first form of the cost function, but the same approach can be used for the second form.</p>
<h2 id="lagrangian-multiplier-approach"><a class="header" href="#lagrangian-multiplier-approach">Lagrangian Multiplier Approach</a></h2>
<p>We wish to minimise the cost function \(G(p)\) with respect to the parameters \(p\), and subject to the constraits of the ODE system of equations,</p>
<p>$$
M \frac{du}{dt} = f(t, u, p)
$$</p>
<p>where \(M\) is the mass matrix, \(u\) is the state vector, and \(f\) is the right-hand side function. We can write the lagrangian as</p>
<p>$$
L(u, \lambda, p) = G(p) + \int_0^{t_f} \lambda^T (M \frac{du}{dt} - f(t, u, p))
$$</p>
<p>where \(\lambda\) is the lagrangian multiplier. We already know we can generate a solution to the ODE system \(u(t)\) that will satisfy the constaint such that the last term in the lagrangian is zero, meaning that the gradient of the lagrangian is equal to the gradient of the cost function. Therefore, we can write the gradient of the cost function as</p>
<p>$$
\frac{dG}{dp} = \int_0^{t_f} (g_p + g_u u_p) dt - \int_0^{t_f} \lambda^T (M u \frac{du_p}{dt} - f_u u_p - f_p) dt
$$</p>
<p>where \(g_p\) and \(g_u\) are the partial derivatives of the output function \(g\) with respect to the parameters and state variables, respectively, and \(u_p\) is the partial derivative of the state vector with respect to the parameters, also known as the sensitivities.</p>
<p>This equation can be simplified by using integration by parts, and requiring that the adjoint ODE system is satisfied, which is given by</p>
<p>$$
\begin{aligned}
M \frac{d \lambda}{dt} &amp;= -f_u^T \lambda - g_u^T \\
\lambda(t_f) &amp;= 0
\end{aligned}
$$</p>
<p>giving the gradient of the cost function as</p>
<p>$$
\frac{dG}{dp} = \lambda^T(0) M u_p(0) + \int_0^{t_f} (g_p + \lambda^T f_p) dt
$$</p>
<h2 id="solving-the-adjoint-ode-system"><a class="header" href="#solving-the-adjoint-ode-system">Solving the Adjoint ODE System</a></h2>
<p>Solving the adjoint ODE system is done in two stages. First, we solve the forward ODE system to get the state vector \(u(t)\). We require this solution to be valid the entire time interval \([0, t_f]\), so we use a checkpointing system to store the state vector at regular intervals in interpolate between them to get the state vector at any time point. The second stage is to solve the adjoint ODE system backwards in time, starting from the final time point \(t_f\) and using the interpolated state vector to supply \(u(t)\) as needed.</p>
<p>The gradient \(\frac{dG}{dp}\) can be calculated by performing a quadrature over the time interval \([0, t_f]\) to calculate the last term in the equation above. Special consideration needs to be taken for the second form of the cost function above, where the discrete functions are evaluated at specific time points. In this case, the solver will need to be stopped at each time point and the contribution \(M^{-1} g_u^T\) added to the state vector \(\lambda\), and the contribution \(g_p\) added to the gradient \(\frac{dG}{dp}\).</p>
<p>In the case that \(M\) is singular, but can be divided into a singular and zero blocks like so:</p>
<p>$$
M = \begin{bmatrix} M_{11} &amp; 0 \\ 0 &amp; 0 \end{bmatrix}
$$</p>
<p>where \(M_{11}\) is invertible. The corresponding block decomposition of the adjoint Jacobian and the partial derivative of the output function can be written as</p>
<p>$$
f_u^T = \begin{bmatrix} f_{dd} &amp; f_{da} \\ f_{ad} &amp; f_{aa} \end{bmatrix}
$$</p>
<p>and</p>
<p>$$
g_u^T = \begin{bmatrix} g_{d} &amp; g_{a} \end{bmatrix}.
$$</p>
<p>In this case, the contribution to \(\lambda\) can be calculated as</p>
<p>$$
-f_{da} f_{aa}^{-1} g_{a} + M_{11}^{-1} g_{d}
$$</p>
<h2 id="specifying-the-discrete-functions"><a class="header" href="#specifying-the-discrete-functions">Specifying the discrete functions</a></h2>
<p>Here we consider the second form of the cost function. If we have a model output function \(m(t, u)\), and a set of discrete functions \(h_i(t, u)\) which only depend on the model output (i.e. \(h_i(t, u) = h_i(m(t, u))\)), then the partial derivatives of the cost function \(g\) with respect to the parameters can be calculated as</p>
<p>$$
\begin{aligned}
g_u &amp;= g_m m_u \\
g_p &amp;= g_m m_p
\end{aligned}
$$</p>
<p>where \(m_u\) and \(m_p\) are the partial derivatives of the model output function with respect to the state variables and parameters, respectively. Therefore, a user only has to supply \(g_m\) at each of the time points \(t_i\) and DiffSol will be able to calculate the correct gradients as part of the backwards solution of the adjoint ODE system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-fitting-a-spring-mass-model-to-data"><a class="header" href="#example-fitting-a-spring-mass-model-to-data">Example: Fitting a spring-mass model to data</a></h1>
<p>In this example we'll fit a damped spring-mass system to some synthetic data (using the model to generate the data). The system consists of a mass \(m\) attached to a spring with spring constant \(k\), and a damping force proportional to the velocity of the mass with damping coefficient \(c\).</p>
<p>\[
\begin{align*}
\frac{dx}{dt} &amp;= v \\
\frac{dv}{dt} &amp;= -\frac{k}{m} x - \frac{c}{m} v
\end{align*}
\]</p>
<p>where \(v = \frac{dx}{dt}\) is the velocity of the mass.</p>
<p>We'll use the argmin crate to perform the optimisation. To hold the synthetic data and the model, we'll create a <code>struct Problem</code> like so</p>
<pre><code class="language-rust ignore">use argmin::{
    core::{observers::ObserverMode, CostFunction, Executor, Gradient},
    solver::{linesearch::MoreThuenteLineSearch, quasinewton::LBFGS},
};
use argmin_observer_slog::SlogLogger;
use diffsol::{
    AdjointOdeSolverMethod, DiffSl, OdeBuilder, OdeEquations, OdeSolverMethod, OdeSolverProblem,
    OdeSolverState,
};
use nalgebra::{DMatrix, DVector};
use std::cell::RefCell;

type M = DMatrix&lt;f64&gt;;
type V = DVector&lt;f64&gt;;
type T = f64;
type LS = diffsol::NalgebraLU&lt;f64&gt;;
type CG = diffsol::LlvmModule;
type Eqn = DiffSl&lt;M, CG&gt;;

struct Problem {
    ys_data: M,
    ts_data: Vec&lt;T&gt;,
    problem: RefCell&lt;OdeSolverProblem&lt;Eqn&gt;&gt;,
}</code></pre>
<p>To use argmin we need to specify traits giving the loss function and its gradient. In this case we'll define a loss function equal to the sum of squares error between the model output and the synthetic data.</p>
<p>$$
\text{loss} = \sum_i (y_i(p) - \hat{y}_i)^2
$$</p>
<p>where \(y_i(p)\) is the model output as a function of the parameters \(p\), and \(\hat{y}_i\) is the observed data at time index \(i\).</p>
<pre><code class="language-rust ignore">impl CostFunction for Problem {
    type Output = T;
    type Param = Vec&lt;T&gt;;

    fn cost(&amp;self, param: &amp;Self::Param) -&gt; Result&lt;Self::Output, argmin_math::Error&gt; {
        let mut problem = self.problem.borrow_mut();
        problem.eqn_mut().set_params(&amp;V::from_vec(param.clone()));
        let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
        let ys = match solver.solve_dense(&amp;self.ts_data) {
            Ok(ys) =&gt; ys,
            Err(_) =&gt; return Ok(f64::MAX / 1000.),
        };
        let loss = ys
            .column_iter()
            .zip(self.ys_data.column_iter())
            .map(|(a, b)| (a - b).norm_squared())
            .sum::&lt;f64&gt;();
        Ok(loss)
    }
}</code></pre>
<p>The gradient of this cost function with respect to the model outputs \(y_i\) is</p>
<p>$$
\frac{\partial \text{loss}}{\partial y_i} = 2 (y_i(p) - \hat{y}_i)
$$</p>
<p>We can calculate this using DiffSol's adjoint sensitivity analysis functionality. First we solve the forwards problem, generating a checkpointing struct. Using the forward solution we can then calculate \(\frac{\partial loss}{\partial y_i}\) for each time point, and then pass this into the adjoint backwards pass to calculate the gradient of the cost function with respect to the parameters.</p>
<pre><code class="language-rust ignore">impl Gradient for Problem {
    type Gradient = Vec&lt;T&gt;;
    type Param = Vec&lt;T&gt;;

    fn gradient(&amp;self, param: &amp;Self::Param) -&gt; Result&lt;Self::Gradient, argmin_math::Error&gt; {
        let mut problem = self.problem.borrow_mut();
        problem.eqn_mut().set_params(&amp;V::from_vec(param.clone()));
        let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
        let (c, ys) = match solver.solve_dense_with_checkpointing(&amp;self.ts_data, None) {
            Ok(ys) =&gt; ys,
            Err(_) =&gt; return Ok(vec![f64::MAX / 1000.; param.len()]),
        };
        let mut g_m = M::zeros(2, self.ts_data.len());
        for j in 0..g_m.ncols() {
            let g_m_i = 2.0 * (ys.column(j) - self.ys_data.column(j));
            g_m.column_mut(j).copy_from(&amp;g_m_i);
        }
        let adjoint_solver = problem.bdf_solver_adjoint::&lt;LS, _&gt;(c, Some(1)).unwrap();
        match adjoint_solver.solve_adjoint_backwards_pass(self.ts_data.as_slice(), &amp;[&amp;g_m]) {
            Ok(soln) =&gt; Ok(soln.as_ref().sg[0].iter().copied().collect::&lt;Vec&lt;_&gt;&gt;()),
            Err(_) =&gt; Ok(vec![f64::MAX / 1000.; param.len()]),
        }
    }
}</code></pre>
<p>In our main function we'll create the model, generate some synthetic data, and then call argmin to fit the model to the data.</p>
<pre><code class="language-rust ignore">pub fn main() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
        in = [k, c]
        k { 1.0 } m { 1.0 } c { 0.1 }
        u_i {
            x = 1,
            v = 0,
        }
        F_i {
            v,
            -k/m * x - c/m * v,
        }
        ",
    )
    .unwrap();

    let (k_true, c_true) = (1.0, 0.1);
    let t_data = (0..101)
        .map(|i| f64::from(i) * 40. / 100.)
        .collect::&lt;Vec&lt;f64&gt;&gt;();
    let problem = OdeBuilder::&lt;M&gt;::new()
        .p([k_true, c_true])
        .sens_atol([1e-6])
        .sens_rtol(1e-6)
        .out_atol([1e-6])
        .out_rtol(1e-6)
        .build_from_eqn(eqn)
        .unwrap();
    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let ys_data = solver.solve_dense(&amp;t_data).unwrap();

    let cost = Problem {
        ys_data,
        ts_data: t_data,
        problem: RefCell::new(problem),
    };

    let init_param = vec![k_true - 0.1, c_true - 0.01];

    let linesearch = MoreThuenteLineSearch::new().with_c(1e-4, 0.9).unwrap();
    let solver = LBFGS::new(linesearch, 7);
    let res = Executor::new(cost, solver)
        .configure(|state| state.param(init_param))
        .add_observer(SlogLogger::term(), ObserverMode::Always)
        .run()
        .unwrap();

    // print result
    println!("{}", res);
    // Best parameter vector
    let best = res.state().best_param.as_ref().unwrap();
    println!("Best parameter vector: {:?}", best);
    println!("True parameter vector: {:?}", vec![k_true, c_true]);
}</code></pre>
<pre><code>Mar 05 15:12:51.068 INFO L-BFGS
Mar 05 15:12:53.667 INFO iter: 0, cost: 6.099710479003417, best_cost: 6.099710479003417, gradient_count: 14, cost_count: 13, gamma: 1, time: 2.598805685
Mar 05 15:12:54.246 INFO iter: 1, cost: 1.9513388387772255, best_cost: 1.9513388387772255, gradient_count: 18, cost_count: 16, time: 0.579365776, gamma: 0.0009218600784406668
Mar 05 15:12:54.679 INFO iter: 2, cost: 1.1328003486802616, best_cost: 1.1328003486802616, gradient_count: 21, cost_count: 18, gamma: 0.0011158173475820988, time: 0.432772159
Mar 05 15:12:55.100 INFO iter: 3, cost: 0.36245408149937774, best_cost: 0.36245408149937774, gradient_count: 24, cost_count: 20, time: 0.421368339, gamma: 0.0010683972634626152
Mar 05 15:12:55.473 INFO iter: 4, cost: 0.005661451144141899, best_cost: 0.005661451144141899, gradient_count: 27, cost_count: 22, gamma: 0.0010337960155067532, time: 0.372749194
Mar 05 15:12:55.657 INFO iter: 5, cost: 0.0001534604284670027, best_cost: 0.0001534604284670027, gradient_count: 29, cost_count: 23, gamma: 0.0005519136139557582, time: 0.183717262
Mar 05 15:12:55.811 INFO iter: 6, cost: 0.000017178666309946563, best_cost: 0.000017178666309946563, gradient_count: 31, cost_count: 24, time: 0.154246656, gamma: 0.0005222593123731191
Mar 05 15:12:55.934 INFO iter: 7, cost: 0.0000011504081912133204, best_cost: 0.0000011504081912133204, gradient_count: 33, cost_count: 25, gamma: 0.0005839951848538406, time: 0.123233143
Mar 05 15:12:55.999 INFO iter: 8, cost: 0.0000000057304906811474396, best_cost: 0.0000000057304906811474396, gradient_count: 35, cost_count: 26, time: 0.064562531, gamma: 0.0004953781862470435
Mar 05 15:12:56.040 INFO iter: 9, cost: 0.00000000014827166483234088, best_cost: 0.00000000014827166483234088, gradient_count: 37, cost_count: 27, gamma: 0.0004739141598396127, time: 0.041539938
Mar 05 15:12:56.089 INFO iter: 10, cost: 0.00000000005665660355834637, best_cost: 0.00000000005665660355834637, gradient_count: 39, cost_count: 28, time: 0.048698991, gamma: 0.0006574550747061086
Mar 05 15:12:56.150 INFO iter: 11, cost: 0.00000000004046321552763034, best_cost: 0.00000000004046321552763034, gradient_count: 42, cost_count: 30, gamma: 0.0007768025353897974, time: 0.06118116
Mar 05 15:12:56.230 INFO iter: 12, cost: 0.000000000028544950162250156, best_cost: 0.000000000028544950162250156, gradient_count: 45, cost_count: 32, time: 0.079473263, gamma: 0.0007211431129919831
Mar 05 15:12:56.310 INFO iter: 13, cost: 0.000000000019824882126122364, best_cost: 0.000000000019824882126122364, gradient_count: 48, cost_count: 34, gamma: 0.0005276999999419798, time: 0.079908383
Mar 05 15:12:56.399 INFO iter: 14, cost: 0.000000000014773791668031016, best_cost: 0.000000000014773791668031016, gradient_count: 51, cost_count: 36, time: 0.088933521, gamma: 0.0006137808250157392
Mar 05 15:12:56.488 INFO iter: 15, cost: 0.000000000011918443921135866, best_cost: 0.000000000011918443921135866, gradient_count: 54, cost_count: 38, time: 0.088925265, gamma: 0.0006964726153446881
Mar 05 15:12:56.577 INFO iter: 16, cost: 0.000000000009847613120347547, best_cost: 0.000000000009847613120347547, gradient_count: 57, cost_count: 40, gamma: 0.0006788190120544423, time: 0.088873097
Mar 05 15:12:56.666 INFO iter: 17, cost: 0.000000000008250422213735562, best_cost: 0.000000000008250422213735562, gradient_count: 60, cost_count: 42, gamma: 0.0007147657772943421, time: 0.089253633
Mar 05 15:12:56.735 INFO iter: 18, cost: 0.000000000006963535307175679, best_cost: 0.000000000006963535307175679, gradient_count: 63, cost_count: 44, gamma: 0.0007522010953601424, time: 0.069181779
Mar 05 15:12:56.794 INFO iter: 19, cost: 0.000000000005843346318988485, best_cost: 0.000000000005843346318988485, gradient_count: 66, cost_count: 46, gamma: 0.0008115415177531896, time: 0.05931185
Mar 05 15:12:56.875 INFO iter: 20, cost: 0.000000000005668499496383206, best_cost: 0.000000000005668499496383206, gradient_count: 70, cost_count: 49, gamma: 0.0007981283294910353, time: 0.080732485
Mar 05 15:12:56.966 INFO iter: 21, cost: 0.000000000005235587953062947, best_cost: 0.000000000005235587953062947, gradient_count: 74, cost_count: 52, gamma: 0.0007824334700764565, time: 0.090509819
Mar 05 15:12:57.025 INFO iter: 22, cost: 0.000000000005176697246946799, best_cost: 0.000000000005176697246946799, gradient_count: 77, cost_count: 54, time: 0.05927997, gamma: 0.0007160320701376257
Mar 05 15:12:57.084 INFO iter: 23, cost: 0.000000000005123431411964367, best_cost: 0.000000000005123431411964367, gradient_count: 80, cost_count: 56, time: 0.059282524, gamma: 0.0006691254860074899
Mar 05 15:12:57.145 INFO iter: 24, cost: 0.000000000004888671439469577, best_cost: 0.000000000004888671439469577, gradient_count: 83, cost_count: 58, time: 0.060525746, gamma: 0.0006870970887038928
Mar 05 15:12:57.205 INFO iter: 25, cost: 0.000000000004640183634642808, best_cost: 0.000000000004640183634642808, gradient_count: 86, cost_count: 60, time: 0.060494317, gamma: 0.0006938418390339419
Mar 05 15:12:57.266 INFO iter: 26, cost: 0.000000000004202140058725012, best_cost: 0.000000000004202140058725012, gradient_count: 89, cost_count: 62, gamma: 0.0008074272439861259, time: 0.060721945
Mar 05 15:12:57.327 INFO iter: 27, cost: 0.000000000003819065447066373, best_cost: 0.000000000003819065447066373, gradient_count: 92, cost_count: 64, time: 0.060539541, gamma: 0.000745089693258659
Mar 05 15:12:57.388 INFO iter: 28, cost: 0.0000000000034723813904317016, best_cost: 0.0000000000034723813904317016, gradient_count: 95, cost_count: 66, time: 0.061195346, gamma: 0.0006679419374299279
Mar 05 15:12:57.449 INFO iter: 29, cost: 0.0000000000029793598830196132, best_cost: 0.0000000000029793598830196132, gradient_count: 98, cost_count: 68, gamma: 0.0006803520819495024, time: 0.061207339
Mar 05 15:12:57.510 INFO iter: 30, cost: 0.000000000002000300316746391, best_cost: 0.000000000002000300316746391, gradient_count: 101, cost_count: 70, gamma: 0.0007707919521852348, time: 0.061103644
Mar 05 15:12:57.571 INFO iter: 31, cost: 0.0000000000013081231359178465, best_cost: 0.0000000000013081231359178465, gradient_count: 104, cost_count: 72, gamma: 0.0007594375561408552, time: 0.061080561
Mar 05 15:12:57.632 INFO iter: 32, cost: 0.0000000000009129669554476711, best_cost: 0.0000000000009129669554476711, gradient_count: 107, cost_count: 74, gamma: 0.0007714623407119796, time: 0.061010138
Mar 05 15:12:57.693 INFO iter: 33, cost: 0.0000000000006624988392852611, best_cost: 0.0000000000006624988392852611, gradient_count: 110, cost_count: 76, time: 0.060805933, gamma: 0.0006929806628651383
Mar 05 15:12:57.732 INFO iter: 34, cost: 0.0000000000006457742400885126, best_cost: 0.0000000000006457742400885126, gradient_count: 112, cost_count: 77, gamma: 0.0006611075118236918, time: 0.038888894
Mar 05 15:12:57.771 INFO iter: 35, cost: 0.0000000000004844629418810476, best_cost: 0.0000000000004844629418810476, gradient_count: 114, cost_count: 78, time: 0.038867624, gamma: 0.0006746920875937051
Mar 05 15:12:57.832 INFO iter: 36, cost: 0.00000000000021331454699420582, best_cost: 0.00000000000021331454699420582, gradient_count: 117, cost_count: 80, time: 0.060733748, gamma: 0.0006901151177651382
Mar 05 15:12:57.870 INFO iter: 37, cost: 0.0000000000001604124255790092, best_cost: 0.0000000000001604124255790092, gradient_count: 119, cost_count: 81, gamma: 0.0007678508731651804, time: 0.038720877
Mar 05 15:12:57.909 INFO iter: 38, cost: 0.00000000000006736683702894452, best_cost: 0.00000000000006736683702894452, gradient_count: 121, cost_count: 82, time: 0.038724956, gamma: 0.0007450395288400451
Mar 05 15:12:57.948 INFO iter: 39, cost: 0.000000000000033549027916251836, best_cost: 0.000000000000033549027916251836, gradient_count: 123, cost_count: 83, gamma: 0.0007953280906606892, time: 0.038636279
Mar 05 15:12:57.986 INFO iter: 40, cost: 0.0000000000000009190438168193556, best_cost: 0.0000000000000009190438168193556, gradient_count: 125, cost_count: 84, gamma: 0.0008377658208246105, time: 0.038537432
Mar 05 15:12:58.024 INFO iter: 41, cost: 0.0000000000000000010640888952026633, best_cost: 0.0000000000000000010640888952026633, gradient_count: 127, cost_count: 85, gamma: 0.0008326080674532384, time: 0.037460313
Mar 05 15:12:58.060 INFO iter: 42, cost: 0.0000000000000000000003834750428076903, best_cost: 0.0000000000000000000003834750428076903, gradient_count: 129, cost_count: 86, time: 0.036246197, gamma: 0.0008348526737634932
OptimizationResult:
    Solver:        L-BFGS
    param (best):  [0.9999999999993618, 0.0999999999999094]
    cost (best):   0.0000000000000000000003834750428076903
    iters (best):  42
    iters (total): 43
    termination:   Solver converged
    time:          7.139444823s

Best parameter vector: [0.9999999999993618, 0.0999999999999094]
True parameter vector: [1.0, 0.1]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-weather-prediction-using-neural-odes"><a class="header" href="#example-weather-prediction-using-neural-odes">Example: Weather prediction using Neural ODEs</a></h1>
<p>If we wish to train a neural network to predict the weather or any other time series dataset, we can use a Neural ODE. A Neural ODE replaces the rhs of an ODE with a neural network.</p>
<p>$$
\frac{dy}{dt} = f(y, p)
$$</p>
<p>Here, \(y(t)\) is the state of the system at time \(t\), and \(f\) is a neural network with parameters \(p\). The neural network is trained to predict the derivative of the state, and the ODE solver is used to integrate the state forward in time, and to calculate gradients of the loss function with respect to the parameters of the neural network.</p>
<p>In this example, we will duplicate the weather prediction example from the excellent <a href="https://sebastiancallh.github.io/post/neural-ode-weather-forecast/">blog post</a> by Sebastian Callh, but instead using DiffSol as the solver. We'll skip over some of the details, but you can read more details about the problem setup in the original blog post, and see the full code in the <a href="https://github.com/martinjrobins/diffsol">DiffSol repository</a>.</p>
<p>First we'll need a neural network model, and we'll use <a href="https://github.com/patrick-kidger/equinox">Equinox</a> and <a href="https://docs.jax.dev/en/latest/index.html">JAX</a> for this. We'll define a simple neural network with 3 layers like so</p>
<pre><code class="language-python">class NeuralNetwork(eqx.Module):
    layers: list

    def __init__(self, data_dim, key):
        key1, key2, key3 = jax.random.split(key, 3)
        self.layers = [
            eqx.nn.Linear(data_dim, 64, key=key1),
            eqx.nn.Linear(64, 32, key=key2),
            eqx.nn.Linear(32, data_dim, key=key3),
        ]

    def __call__(self, x):
        x = jax.nn.silu(self.layers[0](x))  # Swish = SiLU
        x = jax.nn.silu(self.layers[1](x))
        x = self.layers[2](x)
        return x
</code></pre>
<p>We will then create four JAX functions that will allow us to calculate:</p>
<ul>
<li>the rhs function \(f(y, p)\) of the Neural ODE, where \(y\) is the state of the system and \(p\) are the parameters.</li>
<li>the Jacobian-vector product of the rhs function with respect to the state \(y\).</li>
<li>the negative vector-Jacobian product of the rhs function with respect to the state \(y\).</li>
<li>the negative vector-Jacobian product of the rhs function with respect to the parameters \(p\).</li>
</ul>
<p>We will need all four of these to define the ODE problem and to solve it using DiffSol.</p>
<pre><code class="language-python">key = jax.random.PRNGKey(0)
model = NeuralNetwork(data_dim=data_dim, key=key)
y = jnp.zeros((data_dim,))
v = jnp.zeros((data_dim,))
params, static = eqx.partition(model, eqx.is_array)
p, unravel_params = ravel_pytree(params)


def rhs(p, y):
    params = unravel_params(p)
    model = eqx.combine(params, static)
    return model(y)


def rhs_jac_mul(p, y, v):
    return jax.jvp(ft.partial(rhs, p), (y,), (v,))[1]


def rhs_jac_transpose_mul(p, y, v):
    return -jax.vjp(ft.partial(rhs, p), y)[1](v)[0]


def rhs_sens_transpose_mul(p, y, v):
    return -jax.vjp(ft.partial(rhs, y=y), p)[1](v)[0]
</code></pre>
<p>Finally, we can export all four of these JAX functions to ONNX, which will allow us to use them within rust.</p>
<pre><code class="language-python">def to_onnx(model, inputs, filename):
    sig = [tf.TensorSpec(inpt[0].shape, inpt[0].dtype, name=inpt[1]) for inpt in inputs]
    inference_tf = jax2tf.convert(model, enable_xla=False)
    inference_tf = tf.function(inference_tf, autograph=False)
    inference_onnx = tf2onnx.convert.from_function(inference_tf, input_signature=sig)
    model_proto, _external_tensor_storage = inference_onnx
    with open(filename, "wb") as f:
        f.write(model_proto.SerializeToString())
    return model_proto
</code></pre>
<p>Within rust now, we can define a DiffSol system of equations by creating a struct <code>NeuralOde</code>. We'll use the <a href="https://ort.pyke.io/"><code>ort</code></a> crate and the ONNX Runtime to load the ONNX models that we made in Python.</p>
<pre><code class="language-rust ignore">struct NeuralOde {
    rhs: Session,
    rhs_jac_mul: Session,
    rhs_jac_transpose_mul: Session,
    rhs_sens_transpose_mul: Session,
    input_y: RefCell&lt;Array1&lt;f32&gt;&gt;,
    input_v: RefCell&lt;Array1&lt;f32&gt;&gt;,
    input_p: Array1&lt;f32&gt;,
    y0: V,
}

impl NeuralOde {
    fn new_session(filename: &amp;str) -&gt; Result&lt;Session&gt; {
        let full_filename = format!("{}{}", BASE_MODEL_DIR, filename);
        let session = Session::builder()?
            .with_optimization_level(GraphOptimizationLevel::Level3)?
            .with_intra_threads(4)?
            .commit_from_file(full_filename.as_str())?;
        Ok(session)
    }
    fn new(y0: V) -&gt; Result&lt;Self&gt; {
        let rhs = Self::new_session("rhs.onnx")?;
        let rhs_jac_mul = Self::new_session("rhs_jac_mul.onnx")?;
        let rhs_jac_transpose_mul = Self::new_session("rhs_jac_transpose_mul.onnx")?;
        let rhs_sens_transpose_mul = Self::new_session("rhs_sens_transpose_mul.onnx")?;
        let mut nparams = 0;
        for input in rhs.inputs.iter() {
            if input.name == "p" {
                nparams = input.input_type.tensor_dimensions().unwrap()[0] as usize;
                break;
            }
        }
        let mut rng = rand::rng();
        let elem = Uniform::&lt;f32&gt;::new(0.0, 1.0).unwrap();
        let params = Array1::from_shape_fn((nparams,), |_| elem.sample(&amp;mut rng));
        let y0_ndarray = Array1::from_shape_fn((y0.len(),), |i| y0[i] as f32);

        Ok(Self {
            y0,
            rhs,
            rhs_jac_mul,
            rhs_jac_transpose_mul,
            rhs_sens_transpose_mul,
            input_p: params,
            input_v: RefCell::new(y0_ndarray.clone()),
            input_y: RefCell::new(y0_ndarray),
        })
    }

    fn data_dim(&amp;self) -&gt; usize {
        self.y0.len()
    }
}</code></pre>
<p>We'll also implement the <code>OdeSystemAdjoint</code> trait for <code>NeuralOde</code>, which will allow us to use the adjoint method to calculate gradients of out loss function with respect to the parameters of the neural network. As an example, here is the implementation of the <code>NonLinearOp</code> trait:</p>
<pre><code class="language-rust ignore">impl NonLinearOp for Rhs&lt;'_&gt; {
    fn call_inplace(&amp;self, x: &amp;Self::V, _t: Self::T, y: &amp;mut Self::V) {
        let mut y_input = self.0.input_y.borrow_mut();
        y_input
            .iter_mut()
            .zip(x.iter())
            .for_each(|(y, x)| *y = *x as f32);
        let outputs = self
            .0
            .rhs
            .run(
                inputs![
                    "p" =&gt; self.0.input_p.view(),
                    "y" =&gt; y_input.view(),
                ]
                .unwrap(),
            )
            .unwrap();
        let y_data = outputs["Identity_1:0"].try_extract_tensor::&lt;f32&gt;().unwrap();
        y.iter_mut()
            .zip(y_data.as_slice().unwrap())
            .for_each(|(y, x)| *y = *x as f64);
    }
}</code></pre>
<p>We'll also need an optimiser, so we'll write an AdamW algorithm using the definition in the <a href="https://pytorch.org/docs/stable/generated/torch.optim.AdamW.html">PyTorch documentation</a> as a guide:</p>
<pre><code class="language-rust ignore">impl AdamW {
    fn new(nparams: usize) -&gt; Self {
        let lr = 1e-2;
        let betas = (0.9, 0.999);
        let eps = 1e-8;
        let m = V::zeros(nparams);
        let m_hat = V::zeros(nparams);
        let v = V::zeros(nparams);
        let v_hat = V::zeros(nparams);
        let lambda = 1e-2;
        Self {
            lr,
            betas,
            eps,
            m,
            m_hat,
            v,
            v_hat,
            lambda,
            t: 0,
        }
    }

    fn step(&amp;mut self, params: &amp;mut V, grads: &amp;V) {
        self.t += 1;
        params.mul_assign(1.0 - self.lr * self.lambda);
        self.m.axpy(1.0 - self.betas.0, grads, self.betas.0);
        self.v.axpy(
            1.0 - self.betas.1,
            &amp;grads.component_mul(grads),
            self.betas.1,
        );
        self.m_hat = &amp;self.m / (1.0 - self.betas.0.powi(self.t));
        self.v_hat = &amp;self.v / (1.0 - self.betas.1.powi(self.t));
        params
            .iter_mut()
            .zip(self.v_hat.iter())
            .zip(self.m_hat.iter())
            .for_each(|((params_i, v_hat_i), m_hat_i)| {
                *params_i -= self.lr * m_hat_i / (v_hat_i.sqrt() + self.eps)
            });
    }
}</code></pre>
<p>We'll then define our loss function, which will return the sum of squared errors between the solution and the data points, along with the gradients of the loss function with respect to the parameters. Since the size of the parameter vector is quite large (&gt;2000), we'll use the adjoint method to calculate the gradients.</p>
<pre><code class="language-rust ignore">fn loss_fn(
    problem: &amp;mut OdeSolverProblem&lt;NeuralOde&gt;,
    p: &amp;V,
    ts_data: &amp;[T],
    ys_data: &amp;M,
    g_m: &amp;mut M,
) -&gt; Result&lt;(T, V), DiffsolError&gt; {
    problem.eqn.set_params(p);
    let (c, ys) = problem
        .bdf::&lt;LS&gt;()?
        .solve_dense_with_checkpointing(ts_data, None)?;
    let mut loss = 0.0;
    for j in 0..g_m.ncols() {
        let delta = ys.column(j) - ys_data.column(j);
        loss += delta.dot(&amp;delta);
        let g_m_i = 2.0 * delta;
        g_m.column_mut(j).copy_from(&amp;g_m_i);
    }
    let adjoint_solver = problem.bdf_solver_adjoint::&lt;LS, _&gt;(c, Some(1)).unwrap();
    let soln = adjoint_solver.solve_adjoint_backwards_pass(ts_data, &amp;[g_m])?;
    Ok((loss, soln.into_common().sg.pop().unwrap()))
}</code></pre>
<p>Finally, we can train the neural network to predict the weather. Following the example given in the linked blog post above, we'll train in stages by increasing the number of datapoints by four each time. Each time we'll train for 150 steps using the AdamW optimiser.</p>
<pre><code class="language-rust ignore">fn train_one_round(
    problem: &amp;mut OdeSolverProblem&lt;NeuralOde&gt;,
    ts_data: &amp;[T],
    ys_data: &amp;M,
    p: &amp;mut V,
) {
    let mut gm = M::zeros(problem.eqn.nout(), ts_data.len());
    let mut adam = AdamW::new(problem.eqn.nparams());
    for _ in 0..150 {
        match loss_fn(problem, p, ts_data, ys_data, &amp;mut gm) {
            Ok((loss, g)) =&gt; {
                println!("loss: {}", loss);
                adam.step(p, &amp;g)
            }
            Err(e) =&gt; {
                panic!("{}", e);
            }
        };
    }
}</code></pre>
<p>To give an indication of the results, we'll plot the results after we've used the first 20 data-points to train the model, and we'll predict the model solution to the entire dataset.</p>
<div id="neural-ode-weather-prediction" class="plotly-graph-div" style="height:100%; width:100%;"></div>
<script type="text/javascript">
    Plotly.newPlot("neural-ode-weather-prediction", {"data":[{"type":"scatter","name":"mean_temp_data","mode":"markers","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[-1.8746853167178659,-1.191136175338744,-0.34302325286684865,0.5242379785018397,1.2204600070685376,1.0356392870547464,0.7764584747154226,0.6173196324731776,0.6590820769246282,0.1297597571839188,-0.9138613708403621,-1.43191062565957,-1.6811401485200248,-1.350977634598048,-0.517147085210099,0.40489534845729463,0.8822735363935678,1.3622341157160343,0.9719293885451523,0.8831917343164234,0.6479441105980918,0.18215245283677287,-0.7295302919504851,-1.4826273684721798,-1.784298879716084,-0.9167497553279891,-0.5236372947384939,0.3970002961069298,1.1599559187477058,1.0722395046531752,0.740228317727797,0.7289936828795937,0.7745196273120032,0.234731365471876,-0.6368270966107191,-1.4589668577863832,-1.4376121514984388,-0.8833449276118914,0.06870249488640581,1.0455023341197416,1.3562287140913167,1.3873356804220447,0.8067242113010039,0.8410630606549492,0.8928614257188988,0.5337309523464745,-0.32260436328875725,-1.0763261134169495,-1.381555913431708,-0.9797127576870259,-0.20902418198438702,0.7893040760475085]},{"type":"scatter","name":"mean_temp_predict","mode":"lines","x":[20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[0.5060383828209065,0.04193911626713242,-0.7254366254067464,-1.3883146554051666,-1.4869132109102785,-1.0726413892822,-0.40489765955201756,0.318529041633813,0.9680258979043675,1.0645743295024983,0.7630761213855735,0.5902499330719362,0.3205967780516363,-0.24153137372216754,-0.9723819683233675,-1.3863766018528885,-1.240619741688715,-0.7084762970892232,-0.02427274050617308,0.6598567441575677,1.0806699147398666,0.8593658100477722,0.6322403740336222,0.43076839409923745,0.0064382482304854265,-0.6715695517694305,-1.2356740486477213,-1.2922936866754282,-0.8859842384153864,-0.2501026354634277,0.4328517510612345,0.9905036810103283],"line":{"dash":"dash"}},{"type":"scatter","name":"mean_temp_train","mode":"lines","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0],"y":[-1.8746853167178659,-1.1677074134377627,-0.27424020186330245,0.5721634930931321,1.3051224320933414,1.2496087247869545,0.9210821689242298,0.8211757203220286,0.6160116384203276,0.06563801797885854,-0.8392854454415533,-1.6311701341335758,-1.7697077179983427,-1.335077067567901,-0.6224731732393086,0.15299347209451797,0.8825335427039144,1.2067700427035408,0.8869571357612991,0.6983550398934004]},{"type":"scatter","name":"humidity_data","mode":"markers","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[0.8950089305979064,0.8184103047433504,-0.20183686865692718,-1.8040933293829653,-2.202730212994396,-0.10762770079530037,1.0246068502230388,1.1569541354946669,0.29949282403523664,0.7001682134282649,0.41845563613457704,1.323980122095417,1.7060583058048504,0.9165990441519875,0.14288609682316306,-1.3793356733953719,-1.3031210452311734,-1.2376057394135584,0.1796056740310767,0.07926902459519647,0.21749940162014536,-0.08398378579252481,-0.3482493581632638,0.6785672111065525,1.2575933294242039,0.287139623154479,0.5427852423530937,-0.6082897032499905,-1.8948552226214292,-0.7705953609022242,0.6383789860775846,0.7321413932637466,-0.44553238337084616,-0.06859111551456204,0.459138693017879,0.7978772688964758,1.239563264720876,0.14719733837967122,-0.36904653372051155,-2.181237069647178,-1.4987058660408903,-0.5993249801179769,1.0637023440578648,0.8925177716576211,0.05066318582633409,-0.28605047830554076,-0.43831963898277326,0.6007366987949436,1.237331212246076,0.2870563774340041,-0.8627978014632336,-2.099454636427636],"xaxis":"x2","yaxis":"y2"},{"type":"scatter","name":"humidity_predict","mode":"lines","x":[20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[0.4407974417384145,0.335814018420799,0.5158460174284373,0.9931786560029403,1.1060975632685313,0.6218795476893627,-0.25798797564789194,-1.2387797068746957,-1.7382489951368236,-0.6120630145600937,0.393577748460331,0.4634403521624105,0.321400881278544,0.2961533033116729,0.617596130581661,0.9610535309326262,0.8006096017626734,0.13315669564872196,-0.7921572180546502,-1.5996421120082955,-1.2931774050911802,0.0371704633572415,0.44333343400499464,0.3416423374706693,0.2471075903481689,0.41562183943913394,0.8005026101792501,0.8456317266493134,0.3532323353512654,-0.49062470726486385,-1.3734248708167078,-1.576158796545749],"xaxis":"x2","yaxis":"y2","line":{"dash":"dash"}},{"type":"scatter","name":"humidity_train","mode":"lines","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0],"y":[0.8950089305979064,0.7108661688706004,-0.42504698027140525,-1.6080680880546758,-2.037294863541058,-0.27375744840966004,0.7387824936591638,0.7329283319935981,0.591888572660724,0.4902971294622061,0.6875435302423974,1.2999314020629875,1.490222237507779,1.004723156423658,0.07901898187616987,-1.0029551446821268,-1.811145867880187,-1.054549140643468,0.34199840410427806,0.5872969027362414],"xaxis":"x2","yaxis":"y2"},{"type":"scatter","name":"wind_speed_data","mode":"markers","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[-1.0622483675084964,0.2866089963180661,0.9421809893820605,0.5789924449321752,1.0373011430961487,1.3696272046593463,0.22765562861257518,0.2407596157966106,0.34757656753348704,-2.0829192830312144,-1.3594221675986469,-0.9845465695692052,-0.6909968521750836,-0.2609995874388895,0.1077303079621565,0.9990751310733674,0.8498546787208348,1.6339249536569462,0.31445253517161675,0.3843280410197091,0.5833634490117884,-1.4943248282947406,-1.9344747891951188,-1.4199564147282107,-0.8439028622346405,-0.30404132105812964,0.4026435934192968,0.8260697353712222,1.0996524999921853,0.9482591675967841,0.851973604631713,-0.7336819279607797,0.16141761224482387,-1.0131520693660658,-2.4500545885859024,-1.5928254536240538,-1.3425959992967833,-0.4917412468745312,0.14908249030672655,1.4173595423450718,1.3249209733111336,1.0927982978620754,-0.3607338004223368,0.1304289050754564,0.30394817226034127,0.19307941442785168,-0.4697054669186651,-0.3987000366911636,0.013304160751089191,0.3337158648364214,1.0071240196883449,1.1318138915052034],"xaxis":"x3","yaxis":"y3"},{"type":"scatter","name":"wind_speed_predict","mode":"lines","x":[20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[-0.4228687935091334,-0.9996557480787458,-1.31873531130892,-1.072071105863789,-0.5702695012987853,-0.08595159554654438,0.31812784635206537,0.6347377690601093,0.8991313933492054,0.9451827446268815,0.4738709888535102,-0.08248380170250207,-0.6324227801268121,-1.1257603214944256,-1.2020583730407213,-0.8281406935830292,-0.33756770618309173,0.1027622951347252,0.4595444803796398,0.7380213553564698,0.9393780797388633,0.6778808905119631,0.13626429270735502,-0.4073279697318359,-0.9312633964706645,-1.199545887197881,-0.9740900287706836,-0.5099672588270758,-0.05132892063443479,0.3327856013769102,0.6319531350232903,0.8709498822409896],"xaxis":"x3","yaxis":"y3","line":{"dash":"dash"}},{"type":"scatter","name":"wind_speed_train","mode":"lines","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0],"y":[-1.0622483675084964,0.14570652996633918,0.6363304646567752,0.9565475142803184,1.2719398172779446,1.2745631037834169,0.6966664863480119,0.12264955555984441,-0.45352964505024623,-1.1194222303856145,-1.4971195964154558,-1.197928307983989,-0.6416371329665119,-0.1273665175081518,0.29795771423888784,0.6338826524392149,0.9110033275159173,1.1004216636251638,0.7097716060545158,0.13693358648670925],"xaxis":"x3","yaxis":"y3"},{"type":"scatter","name":"meanpressure_data","mode":"markers","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[0.21925806231331432,0.16196180503671928,0.03505782026846573,-0.12888834765053261,-0.32075094983053937,-0.3965344479451143,-0.39739460598099435,-0.3052111804095199,-0.19948463347672396,-0.021736213055168815,0.14410077529269752,0.16784064342639346,0.2515617152233699,0.11678189690344691,0.08146423912839706,-0.06445524861193747,-0.20890417965998495,-0.4180165313979852,-0.37296060133114023,-0.30107744738510017,-0.1886096874010716,0.029034438568977094,0.10596792512967107,0.17365460674562827,0.2506534642371775,0.13115441091692204,0.10183914341729557,-0.09426092205806323,-0.24331937148697244,-0.33778152357730107,-0.35457143973791216,-0.2712191641216393,-0.15724378917166348,0.026552657211810764,0.12228751769042931,0.20789624742875867,0.19436851426886093,0.1652695224992091,6.525728778113121,-0.1455896670984204,-0.26279450845946706,-0.3772031571178986,-0.38510602798823973,-2.281426436921991,0.1711144550392202,-0.041197649219321036,-0.5573537359972486,0.1723558237466763,-0.6896062220111515,0.15076147595248865,-0.003032656175887003,-0.18093559328023856],"xaxis":"x4","yaxis":"y4"},{"type":"scatter","name":"meanpressure_predict","mode":"lines","x":[20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0],"y":[-0.17568835608974,-0.2166154698471055,-0.20617080399140617,-0.11715975597921402,-0.035660706286728815,-0.0073462667892219835,-0.026932269562164848,-0.10513314486121329,-0.3200999829262922,-0.47296756047778854,-0.29823119130267367,-0.1908697470751912,-0.2008855718262165,-0.22672690317327948,-0.1802678589620928,-0.08913276726560221,-0.03160267431544212,-0.025633190749212338,-0.06908898157371787,-0.20551600064031944,-0.446749914078238,-0.38853563755360926,-0.22982503436516696,-0.19525832774225874,-0.22410067611669898,-0.21008817477378816,-0.12830198004788063,-0.054684780455038766,-0.03040693375748028,-0.05497440636232242,-0.15024396906162527,-0.3771716617933828],"xaxis":"x4","yaxis":"y4","line":{"dash":"dash"}},{"type":"scatter","name":"meanpressure_train","mode":"lines","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0],"y":[0.21925806231331432,0.09602004286261275,0.030306935498949094,-0.07640026001255688,-0.3706474144648388,-0.49535287577305603,-0.24938273587836196,-0.1359544221285176,-0.15608752738734358,-0.20450063860009224,-0.19488533166584593,-0.0960391562043246,-0.006060927207692561,0.024922960306250363,0.008110458628185142,-0.05422809357077196,-0.23365767706778004,-0.48916326281258143,-0.3465004539854287,-0.19057609603297523],"xaxis":"x4","yaxis":"y4"}],"layout":{"grid":{"rows":4,"columns":1,"pattern":"independent"},"yaxis":{"range":[-2.0,2.0]},"yaxis2":{"range":[-2.0,2.0]},"yaxis3":{"range":[-2.0,2.0]},"yaxis4":{"range":[-0.75,0.5]}},"config":{}});
</script>
<p>This seems to work well, and is good at matching the data points a long way into the future. This has been a whirlwind description of both Neural ODEs and this particular analysis. For a more detailed explanation, please refer to the original blog post by Sebastian Callh. We've also skipped over many more boring parts of the code, and you can see the full code for this example in the <a href="https://github.com/martinjrobins/diffsol">DiffSol repository</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="diffsol-apis-for-specifying-problems"><a class="header" href="#diffsol-apis-for-specifying-problems">DiffSol APIs for specifying problems</a></h1>
<p>Most of the DiffSol user-facing API revolves around specifying the problem you want to solve, thus a large part of this book will be dedicated to explaining how to specify a problem. All the examples presented in <a href="specify/../primer/modelling_with_odes.html">the primer</a> used the DiffSL DSL to specify the problem, but DiffSol also provides a pure Rust API for specifying problems. This API is sometimes more verbose than the DSL, but is more flexible, more performant, and easier to use if you have a model already written in Rust or another language that you can easily port or call from Rust.</p>
<h2 id="ode-equations"><a class="header" href="#ode-equations">ODE equations</a></h2>
<p>The class of ODE equations that DiffSol can solve are of the form</p>
<p>\[M(t) \frac{dy}{dt} = f(t, y, p),\]
\[y(t_0) = y_0(t_0, p),\]
\[z(t) = g(t, y, p),\]</p>
<p>where:</p>
<ul>
<li>\(f(t, y, p)\) is the right-hand side of the ODE,</li>
<li>\(y\) is the state vector,</li>
<li>\(p\) are the parameters,</li>
<li>\(t\) is the time.</li>
<li>\(y_0(t_0, p)\) is the initial state vector at time \(t_0\).</li>
<li>\(M(t)\) is the mass matrix (this is optional, and is implicitly the identity matrix if not specified),</li>
<li>\(g(t, y, p)\) is an output function that can be used to calculate additional outputs from the state vector (this is optional, and is implicitly \(g(t, y, p) = y\) if not specified).</li>
</ul>
<p>The user can also optionally specify a root function \(r(t, y, p)\) that can be used to find the time at which a root occurs.</p>
<h2 id="diffsol-problem-apis"><a class="header" href="#diffsol-problem-apis">DiffSol problem APIs</a></h2>
<p>Specifying a problem in DiffSol is done via the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct, using the <code>OdeBuilder::new</code> method to create a new builder, and then chaining methods to set the equations to be solved, initial time, initial step size, relative &amp; absolute tolerances, and parameters, or leaving them at their default values. Then, call the <code>build</code> method to create a new problem.</p>
<p>Users can specify the equations to be solved via three main APIs, ranging from the simplest to the most complex (but also the most flexible):</p>
<ul>
<li>The <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/diffsl/struct.DiffSl.html"><code>DiffSl</code></a> struct allows users to specify the equations above using the <a href="https://martinjrobins.github.io/diffsl/">DiffSL</a>
Domain Specific Language (DSL). This API is behind a feature flag (<code>diffsl</code> if you want to use the slower cranelift backend, <code>diffsl-llvm*</code> if you want to use the faster LLVM backend). This is the easiest API to use as it can use automatic differentiation to calculate the neccessary gradients, and is the best API if you want to use DiffSL from a higher-level language like Python or R while still having similar performance to Rust.</li>
<li>The <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct also has methods to set the equations using rust closures (see e.g. <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html#method.rhs_implicit">OdeBuilder::rhs_implicit</a>). This API is convenient if you want to stick to pure rust code without using DiffSL and the JIT compiler, but requires you to calculate the gradients of the equations yourself.</li>
<li>Implementing the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/equations/trait.OdeEquations.html"><code>OdeEquations</code></a> trait allows users to implement the equations on their own structs. This API is the most flexible as it allows users to use custom data structures and code that might not fit within the <code>OdeBuilder</code> API. However, it is the most verbose API and requires users to be more familiar with the various DiffSol traits.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ode-equations-1"><a class="header" href="#ode-equations-1">ODE equations</a></h1>
<p>To create a new ode problem, use the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct. You can create a builder using the <code>OdeBuilder::new</code> method, and then chain methods to set the equations to be solve, initial time, initial step size, relative &amp; absolute tolerances, and parameters, or leave them at their default values. Then, call the <code>build</code> method to create a new problem.</p>
<p>Below is an example of how to create a new ODE problem using the <code>OdeBuilder</code> struct.
The specific problem we will solve is the logistic equation</p>
<p>\[\frac{dy}{dt} = r y (1 - y/K),\]</p>
<p>where \(r\) is the growth rate and \(K\) is the carrying capacity.
To specify the problem, we need to provide the \(dy/dt\) function \(f(y, p, t)\),
and the jacobian of \(f\) multiplied by a vector \(v\) function, which we will call \(f'(y, p, t, v)\). That is</p>
<p>\[f(y, p, t) = r y (1 - y/K),\]
\[f'(y, p, t, v) = rv (1 - 2y/K),\]</p>
<p>and the initial state</p>
<p>\[y_0(p, t) = 0.1\]</p>
<p>This can be done using the following code:</p>
<pre><code class="language-rust ignore">use diffsol::{NalgebraLU, OdeSolverMethod, OdeSolverStopReason};
use nalgebra::DVector;
type M = nalgebra::DMatrix&lt;f64&gt;;

fn main() {
    //
    // SPECIFYING THE PROBLEM
    //
    let problem = OdeBuilder::&lt;M&gt;::new()
        .p(vec![1.0, 10.0])
        .rhs_implicit(
            |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
            |x, p, _t, v, y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
        )
        .init(|_p, _t| DVector::from_element(1, 0.1))
        .build()
        .unwrap();</code></pre>
<p>The <code>rhs_implicit</code> method is used to specify the \(f(y, p, t)\) and \(f'(y, p, t, v)\) functions, whereas the <code>init</code> method is used to specify the initial state vector \(y_0(p, t)\).
We also use the <code>t0</code>, <code>rtol</code>, <code>atol</code>, and <code>p</code> methods to set the initial time, relative tolerance, absolute tolerance, and parameters, respectively.</p>
<p>We have also specified the matrix type <code>M</code> to be <code>nalgebra::DMatrix&lt;f64&gt;</code>, using a generic parameter of the <code>OdeBuilder</code> struct.
The <code>nalgebra::DMatrix&lt;f64&gt;</code> type is a dense matrix type from the <a href="https://nalgebra.org">nalgebra</a> crate. Other options are:</p>
<ul>
<li><code>faer::Mat&lt;T&gt;</code> from <a href="https://github.com/sarah-ek/faer-rs">faer</a>, which is a dense matrix type.</li>
<li><code>diffsol::SparseColMat&lt;T&gt;</code>, which is a thin wrapper around <code>faer::sparse::SparseColMat&lt;T&gt;</code>, a sparse compressed sparse column matrix type.</li>
</ul>
<p>Each of these matrix types have an associated vector type that is used to represent the vectors in the problem (i.e. the state vector \(y\), the parameter vector \(p\), and the gradient vector \(v\)).
You can see in the example above that the <code>DVector</code> type is explicitly used to create the initial state vector in the third closure.
For these matrix types the associated vector type is:</p>
<ul>
<li><code>nalgebra::DVector&lt;T&gt;</code> for <code>nalgebra::DMatrix&lt;T&gt;</code>.</li>
<li><code>faer::Col&lt;T&gt;</code> for <code>faer::Mat&lt;T&gt;</code>.</li>
<li><code>faer::Coll&lt;T&gt;</code> for <code>diffsol::SparseColMat&lt;T&gt;</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mass-matrix"><a class="header" href="#mass-matrix">Mass matrix</a></h1>
<p>In some cases, it is necessary to include a mass matrix in the problem, such that the problem is of the form</p>
<p>\[M(t) \frac{dy}{dt} = f(t, y, p).\]</p>
<p>A mass matrix is useful for PDE discretisation that lead to a non-identity mass matrix, or for DAE problems that can be transformed into ODEs with a singular mass matrix.
Diffsol can handle singular and non-singular mass matrices, and the mass matrix can be time-dependent.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>To illustrate the addition of a mass matrix to a problem, we will once again take the logistic equation, but this time we will add an additional variable that is set via an algebraic equation.
This system is written as</p>
<p>\[\frac{dy}{dt} = r y (1 - y/K),\]
\[0 = y - z,\]</p>
<p>where \(z\) is the additional variable with a solution \(z = y\). When this system is put in the form \(M(t) \frac{dy}{dt} = f(t, y, p)\), the mass matrix is</p>
<p>\[M(t) = \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 0 \end{bmatrix}.\]</p>
<p>Like the Jacobian, the DiffSol builder does not require the full mass matrix, instead users can provide a function that gives a GEMV (General Matrix-Vector) product of the mass matrix with a vector.</p>
<p>\[m(\mathbf{v}, \mathbf{p}, t, \beta, \mathbf{y}) = M(p, t) \mathbf{v} + \beta \mathbf{y}. \]</p>
<p>Thus, to specify this problem using DiffSol, we can use the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct and provide the functions:</p>
<p>\[f(\mathbf{y}, \mathbf{p}, t) = \begin{bmatrix} r y_0 (1 - y_0/K) \\ y_0 - y_1 \end{bmatrix},\]
\[f'(\mathbf{y}, \mathbf{p}, t, \mathbf{v}) = \begin{bmatrix} r v_0 (1 - 2 y_0/K) \\ v_0 - v_1 \end{bmatrix},\]
\[m(\mathbf{v}, \mathbf{p}, t, \beta, \mathbf{y}) = \begin{bmatrix} v_0 + \beta y_0 \\ \beta y_1 \end{bmatrix}.\]</p>
<p>where \(f\) is the right-hand side of the ODE, \(f'\) is the Jacobian of \(f\) multiplied by a vector, and \(m\) is the mass matrix multiplied by a vector.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::OdeBuilder;
use nalgebra::{DMatrix, DVector};
type M = DMatrix&lt;f64&gt;;
type V = DVector&lt;f64&gt;;

let problem = OdeBuilder::&lt;M&gt;::new()
    .t0(0.0)
    .rtol(1e-6)
    .atol([1e-6])
    .p(vec![1.0, 10.0])
    .rhs_implicit(
        |x, p, _t, y| {
            y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]);
            y[1] = x[0] - x[1];
        },
        |x, p, _t, v , y| {
            y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]);
            y[1] = v[0] - v[1];
        },
    )
    .mass(
        |v, _p, _t, beta, y| {
            y[0] = v[0] + beta * y[0];
            y[1] *= beta;
        },
    )
    .init(|_p, _t| V::from_element(2, 0.1))
    .build()
    .unwrap();
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="root-finding"><a class="header" href="#root-finding">Root finding</a></h1>
<p>Root finding is the process of finding the values of the variables that make a set of equations equal to zero. This is a common problem where you want to
stop the solver or perform some action when a certain condition is met.</p>
<h2 id="specifying-the-root-finding-function"><a class="header" href="#specifying-the-root-finding-function">Specifying the root finding function</a></h2>
<p>Using the logistic example, we can add a root finding function \(r(y, p, t)\) that will stop the solver when the value of \(y\) is such that \(r(y, p, t) = 0\).
For this example we'll use the root finding function \(r(y, p, t) = y - 0.5\), which will stop the solver when the value of \(y\) is 0.5.</p>
<p>\[\frac{dy}{dt} = r y (1 - y/K),\]
\[r(y, p, t) = y - 0.5,\]</p>
<p>This can be done using the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> via the following code:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::OdeBuilder;
use nalgebra::DVector;
type M = nalgebra::DMatrix&lt;f64&gt;;

let problem = OdeBuilder::&lt;M&gt;::new()
    .t0(0.0)
    .rtol(1e-6)
    .atol([1e-6])
    .p(vec![1.0, 10.0])
    .rhs_implicit(
       |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
       |x, p, _t, v , y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
    )
    .init(|_p, _t| DVector::from_element(1, 0.1))
    .root(|x, _p, _t, y| y[0] = x[0] - 0.5, 1)
    .build()
    .unwrap();
<span class="boring">}</span></code></pre></pre>
<p>here we have added the root finding function \(r(y, p, t) = y - 0.5\), and also let DiffSol know that we have one root function by passing <code>1</code> as the last argument to the <code>root</code> method.
If we had specified more than one root function, the solver would stop when any of the root functions are zero.</p>
<h2 id="detecting-roots-during-the-solve"><a class="header" href="#detecting-roots-during-the-solve">Detecting roots during the solve</a></h2>
<p>To detect the root during the solve, we can use the return type on the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#tymethod.step"><code>step</code></a> method of the solver.
If successful the <code>step</code> method returns an <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/enum.OdeSolverStopReason.html"><code>OdeSolverStopReason</code></a> enum that contains the reason the solver stopped.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use diffsol::OdeBuilder;
</span><span class="boring">use nalgebra::DVector;
</span><span class="boring">type M = nalgebra::DMatrix&lt;f64&gt;;
</span>use diffsol::{OdeSolverMethod, OdeSolverStopReason, NalgebraLU};
type LS = NalgebraLU&lt;f64&gt;;

<span class="boring">let problem = OdeBuilder::&lt;M&gt;::new()
</span><span class="boring">    .p(vec![1.0, 10.0])
</span><span class="boring">    .rhs_implicit(
</span><span class="boring">       |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
</span><span class="boring">       |x, p, _t, v , y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
</span><span class="boring">    )
</span><span class="boring">    .init(|_p, _t| DVector::from_element(1, 0.1))
</span><span class="boring">    .root(|x, _p, _t, y| y[0] = x[0] - 0.5, 1)
</span><span class="boring">    .build()
</span><span class="boring">    .unwrap();
</span>let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
let t = loop {
    match solver.step() {
        Ok(OdeSolverStopReason::InternalTimestep) =&gt; continue,
        Ok(OdeSolverStopReason::TstopReached) =&gt; panic!("We didn't set a stop time"),
        Ok(OdeSolverStopReason::RootFound(t)) =&gt; break t,
        Err(e) =&gt; panic!("Solver failed to converge: {}", e),
    }
};
println!("Root found at t = {}", t);
let _soln = &amp;solver.state().y;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="forward-sensitivity"><a class="header" href="#forward-sensitivity">Forward Sensitivity</a></h1>
<p>In this section we will discuss how to compute the forward sensitivity of the solution of an ODE problem. The forward sensitivity is the derivative of the solution with respect to the parameters of the problem. This is useful for many applications, such as parameter estimation, optimal control, and uncertainty quantification.</p>
<h2 id="specifying-the-sensitivity-problem"><a class="header" href="#specifying-the-sensitivity-problem">Specifying the sensitivity problem</a></h2>
<p>We will again use the example of the logistic growth equation, but this time we will compute the sensitivity of the solution \(y\) with respect to the parameters \(r\) and \(K\) (i.e. \(\frac{dy}{dr}\) and \(\frac{dy}{dK}\)).
The logistic growth equation is:</p>
<p>\[\frac{dy}{dt} = r y (1 - y/K),\]
\[y(0) = 0.1\]</p>
<p>Recall from <a href="specify/ode_equations.html">ODE equations</a> that we also need to provide the jacobian of the right hand side of the ODE with respect to the state vector \(y\) and the gradient vector \(v\), which we will call \(J\). This is:</p>
<p>\[J v = \begin{bmatrix} r v (1 - 2 y/K) \end{bmatrix}.\]</p>
<p>Using the logistic growth equation above, we can compute the partial derivative of the right hand side of the ODE with respect to the vector \([r, K]\) multiplied by a vector \(v = [v_r, v_K]\), which we will call \(J_p v\). This is:</p>
<p>\[J_p v = v_r y (1 - y/K) + v_K r y^2 / K^2 .\]</p>
<p>We also need the partial derivative of the initial state vector with respect to the parameters multiplied by a vector \(v\), which we will call \(J_{y_0} v\). Since the initial state vector is constant, this is just zero</p>
<p>\[J_{y_0} v = 0.\]</p>
<p>We can then use the <code>OdeBuilder</code> struct to specify the sensitivity problem. The <code>rhs_sens_implicit</code> and <code>init_sens</code> methods are used to create a new problem that includes the sensitivity equations.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::OdeBuilder;
use nalgebra::DVector;
type M = nalgebra::DMatrix&lt;f64&gt;;

let problem = OdeBuilder::&lt;M&gt;::new()
    .p(vec![1.0, 10.0])
    .rhs_sens_implicit(
      |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
      |x, p, _t, v , y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
      |x, p, _t, v, y| y[0] = v[0] * x[0] * (1.0 - x[0] / p[1]) 
        + v[1] * p[0] * x[0] * x[0] / (p[1] * p[1]),
    )
    .init_sens(
      |_p, _t| DVector::from_element(1, 0.1),
      |_p, _t, _v, y| y[0] = 0.0,
    )
    .build()
    .unwrap();
<span class="boring">}</span></code></pre></pre>
<h2 id="solving-the-sensitivity-problem"><a class="header" href="#solving-the-sensitivity-problem">Solving the sensitivity problem</a></h2>
<p>Once the sensitivity problem has been specified, we can solve it using the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html"><code>OdeSolverMethod</code></a> trait.
Lets imagine we want to solve the sensitivity problem up to a time \(t_o = 10\). We can use the <code>OdeSolverMethod</code> trait to solve the problem as normal, stepping forward in time until we reach \(t_o\).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use diffsol::OdeBuilder;
</span><span class="boring">use nalgebra::DVector;
</span><span class="boring">type M = nalgebra::DMatrix&lt;f64&gt;;
</span>use diffsol::{OdeSolverMethod, NalgebraLU};
type LS = NalgebraLU&lt;f64&gt;;

<span class="boring">let problem = OdeBuilder::&lt;M&gt;::new()
</span><span class="boring">    .p(vec![1.0, 10.0])
</span><span class="boring">    .rhs_sens_implicit(
</span><span class="boring">      |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
</span><span class="boring">      |x, p, _t, v , y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
</span><span class="boring">      |x, p, _t, v, y| y[0] = v[0] * x[0] * (1.0 - x[0] / p[1]) 
</span><span class="boring">        + v[1] * p[0] * x[0] * x[0] / (p[1] * p[1]),
</span><span class="boring">    )
</span><span class="boring">    .init_sens(
</span><span class="boring">      |_p, _t| DVector::from_element(1, 0.1),
</span><span class="boring">      |_p, _t, _v, y| y[0] = 0.0,
</span><span class="boring">    )
</span><span class="boring">    .build()
</span><span class="boring">    .unwrap();
</span>let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
let t_o = 10.0;
while solver.state().t &lt; t_o {
    solver.step().unwrap();
}
<span class="boring">}</span></code></pre></pre>
<p>We can then obtain the sensitivity vectors at time \(t_o\) using the <code>interpolate_sens</code> method on the <code>OdeSolverMethod</code> trait.
This method returns a <code>Vec&lt;DVector&lt;f64&gt;&gt;</code> where each element of the vector is the sensitivity vector for element \(i\) of the parameter vector at time \(t_o\).
If we need the sensitivity at the current internal time step, we can get this from the <code>s</code> field of the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/struct.OdeSolverState.html"><code>OdeSolverState</code></a> struct.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span><span class="boring">use diffsol::OdeBuilder;
</span><span class="boring">use nalgebra::DVector;
</span><span class="boring">type M = nalgebra::DMatrix&lt;f64&gt;;
</span><span class="boring">use diffsol::{OdeSolverMethod, OdeSolverState, NalgebraLU};
</span><span class="boring">type LS = NalgebraLU&lt;f64&gt;;
</span><span class="boring">
</span><span class="boring">let problem = OdeBuilder::&lt;M&gt;::new()
</span><span class="boring">    .p(vec![1.0, 10.0])
</span><span class="boring">    .rhs_sens_implicit(
</span><span class="boring">      |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
</span><span class="boring">      |x, p, _t, v , y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
</span><span class="boring">      |x, p, _t, v, y| y[0] = v[0] * x[0] * (1.0 - x[0] / p[1]) 
</span><span class="boring">        + v[1] * p[0] * x[0] * x[0] / (p[1] * p[1]),
</span><span class="boring">    )
</span><span class="boring">    .init_sens(
</span><span class="boring">      |_p, _t| DVector::from_element(1, 0.1),
</span><span class="boring">      |_p, _t, _v, y| y[0] = 0.0,
</span><span class="boring">    )
</span><span class="boring">    .build()
</span><span class="boring">    .unwrap();
</span><span class="boring">let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
</span><span class="boring">let t_o = 10.0;
</span><span class="boring">while solver.state().t &lt; t_o {
</span><span class="boring">    solver.step().unwrap();
</span><span class="boring">}
</span>let sens_at_t_o = solver.interpolate_sens(t_o).unwrap();
let sens_at_internal_step = &amp;solver.state().s;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-problem-structs"><a class="header" href="#custom-problem-structs">Custom Problem Structs</a></h1>
<p>While the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct is a convenient way to specify the problem, it may not be suitable in all cases.
Often users will want to provide their own structs that can hold custom data structures and methods for evaluating the right-hand side of the ODE, the jacobian, and other functions.</p>
<h2 id="traits"><a class="header" href="#traits">Traits</a></h2>
<p>To create your own structs for the ode system, the final goal is to implement the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/equations/trait.OdeEquations.html"><code>OdeEquations</code></a> trait.
When you have done this, you can use the <code>build_from_eqn</code> method on the <code>OdeBuilder</code> struct to create the problem.</p>
<p>For each function in your system of equations, you will need to implement the appropriate trait for each function.</p>
<ul>
<li>Non-linear functions (rhs, out, root). In this case the <a href="https://docs.rs/diffsol/latest/diffsol/op/trait.NonLinearOp.html"><code>NonLinearOp</code></a> trait needs to be implemented.</li>
<li>Linear functions (mass). In this case the <a href="https://docs.rs/diffsol/latest/diffsol/op/trait.LinearOp.html"><code>LinearOp</code></a> trait needs to be implemented.</li>
<li>Constant functions (init). In this case the <a href="https://docs.rs/diffsol/latest/diffsol/op/trait.ConstantOp.html"><code>ConstantOp</code></a> trait needs to be implemented.</li>
</ul>
<p>Additionally, each function needs to implement the base operation trait <a href="https://docs.rs/diffsol/latest/diffsol/op/trait.Op.html"><code>Op</code></a>.</p>
<p>Once you have implemented the appropriate traits for your custom struct, you can use the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct to specify the problem.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="non-linear-functions"><a class="header" href="#non-linear-functions">Non-linear functions</a></h1>
<p>To illustrate how to implement a custom problem struct, we will take the familar logistic equation:</p>
<p>\[\frac{dy}{dt} = r y (1 - y/K),\]</p>
<p>Our goal is to implement a custom struct that can evaluate the rhs function \(f(y, p, t)\) and the jacobian multiplied by a vector \(f'(y, p, t, v)\).
First we define an empty struct. For a more complex problem, this struct could hold data structures neccessary to compute the rhs.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>type T = f64;
type V = nalgebra::DVector&lt;T&gt;;

struct MyProblem;
<span class="boring">}</span></code></pre></pre>
<p>Now we will implement the base <code>Op</code> trait for our struct. The <code>Op</code> trait specifies the types of the vectors and matrices that will be used, as well as the number of states and outputs in the rhs function.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::Op;

type T = f64;
type V = nalgebra::DVector&lt;T&gt;;
type M = nalgebra::DMatrix&lt;T&gt;;

<span class="boring">struct MyProblem;
</span><span class="boring">
</span><span class="boring">impl MyProblem {
</span><span class="boring">    fn new() -&gt; Self {
</span><span class="boring">        MyProblem {}
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>impl Op for MyProblem {
    type T = T;
    type V = V;
    type M = M;
    fn nstates(&amp;self) -&gt; usize {
        1
    }
    fn nout(&amp;self) -&gt; usize {
        1
    }
    fn nparams(&amp;self) -&gt; usize {
        0
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Next we implement the <code>NonLinearOp</code> and <code>NonLinearOpJacobian</code> trait for our struct. This trait specifies the functions that will be used to evaluate the rhs function and the jacobian multiplied by a vector.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::{
  NonLinearOp, NonLinearOpJacobian
};
<span class="boring">use diffsol::Op;
</span>
<span class="boring">type T = f64;
</span><span class="boring">type V = nalgebra::DVector&lt;T&gt;;
</span><span class="boring">type M = nalgebra::DMatrix&lt;T&gt;;
</span><span class="boring">
</span><span class="boring">struct MyProblem;
</span><span class="boring">
</span><span class="boring">impl MyProblem {
</span><span class="boring">    fn new() -&gt; Self {
</span><span class="boring">        MyProblem { }
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Op for MyProblem {
</span><span class="boring">    type T = T;
</span><span class="boring">    type V = V;
</span><span class="boring">    type M = M;
</span><span class="boring">    fn nstates(&amp;self) -&gt; usize {
</span><span class="boring">        1
</span><span class="boring">    }
</span><span class="boring">    fn nout(&amp;self) -&gt; usize {
</span><span class="boring">        1
</span><span class="boring">    }
</span><span class="boring">    fn nparams(&amp;self) -&gt; usize {
</span><span class="boring">        0
</span><span class="boring">    }
</span><span class="boring">}
</span>
impl&lt;'a&gt; NonLinearOp for MyProblem {
    fn call_inplace(&amp;self, x: &amp;V, _t: T, y: &amp;mut V) {
        y[0] = x[0] * (1.0 - x[0]);
    }
}
impl&lt;'a&gt; NonLinearOpJacobian for MyProblem {
    fn jac_mul_inplace(&amp;self, x: &amp;V, _t: T, v: &amp;V, y: &amp;mut V) {
        y[0] = v[0] * (1.0 - 2.0 * x[0]);
    }
}
<span class="boring">}</span></code></pre></pre>
<p>There we go, all done! This demonstrates how to implement a custom struct to specify a rhs function.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constant-functions"><a class="header" href="#constant-functions">Constant functions</a></h1>
<p>Now we've implemented the rhs function, but how about the initial condition? We can implement the <code>ConstantOp</code> trait to specify the initial condition. Since this is quite similar to the <code>NonLinearOp</code> trait, we will do it all in one go.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::{Op, ConstantOp};

<span class="boring">type T = f64;
</span><span class="boring">type V = nalgebra::DVector&lt;T&gt;;
</span><span class="boring">type M = nalgebra::DMatrix&lt;T&gt;;
</span><span class="boring">
</span>struct MyInit {}

impl Op for MyInit {
    type T = T;
    type V = V;
    type M = M;
    fn nstates(&amp;self) -&gt; usize {
        1
    }
    fn nout(&amp;self) -&gt; usize {
        1
    }
    fn nparams(&amp;self) -&gt; usize {
        0
    }
}

impl ConstantOp for MyInit {
    fn call_inplace(&amp;self, _t: T, y: &amp;mut V) {
        y[0] = 0.1;
    }
}
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linear-functions"><a class="header" href="#linear-functions">Linear functions</a></h1>
<p>Naturally, we can also implement the <code>LinearOp</code> trait if we want to include a mass matrix in our model. A common use case for implementing this trait is to store the mass matrix in a custom struct, like so:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::{Op, LinearOp};

<span class="boring">type T = f64;
</span><span class="boring">type V = nalgebra::DVector&lt;T&gt;;
</span><span class="boring">type M = nalgebra::DMatrix&lt;T&gt;;
</span><span class="boring">
</span>struct MyMass {
  mass: M,
}

impl MyMass {
  fn new() -&gt; Self {
      let mass = M::from_element(1, 1, 1.0);
      Self { mass }
  }
}

impl Op for MyMass {
  type T = T;
  type V = V;
  type M = M;
  fn nstates(&amp;self) -&gt; usize {
      1
  }
  fn nout(&amp;self) -&gt; usize {
      1
  }
  fn nparams(&amp;self) -&gt; usize {
      0
  }
}

impl LinearOp for MyMass {
  fn gemv_inplace(&amp;self, x: &amp;V, _t: T, beta: T, y: &amp;mut V) {
      y.gemv(1.0, &amp;self.mass, x, beta)
  }
}
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ode-systems"><a class="header" href="#ode-systems">ODE systems</a></h1>
<p>So far we've focused on using custom structs to specify individual equations, now we need to put these together to specify the entire system of equations.</p>
<h2 id="implementing-the-odeequations-trait"><a class="header" href="#implementing-the-odeequations-trait">Implementing the OdeEquations trait</a></h2>
<p>To specify the entire system of equations, you need to implement the <code>Op</code>, <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/equations/trait.OdeEquations.html"><code>OdeEquations</code></a>
and <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/equations/trait.OdeEquationsRef.html"><code>OdeEquationsRef</code></a> traits for your struct.</p>
<h2 id="getting-all-your-traits-in-order"><a class="header" href="#getting-all-your-traits-in-order">Getting all your traits in order</a></h2>
<p>The <code>OdeEquations</code> trait requires methods that return objects corresponding to the right-hand side function, mass matrix, root function, initial condition, and output functions.
Therefore, you need to already have structs that implement the <code>NonLinearOp</code>, <code>LinearOp</code>, and <code>ConstantOp</code> traits for these functions. For the purposes of this example, we will assume that
you have already implemented these traits for your structs.</p>
<p>Often, the structs that implement these traits will have to use data defined in the struct that implements the <code>OdeEquations</code> trait. For example, they might wish to have a reference to the same parameter vector <code>p</code>. Therefore, you will often need to define lifetimes for these structs to ensure that they can access the data they need.</p>
<p>Note that these struct will need to be lightweight and should not contain a significant amount of data. The data should be stored in the struct that implements the <code>OdeEquations</code> trait. This is because these structs will be created and destroyed many times during the course of the simulation (e.g. every time the right-hand side function is called).</p>
<pre><code class="language-rust ignore">use diffsol::{ConstantOp, LinearOp, NonLinearOp, OdeEquations, OdeEquationsRef, Op};
type T = f64;
type V = nalgebra::DVector&lt;f64&gt;;
type M = nalgebra::DMatrix&lt;f64&gt;;
struct MyRhs&lt;'a&gt; {
    p: &amp;'a V,
} // implements NonLinearOp
struct MyMass&lt;'a&gt; {
    p: &amp;'a V,
} // implements LinearOp
struct MyInit&lt;'a&gt; {
    p: &amp;'a V,
} // implements ConstantOp
struct MyRoot&lt;'a&gt; {
    p: &amp;'a V,
} // implements NonLinearOp
struct MyOut&lt;'a&gt; {
    p: &amp;'a V,
} // implements NonLinearOp</code></pre>
<h2 id="implementing-the-odeequations-traits"><a class="header" href="#implementing-the-odeequations-traits">Implementing the OdeEquations traits</a></h2>
<p>Lets imagine we have a struct <code>MyProblem</code> that we want to use to specify the entire system of equations. We can implement the <code>Op</code>, <code>OdeEquations</code>, and <code>OdeEquationsRef</code> traits for this struct like so:</p>
<pre><code class="language-rust ignore">struct MyProblem {
    p: V,
}

impl MyProblem {
    fn new() -&gt; Self {
        MyProblem { p: V::zeros(2) }
    }
}

impl Op for MyProblem {
    type T = T;
    type V = V;
    type M = M;
    fn nstates(&amp;self) -&gt; usize {
        1
    }
    fn nout(&amp;self) -&gt; usize {
        1
    }
    fn nparams(&amp;self) -&gt; usize {
        2
    }
}

impl&lt;'a&gt; OdeEquationsRef&lt;'a&gt; for MyProblem {
    type Rhs = MyRhs&lt;'a&gt;;
    type Mass = MyMass&lt;'a&gt;;
    type Init = MyInit&lt;'a&gt;;
    type Root = MyRoot&lt;'a&gt;;
    type Out = MyOut&lt;'a&gt;;
}

impl OdeEquations for MyProblem {
    fn rhs(&amp;self) -&gt; &lt;MyProblem as OdeEquationsRef&lt;'_&gt;&gt;::Rhs {
        MyRhs { p: &amp;self.p }
    }
    fn mass(&amp;self) -&gt; Option&lt;&lt;MyProblem as OdeEquationsRef&lt;'_&gt;&gt;::Mass&gt; {
        Some(MyMass { p: &amp;self.p })
    }
    fn init(&amp;self) -&gt; &lt;MyProblem as OdeEquationsRef&lt;'_&gt;&gt;::Init {
        MyInit { p: &amp;self.p }
    }
    fn root(&amp;self) -&gt; Option&lt;&lt;MyProblem as OdeEquationsRef&lt;'_&gt;&gt;::Root&gt; {
        Some(MyRoot { p: &amp;self.p })
    }
    fn out(&amp;self) -&gt; Option&lt;&lt;MyProblem as OdeEquationsRef&lt;'_&gt;&gt;::Out&gt; {
        Some(MyOut { p: &amp;self.p })
    }
    fn set_params(&amp;mut self, p: &amp;V) {
        self.p.copy_from(p);
    }
    fn get_params(&amp;self, p: &amp;mut Self::V) {
        p.copy_from(&amp;self.p);
    }
}</code></pre>
<h2 id="creating-the-problem"><a class="header" href="#creating-the-problem">Creating the problem</a></h2>
<p>Now that we have our custom <code>OdeEquations</code> struct, we can use it in an <code>OdeBuilder</code> to create the problem. Hint: click the button below to see the full code, which includes the implementation of the <code>Op</code>, <code>NonLinearOp</code>, <code>LinearOp</code>, and <code>ConstantOp</code> traits for the <code>MyRhs</code>, <code>MyMass</code>, <code>MyInit</code>, <code>MyRoot</code>, and <code>MyOut</code> structs.</p>
<pre><code class="language-rust ignore">use diffsol::OdeBuilder;
fn main() {
    let _problem = OdeBuilder::&lt;M&gt;::new()
        .p(vec![1.0, 10.0])
        .build_from_eqn(MyProblem::new())
        .unwrap();
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="diffsl"><a class="header" href="#diffsl">DiffSL</a></h1>
<p>Thus far we have used Rust code to specify the problem we want to solve. This is fine if you are using DiffSol from Rust, but what if you want to use DiffSol from a higher-level language like Python or R?
For this usecase we have designed a Domain Specific Language (DSL) called DiffSL that can be used to specify the problem. DiffSL is not a general purpose language but is tightly constrained to
the specification of a system of ordinary differential equations. It features a relatively simple syntax that consists of writing a series of tensors (dense or sparse) that represent the equations of the system.
For more detail on the syntax of DiffSL see the <a href="https://martinjrobins.github.io/diffsl/">DiffSL book</a>. This section will focus on how to use DiffSL to specify a problem in DiffSol.</p>
<h2 id="diffsl-context"><a class="header" href="#diffsl-context">DiffSL Context</a></h2>
<p>The main struct that is used to specify a problem in DiffSL is the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/diffsl/struct.DiffSl.html"><code>DiffSl</code></a> struct. Creating this struct
Just-In-Time (JIT) compiles your DiffSL code into a form that can be executed efficiently by DiffSol.</p>
<pre><code class="language-rust ignore">use diffsol::{CraneliftModule, DiffSl};
use diffsol::{OdeBuilder, OdeSolverMethod};
type M = nalgebra::DMatrix&lt;f64&gt;;
type CG = CraneliftModule;
type LS = diffsol::NalgebraLU&lt;f64&gt;;

fn main() {
    let eqn = DiffSl::&lt;M, CG&gt;::compile(
        "
     in = [r, k]
     r { 1.0 }
     k { 1.0 }
     u { 0.1 }
     F { r * u * (1.0 - u / k) }
 ",
    )
    .unwrap();</code></pre>
<p>The <code>CG</code> parameter specifies the backend that you want to use to compile the DiffSL code. The <code>CraneliftModule</code> backend is the default backend and is behind the <code>diffsl</code> feature flag. If you want to use the faster LLVM backend you can use the <code>LlvmModule</code> backend, which is behind one of the <code>diffsl-llvm*</code> feature flags, depending on the version of LLVM you have installed.</p>
<p>Once you have created the <code>DiffSl</code> struct you can use it to create a problem using the <code>build_from_eqn</code> method on the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/builder/struct.OdeBuilder.html"><code>OdeBuilder</code></a> struct.</p>
<pre><code class="language-rust ignore">    let problem = OdeBuilder::&lt;M&gt;::new()
        .rtol(1e-6)
        .p([1.0, 10.0])
        .build_from_eqn(eqn)
        .unwrap();
    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let t = 0.4;
    let _soln = solver.solve(t).unwrap();
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sparse-problems"><a class="header" href="#sparse-problems">Sparse problems</a></h1>
<p>Lets consider a large system of equations that have a jacobian matrix that is sparse. For simplicity we will start with the logistic equation from the <a href="specify/./specifying_the_problem.html">"Specifying the Problem"</a> section,
but we will duplicate this equation 10 times to create a system of 10 equations. This system will have a jacobian matrix that is a diagonal matrix with 10 diagonal elements, and all other elements are zero.</p>
<p>Since this system is sparse, we choose a sparse matrix type to represent the jacobian matrix. We will use the <code>diffsol::SparseColMat&lt;T&gt;</code> type, which is a thin wrapper around <code>faer::sparse::SparseColMat&lt;T&gt;</code>, a sparse compressed sparse column matrix type.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>use diffsol::OdeBuilder;
type M = diffsol::SparseColMat&lt;f64&gt;;
type V = faer::Col&lt;f64&gt;;

let problem = OdeBuilder::&lt;M&gt;::new()
    .t0(0.0)
    .rtol(1e-6)
    .atol([1e-6])
    .p(vec![1.0, 10.0])
    .rhs_implicit(
        |x, p, _t, y| {
            for i in 0..10 {
                y[i] = p[0] * x[i] * (1.0 - x[i] / p[1]);
            }
        },
        |x, p, _t, v , y| {
            for i in 0..10 {
                y[i] = p[0] * v[i] * (1.0 - 2.0 * x[i] / p[1]);
            }
        },
    )
    .init(
        |_p, _t| V::from_fn(10, |_| 0.1),
    )
    .build()
    .unwrap();
<span class="boring">}</span></code></pre></pre>
<p>Note that we have not specified the jacobian itself, but instead we have specified the jacobian multiplied by a vector function \(f'(y, p, t, v)\).
DiffSol will use this function to generate a jacobian matrix, and since we have specified a sparse matrix type, DiffSol will attempt to
guess the sparsity pattern of the jacobian matrix and use this to efficiently generate the jacobian matrix.</p>
<p>To illustrate this, we can calculate the jacobian matrix from the <code>rhs</code> function contained in the <code>problem</code> object:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">use diffsol::OdeBuilder;
</span>use diffsol::{OdeEquations, NonLinearOp, NonLinearOpJacobian, Matrix, ConstantOp};

<span class="boring">type M = diffsol::SparseColMat&lt;f64&gt;;
</span><span class="boring">type V = faer::Col&lt;f64&gt;;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">let problem = OdeBuilder::&lt;M&gt;::new()
</span><span class="boring">    .t0(0.0)
</span><span class="boring">    .rtol(1e-6)
</span><span class="boring">    .atol([1e-6])
</span><span class="boring">    .p(vec![1.0, 10.0])
</span><span class="boring">    .rhs_implicit(
</span><span class="boring">        |x, p, _t, y| {
</span><span class="boring">            for i in 0..10 {
</span><span class="boring">                y[i] = p[0] * x[i] * (1.0 - x[i] / p[1]);
</span><span class="boring">            }
</span><span class="boring">        },
</span><span class="boring">        |x, p, _t, v , y| {
</span><span class="boring">            for i in 0..10 {
</span><span class="boring">                y[i] = p[0] * v[i] * (1.0 - 2.0 * x[i] / p[1]);
</span><span class="boring">            }
</span><span class="boring">        },
</span><span class="boring">    )
</span><span class="boring">    .init(
</span><span class="boring">        |_p, _t| V::from_fn(10, |_| 0.1),
</span><span class="boring">    )
</span><span class="boring">    .build()
</span><span class="boring">    .unwrap();
</span>let t0 = problem.t0;
let y0 = problem.eqn.init().call(t0);
let jacobian = problem.eqn.rhs().jacobian(&amp;y0, t0);
for (i, j, v) in jacobian.triplet_iter() {
    println!("({}, {}) = {}", i, j, v);
}
<span class="boring">}</span></code></pre></pre>
<p>which will print the jacobian matrix in triplet format:</p>
<pre><code>(0, 0) = 0.98
(1, 1) = 0.98
(2, 2) = 0.98
(3, 3) = 0.98
(4, 4) = 0.98
(5, 5) = 0.98
(6, 6) = 0.98
(7, 7) = 0.98
(8, 8) = 0.98
(9, 9) = 0.98
</code></pre>
<p>DiffSol attempts to guess the sparsity pattern of your jacobian matrix by calling the \(f'(y, p, t, v)\) function repeatedly with different one-hot vectors \(v\)
with a <code>NaN</code> value at each hot index. The output of this function (i.e. which elements are <code>0</code> and which are <code>NaN</code>) is then used to determine the sparsity pattern of the jacobian matrix.
Due to the fact that for IEEE 754 floating point numbers, <code>NaN</code> is propagated through most operations, this method is able to detect which output elements are dependent on which input elements.</p>
<p>However, this method is not foolproof, and it may fail to detect the correct sparsity pattern in some cases, particularly if values of <code>v</code> are used in control-flow statements.
If DiffSol does not detect the correct sparsity pattern, you can manually specify the jacobian. To do this, you need to use a custom struct that implements the <code>OdeEquations</code> trait,
This is described in more detail in the <a href="specify/./custom_problem_structs.html">"Custom Problem Structs"</a> section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="choosing-a-solver"><a class="header" href="#choosing-a-solver">Choosing a solver</a></h1>
<p>Once you have defined the problem, you need to create a solver to solve the problem. The available solvers are:</p>
<ul>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/bdf/struct.Bdf.html"><code>diffsol::Bdf</code></a>: A Backwards Difference Formulae solver, suitable for stiff problems and singular mass matrices.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/sdirk/struct.Sdirk.html"><code>diffsol::Sdirk</code></a> A Singly Diagonally Implicit Runge-Kutta (SDIRK or ESDIRK) solver. You can define your own butcher tableau using <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/tableau/struct.Tableau.html"><code>Tableau</code></a> or use one of the pre-defined tableaues.</li>
</ul>
<p>For each solver, you will need to specify the linear solver type to use. The available linear solvers are:</p>
<ul>
<li><a href="https://docs.rs/diffsol/latest/diffsol/linear_solver/nalgebra_lu/struct.NalgebraLU.html"><code>diffsol::NalgebraLU</code></a>: A LU decomposition solver using the <a href="https://nalgebra.org">nalgebra</a> crate.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/linear_solver/faer_lu/struct.FaerLU.html"><code>diffsol::FaerLU</code></a>: A LU decomposition solver using the <a href="https://github.com/sarah-ek/faer-rs">faer</a> crate.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/linear_solver/faer_sparse_lu/struct.FaerSparseLU.html"><code>diffsol::FaerSparseLU</code></a>: A sparse LU decomposition solver using the <code>faer</code> crate.</li>
</ul>
<p>Each solver can be created directly, but it generally easier to use the methods on the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/problem/struct.OdeSolverProblem.html"><code>OdeSolverProblem</code></a> struct to create the solver.
For example:</p>
<pre><code class="language-rust ignore">use diffsol::OdeBuilder;
use diffsol::{BdfState, OdeSolverState, SdirkState, Tableau};
use diffsol::{NalgebraLU, OdeSolverMethod, OdeSolverStopReason};
use nalgebra::DVector;
type M = nalgebra::DMatrix&lt;f64&gt;;
type LS = NalgebraLU&lt;f64&gt;;

fn main() {
    //
    // SPECIFYING THE PROBLEM
    //
    let problem = OdeBuilder::&lt;M&gt;::new()
        .p(vec![1.0, 10.0])
        .rhs_implicit(
            |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
            |x, p, _t, v, y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
        )
        .init(|_p, _t| DVector::from_element(1, 0.1))
        .build()
        .unwrap();

    //
    // CHOOSING A SOLVER
    //

    // Create a BDF solver with an initial state
    let _solver = problem.bdf::&lt;LS&gt;();

    // Create a non-initialised state and manually set the values before
    // creating the solver
    let state = BdfState::new_without_initialise(&amp;problem).unwrap();
    // ... set the state values manually
    let _solver = problem.bdf_solver::&lt;LS&gt;(state);

    // Create a SDIRK solver with a pre-defined tableau
    let tableau = Tableau::&lt;M&gt;::tr_bdf2();
    let state = problem.sdirk_state::&lt;LS, _&gt;(&amp;tableau).unwrap();
    let _solver = problem.sdirk_solver::&lt;LS, _&gt;(state, tableau);

    // Create a tr_bdf2 or esdirk34 solvers directly (both are SDIRK solvers with different tableaus)
    let _solver = problem.tr_bdf2::&lt;LS&gt;();
    let _solver = problem.esdirk34::&lt;LS&gt;();</code></pre>
<h1 id="initialisation"><a class="header" href="#initialisation">Initialisation</a></h1>
<p>Each solver has an internal state that holds information like the current state vector, the gradient of the state vector, the current time, and the current step size. When you create a solver using the <code>bdf</code> or <code>sdirk</code> methods on the <code>OdeSolverProblem</code> struct, the solver will be initialised with an initial state based on the initial conditions of the problem as well as satisfying any algebraic constraints. An initial time step will also be chosen based on your provided equations.</p>
<p>Each solver's state struct implements the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/state/trait.OdeSolverState.html"><code>OdeSolverState</code></a> trait, and if you wish to manually create and setup a state, you can use the methods on this trait to do so.</p>
<p>For example, say that you wish to bypass the initialisation of the state as you already have the algebraic constraints and so don't need to solve for them. You can use the <code>new_without_initialise</code> method on the <code>OdeSolverState</code> trait to create a new state without initialising it. You can then use the <code>as_mut</code> method to get a mutable reference to the state and set the values manually.</p>
<p>Note that each state struct has a <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/state/trait.OdeSolverState.html#tymethod.as_ref"><code>as_ref</code></a> and <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/state/trait.OdeSolverState.html#tymethod.as_mut"><code>as_mut</code></a> methods that return a <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/state/struct.StateRef.html"><code>StateRef</code></a> or <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/state/struct.StateRefMut.html"><code>StateRefMut</code></a> struct respectively. These structs provide a solver-independent way to access the state values so you can use the same code with different solvers.</p>
<pre><code class="language-rust ignore">    // Create a non-initialised state and manually set the values before
    // creating the solver
    let mut state = SdirkState::new_without_initialise(&amp;problem).unwrap();
    // ... set the state values manually
    state.as_mut().y[0] = 0.1;
    let _solver = problem.tr_bdf2_solver::&lt;LS&gt;(state);</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solving-the-problem"><a class="header" href="#solving-the-problem">Solving the Problem</a></h1>
<p>Each solver implements the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html"><code>OdeSolverMethod</code></a> trait, which provides a number of methods to solve the problem.</p>
<h2 id="solving-the-problem-1"><a class="header" href="#solving-the-problem-1">Solving the Problem</a></h2>
<p>DiffSol has a few high-level solution functions on the <code>OdeSolverMethod</code> trait that are the easiest way to solve your equations:</p>
<ul>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#method.solve"><code>solve</code></a> - solve the problem from an initial state up to a specified time, returning the solution at all the internal timesteps used by the solver.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#method.solve_dense"><code>solve_dense</code></a> - solve the problem from an initial state, returning the solution at a <code>Vec</code> of times provided by the user.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#method.solve_dense_sensitivities"><code>solve_dense_sensitivities</code></a> - solve the forward sensitivity problem from an initial state, returning the solution at a <code>Vec</code> of times provided by the user.</li>
<li><a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#method.solve_adjoint"><code>solve_adjoint</code></a> - solve the adjoint sensitivity problem from an initial state to a final time, returning the integration of the output function over time as well as its gradient with respect to the initial state.</li>
</ul>
<p>The following example shows how to solve a simple ODE problem using the <code>solve</code> method on the <code>OdeSolverMethod</code> trait.</p>
<pre><code class="language-rust ignore">use diffsol::OdeBuilder;
use diffsol::{BdfState, OdeSolverState, SdirkState, Tableau};
use diffsol::{NalgebraLU, OdeSolverMethod, OdeSolverStopReason};
use nalgebra::DVector;
type M = nalgebra::DMatrix&lt;f64&gt;;
type LS = NalgebraLU&lt;f64&gt;;

fn main() {
    //
    // SPECIFYING THE PROBLEM
    //
    let problem = OdeBuilder::&lt;M&gt;::new()
        .p(vec![1.0, 10.0])
        .rhs_implicit(
            |x, p, _t, y| y[0] = p[0] * x[0] * (1.0 - x[0] / p[1]),
            |x, p, _t, v, y| y[0] = p[0] * v[0] * (1.0 - 2.0 * x[0] / p[1]),
        )
        .init(|_p, _t| DVector::from_element(1, 0.1))
        .build()
        .unwrap();

    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let (_ys, _ts) = solver.solve(10.0).unwrap();</code></pre>
<p><code>solve_dense</code> will solve a problem from an initial state, returning the solution at a <code>Vec</code> of times provided by the user.</p>
<pre><code class="language-rust ignore">    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let times = vec![0.0, 1.0, 2.0, 3.0, 4.0, 5.0];
    let _soln = solver.solve_dense(&amp;times).unwrap();</code></pre>
<h2 id="stepping-the-solution"><a class="header" href="#stepping-the-solution">Stepping the Solution</a></h2>
<p>The fundamental method to step the solver through a solution is the <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/trait.OdeSolverMethod.html#tymethod.step"><code>step</code></a> method on the <code>OdeSolverMethod</code> trait, which steps the solution forward in time by a single step, with a step size chosen by the solver in order to satisfy the error tolerances in the <code>problem</code> struct. The <code>step</code> method returns a <code>Result</code> that contains the new state of the solution if the step was successful, or an error if the step failed.</p>
<pre><code class="language-rust ignore">    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    while solver.state().t &lt; 10.0 {
        if solver.step().is_err() {
            break;
        }
    }</code></pre>
<p>The <code>step</code> method will return an error if the solver fails to converge to the solution or if the step size becomes too small.</p>
<p>Often you will want to get the solution at a specific time \(t_o\). There are two ways to do this based on your particular needs, the most lightweight way is to step the solution forward
until you are beyond \(t_o\), and then interpolate the solution back to \(t_o\) using the <code>interpolate</code> method on the <code>OdeSolverMethod</code> trait.</p>
<pre><code class="language-rust ignore">    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    let t_o = 10.0;
    while solver.state().t &lt; t_o {
        solver.step().unwrap();
    }
    let _soln = solver.interpolate(t_o).unwrap();</code></pre>
<p>The second way is to use the <code>set_stop_time</code> method on the <code>OdeSolverMethod</code> trait to stop the solver at a specific time, this will override the internal time step so that the solver stops at the specified time.
Note that this can be less efficient if you wish to continue stepping forward after the specified time, as the solver will need to be re-initialised.
The enum returned by <code>step</code> will indicate when the solver has stopped at the specified time.
Once the solver has stopped at the specified time, you can get the current state of the solution using the <code>state</code> method on the solver, which returns an <a href="https://docs.rs/diffsol/latest/diffsol/ode_solver/method/struct.OdeSolverState.html"><code>OdeSolverState</code></a> struct.</p>
<pre><code class="language-rust ignore">    let mut solver = problem.bdf::&lt;LS&gt;().unwrap();
    solver.set_stop_time(10.0).unwrap();
    loop {
        match solver.step() {
            Ok(OdeSolverStopReason::InternalTimestep) =&gt; continue,
            Ok(OdeSolverStopReason::TstopReached) =&gt; break,
            Ok(OdeSolverStopReason::RootFound(_)) =&gt; panic!("Root finding not used"),
            Err(e) =&gt; panic!("Solver failed to converge: {}", e),
        }
    }
    let _soln = &amp;solver.state().y;</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="benchmarks"><a class="header" href="#benchmarks">Benchmarks</a></h1>
<p>The goal of this chapter is to compare the performance of the DiffSol implementation with other similar ode solver libraries.</p>
<p>The libraries we will compare against are:</p>
<ul>
<li><a href="https://computing.llnl.gov/projects/sundials">Sundials</a>: A suite of advanced numerical solvers for ODEs and DAEs, implemented in C.</li>
<li><a href="https://docs.kidger.site/diffrax/">Diffrax</a>: A Python library for solving ODEs and SDEs implemented using JAX.</li>
<li><a href="https://web.casadi.org/">Casadi</a>: A C++ library with Python anbd MATLAB bindings, for solving ODEs and DAEs, nonlinear optimisation and algorithmic differentiation.</li>
</ul>
<p>The comparison with Sundials will be done in Rust by wrapping C functions and comparing them to Rust implementations. The comparsion with the Python libraries (Diffrax and Casadi) will be done by wrapping DiffSol in Python using the PyO3 library, and comparing the performance of the wrapped functions. As well as benchmarking the DiffSol solvers, this also serves <a href="https://github.com/martinjrobins/diffsol_python_benchmark">as an example</a> of how to wrap and use DiffSol in other languages.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sundials-benchmarks"><a class="header" href="#sundials-benchmarks">Sundials Benchmarks</a></h1>
<p>To begin with we have focused on comparing against the popular <a href="https://github.com/LLNL/sundials">Sundials</a> solver suite, developed by the Lawrence Livermore National Laboratory.</p>
<h2 id="test-problems"><a class="header" href="#test-problems">Test Problems</a></h2>
<p>To choose the test problems we have used several of the examples provided in the Sundials library. The problems are:</p>
<ul>
<li><code>robertson</code> : A stiff DAE system with 3 equations (2 differential and 1 algebraic). In Sundials this is part of the IDA examples
and is contained in the file <code>ida/serial/idaRoberts_dns.c</code>. In Sundials the problem is solved using the Sundials dense linear solver and <code>Sunmatrix_Dense</code>, in DiffSol we use the
dense LU linear solver, dense matrices and vectors from the <a href="https://nalgebra.org">nalgebra</a> library.</li>
<li><code>robertson_ode</code>: The same problem as <code>robertson</code> but in the form of an ODE. This problem has a variable size implemented
by duplicating the 3 original equations \(n^2\) times, where \(n\) is the size input parameter. In Sundials problem is solved using the KLU sparse linear solver and the <code>Sunmatrix_Sparse</code> matrix, and in DiffSol we use the
same KLU solver from the <a href="https://github.com/DrTimothyAldenDavis/SuiteSparse">SuiteSparse</a> library along with the <a href="https://github.com/sarah-ek/faer-rs">faer</a> sparse matrix.
This example is part of the Sundials CVODE examples and is contained in the file <code>cvode/serial/cvRoberts_block_klu.c</code>.</li>
<li><code>heat2d</code>: A 2D heat DAE problem with boundary conditions imposed via algebraic equations. The size \(n\) input parameter sets the number of grid points along each dimension, so the
total number of equations is \(n^2\). This is part of the IDA examples and is contained in the file <code>ida/serial/idaHeat2D_klu.c</code>.
In Sundials this problem is solved using the KLU sparse linear solver and the Sunmatrix_Sparse matrix, and in DiffSol we use the same KLU solver along with the faer sparse matrix.</li>
<li><code>foodweb</code>: A predator-prey problem with diffusion on a 2D grid. The size \(n\) input parameter sets the number of grid points along each dimension and we have 2 species, so the
total number of equations is \(2n^2\) This is part of the IDA examples and is contained in the file <code>ida/serial/idaFoodWeb_bnd.c</code>.
In Sundials the problem is solved using a banded linear solver and the <code>Sunmatrix_Band</code> matrix. DiffSol does not have a banded linear solver, so we use the KLU solver for this problem along with the faer sparse matrix.</li>
</ul>
<h2 id="method"><a class="header" href="#method">Method</a></h2>
<p>In each case we have taken the example files from the Sundials library at version 6.7.0, compiling and linking them against the same version of the code.
We have made minimal modifications to the files to remove all <code>printf</code> output and to change the <code>main</code> functions to named functions to allow them to be called from rust.
We have then implemented the same problem in Rust using the DiffSol library, porting the residual functions defined in the Sundials examples to DiffSol-compatible functions representing the RHS, mass matrix and jacobian multiplication functions for the problem.
We have used the outputs published in the Sundials examples as the reference outputs for the tests to ensure that the implementations are equivalent.
The relative and absolute tolerances for the solvers were set to the same values in both implementations.</p>
<p>There are a number of differences between the Sundials and DiffSol implementations that may affect the performance of the solvers. The main differences are:</p>
<ul>
<li>The Sundials IDA solver has the problem defined as a general DAE system, while the DiffSol solver has access to the RHS and mass matrix functions separately.
The Sundials CVODE solver has the problem defined as an ODE system and the mass is implicitly an identity matrix, and this is the same for the DiffSol implementation for the <code>robertson_ode</code> problem.</li>
<li>In the Sundials examples that use a user-defined jacobian (<code>robertson</code>, <code>robertson_ode</code>, <code>heat2d</code>), the jacobian is provided as a sparse or dense matrix. In DiffSol the jacobian is provided as a function that multiplies the jacobian by a vector,
so DiffSol needs to do additional work to generate a jacobian matrix from this function.</li>
<li>Generally the types of matrices and linear solver are matched between the two implementations (see details in the "Test Problems" section above). However, the <code>foodweb</code> problem is slightly different in that
it is solved in Sundials using a banded linear solver and banded matrices and the jacobian is calculated using finite differences.
In DiffSol we use the KLU sparse linear solver and sparse matrices, and the jacobian is calculated using the jacobian function provided by the user.</li>
<li>The Sundials implementations make heavy use of indexing into arrays, as does the DiffSol implementations. In Rust these indexing is bounds checked, which affects performance slightly but was not found to be a significant factor.</li>
</ul>
<p>Finally, we have also implemented the <code>robertson</code>, <code>heat2d</code> and <code>foodweb</code>
problems in the DiffSl language. For the <code>heat2d</code> and <code>foodweb</code> problems we
wrote out the diffusion matrix and mass matrix from the Rust implementations and
wrote the rest of the model by hand. For the <code>robertson</code> problem we wrote the
entire model by hand.</p>
<h2 id="results"><a class="header" href="#results">Results</a></h2>
<p>These results were generated using DiffSol v0.5.1, and were run on a Dell PowerEdge R7525 2U rack server, with dual AMD EPYC 7343 3.2Ghz 16C CPU and 128GB Memory.</p>
<p>The performance of each implementation was timed and includes all setup and solve time. The exception to this is for the DiffSl implementations, where the JIT compilation for the model was not included in the timings
(since the compilation time for the C and Rust code was also not included).
We have presented the results in the following graphs, where the x-axis is the size of the problem \(n\) and the y-axis is the time taken to solve the problem relative to the time taken by the Sundials implementation
(so \(10^0\) is the same time as Sundials, \(10^1\) is 10 times slower etc.)</p>
<h3 id="bdf-solver"><a class="header" href="#bdf-solver">Bdf solver</a></h3>
<p><img src="benchmarks/./images/benchmarks/bench_bdf.svg" alt="Bdf" /></p>
<p>The BDF solver is the same method as that used by the Sundials IDA and CVODE solvers so we expect the performance to be largely similar, and this is generally the case.
There are differences due to the implementation details for each library, and the differences in the implementations for the linear solvers and matrices as discussed above.</p>
<p>For the small, dense, stiff <code>robertson</code> problem the DiffSol implementation is very close and only slightly faster than Sundials (about 0.9).</p>
<p>For the sparse <code>heat2d</code> problem the DiffSol implementation is slower than Sundials for smaller problems (about 2) but the performance improves significantly for larger problems until it is at about 0.3.
Since this improvement for larger systems is not seen in <code>foodweb</code> or <code>robertson_ode</code> problems, it is likely due to the fact that the <code>heat2d</code> problem has a constant jacobian matrix and the DiffSol implementation has an advantage in this case.</p>
<p>For the <code>foodweb</code> problem the DiffSol implementation is between 1.8 - 2.1 times slower than Sundials. It is interesting that when the problem is implemented in the DiffSl language (see benchmark below) the slowdown reduces to 1.5, indicating
that much of the performance difference is likely due to the implementation details of the Rust code for the rhs, jacobian and mass matrix functions.</p>
<p>The DiffSol implementation of the <code>robertson_ode</code> problem ranges between 1.2 - 1.8 times slower than Sundials over the problem range.</p>
<h3 id="tr_bdf2--esdirk34-solvers-sdirk"><a class="header" href="#tr_bdf2--esdirk34-solvers-sdirk">tr_bdf2 &amp; esdirk34 solvers (SDIRK)</a></h3>
<p><img src="benchmarks/./images/benchmarks/bench_tr_bdf2_esdirk.svg" alt="Sdirk" /></p>
<p>The low-order <code>tr_bdf2</code> solver is slower than the <code>bdf</code> solver for all the problems, perhaps due to the generally tight tolerances used (<code>robertson</code> and <code>robertson_ode</code> have tolerances of 1e-6-1e-8, <code>heat2d</code> was 1e-7 and <code>foodweb</code> was 1e-5). The <code>esdirk34</code> solver is faster than <code>bdf</code> for the <code>foodweb</code> problem, but slightly slower for the other problems.</p>
<h3 id="bdf--diffsl"><a class="header" href="#bdf--diffsl">Bdf + DiffSl</a></h3>
<p><img src="benchmarks/./images/benchmarks/bench_bdf_diffsl.svg" alt="Bdf + DiffSl" /></p>
<p>The main difference between this plot and the previous for the Bdf solver is the use of the DiffSl language for the equations, rather than Rust closures.
The trends in each case are mostly the same, and the DiffSl implementation only has a small slowdown comparared with rust closures for most problems. For some problems, such as <code>foodweb</code>, the DiffSl implementation is actually faster than the Rust closure implementation.
This may be due to the fact that the rust closures bound-check the array indexing, while the DiffSl implementation does not.</p>
<p>This plot demonstrates that a DiffSL implementation can be comparable in speed to a hand-written Rust or C implementation, but much more easily wrapped and used from a high-level language like Python or R, where the equations can be passed down
to the rust solver as a simple string and then JIT compiled at runtime.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python-diffrax--casadi"><a class="header" href="#python-diffrax--casadi">Python (Diffrax &amp; Casadi)</a></h1>
<p><a href="https://docs.kidger.site/diffrax/">Diffrax</a> is a Python library for solving ODEs and SDEs implemented using JAX. <a href="https://web.casadi.org/">Casadi</a> is a C++ library with Python and MATLAB bindings for solving ODE and nonlinear optimisation problems. In this benchmark we compare the performance of the DiffSol implementation with the Diffrax and Casadi libraries.</p>
<p>As well as demonstrating the performance of the DiffSol library, this benchmark also serves as an example of how to wrap and use DiffSol in other languages. The code for this benchmark can be found <a href="https://github.com/martinjrobins/diffsol_python_benchmark">here</a>. The <a href="https://www.maturin.rs/">maturin</a> library was used to generate a template for the Python bindings and the CI/CD pipeline neccessary to build the wheels ready for distribution on PyPI. The <a href="https://github.com/PyO3/pyo3">pyo3</a> library was used to wrap the DiffSol library in Python.</p>
<h2 id="problem-setup"><a class="header" href="#problem-setup">Problem setup</a></h2>
<p>We will use the <code>robertson_ode</code> problem for this benchmark. This is a stiff ODE system with 3 equations and 3 unknowns, and is a common benchmark problem. To illustrate the performance over a range of problem sizes, the Robertson equations were duplicated a factor of <code>ngroups</code>, so the total number of equations solved is <code>3 * ngroups</code>.</p>
<p>The Diffrax implementation was based this on the <a href="https://docs.kidger.site/diffrax/examples/stiff_ode/">example</a> in the Diffrax documentation, which was further extending to include the <code>ngroups</code> parameter. As is already used in the example, the <code>Kvaerno5</code> method was used for the solver. You can see the final implementation of the model <a href="https://github.com/martinjrobins/diffsol_python_benchmark/blob/main/diffsol_python_benchmark/diffrax_models.py">here</a>.</p>
<p>The Casadi implementation was written from scratch using Casadi's python API. You can see the final implementation of the model <a href="https://github.com/martinjrobins/diffsol_python_benchmark/blob/main/diffsol_python_benchmark/casadi_models.py">here</a>.</p>
<p>The DiffSol implementation of the model written using the DiffSL language, you can see the final implementation of the model <a href="https://github.com/martinjrobins/diffsol_python_benchmark/blob/main/diffsol_python_benchmark/diffsol_models.py">here</a>.</p>
<p>The full implementation of the benchmark presented below can be seen <a href="https://github.com/martinjrobins/diffsol_python_benchmark/blob/main/bench/bench.py">here</a>. The DiffSol benchmark is performed using the <code>bdf</code> solver. For <code>ngroup</code> &lt; 20 it uses the <code>nalgebra</code> dense matrix and LU solver, and for <code>ngroups</code> &gt;= 20 the <code>faer</code> sparse matrix and LU solver are used.</p>
<h2 id="differences-between-implementations"><a class="header" href="#differences-between-implementations">Differences between implementations</a></h2>
<p>There are a few key differences between the Diffrax, Casadi and DiffSol implementations that may affect the performance of the solvers. The main differences are:</p>
<ul>
<li>The Casadi implementation uses sparse matrices, whereas the DiffSol implementation uses dense matrices for <code>ngroups</code> &lt; 20, and sparse matrices for <code>ngroups</code> &gt;= 20. This will provide an advantage for DiffSol for smaller problems.</li>
<li>I'm unsure if the Diffrax implementation uses sparse or dense matrices, but it is most likely dense as JAX only has experimental support for sparse matrices. Treating the Jacobian as dense will be a disadvantage for Diffrax for larger problems as the Jacobian is very sparse.</li>
<li>The Diffrax implementation uses the <code>Kvaerno5</code> method (a 5th order implicit Runge-Kutta method). This is different from the BDF method used by both the Casadi and DiffSol implementations.</li>
<li>Each library was allowed to use multiple threads according to their default settings. The only part of the DiffSol implementation that takes advantage of multiple threads is the <code>faer</code> sparse LU solver and matrix. Both the <code>nalgebra</code> LU solver, matrix, and the DiffSL generated code are all single-threaded. Diffrax uses JAX, which takes advantage of multiple threads (CPU only, no GPUs were used in these benchmarks). The Casadi implementation also uses multiple threads.</li>
</ul>
<h2 id="results-1"><a class="header" href="#results-1">Results</a></h2>
<p>The benchmarks were run on a Dell PowerEdge R7525 2U rack server, with dual AMD EPYC 7343 3.2Ghz 16C CPU and 128GB Memory. Each benchmark was run using both a low (1e-8) and high (1e-4) tolerances for both <code>rtol</code> and <code>atol</code>, and with <code>ngroup</code> ranging between 1 - 10,000. The results are presented in the following graph, where the x-axis is the size of the problem <code>ngroup</code> and the y-axis is the time taken to solve the problem relative to the time taken by the DiffSol implementation (so <code>10^0</code> is the same time as DiffSol, <code>10^1</code> is 10 times slower etc.).</p>
<p><img src="benchmarks/./images/python_plot.svg" alt="Python" /></p>
<p>DiffSol is faster than both the Casadi and Diffrax implementations over the range of problem sizes and tolerances tested, although the Casadi and DiffSol implementations converge to be similar for larger problems (<code>ngroups</code> &gt; 100).</p>
<p>The DiffSol implementation outperforms the other implementations significantly for small problem sizes (<code>ngroups</code> &lt; 5). E.g. at <code>ngroups</code> = 1, Casadi and Diffrax are between 3 - 40 times slower than DiffSol. At these small problem sizes, the dense matrix and solver used by DiffSol provide an advantage over the sparse solver used by Casadi. Casadi also has additional overhead to evaluate each function evaluation, as it needs to traverse a graph of operations to calculate each rhs or jacobian evaluation, whereas the DiffSL JIT compiler will compile to native code using the LLVM backend, along with low-level optimisations that are not available to Casadi. Diffrax is also significantly slower than DiffSol for smaller problems, this might be due to (a) Diffrax being a ML library and not optimised for solving stiff ODEs, or (b) double precision is used, which again is not a common use case for ML libraries, or (c) perhaps the different solver methods (Kvaerno5 vs BDF) are causing the difference.</p>
<p>As the problem sizes get larger, the performance of Diffrax and Casadi improve rapidly relative to DiffSol, but after <code>ngroups</code> &gt; 10 the performance of Diffrax drops off again, probably due to JAX not taking advantage of the sparse structure of the problem. The performance of Casadi continues to improve, and for <code>ngroups</code> &gt; 100 it is comparable to DiffSol. By the time <code>ngroups</code> = 10,000, the performance of Casadi is identical to DiffSol.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
